name: Deploy Frontend (Simple)

on:
  # Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾ Ð´Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐµÐºÑ€ÐµÑ‚Ð¾Ð²
  # push:
  #   branches: ["main"]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check deployment secrets
        id: check-secrets
        run: |
          if [ -z "${{ secrets.HOST }}" ] || [ -z "${{ secrets.USERNAME }}" ] || [ -z "${{ secrets.PRIVATE_KEY }}" ]; then
            echo "âš ï¸ Deployment secrets not configured. Skipping deployment."
            echo "ðŸ“‹ Configure HOST, USERNAME, and PRIVATE_KEY secrets to enable deployment."
            echo "should_deploy=false" >> $GITHUB_OUTPUT
          else
            echo "âœ… Deployment secrets configured. Proceeding..."
            echo "should_deploy=true" >> $GITHUB_OUTPUT
          fi

      - name: Deploy via SSH
        if: steps.check-secrets.outputs.should_deploy == 'true'
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.PRIVATE_KEY }}
          port: ${{ secrets.PORT || '22' }}
          script_stop: true
          script: |
            set -e
            cd /var/www/frontend_axenta
            git fetch --all --prune
            git pull origin main
            npm install
            npm run build
            sudo systemctl reload nginx
