# GitHub Secrets Setup Guide

## Обязательные секреты для развертывания

Для корректной работы GitHub Actions необходимо настроить следующие секреты в репозитории:

### 1. HOST
- **Описание**: IP-адрес или доменное имя вашего сервера
- **Пример**: `192.168.1.100` или `your-domain.com`
- **Как получить**: Узнайте у администратора сервера или хостинг-провайдера

### 2. USERNAME  
- **Описание**: Имя пользователя для SSH подключения
- **Пример**: `root`, `ubuntu`, `deploy`
- **Как получить**: Обычно предоставляется администратором сервера

### 3. PRIVATE_KEY
- **Описание**: Приватный SSH ключ для подключения к серверу
- **Формат**: Полный текст приватного ключа, включая заголовки
- **Пример**:
```
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAAAFwAAAAdzc2gtcn
...
-----END OPENSSH PRIVATE KEY-----
```

### 4. PORT (опционально)
- **Описание**: Порт SSH (по умолчанию 22)
- **Пример**: `22`, `2222`
- **По умолчанию**: Если не указан, используется порт 22

## Как настроить секреты в GitHub

1. Перейдите в ваш репозиторий на GitHub
2. Откройте **Settings** → **Secrets and variables** → **Actions**
3. Нажмите **New repository secret**
4. Введите имя секрета (HOST, USERNAME, PRIVATE_KEY, PORT)
5. Вставьте соответствующее значение
6. Нажмите **Add secret**

## Генерация SSH ключей

Если у вас нет SSH ключей, создайте их:

```bash
# Генерация нового SSH ключа
ssh-keygen -t ed25519 -C "deploy@frontend-axenta"

# Или для старых систем
ssh-keygen -t rsa -b 4096 -C "deploy@frontend-axenta"
```

### Добавление публичного ключа на сервер

```bash
# Скопируйте публичный ключ на сервер
ssh-copy-id -i ~/.ssh/id_ed25519.pub username@your-server-host

# Или добавьте вручную в ~/.ssh/authorized_keys
cat ~/.ssh/id_ed25519.pub >> ~/.ssh/authorized_keys
```

## Проверка подключения

Проверьте SSH подключение локально:

```bash
ssh -i ~/.ssh/id_ed25519 username@your-server-host
```

## Требования к серверу

Убедитесь, что на сервере:

1. **Установлен Git**:
```bash
git --version
```

2. **Установлен Node.js и npm**:
```bash
node --version
npm --version
```

3. **Настроен nginx**:
```bash
sudo systemctl status nginx
```

4. **Существует директория проекта**:
```bash
ls -la /var/www/frontend_axenta
```

5. **Настроены права доступа**:
```bash
# Пользователь должен иметь права на запись в директорию
sudo chown -R username:username /var/www/frontend_axenta

# И права на перезагрузку nginx
sudo visudo
# Добавьте строку: username ALL=(ALL) NOPASSWD: /bin/systemctl reload nginx
```

## Безопасность

- ✅ Используйте отдельного пользователя для развертывания
- ✅ Ограничьте права пользователя только необходимыми действиями
- ✅ Регулярно обновляйте SSH ключи
- ✅ Используйте сильные пароли и двухфакторную аутентификацию
- ❌ Никогда не публикуйте приватные ключи в коде

## Отладка

Если развертывание не работает, проверьте:

1. **Секреты настроены корректно**
2. **SSH подключение работает локально**
3. **Пользователь имеет необходимые права**
4. **Сервер доступен по указанному адресу**
5. **Порт SSH открыт в файрволе**

## Workflow файлы

В репозитории доступны следующие workflow файлы:

- `main.yml` - Основной workflow с расширенным логированием
- `deploy.yml` - Простой workflow для быстрого развертывания  
- `deploy-safe.yml` - Безопасный workflow с дополнительными проверками
- `deploy-production.yml` - Продакшн workflow с валидацией и бэкапами

Выберите подходящий для ваших нужд или используйте `deploy-production.yml` для максимальной надежности.
