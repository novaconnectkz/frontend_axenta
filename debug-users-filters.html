<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - Axenta CRM</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f7;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .debug-section {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .debug-section:last-child {
            border-bottom: none;
        }
        
        .debug-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .debug-info {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        
        .debug-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #5a6fd8;
        }
        
        .status-ok {
            color: #2e7d32;
            font-weight: 600;
        }
        
        .status-error {
            color: #c62828;
            font-weight: 600;
        }
        
        .status-warning {
            color: #f57c00;
            font-weight: 600;
        }
        
        .filter-test {
            background: #fff3e0;
            border: 1px solid #ffb74d;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .filter-test h4 {
            margin: 0 0 10px 0;
            color: #e65100;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        
        .test-success {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
        
        .test-error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }
        
        .test-warning {
            background: #fff8e1;
            border: 1px solid #ff9800;
            color: #f57c00;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç –û—Ç–ª–∞–¥–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
            <p>–î–µ—Ç–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤–æ –≤–∫–ª–∞–¥–∫–µ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"</p>
        </div>

        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <div class="debug-section">
            <div class="debug-title">1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</div>
            <div class="debug-controls">
                <button onclick="checkAuth()">üîê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</button>
                <button onclick="clearAuth()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω—ã</button>
            </div>
            <div class="debug-info" id="authInfo">–ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é" –¥–ª—è –Ω–∞—á–∞–ª–∞</div>
        </div>

        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoints -->
        <div class="debug-section">
            <div class="debug-title">2. –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoints</div>
            <div class="debug-controls">
                <button onclick="testUsersEndpoint()">üë• –¢–µ—Å—Ç /users/</button>
                <button onclick="testRolesEndpoint()">üé≠ –¢–µ—Å—Ç /roles/</button>
                <button onclick="testStatsEndpoint()">üìä –¢–µ—Å—Ç /users/stats/</button>
            </div>
            <div class="debug-info" id="apiInfo">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API endpoints</div>
        </div>

        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <div class="debug-section">
            <div class="debug-title">3. –î–µ—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤</div>
            
            <div class="filter-test">
                <h4>üîç –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞</h4>
                <div class="debug-controls">
                    <button onclick="testSearchFilter('admin')">–ü–æ–∏—Å–∫ "admin"</button>
                    <button onclick="testSearchFilter('test@example.com')">–ü–æ–∏—Å–∫ "test@example.com"</button>
                    <button onclick="testSearchFilter('–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π')">–ü–æ–∏—Å–∫ "–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π"</button>
                </div>
                <div id="searchTestResults"></div>
            </div>

            <div class="filter-test">
                <h4>üé≠ –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ —Ä–æ–ª–µ–π</h4>
                <div class="debug-controls">
                    <button onclick="testRoleFilter('admin')">–†–æ–ª—å "admin"</button>
                    <button onclick="testRoleFilter('manager')">–†–æ–ª—å "manager"</button>
                    <button onclick="testRoleFilter('user')">–†–æ–ª—å "user"</button>
                    <button onclick="testRoleFilter('–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è')">–†–æ–ª—å "–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è"</button>
                </div>
                <div id="roleTestResults"></div>
            </div>

            <div class="filter-test">
                <h4>‚úÖ –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞</h4>
                <div class="debug-controls">
                    <button onclick="testStatusFilter('true')">–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                    <button onclick="testStatusFilter('false')">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                </div>
                <div id="statusTestResults"></div>
            </div>

            <div class="filter-test">
                <h4>üîó –¢–µ—Å—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤</h4>
                <div class="debug-controls">
                    <button onclick="testCombinedFilter('admin', 'admin', 'true')">admin + admin + –∞–∫—Ç–∏–≤–Ω—ã–µ</button>
                    <button onclick="testCombinedFilter('test', 'manager', 'false')">test + manager + –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</button>
                </div>
                <div id="combinedTestResults"></div>
            </div>
        </div>

        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞ -->
        <div class="debug-section">
            <div class="debug-title">4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞</div>
            <div class="debug-controls">
                <button onclick="testDebounceTiming()">‚è±Ô∏è –¢–µ—Å—Ç —Ç–∞–π–º–∏–Ω–≥–∞ –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞</button>
                <button onclick="simulateFastTyping()">‚å®Ô∏è –°–∏–º—É–ª—è—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–≤–æ–¥–∞</button>
            </div>
            <div class="debug-info" id="debounceInfo">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞</div>
        </div>

        <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π -->
        <div class="debug-section">
            <div class="debug-title">5. –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</div>
            <div class="debug-controls">
                <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
                <button onclick="exportLog()">üì• –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–∞</button>
            </div>
            <div class="debug-info" id="eventLog">–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å...</div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let authToken = null;
        let companyId = null;
        let eventLog = [];

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
        const API_BASE_URL = 'https://api.axenta.cloud/api';

        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            eventLog.push(logEntry);
            
            const logElement = document.getElementById('eventLog');
            logElement.textContent = eventLog.join('\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(logEntry);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function checkAuth() {
            log('üîê –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
            
            authToken = localStorage.getItem('axenta_token');
            companyId = localStorage.getItem('axenta_company');
            
            let authInfo = '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:\n\n';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
            if (authToken) {
                authInfo += `‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω: ${authToken.substring(0, 20)}... (${authToken.length} —Å–∏–º–≤–æ–ª–æ–≤)\n`;
                log(`–¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω: ${authToken.length} —Å–∏–º–≤–æ–ª–æ–≤`, 'success');
            } else {
                authInfo += `‚ùå –¢–æ–∫–µ–Ω –ù–ï –Ω–∞–π–¥–µ–Ω –≤ localStorage\n`;
                log('–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage', 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–∞–Ω–∏–∏
            if (companyId) {
                try {
                    const companyData = JSON.parse(companyId);
                    authInfo += `‚úÖ –ö–æ–º–ø–∞–Ω–∏—è –Ω–∞–π–¥–µ–Ω–∞: ${companyData.name || companyData.id}\n`;
                    log(`–ö–æ–º–ø–∞–Ω–∏—è: ${companyData.name || companyData.id}`, 'success');
                } catch (e) {
                    authInfo += `‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–∏: ${e.message}\n`;
                    log(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–æ–º–ø–∞–Ω–∏–∏: ${e.message}`, 'warning');
                }
            } else {
                authInfo += `‚ùå –ö–æ–º–ø–∞–Ω–∏—è –ù–ï –Ω–∞–π–¥–µ–Ω–∞ –≤ localStorage\n`;
                log('–ö–æ–º–ø–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ localStorage', 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const user = localStorage.getItem('axenta_user');
            if (user) {
                try {
                    const userData = JSON.parse(user);
                    authInfo += `‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userData.username || userData.email}\n`;
                    log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userData.username || userData.email}`, 'success');
                } catch (e) {
                    authInfo += `‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${e.message}\n`;
                    log(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${e.message}`, 'warning');
                }
            } else {
                authInfo += `‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –Ω–∞–π–¥–µ–Ω –≤ localStorage\n`;
                log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ localStorage', 'error');
            }
            
            document.getElementById('authInfo').textContent = authInfo;
        }

        // –û—á–∏—Å—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function clearAuth() {
            localStorage.removeItem('axenta_token');
            localStorage.removeItem('axenta_company');
            localStorage.removeItem('axenta_user');
            authToken = null;
            companyId = null;
            log('üóëÔ∏è –í—Å–µ —Ç–æ–∫–µ–Ω—ã –æ—á–∏—â–µ–Ω—ã', 'warning');
            document.getElementById('authInfo').textContent = '–í—Å–µ —Ç–æ–∫–µ–Ω—ã –æ—á–∏—â–µ–Ω—ã. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è API –∑–∞–ø—Ä–æ—Å–∞
        async function makeApiRequest(endpoint, params = {}) {
            const url = new URL(endpoint, API_BASE_URL);
            Object.keys(params).forEach(key => {
                if (params[key] !== undefined && params[key] !== null && params[key] !== '') {
                    url.searchParams.append(key, params[key]);
                }
            });

            const headers = {
                'Content-Type': 'application/json',
            };

            if (authToken) {
                headers['Authorization'] = `Token ${authToken}`;
                headers['authorization'] = `Token ${authToken}`;
            }

            if (companyId) {
                try {
                    const companyData = JSON.parse(companyId);
                    headers['X-Tenant-ID'] = companyData.id;
                } catch (e) {
                    log(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ companyId: ${e.message}`, 'warning');
                }
            }

            log(`üì° API –∑–∞–ø—Ä–æ—Å: ${url.toString()}`);
            log(`üì° Headers: ${JSON.stringify(headers, null, 2)}`);
            log(`üì° Params: ${JSON.stringify(params, null, 2)}`);

            try {
                const response = await fetch(url.toString(), {
                    method: 'GET',
                    headers: headers,
                });

                const data = await response.json();
                
                log(`üì° API –æ—Ç–≤–µ—Ç: ${response.status} ${response.statusText}`);
                log(`üì° –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(data, null, 2)}`);

                return {
                    success: response.ok,
                    status: response.status,
                    data: data
                };
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ API –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        // –¢–µ—Å—Ç endpoint –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function testUsersEndpoint() {
            log('üë• –¢–µ—Å—Ç–∏—Ä—É–µ–º endpoint /users/...');
            
            const result = await makeApiRequest('/users/', {
                page: 1,
                limit: 5
            });
            
            let info = '–¢–µ—Å—Ç endpoint /users/:\n\n';
            
            if (result.success && result.data.status === 'success') {
                const users = result.data.data.items || [];
                info += `‚úÖ –£—Å–ø–µ—à–Ω–æ! –ü–æ–ª—É—á–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n`;
                info += `üìä –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${result.data.data.total}\n`;
                info += `üìÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞: ${result.data.data.page}/${result.data.data.pages}\n\n`;
                
                if (users.length > 0) {
                    info += `–ü—Ä–∏–º–µ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:\n`;
                    users.slice(0, 3).forEach((user, index) => {
                        info += `${index + 1}. ${user.username} (${user.email}) - ${user.role?.display_name || '–ë–µ–∑ —Ä–æ–ª–∏'}\n`;
                    });
                }
                
                log(`‚úÖ Endpoint /users/ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`, 'success');
            } else {
                info += `‚ùå –û—à–∏–±–∫–∞: ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}\n`;
                log(`‚ùå Endpoint /users/ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${result.error || result.data?.error}`, 'error');
            }
            
            document.getElementById('apiInfo').textContent = info;
        }

        // –¢–µ—Å—Ç endpoint —Ä–æ–ª–µ–π
        async function testRolesEndpoint() {
            log('üé≠ –¢–µ—Å—Ç–∏—Ä—É–µ–º endpoint /roles/...');
            
            const result = await makeApiRequest('/roles/', {
                page: 1,
                limit: 10,
                active_only: true
            });
            
            let info = document.getElementById('apiInfo').textContent;
            info += '\n\n–¢–µ—Å—Ç endpoint /roles/:\n\n';
            
            if (result.success && result.data.status === 'success') {
                const roles = result.data.data.items || [];
                info += `‚úÖ –£—Å–ø–µ—à–Ω–æ! –ü–æ–ª—É—á–µ–Ω–æ ${roles.length} —Ä–æ–ª–µ–π\n`;
                info += `üìä –í—Å–µ–≥–æ —Ä–æ–ª–µ–π: ${result.data.data.total}\n\n`;
                
                if (roles.length > 0) {
                    info += `–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–æ–ª–∏:\n`;
                    roles.forEach((role, index) => {
                        info += `${index + 1}. ${role.display_name} (${role.name})\n`;
                    });
                }
                
                log(`‚úÖ Endpoint /roles/ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${roles.length} —Ä–æ–ª–µ–π`, 'success');
            } else {
                info += `‚ùå –û—à–∏–±–∫–∞: ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}\n`;
                log(`‚ùå Endpoint /roles/ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${result.error || result.data?.error}`, 'error');
            }
            
            document.getElementById('apiInfo').textContent = info;
        }

        // –¢–µ—Å—Ç endpoint —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function testStatsEndpoint() {
            log('üìä –¢–µ—Å—Ç–∏—Ä—É–µ–º endpoint /users/stats/...');
            
            const result = await makeApiRequest('/users/stats/');
            
            let info = document.getElementById('apiInfo').textContent;
            info += '\n\n–¢–µ—Å—Ç endpoint /users/stats/:\n\n';
            
            if (result.success && result.data.status === 'success') {
                const stats = result.data.data;
                info += `‚úÖ –£—Å–ø–µ—à–Ω–æ! –ü–æ–ª—É—á–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n`;
                info += `üìä –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${stats.total || 0}\n`;
                info += `‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö: ${stats.active || 0}\n`;
                info += `‚ùå –ù–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö: ${stats.inactive || 0}\n`;
                info += `üîÑ –ù–µ–¥–∞–≤–Ω–∏–µ –≤—Ö–æ–¥—ã: ${stats.recent || 0}\n`;
                
                log(`‚úÖ Endpoint /users/stats/ —Ä–∞–±–æ—Ç–∞–µ—Ç`, 'success');
            } else {
                info += `‚ùå –û—à–∏–±–∫–∞: ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}\n`;
                log(`‚ùå Endpoint /users/stats/ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${result.error || result.data?.error}`, 'error');
            }
            
            document.getElementById('apiInfo').textContent = info;
        }

        // –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ–∏—Å–∫–∞
        async function testSearchFilter(searchTerm) {
            log(`üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–∏—Å–∫: "${searchTerm}"`);
            
            const result = await makeApiRequest('/users/', {
                page: 1,
                limit: 10,
                search: searchTerm
            });
            
            let resultDiv = document.getElementById('searchTestResults');
            let resultClass = 'test-error';
            let resultText = `‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ "${searchTerm}": ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
            
            if (result.success && result.data.status === 'success') {
                const users = result.data.data.items || [];
                resultClass = users.length > 0 ? 'test-success' : 'test-warning';
                resultText = `üîç –ü–æ–∏—Å–∫ "${searchTerm}": –Ω–∞–π–¥–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`;
                
                if (users.length > 0) {
                    resultText += `\n–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:`;
                    users.forEach(user => {
                        resultText += `\n- ${user.username} (${user.email})`;
                    });
                } else {
                    resultText += `\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`;
                }
                
                log(`‚úÖ –ü–æ–∏—Å–∫ "${searchTerm}": ${users.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`, 'success');
            } else {
                log(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ "${searchTerm}": ${result.error || result.data?.error}`, 'error');
            }
            
            resultDiv.innerHTML = `<div class="test-result ${resultClass}">${resultText}</div>`;
        }

        // –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ —Ä–æ–ª–µ–π
        async function testRoleFilter(roleName) {
            log(`üé≠ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä —Ä–æ–ª–∏: "${roleName}"`);
            
            const result = await makeApiRequest('/users/', {
                page: 1,
                limit: 10,
                role: roleName
            });
            
            let resultDiv = document.getElementById('roleTestResults');
            let resultClass = 'test-error';
            let resultText = `‚ùå –û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ —Ä–æ–ª–∏ "${roleName}": ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
            
            if (result.success && result.data.status === 'success') {
                const users = result.data.data.items || [];
                resultClass = users.length > 0 ? 'test-success' : 'test-warning';
                resultText = `üé≠ –§–∏–ª—å—Ç—Ä —Ä–æ–ª–∏ "${roleName}": –Ω–∞–π–¥–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`;
                
                if (users.length > 0) {
                    resultText += `\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é "${roleName}":`;
                    users.forEach(user => {
                        resultText += `\n- ${user.username} (${user.role?.display_name || '–ë–µ–∑ —Ä–æ–ª–∏'})`;
                    });
                } else {
                    resultText += `\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é "${roleName}" –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`;
                }
                
                log(`‚úÖ –§–∏–ª—å—Ç—Ä —Ä–æ–ª–∏ "${roleName}": ${users.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`, 'success');
            } else {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ —Ä–æ–ª–∏ "${roleName}": ${result.error || result.data?.error}`, 'error');
            }
            
            resultDiv.innerHTML = `<div class="test-result ${resultClass}">${resultText}</div>`;
        }

        // –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞
        async function testStatusFilter(status) {
            const statusText = status === 'true' ? '–∞–∫—Ç–∏–≤–Ω—ã–µ' : '–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ';
            log(`‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞: ${statusText}`);
            
            const result = await makeApiRequest('/users/', {
                page: 1,
                limit: 10,
                active: status
            });
            
            let resultDiv = document.getElementById('statusTestResults');
            let resultClass = 'test-error';
            let resultText = `‚ùå –û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞ "${statusText}": ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
            
            if (result.success && result.data.status === 'success') {
                const users = result.data.data.items || [];
                resultClass = users.length > 0 ? 'test-success' : 'test-warning';
                resultText = `‚úÖ –§–∏–ª—å—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ "${statusText}": –Ω–∞–π–¥–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`;
                
                if (users.length > 0) {
                    resultText += `\n${statusText.charAt(0).toUpperCase() + statusText.slice(1)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:`;
                    users.forEach(user => {
                        resultText += `\n- ${user.username} (–∞–∫—Ç–∏–≤–µ–Ω: ${user.is_active})`;
                    });
                } else {
                    resultText += `\n${statusText.charAt(0).toUpperCase() + statusText.slice(1)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã`;
                }
                
                log(`‚úÖ –§–∏–ª—å—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞ "${statusText}": ${users.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`, 'success');
            } else {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞ —Å—Ç–∞—Ç—É—Å–∞ "${statusText}": ${result.error || result.data?.error}`, 'error');
            }
            
            resultDiv.innerHTML = `<div class="test-result ${resultClass}">${resultText}</div>`;
        }

        // –¢–µ—Å—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        async function testCombinedFilter(search, role, status) {
            log(`üîó –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã: –ø–æ–∏—Å–∫="${search}", —Ä–æ–ª—å="${role}", —Å—Ç–∞—Ç—É—Å="${status}"`);
            
            const params = {
                page: 1,
                limit: 10
            };
            
            if (search) params.search = search;
            if (role) params.role = role;
            if (status) params.active = status;
            
            const result = await makeApiRequest('/users/', params);
            
            let resultDiv = document.getElementById('combinedTestResults');
            let resultClass = 'test-error';
            let resultText = `‚ùå –û—à–∏–±–∫–∞ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤: ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
            
            if (result.success && result.data.status === 'success') {
                const users = result.data.data.items || [];
                resultClass = users.length > 0 ? 'test-success' : 'test-warning';
                resultText = `üîó –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã: –Ω–∞–π–¥–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`;
                resultText += `\n–§–∏–ª—å—Ç—Ä—ã: –ø–æ–∏—Å–∫="${search}", —Ä–æ–ª—å="${role}", —Å—Ç–∞—Ç—É—Å="${status}"`;
                
                if (users.length > 0) {
                    resultText += `\n–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:`;
                    users.forEach(user => {
                        resultText += `\n- ${user.username} (${user.email}) - ${user.role?.display_name || '–ë–µ–∑ —Ä–æ–ª–∏'} - –∞–∫—Ç–∏–≤–µ–Ω: ${user.is_active}`;
                    });
                } else {
                    resultText += `\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏`;
                }
                
                log(`‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã: ${users.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`, 'success');
            } else {
                log(`‚ùå –û—à–∏–±–∫–∞ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤: ${result.error || result.data?.error}`, 'error');
            }
            
            resultDiv.innerHTML = `<div class="test-result ${resultClass}">${resultText}</div>`;
        }

        // –¢–µ—Å—Ç –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞
        async function testDebounceTiming() {
            log('‚è±Ô∏è –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç–∞–π–º–∏–Ω–≥ –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞...');
            
            const startTime = Date.now();
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
            let searchCount = 0;
            const searchPromises = [];
            
            for (let i = 1; i <= 5; i++) {
                setTimeout(() => {
                    searchCount++;
                    log(`üîç –ü–æ–∏—Å–∫ #${searchCount}: "test${i}" (—á–µ—Ä–µ–∑ ${Date.now() - startTime}–º—Å)`);
                    
                    const promise = makeApiRequest('/users/', {
                        page: 1,
                        limit: 5,
                        search: `test${i}`
                    }).then(result => {
                        const endTime = Date.now();
                        log(`‚úÖ –ü–æ–∏—Å–∫ #${searchCount} –∑–∞–≤–µ—Ä—à–µ–Ω —á–µ—Ä–µ–∑ ${endTime - startTime}–º—Å`);
                        return result;
                    });
                    
                    searchPromises.push(promise);
                }, i * 100); // –ö–∞–∂–¥—ã–µ 100–º—Å
            }
            
            // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–∏—Å–∫–æ–≤
            setTimeout(async () => {
                try {
                    await Promise.all(searchPromises);
                    const totalTime = Date.now() - startTime;
                    log(`‚úÖ –í—Å–µ –ø–æ–∏—Å–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã –∑–∞ ${totalTime}–º—Å`);
                    
                    document.getElementById('debounceInfo').textContent = 
                        `–¢–µ—Å—Ç –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω:\n` +
                        `‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è: ${totalTime}–º—Å\n` +
                        `üîç –í—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–∏—Å–∫–æ–≤: ${searchCount}\n` +
                        `üìä –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ –ø–æ–∏—Å–∫: ${Math.round(totalTime / searchCount)}–º—Å\n\n` +
                        `–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –ø–æ–∏—Å–∫–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 500–º—Å –º–µ–∂–¥—É –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏`;
                } catch (error) {
                    log(`‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–µ –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞: ${error.message}`, 'error');
                }
            }, 1000);
        }

        // –°–∏–º—É–ª—è—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–≤–æ–¥–∞
        function simulateFastTyping() {
            log('‚å®Ô∏è –°–∏–º—É–ª–∏—Ä—É–µ–º –±—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥...');
            
            const testText = 'admin';
            let currentText = '';
            let requestCount = 0;
            
            document.getElementById('debounceInfo').textContent = '–°–∏–º—É–ª—è—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–≤–æ–¥–∞...\n';
            
            // –°–∏–º—É–ª–∏—Ä—É–µ–º –≤–≤–æ–¥ –ø–æ —Å–∏–º–≤–æ–ª–∞–º
            for (let i = 0; i <= testText.length; i++) {
                setTimeout(() => {
                    currentText = testText.substring(0, i);
                    requestCount++;
                    
                    log(`‚å®Ô∏è –°–∏–º–≤–æ–ª ${i}: "${currentText}"`);
                    
                    // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥
                    setTimeout(() => {
                        log(`üîç –î–µ–±–∞—É–Ω—Å–∏–Ω–≥ —Å—Ä–∞–±–æ—Ç–∞–ª –¥–ª—è: "${currentText}"`);
                        makeApiRequest('/users/', {
                            page: 1,
                            limit: 5,
                            search: currentText
                        }).then(result => {
                            if (result.success) {
                                log(`‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è "${currentText}": ${result.data.data.items?.length || 0} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
                            }
                        });
                    }, 500); // –î–µ–±–∞—É–Ω—Å–∏–Ω–≥ 500–º—Å
                    
                    if (i === testText.length) {
                        setTimeout(() => {
                            document.getElementById('debounceInfo').textContent = 
                                `–°–∏–º—É–ª—è—Ü–∏—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–≤–æ–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞:\n` +
                                `‚å®Ô∏è –í–≤–µ–¥–µ–Ω–æ —Å–∏–º–≤–æ–ª–æ–≤: ${testText.length}\n` +
                                `üîç –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–ø—Ä–æ—Å–æ–≤: ${requestCount}\n` +
                                `‚è±Ô∏è –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ 500–º—Å –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–≤–æ–¥–∞`;
                        }, 1000);
                    }
                }, i * 50); // –ö–∞–∂–¥—ã–µ 50–º—Å –Ω–æ–≤—ã–π —Å–∏–º–≤–æ–ª
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞
        function clearLog() {
            eventLog = [];
            document.getElementById('eventLog').textContent = '–õ–æ–≥ –æ—á–∏—â–µ–Ω';
            log('üóëÔ∏è –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π –æ—á–∏—â–µ–Ω');
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–∞
        function exportLog() {
            const logContent = eventLog.join('\n');
            const blob = new Blob([logContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `users-filters-debug-${new Date().toISOString().slice(0, 19)}.log`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            log('üì• –õ–æ–≥ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ —Ñ–∞–π–ª');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–ª–∞–¥–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            log('üìù –î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é"');
        });
    </script>
</body>
</html>
