# Введение | Wialon для разработчиков | Справочный центр

Сохранено 1/13/2026

Содержание

# Введение

В этой документации содержится информация, необходимая для разработки собственных приложений, интегрированных с Wialon.

Для запросов используется только метод POST. Дополнительные параметры (params) отправляются и возвращаются в виде JSON. Для всех текстовых параметров должна использоваться кодировка UTF-8.

Рекомендуется использовать формат DEC, поскольку HEX поддерживается только как текстовый формат.

Для Wialon Hosting в запросах используется хост https://hst-api.wialon.com/ (https://hst-api.wialon.us, https://hst-api.wialon.eu, https://hst-api.wialon.org — в зависимости от дата-центра), для Wialon Local — URL [сайта мониторинга](https://help.wialon.com/ru/wialon-local/2504/user-guide/administration-system/wialon/sites).

## Шаблон запроса

Шаблон любого запроса должен выглядеть так:

https://{host}/wialon/ajax.html?sid=&lt;text&gt;&svc=&lt;svc&gt;&params={&lt;params&gt;}

В заголовке запроса необходимо указывать **Content-Type:application/x-www-form-urlencoded**.

## Параметры

В запросе должны использоваться следующие параметры:

| Название | Описание |
| --- | --- |
| sid | Уникальный идентификатор сессии. |
| svc | Название запроса. |
| params | Параметры для выполнения запроса. |

В следующих разделах описаны значения только двух параметров: **svc** и **params.**

При выполнении всех запросов идентификатор сессии (sid) является обязательным параметром. Исключение составляют запросы из раздела [token/login](https://help.wialon.com/en/api/user-guide/api-reference/token/login) и некоторые запросов из раздела [Другие методы](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods).

Длительность сессии по умолчанию при отсутствии выполняющихся запросов — 5 минут. Для поддержания сессии следует использовать постоянную отправку запроса [avl_evts](https://help.wialon.com/en/api/user-guide/api-reference/other-methods/avl_evts), например, раз в 2 секунды.

Все числа должны быть представлены в десятичной системе, в т. ч. флаги.

# Ограничения

Для обеспечения эффективной работы с системой Wialon учитывайте перечисленные ниже ограничения.

## Ограничения по логинам и сессиям

- Не более 10 неудачных попыток входа с одного IP-адреса за минуту.
- Не более 120 успешных входов в систему с одного IP-адреса за минуту.
- Не более 100 активных сессий одного пользователя с одного IP-адреса.
- Не более 1 000 действующих токенов на одного пользователя.
- Не более 1 попытки сбросить пароль в минуту.

В случае нарушения этих ограничений IP-адрес временно блокируется. Это может привести к затруднениям при входе в систему.

## Ограничения по сообщениям

- Не более 15 млн сообщений может быть выгружено во все сессии пользователя.
- Не более 15 млн сообщений может быть выгружено в течение 2 минут одним пользователем.
- Не более 500 тыс. сообщений может быть импортировано в течение 1 минуты.
- Не более 200 000 000 сообщений может быть выгружено пользователем в час.
- Не более 50 слоев сообщений.
- Не более 2 Гб сообщений по запросу.

После достижения лимита сообщения перестают выгружаться и импортироваться. Это может привести к затруднениям при выполнении отчетов, построении треков и т. п. В этом случае очистите вкладки треков, сообщений и отчетов или перезагрузите страницу, а затем попробуйте снова.

## Ограничения по отчетам

- 5 минут отводится на выполнение отчета онлайн.
- 5 минут отводится на выполнение отчета по уведомлению.
- 10 минут отводится на выполнение отчета по заданию.
- 400 000 — максимальное количество строк в отчете с учетом детализации.
- Один пользователь за час не может запросить большее количество отчетов, чем то, суммарное выполнение которого занимает более одного часа.
- На непрерывное выполнение одного или нескольких отчетов для одного пользователя с одного IP-адреса отводится 10 минут; в течение 10 минут после превышения этого ограничения запрос отчетов невозможен.

После достижения таймаута выполнение отчета принудительно прерывается, т. е. отчет не генерируется. В этом случае следует уменьшить интервал отчета, количество объектов или объем запрашиваемых данных (таблиц, графиков и т. п.).

## Другие ограничения

- В рамках одной сессии может одновременно обрабатываться не более 3 трудоемких запросов, таких как выгрузка сообщений, выполнение отчета и т. п.
- В рамках одной сессии может одновременно обрабатываться не более 10 API-запросов.
- В рамках одной сессии может одновременно производиться не более 3 трассировок карты.
- Не более 10 запросов avl_evts может быть обработано в течение 10 секунд в рамках одной сессии.
- Не более 30 запросов core/check_unique может быть обработано в течение 1 минуты.
- 200 секунд серверного времени отводится на отрисовку тайлов с одного IP-адреса.
- 120 секунд серверного времени отводится на отрисовку тайлов с одного IP на пользователя.
- 9007199254740991 — максимальное целое значение, которое может передаваться в параметре типа double без искажения. Для передачи бóльших значений рекомендуется использовать параметры типа long.

# Формат данных

В этом разделе описаны флаги, которые можно использовать в различных запросах. От использованных флагов зависит результат, возвращаемый в JSON.

Если в возвращаемом результате необходимо получить значения нескольких флагов одновременно, то в запросе необходимо указать **сумму** этих флагов. Например, если для [группы объектов](https://help.wialon.com/ru/api/user-guide/data-format/unit-groups) надо получить значения основных (значение DEC — 1) и произвольных свойств (значение DEC — 2), то в запросе следует указать значение 3.

# Сообщения

В этой главе описаны форматы всех типов сообщений. Вы можете запрашивать сообщения определенного типа с помощью флагов.

Все флаги используются только в десятичном формате (DEC).

## Типы сообщений

Доступны следующие типы сообщений:

| Флаг в HEX | Флаг в DEC | Описание |
| --- | --- | --- |
| 0x0000 | 0   | Сообщение с данными |
| 0x0100 | 256 | SMS |
| 0x0200 | 512 | Команда |
| 0x0400 | 1024 | Журнал пользователя |
| 0x0300 | 768 | Уведомление пользователя |
| 0x0500 | 1280 | Биллинговое сообщение |
| 0x0600 | 1536 | Событие |
| 0x0700 | 1792 | Обработка участка |
| 0x0800 | 2048 | Запись сервиса WDC |
| 0x0900 | 2304 | SMS от водителя |
| 0x1000 | 4096 | Запись журнала |
| 0x2000 | 8192 | Использование видео |
| 0x4000 | 16384 | Сообщение, которое вызвало срабатывание уведомления |
| 0x5000 | 20480 | Задача |

Для удаления определенных сообщений необходимо иметь следующие флаги прав доступа:

| Тип сообщения | Флаг сообщения HEX(DEC) | Флаг прав доступа HEX(DEC) |
| --- | --- | --- |
| Сообщение с данными | 0x0000(0) | 0x800000(8388608) |
| SMS | 0x0100(256) | 0x800000(8388608) |
| Команда | 0x0200(512) | 0x800000(8388608) |
| Событие | 0x0600(1536) | 0x2000000(33554432) |
| Журнал | 0x1000(4096) | 0x800(2048) |

Дополнительную информацию о флагах прав доступа смотрите в разделе [Флаги доступа](https://help.wialon.com/ru/api/user-guide/api-reference/core/check_items_billing#access-flags).

## Сообщения с данными

Флаг сообщений с данными — 0x0000.

{  
"t": &lt;uint&gt;, /\* Время сообщения (UTC). \*/  
"f": &lt;uint&gt;, /\* Флаги (см. ниже). \*/  
"tp": "ud", /\* Тип сообщения («ud» обозначает сообщение с данными). \*/  
"pos": { /\* Местоположение. \*/  
"y": &lt;double&gt;, /\* Широта. \*/  
"x": &lt;double&gt;, /\* Долгота. \*/  
"z": &lt;int&gt;, /\* Высота. \*/  
"s": &lt;uint&gt;, /\* Скорость. \*/  
"c": &lt;uint&gt;, /\* Курс. \*/  
"sc": &lt;ubyte&gt; /\* Количество спутников. \*/  
},  
"i": &lt;uint&gt;, /\* Входные данные. \*/  
"o": &lt;uint&gt;, /\* Выходные данные. \*/  
"p": { /\* Параметры. \*/  
&lt;text&gt;: &lt;double&gt;  
...  
},  
"lc": &lt;int&gt;, /\* Контрольная сумма LBS-сообщения. \*/  
"rt": &lt;uint&gt; /\* Время регистрации сообщения (UTC). \*/  
<br/>}

Флаги сообщений с данными:

| Значение в HEX | Значение в DEC | Описание |
| --- | --- | --- |
| 0x01 | 1   | Доступны данные о местоположении. |
| 0x02 | 2   | Доступна информация о входных данных. |
| 0x04 | 4   | Доступна информация о выходных данных. |
| 0x10 | 16  | Сообщение содержит бит тревоги. |
| 0x20 | 32  | Сообщение содержит информацию о коде водителя в параметре **avl_driver**. |
| 0x20000 | 131072 | Сообщение было скорректировано по LBS. |

## SMS

Флаг SMS-сообщений — 0x0100(256).

{  
"t": &lt;uint&gt;, /\* Время сообщения (UTC). \*/  
"f": &lt;uint&gt;, /\* Флаги: SMS-сообщения не имеют флагов, поэтому указывается значение 0. \*/  
"tp": "us", /\* Тип сообщения («us» обозначает SMS-сообщение). \*/  
"st": &lt;text&gt;, /\* Текст сообщения. \*/  
"mp": &lt;text&gt;, /\* Номер телефона модема. \*/  
"p": {} /\* Параметры. \*/  
}

## Команда

Флаг команд — 0x0200(512)

{  
"t": &lt;uint&gt;, /\* Время сообщения (UTC). \*/  
"f": &lt;uint&gt;, /\* Флаги: команды не имеют флагов, поэтому указывается значение 0. \*/  
"tp": "ucr", /\* Тип сообщения («ucr» обозначает команду). \*/  
"ca": &lt;text&gt;, /\* Название команды. \*/  
"cn": &lt;text&gt;, /\* Тип команды. \*/  
"cp": &lt;text&gt;, /\* Параметры команды. \*/  
"ui": &lt;uint&gt;, /\* ID пользователя. \*/  
"ln": &lt;text&gt;, /\* Название канала. \*/  
"lt": &lt;text&gt;, /\* Тип канала. \*/  
"et": &lt;uint&gt;, /\* Время выполнения. \*/  
"p": {} /\* Параметры. \*/  
}

Типы каналов описаны на странице [update_command_definition](https://help.wialon.com/en/api/user-guide/api-reference/unit/update_command_definition).

## Событие

Флаг событий — 0x0600(1536).

{  
"t": &lt;uint&gt;, /\* Время сообщения (UTC). \*/  
"f": &lt;uint&gt;, /\* Флаги (см. ниже). \*/  
"tp": "evt", /\* Тип сообщения («evt» обозначает событие). \*/  
"et": &lt;text&gt;, /\* Текст события. \*/  
"x": &lt;double&gt;, /\* Долгота. \*/  
"y": &lt;double&gt;, /\* Широта. \*/  
"p": {} /\* Параметры. \*/  
}

Флаги событий:

| Значение в HEX | Значение в DEC | Описание |
| --- | --- | --- |
| 0x0 | 0   | Простое событие. |
| 0x1 | 1   | Нарушение. |
| 0x2 | 2   | Техобслуживание или заправка. |
| 0x4 | 4   | Прохождение маршрута. |
| 0x10 | 16  | Техобслуживание. Этот флаг устанавливается в дополнение к 0x2. |
| 0x20 | 32  | Заправка. Этот флаг устанавливается в дополнение к 0x2. |

## Уведомление

Флаг уведомлений — 0x0300(768).

{  
"t": &lt;uint&gt;, /\* Время сообщения (UTC). \*/  
"f": &lt;uint&gt;, /\* Флаги: уведомления не имеют флагов, поэтому указывается значение 0. \*/  
"tp": "xx", /\* Тип сообщения. \*/  
"p": {} /\* Параметры. \*/  
}

## Биллинговые сообщения

Флаг биллинговых сообщений — 0x0500(1280).

{  
"t": &lt;uint&gt;, /\* Время сообщения (UTC). \*/  
"f": &lt;uint&gt;, /\* Флаги: 0x1 устанавливается, когда сообщение содержит биллинговую информацию. \*/  
"tp": "xx", /\* Тип сообщения. \*/  
"p": {} /\* Параметры. \*/  
}

## SMS-сообщение водителю

Флаг SMS-сообщений — 0x0900(2304).

{  
"t": &lt;uint&gt;, /\* Время сообщения (UTC). \*/  
"f": &lt;uint&gt;, /\* Флаги: 0x1 устанавливается, когда сообщение отправлено. \*/  
"tp": "xx", /\* Тип сообщения. \*/  
"p": { /\* Параметры. \*/  
"phone": &lt;text&gt;, /\* Номер телефона. \*/  
"sms_text": &lt;text&gt;, /\* Текст SMS. \*/  
"driver_name": &lt;text&gt;, /\* Имя водителя. \*/  
"driver_id": &lt;uint&gt; /\* ID водителя. \*/  
}  
}

## Журнал

Флаг записей журнала — 0x1000(4096)

{  
"t": &lt;uint&gt;, /\* Время сообщения (UTC). \*/  
"f": 4096, /\* Флаги: 4096 обозначает запись журнала. \*/  
"tp": "xx", /\* Тип сообщения. \*/  
"p": { /\* Параметры. \*/  
"user": &lt;text&gt;, /\* Имя пользователя. \*/  
"action": &lt;text&gt;, /\* Действие. \*/  
"host": &lt;text&gt;, /\* Хост. \*/  
"p1": &lt;text&gt;, /\* Параметры. \*/  
...  
}  
}

## Сообщения WLN

Сообщения WLN имеют следующий формат:

REG;time;lon;lat;speed;course;double params;int params;text params;long params;boolean params;

Внутри раздела параметры отделяются друг от друга запятыми. Пример:

REG;1466585078;30.4367027283;59.7207145691;1;273;ALT:24.0,adc1:0.0,adc2:25.57,adc3:0.0,adc4:0.0,adc5:0.0,adc6:0.0,fuel1:0.0,fuel2:170.0,fuel3:0.0,odometer:7293607.0,acc:0.0,pwr_int:0.731,pwr_ext:25.751,hdop:1.7;in13:1,,SATS:5,count1:1,count2:0,temp1:0,temp2:23,temp3:0,sats_glonass:0,sats_gps:5;soft_version:"44";;;

# Объекты

В зависимости от указанных флагов формат ответа может различаться.

На этой странице описаны флаги, которые могут быть применены к объектам, и соответствующие им части результирующего JSON, которыми они управляют. Если указано несколько флагов, их соответствующие части объединяются в единый JSON.

Все флаги используются только в DEC формате.

## Флаги объектов

К объектам могут быть применены следующие флаги:

| HEX значение | DEC значение | Описание |
| --- | --- | --- |
| 0x00000001 | 1   | [Основные свойства](#general) (базовый флаг) |
| 0x00000002 | 2   | [Пользовательские свойства](#custom) |
| 0x00000004 | 4   | [Информация о биллинге](#billing) |
| 0x00000008 | 8   | [Общие произвольные поля](#custom_fields) |
| 0x00000010 | 16  | [Изображение](#image) |
| 0x00000020 | 32  | [Сообщения](#messages) |
| 0x00000040 | 64  | [GUID](#guid) |
| 0x00000080 | 128 | [Административные произвольные поля](#admin_fields) |
| 0x00000100 | 256 | [Расширенные свойства](#advanced) |
| 0x00000200 | 512 | [Команды](#available_commands), доступные в данный момент |
| 0x00000400 | 1024 | [Последнее сообщение и местоположение](#last) |
| 0x00000800 | 2048 | Код водителя |
| 0x00001000 | 4096 | [Датчики](#sensors) |
| 0x00002000 | 8192 | [Счетчики](#counters) |
| 0x00004000 | 16384 | Маршруты |
| 0x00008000 | 32768 | [Техобслуживание](#maintenance) |
| 0x00010000 | 65536 | Журналы объекта |
| 0x00020000 | 131072 | Конфигурация объекта в отчетах: [детектор поездок и расход топлива](#trip_detector) |
| 0x00040000 | 262144 | Все остальные настройки объекта: фильтрация валидности сообщений |
| 0x00080000 | 524288 | Список всех возможных [команд](#commands) для этого объекта |
| 0x00100000 | 1048576 | [Параметры сообщений](#message) |
| 0x00200000 | 2097152 | [Состояние подключения объекта](#connection) |
| 0x00400000 | 4194304 | [Местоположение](#location) |
| 0x00800000 | 8388608 | [Свойства характеристик](#profile) |
| 0x01000000 | 16777216 | [Задачи](#tasks) |
| 0x3FFFFFFFFFFFFFFF | 4611686018427387903 | Установить все возможные флаги объекта |

## Основные свойства

Флаг основных свойств — 0x00000001.

{  
"mu": &lt;uint&gt;, /\* Система измерения:  
0 — СИ,  
1 — американская,  
2 — имперская,  
3 — метрическая с галлонами \*/  
"nm": "&lt;text&gt;", /\* Имя \*/  
"cls": &lt;uint&gt;, /\* ID суперкласса: "avl_unit" \*/  
"id": &lt;uint&gt;, /\* ID объекта \*/  
"uacl": &lt;uint&gt; /\* Права доступа пользователя к этому объекту \*/  
}

## Пользовательские свойства

Флаг пользовательских свойств — 0x00000002.

{  
"prp": { /\* Пользовательские свойства \*/  
"img_rot": "&lt;text&gt;", /\* Поворот изображений: 1 - да, 0 - нет \*/  
"monitoring_sensor_id": "&lt;text&gt;",/\* ID датчика, который будет отображаться в системе мониторинга \*/  
"motion_state_sensor_id": "&lt;text&gt;",/\* ID датчика, используемого как источник состояния движения \*/  
"sensors_colors_id": "&lt;text&gt;", /\* ID датчика, используемого как источник цвета трека \*/  
"use_sensor_color": "&lt;text&gt;", /\* Использовать цвет датчика в системе мониторинга: 1 - да, 0 - нет \*/  
<br/>/\* Используется один из параметров для выбора источника цвета трека \*/  
"sensors_colors": "&lt;text&gt;", /\* Таблица цветов для треков, окрашенных на основе значений датчика \*/  
"solid_colors": "&lt;text&gt;", /\* Однотонный цвет трека \*/  
"speed_colors": "&lt;text&gt;", /\* Таблица цветов для окрашивания треков на основе скорости \*/  
<br/>/\* Хранение последних использованных цветов \*/  
"track_sensor": "&lt;text&gt;", /\* Таблица цветов для треков, окрашенных на основе значений датчика \*/  
"track_solid": "&lt;text&gt;", /\* Однотонный цвет трека \*/  
"track_speed": "&lt;text&gt;", /\* Таблица цветов для окрашивания треков на основе скорости \*/  
<br/>"monitoring_battery_id": "&lt;text&gt;"/\* ID датчика, показывающего состояние батареи \*/  
},  
"ct": &lt;uint&gt; /\* Время создания \*/  
}

## Информация о биллинге

Флаг информации о биллинге — 0x00000004.

{  
"crt": &lt;uint&gt;, /\* ID создателя \*/  
"bact": &lt;uint&gt; /\* ID учетной записи \*/  
}

## Произвольные поля

Флаг произвольных полей — 0x00000008.

{  
"flds": { /\* Произвольные поля \*/  
"&lt;text&gt;": { /\* Порядковый номер \*/  
"id": &lt;uint&gt;, /\* ID \*/  
"n": "&lt;text&gt;", /\* Имя \*/  
"v": "&lt;text&gt;" /\* Значение \*/  
},  
...  
},  
"fldsmax": &lt;long&gt; /\* Максимальное количество произвольных полей (-1 для неограниченного) \*/  
}

## Изображение объекта

Флаг изображения объекта — 0x00000010.

{  
"uri": "&lt;text&gt;", /\* Ссылка на изображение \*/  
"ugi": &lt;uint&gt; /\* Количество изменений изображения \*/  
}

## Сообщения

Флаг сообщений — 0x00000020.

После указания этого флага вы можете получать сообщения от объекта.

## GUID

Флаг GUID — 0x00000040.

{  
"gd":&lt;text&gt; /\* GUID объекта \*/  
}

## Административные поля

Флаг административных полей — 0x00000080.

{  
"aflds": { /\* Административные поля \*/  
"&lt;text&gt;": { /\* Порядковый номер \*/  
"id": &lt;uint&gt;, /\* ID \*/  
"n": "&lt;text&gt;", /\* Имя \*/  
"v": "&lt;text&gt;" /\* Значение \*/  
}  
},  
"afldsmax": &lt;long&gt; /\* Максимальное количество административных полей (-1 для неограниченного) \*/  
}

## Расширенные свойства

Флаг расширенных свойств — 0x00000100.

{  
"uid": &lt;text&gt;, /\* Уникальный ID (устройства) \*/  
"uid2": &lt;text&gt;, /\* Второй уникальный ID (устройства) \*/  
"hw": &lt;long&gt;, /\* Тип оборудования \*/  
"ph": &lt;text&gt;, /\* Номер телефона \*/  
"ph2": &lt;text&gt;, /\* Второй номер телефона \*/  
"psw": &lt;text&gt; /\* Пароль \*/  
}

## Доступные команды

Флаг доступных команд — 0x00000200.

{  
"cmds": \[ /\* Массив команд \*/  
{  
"n": &lt;text&gt;, /\* Имя \*/  
"a": &lt;uint&gt;, /\* Уровень доступа (права доступа, которые должны быть у пользователя для выполнения этой команды) \*/  
"t": &lt;text&gt;, /\* Тип связи \*/  
"c": &lt;text&gt; /\* Тип команды \*/  
}  
\]  
}

Типы команд и связи описаны на странице [unit/update_command_definition](https://help.wialon.com/ru/api/user-guide/api-reference/unit/update_command_definition). Список флагов доступа для объектов приведен в разделах **Основное** и **Объекты и группы объектов** на странице [core/check_items_billing](https://help.wialon.com/ru/api/user-guide/api-reference/core/check_items_billing).

## Последнее сообщение и местоположение

Флаг последнего сообщения и местоположения — 0x00000400.

{  
"pos": { /\* Последнее известное местоположение \*/  
"t": &lt;uint&gt;, /\* Время (UTC) \*/  
"y": &lt;double&gt;, /\* Широта \*/  
"x": &lt;double&gt;, /\* Долгота \*/  
"z": &lt;double&gt;, /\* Высота \*/  
"s": &lt;int&gt;, /\* Скорость \*/  
"c": &lt;int&gt;, /\* Курс \*/  
"sc": &lt;int&gt; /\* Количество спутников \*/  
},  
"lmsg": { /\* Последнее известное сообщение \*/  
...  
}  
}

Формат сообщения зависит от типа сообщения. Все типы описаны на странице [messages](https://help.wialon.com/ru/api/user-guide/data-format/messages).

## Датчики

Флаг датчиков — 0x00001000.

{  
"sens": { /\* Датчики \*/  
"&lt;text&gt;": { /\* Порядковый номер датчика \*/  
"id": &lt;long&gt;, /\* ID \*/  
"n": "&lt;text&gt;", /\* Имя \*/  
"t": "&lt;text&gt;", /\* Тип \*/  
"d": "&lt;text&gt;", /\* Описание \*/  
"m": "&lt;text&gt;", /\* Единица измерения \*/  
"p": "&lt;text&gt;", /\* Параметр \*/  
"f": &lt;uint&gt;, /\* Флаги датчика \*/  
"c": "&lt;text&gt;", /\* Конфигурация \*/  
"vt": &lt;uint&gt;, /\* Тип валидации \*/  
"vs": &lt;uint&gt;, /\* ID датчика валидации \*/  
"tbl": \[ /\* Таблица расчета \*/  
{ /\* Параметры \*/  
"x": &lt;double&gt;,  
"a": &lt;double&gt;,  
"b": &lt;double&gt;  
}  
\]  
},  
...  
},  
"sens_max": &lt;long&gt; /\* Максимальное количество датчиков (-1 для неограниченного) \*/  
}

Флаги датчиков, типы датчиков и валидации, а также примеры конфигурации приведены на странице [unit/update_sensor](https://help.wialon.com/ru/api/user-guide/api-reference/unit/update_sensor).

## Счетчики

Флаг счетчиков — 0x00002000.

{  
"cfl": &lt;uint&gt;, /\* Флаги расчета \*/  
"cnm": &lt;uint&gt;, /\* Счетчик пробега, км или мили \*/  
"cneh": &lt;uint&gt;, /\* Счетчик моточасов, ч \*/  
"cnkb": &lt;uint&gt; /\* Счетчик GPRS-трафика, КБ \*/  
}

Флаги расчета описаны на странице [unit/update_calc_flags](https://help.wialon.com/ru/api/user-guide/api-reference/unit/update_calc_flags).

## Техобслуживание

Флаг интервалов техобслуживания — 0x00008000.

{  
"si": { /\* интервалы техобслуживания \*/  
"&lt;text&gt;": { /\* порядковый номер интервала техобслуживания \*/  
"id": &lt;uint&gt;, /\* ID \*/  
"n": "&lt;text&gt;", /\* имя \*/  
"t": "&lt;text&gt;", /\* описание \*/  
"im": &lt;uint&gt;, /\* интервал пробега \*/  
"it": &lt;uint&gt;, /\* интервал дней \*/  
"ie": &lt;uint&gt;, /\* интервал моточасов \*/  
"pm": &lt;uint&gt;, /\* последнее ТО по интервалу пробега, км \*/  
"pt": &lt;uint&gt;, /\* последнее ТО по интервалу дней, сек (UTC) \*/  
"pe": &lt;uint&gt;, /\* последнее ТО по интервалу моточасов, ч \*/  
"c": &lt;uint&gt; /\* количество выполненных ТО \*/  
},  
...  
},  
"simax": &lt;long&gt; /\* Максимальное количество интервалов техобслуживания (-1 для неограниченного) \*/  
}

## Детектор поездок и расход топлива

Флаг детектора поездок и расхода топлива — 0x00020000.

{  
"rtd": { /\* Детектор поездок \*/  
"type": &lt;uint&gt;, /\* Тип определения движения \*/  
"gpsCorrection": &lt;int&gt;, /\* Разрешить GPS-коррекцию: 0 - нет, 1 - да \*/  
"minSat": &lt;uint&gt;, /\* Минимальное количество спутников \*/  
"minMovingSpeed": &lt;uint&gt;, /\* Минимальная скорость движения, км/ч \*/  
"minStayTime": &lt;uint&gt;, /\* Минимальное время стоянки, секунды \*/  
"maxMessagesDistance": &lt;uint&gt;,/\* Максимальное расстояние между сообщениями, метры \*/  
"minTripTime": &lt;uint&gt;, /\* Минимальное время поездки, секунды \*/  
"minTripDistance": &lt;uint&gt; /\* Минимальное расстояние поездки, метры \*/  
},  
"rfc": { /\* Расход топлива \*/  
"calcTypes": &lt;uint&gt;, /\* Тип расчета \*/  
"fuelLevelParams": { /\* Определение заправок и сливов \*/  
"flags": &lt;uint&gt;, /\* Флаги заправок и сливов \*/  
"ignoreStayTimeout": &lt;uint&gt;, /\* Игнорировать сообщения после начала движения, с \*/  
"minFillingVolume": &lt;uint&gt;, /\* Минимальный объем заправки, литры \*/  
"minTheftTimeout": &lt;uint&gt;, /\* Минимальное время стоянки для определения слива, с \*/  
"minTheftVolume": &lt;uint&gt;, /\* Минимальный объем слива, литры \*/  
"filterQuality": &lt;ubyte&gt;, /\* Уровень фильтрации (0..255) \*/  
"fillingsJoinInterval": &lt;uint&gt;, /\* Таймаут для объединения последовательных заправок, с \*/  
"theftsJoinInterval": &lt;uint&gt;, /\* Таймаут для объединения последовательных сливов, с \*/  
"extraFillingTimeout": &lt;uint&gt; /\* Таймаут для определения конечного объема заправки, с \*/  
},  
"fuelConsMath": { /\* Математический расчет \*/  
"idling": &lt;double&gt;, /\* Холостой ход, литров в час \*/  
"urban": &lt;double&gt;, /\* Городской цикл, литров на 100 км \*/  
"suburban": &lt;double&gt; /\* Загородный цикл, литров на 100 км \*/  
},  
"fuelConsRates": { /\* Расход по нормам \*/  
"consSummer": &lt;int&gt;, /\* Летний расход, литров на 100 км \*/  
"consWinter": &lt;int&gt;, /\* Зимний расход, литров на 100 км \*/  
"winterMonthFrom": &lt;int&gt;, /\* Зима с (месяц: 0-11) \*/  
"winterDayFrom": &lt;int&gt;, /\* Зима с (день 1-31) \*/  
"winterMonthTo": &lt;int&gt;, /\* Зима по (месяц 0-11) \*/  
"winterDayTo": &lt;int&gt; /\* Зима по (день 1-31) \*/  
},  
"fuelConsImpulse": { /\* Импульсные датчики расхода топлива \*/  
"maxImpulses": &lt;int&gt;, /\* Максимальное количество импульсов \*/  
"skipZero": &lt;int&gt; /\* Пропускать первое нулевое значение \*/  
}  
}  
}

Типы определения движения описаны на странице [unit/get_trip_detector](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trip_detector). Типы расчета расхода топлива, а также флаги заправок и сливов описаны на странице [get_fuel_settings](https://help.wialon.com/en/api/user-guide/api-reference/unit/get_fuel_settings).

## Команды

Флаг команд — 0x00080000.

{  
"cml": { /\* Список команд \*/  
"&lt;text&gt;": { /\* Порядковый номер команды \*/  
"id": &lt;uint&gt;, /\* ID \*/  
"n": "&lt;text&gt;", /\* Имя \*/  
"c": "&lt;text&gt;", /\* Тип \*/  
"l": "&lt;text&gt;", /\* Тип связи \*/  
"p": "&lt;text&gt;", /\* Параметры \*/  
"a": &lt;uint&gt;, /\* Уровень доступа (права доступа, которые должны быть у пользователя для отправки этой команды) \*/  
"f": &lt;uint&gt; /\* Флаги номера телефона: 0 - любой (сначала основной, затем дополнительный), 0x1 - основной, 0x2 - дополнительный \*/  
},  
...  
},  
"cml_max": &lt;long&gt; /\* Максимальное количество команд (-1 для неограниченного) \*/  
}

Типы команд и связи описаны на странице [unit/update_command_definition](https://help.wialon.com/ru/api/user-guide/api-reference/unit/update_command_definition). Список флагов доступа для объектов приведен в разделах **Основное** и **Объекты и группы объектов** на странице [check_items_billing](https://help.wialon.com/ru/api/user-guide/api-reference/core/check_items_billing).

## Параметры сообщений

Позволяет использовать накопительную систему значений параметров сообщений. Параметры будут храниться в соответствующем разделе JSON-объекта, который будет хранить не только значения параметров из последнего сообщения, но и значения параметров из более ранних сообщений.

Флаг параметров сообщений — 0x00100000.

{  
"prms": { /\* Список параметров сообщений \*/  
"&lt;text&gt;": { /\* Имя параметра \*/  
"v": &lt;any&gt;, /\* Значение параметра \*/  
"ct": &lt;uint&gt;, /\* Время последнего изменения значения \*/  
"at": &lt;uint&gt; /\* Время последнего сообщения с этим параметром \*/  
},  
...  
}  
}

## Подключение

Флаг состояния подключения объекта — 0x00200000.

{  
"item": {  
"netconn": &lt;bool&gt;  
}  
}

## Местоположение

Флаг местоположения объекта — 0x00400000.

{  
"pos": { /\* Последнее известное местоположение \*/  
"t": &lt;uint&gt;, /\* Время (UTC) \*/  
"y": &lt;double&gt;, /\* Широта \*/  
"x": &lt;double&gt;, /\* Долгота \*/  
"z": &lt;double&gt;, /\* Высота \*/  
"s": &lt;int&gt;, /\* Скорость \*/  
"c": &lt;int&gt;, /\* Курс \*/  
"sc": &lt;int&gt; /\* Количество спутников \*/  
}  
}

## Свойства характеристик

Флаг свойств характеристик — 0x00800000.

{  
"pflds": {  
"&lt;long&gt;": { /\* ID поля \*/  
"id": &lt;long&gt;, /\* ID поля \*/  
"n": &lt;text&gt;, /\* Имя поля \*/  
"v": &lt;text&gt; /\* Значение поля \*/  
}  
}  
}

## Задачи

Флаг задач — 0x01000000.

{  
"task_sub_type": &lt;uint&gt;, /\* Подтип задачи \*/  
"task_reg_type": &lt;uint&gt;, /\* Тип регистрации \*/  
"task_evt_name": &lt;text&gt;, /\* Имя задачи \*/  
"task_id": &lt;text&gt;, /\* ID задачи \*/  
"task_update_time": &lt;int&gt;, /\* Время последнего обновления \*/  
"task_status": &lt;uint&gt;, /\* Статус задачи \*/  
"task_priority": &lt;uint&gt;, /\* Приоритет задачи \*/  
"task_assignee": &lt;long&gt;, /\* Ответственное лицо, назначенное на задачу \*/  
"task_comments": &lt;text&gt;, /\* Комментарии к задаче \*/  
"task_account": &lt;long&gt; /\* Учетная запись задачи \*/  
}

# Ресурсы

В зависимости от указанных флагов формат ответа может различаться. На этой странице описаны флаги, которые можно применять к ресурсам. Также подробно описываются части ответа, которые содержат информацию о флагах. Если указано несколько флагов, их соответствующие части объединяются в один JSON.

Все флаги используются только в десятичном формате (DEC).

## Флаги ресурсов

К ресурсам могут быть применены следующие флаги:

| Значение в HEX | Значение в DEC | Описание |
| --- | --- | --- |
| 0x00000001 | 1   | Основные свойства. |
| 0x00000002 | 2   | Пользовательские свойства. |
| 0x00000004 | 4   | Информация о биллинге. |
| 0x00000008 | 8   | Общие произвольные поля. |
| 0x00000020 | 32  | Сообщения. |
| 0x00000040 | 64  | GUID. |
| 0x00000080 | 128 | Административные произвольные поля. |
| 0x00000100 | 256 | Водители. |
| 0x00000200 | 512 | Задания. |
| 0x00000400 | 1024 | Уведомления. |
| 0x00000800 | 2048 | POI. |
| 0x00001000 | 4096 | Геозоны. |
| 0x00002000 | 8192 | Шаблоны отчетов. |
| 0x00004000 | 16384 | Список объектов, на которые водители могут быть назначены автоматически. |
| 0x00008000 | 32768 | Группы водителей. |
| 0x00010000 | 65536 | Прицепы. |
| 0x00020000 | 131072 | Группы прицепов. |
| 0x00040000 | 262144 | Список объектов, на которые прицепы могут быть назначены автоматически. |
| 0x00080000 | 524288 | Заявки. |
| 0x00100000 | 1048576 | Группы геозон. |
| 0x00200000 | 2097152 | Метки (пассажиры). |
| 0x00400000 | 4194304 | Список объектов, на которые метки (пассажиры) могут быть назначены автоматически. |
| 0x00800000 | 8388608 | Группы меток (группы пассажиров). |
| 0x3FFFFFFFFFFFFFFF | 4611686018427387903 | Установить все возможные флаги ресурсов. |

## Основные свойства

Флаг основных свойств - 0x00000001.

{  
"nm": &lt;text&gt;, /\* Имя. \*/  
"cls": &lt;uint&gt;, /\* ID базового класса: "avl_resource". \*/  
"id": &lt;uint&gt;, /\* ID ресурса. \*/  
"mu": &lt;uint&gt;, /\* Система измерений:  
0 — СИ,  
1 — американская,  
2 — имперская,  
3 — метрическая с галлонами. \*/  
"uacl": &lt;uint&gt; /\* Текущие права доступа пользователя на ресурс. \*/  
}

## Пользовательские свойства

Флаг пользовательских свойств — 0x00000002.

В произвольных свойствах можно хранить любые данные ресурса.

{  
"prp": { /\* Произвольные свойства. \*/  
"emails": "\[&lt;text&gt;\]", /\* Список email-адресов для заданий. \*/  
"nf_rep_emails": "\[&lt;text&gt;\]", /\* Список email-адресов для уведомлений. \*/  
"phones": "\[&lt;text&gt;\]" /\* Список телефонных номеров для задания "Отправка информации о топливе по email или SMS". \*/  
...  
},  
"ftp": { /\* Настройки FTP. \*/  
"hs": &lt;text&gt;, /\* Хост. \*/  
"lg": &lt;text&gt;, /\* Логин. \*/  
"pt": &lt;text&gt;, /\* Путь к директории. \*/  
"ch": &lt;uint&gt;, /\* Валидность настроек FTP: 1 — да, 0 — нет. \*/  
"tp": &lt;uint&gt;, /\* Использовать FTP Wialon Hosting: 1 — да, 0 — нет. \*/  
"fl": &lt;uint&gt; /\* Доступность FTP Wialon Hosting: 1 — да, 0 — нет. \*/  
}  
}

## Информация о биллинге

Флаг информации о биллинге — 0x00000004.

{  
"crt": &lt;uint&gt;, /\* ID создателя. \*/  
"bact": &lt;uint&gt;, /\* ID учетной записи. \*/  
"bpact": &lt;uint&gt; /\* ID родительской учетной записи\*/  
}

## Общие произвольные поля

Флаг произвольных полей — 0x00000008.

{  
"flds": { /\* Произвольные поля. \*/  
"&lt;uint&gt;": { /\* Порядковый номер. \*/  
"id": &lt;uint&gt;, /\* ID. \*/  
"n": &lt;text&gt;, /\* Имя. \*/  
"v": &lt;text&gt; /\* Значение. \*/  
},  
...  
},  
"fldsmax": &lt;long&gt; /\* Максимальное количество произвольных полей (-1 для неограниченного количества). \*/  
}

## Сообщения

Флаг сообщений — 0x00000020.

После установки этого флага вы можете получать сообщения ресурса.

{}

## GUID

Флаг GUID — 0x00000040.

{  
"gd":&lt;text&gt; /\* GUID ресурса. \*/  
}

## Административные произвольные поля

Флаг административных произвольных полей — 0x00000080.

{  
"aflds": { /\* Административные поля. \*/  
"&lt;uint&gt;": { /\* Порядковый номер. \*/  
"id": &lt;uint&gt;, /\* ID. \*/  
"n": &lt;text&gt;, /\* Имя. \*/  
"v": &lt;text&gt; /\* Значение. \*/  
},  
...  
},  
"afldsmax": &lt;long&gt; /\* Максимальное количество административных полей (-1 для неограниченного количества). \*/  
}

## Водители

Флаг водителей — 0x00000080.

{  
"drvrs": {  
&lt;text&gt;: { /\* Порядковый номер водителя. \*/  
"id": &lt;long&gt;, /\* ID. \*/  
"n": &lt;text&gt;, /\* Имя. \*/  
"c": &lt;text&gt;, /\* Код. \*/  
"pwd": &lt;text&gt;, /\* Пароль для мобильной авторизации. \*/  
"ej": &lt;text&gt;, /\* Расширенный JSON. \*/  
"jp": { /\* Произвольные поля. \*/  
&lt;text&gt;: &lt;text&gt;, /\* Имя: значение. \*/  
...  
},  
"ds": &lt;text&gt;, /\* Описание. \*/  
"p": &lt;text&gt;, /\* Номер телефона. \*/  
"r": &lt;double&gt;, /\* Соотношение сторон изображения. \*/  
"ck": &lt;ushort&gt;, /\* Контрольная сумма (CRC16). \*/  
"bu": &lt;long&gt;, /\* Назначенный объект. \*/  
"pu": &lt;long&gt;, /\* Предыдущий назначенный объект. \*/  
"bt": &lt;uint&gt;, /\* Время последнего назначения/снятия. \*/  
"pos": { /\* Местоположение. \*/  
"y": &lt;double&gt;, /\* Широта. \*/  
"x": &lt;double&gt; /\* Долгота. \*/  
},  
"infr": { /\* Параметры для анализа нарушений режима труда и отдыха водителя (ЕСТР). \*/  
"a": &lt;uint&gt;, /\* Текущая активность. \*/  
"t": &lt;uint&gt;, /\* Время начала текущей активности. \*/  
"ud": &lt;uint&gt;, /\* Длительность непрерывного вождения до текущей активности. \*/  
"ur": &lt;uint&gt;, /\* Длительность непрерывного отдыха до текущей активности. \*/  
"uil": &lt;uint&gt;, /\* Допустимая длительность непрерывного вождения. \*/  
"uim": &lt;uint&gt;, /\* Максимальная длительность непрерывного вождения для незначительного нарушения. \*/  
"uis": &lt;uint&gt;, /\* Максимальная длительность непрерывного вождения для критического нарушения. При превышении нарушение классифицируется как критическое. \*/  
"uir": &lt;uint&gt;, /\* Требуемая длительность отдыха. \*/  
"ddt": &lt;uint&gt;, /\* Время вождения за сутки до текущей активности. \*/  
"ddc": &lt;uint&gt;, /\* Количество возможных продлений суточного вождения на этой неделе. \*/  
"ddil": &lt;uint&gt;,/\* Допустимая длительность суточного вождения. \*/  
"ddim": &lt;uint&gt;,/\* Максимальная длительность суточного вождения для незначительного нарушения. \*/  
"ddis": &lt;uint&gt;,/\* Максимальная длительность суточного вождения для значительного нарушения. При превышении нарушение классифицируется как критическое. \*/  
"wdt": &lt;uint&gt;, /\* Длительность вождения за неделю до текущей активности. \*/  
"wdil": &lt;uint&gt;,/\* Допустимая длительность недельного вождения. \*/  
"wdim": &lt;uint&gt;,/\* Максимальная длительность недельного вождения для незначительного нарушения. \*/  
"wdis": &lt;uint&gt;,/\* Максимальная длительность недельного вождения для значительного нарушения. При превышении нарушение классифицируется как критическое. \*/  
"twdt": &lt;uint&gt;,/\* Длительность вождения за две недели до текущей активности. \*/  
"twdil": &lt;uint&gt;,/\* Допустимая длительность двухнедельного вождения. \*/  
"twdim": &lt;uint&gt;,/\* Максимальная длительность двухнедельного вождения для незначительного нарушения. \*/  
"twdis": &lt;uint&gt;,/\* Максимальная длительность двухнедельного вождения для значительного нарушения. При превышении нарушение классифицируется как критическое. \*/  
"drt": &lt;uint&gt;, /\* Длительность предыдущего суточного отдыха. \*/  
"drd": &lt;uint&gt;, /\* Требуемая длительность суточного отдыха. \*/  
"dril": &lt;uint&gt;, /\* Время, до которого должен быть осуществлен суточный отдых. \*/  
"drim": &lt;uint&gt;, /\* Время, до которого нарушение классифицируется как незначительное. \*/  
"dris": &lt;uint&gt;, /\* Время, до которого нарушение классифицируется как значительного. При превышении нарушение классифицируется как критическое. \*/  
"wrt": &lt;uint&gt;, /\* Длительность предыдущего недельного отдыха. \*/  
"wrd": &lt;uint&gt;, /\* Требуемая длительность недельного отдыха. \*/  
"wril": &lt;uint&gt;, /\* Время, до которого должен быть осуществлен недельный отдых. \*/  
"wrim": &lt;uint&gt;, /\* Время, до которого нарушение классифицируется как незначительное. \*/  
"wris": &lt;uint&gt; /\* Время, до которого нарушение классифицируется как значительное. При превышении нарушение классифицируется как критическое. \*/  
}  
},  
...  
},  
"drvrsmax": &lt;long&gt; /\* Максимальное количество водителей (-1 для неограниченного количества). \*/  
}

## Задания

Флаг заданий — 0x00000200.

{  
"ujb": {  
"&lt;text&gt;": { /\* Порядковый номер задания. \*/  
"id": &lt;uint&gt;, /\* ID. \*/  
"n": &lt;text&gt;, /\* Имя. \*/  
"d": &lt;text&gt;, /\* Описание. \*/  
"m": &lt;uint&gt;, /\* Максимально допустимое количество выполнений. \*/  
"st": { /\* Состояние. \*/  
"e": &lt;uint&gt;, /\* Активно (1) / Неактивно (0). \*/  
"c": &lt;uint&gt;, /\* Количество выполнений. \*/  
"l": &lt;uint&gt; /\* Время последнего выполнения (UTC). \*/  
},  
"act": &lt;text&gt; /\* Тип действия. \*/  
},  
...  
},  
"ujbmax": &lt;long&gt; /\* Максимальное количество заданий (-1 для неограниченного количества). \*/  
}

Типы действий описаны в разделе [get_job_data](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_job_data).

## Уведомления

Флаг уведомлений — 0x00000400.

{  
"unf": {  
"&lt;text&gt;": { /\* Порядковый номер уведомления. \*/  
"id": &lt;long&gt;, /\* ID уведомления. \*/  
"n": &lt;text&gt;, /\* Имя. \*/  
"ta": &lt;uint&gt;, /\* Время активации. \*/  
"td": &lt;uint&gt;, /\* Время деактивации. \*/  
"ma": &lt;uint&gt;, /\* Максимальное количество срабатываний (0 для неограниченного количества). \*/  
"fl": &lt;uint&gt;, /\* Типы уведомлений. \*/  
"ac": &lt;uint&gt;, /\* Количество срабатываний. \*/  
"un": \[&lt;long&gt;\], /\* Массив ID объектов. \*/  
"act": \[&lt;text&gt;\], /\* Список действий. \*/  
"trg": &lt;text&gt;, /\* Тип контроля.. \*/  
"crc": &lt;long&gt; /\* Контрольная сумма бинарного представления уведомления. \*/  
},  
...  
},  
"unfmax": &lt;long&gt; /\* Максимальное количество уведомлений (-1 для неограниченного количества). \*/  
}

Типы действий, типы контроля и флаги уведомлений описаны в разделе [get_notification_data](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_notification_data).

## POI

Флаг POIs — 0x00000800.

{  
"poi": {  
"&lt;text&gt;": { /\* Порядковый номер POI. \*/  
"id": &lt;long&gt;, /\* ID POI. \*/  
"n": &lt;text&gt;, /\* Имя. \*/  
"y": &lt;double&gt;, /\* Широта. \*/  
"x": &lt;double&gt;, /\* Долгота \*/  
"t": &lt;double&gt;, /\* Соотношение сторон изображения \*/  
"i": &lt;short&gt;, /\* Контрольная сумма изображения (CRC16) \*/  
"e": &lt;ushort&gt; /\* Контрольная сумма POI (CRC16) \*/  
},  
...  
},  
"poimax": &lt;long&gt; /\* Максимальное количество POI (-1 для неограниченного количества) \*/  
}

## Геозоны

Флаг геозон — 0x00001000.

{  
"zl": {  
"&lt;text&gt;": { /\* Порядковый номер геозоны. \*/  
"n": &lt;text&gt;, /\* Имя. \*/  
"d": &lt;text&gt;, /\* Описание. \*/  
"id": &lt;long&gt;, /\* ID.\*/  
"f": &lt;uint&gt;, /\* Флаги. \*/  
"t": &lt;int&gt;, /\* Тип: 1 — линия, 2 — полигон, 3 — круг. \*/  
"e": &lt;ushort&gt;, /\* Контрольная сумма (CRC16).\*/  
"b": { /\* Настройки отрисовки геозон. \*/  
"min_x": &lt;double&gt;, /\* Минимальная долгота. \*/  
"min_y": &lt;double&gt;, /\* Минимальная широта. \*/  
"max_x": &lt;double&gt;, /\* Максимальная долгота. \*/  
"max_y": &lt;double&gt;, /\* Максимальная широта. \*/  
"cen_x": &lt;double&gt;, /\* Долгота центра геозоны. \*/  
"cen_y": &lt;double&gt; /\* Широта центра геозоны. \*/  
}  
},  
...  
},  
"zlmax": &lt;long&gt; /\* Максимальное количество геозон (-1 для неограниченного количества) \*/  
}

Флаги геозон описаны в разделе [get_zone_data](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_zone_data).

## Шаблоны отчетов

Флаг шаблонов отчетов — 0x00002000.

{  
"rep": {  
&lt;text&gt;: { /\* Порядковый номер шаблона \*/  
"id": &lt;long&gt;, /\* ID шаблона \*/  
"n": &lt;text&gt;, /\* Имя шаблона \*/  
"ct": &lt;text&gt;, /\* Тип шаблона \*/  
"c": &lt;ushort&gt; /\* Контрольная сумма (CRC16) \*/  
},  
...  
},  
"repmax": &lt;long&gt; /\* Максимальное количество шаблонов (-1 для неограниченного количества) \*/  
}

Типы шаблонов описаны в разделе [get_report_data](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_report_data).

## Список объектов, на которые водители могут быть назначены автоматически

Флаг объектов, на которые водители могут быть назначены автоматически — 0x00004000.

{  
"drvrun": \[&lt;long&gt;\] /\* Массив ID объектов.\*/  
}

## Группы водителей

Флаг групп водителей — 0x00008000.

{  
"drvrsgr": { /\* Группы водителей. \*/  
&lt;text&gt;: { /\* Порядковый номер группы. \*/  
"id": &lt;long&gt;, /\* ID группы. \*/  
"n": &lt;text&gt;, /\* Имя группы. \*/  
"d": &lt;text&gt;, /\* Описание группы. \*/  
"drs": \[&lt;uint&gt;\] /\* Массив ID водителей. \*/  
},  
...  
},  
"drvrsgrmax": &lt;long&gt; /\* Максимальное количество групп водителей (-1 для неограниченного количества). \*/  
}

## Прицепы

Флаг прицепов — 0x00010000

{  
"trlrs": { /\* Прицепы. \*/  
&lt;text&gt;: { /\* Порядковый номер прицепа. \*/  
"id": &lt;long&gt;, /\* ID прицепа. \*/  
"n": &lt;text&gt;, /\* Имя прицепа. \*/  
"c": &lt;text&gt;, /\* Код прицепа. \*/  
"ej": &lt;text&gt;, /\* Расширенный JSON. \*/  
"jp": { /\* Произвольные поля. \*/  
&lt;text&gt;: &lt;text&gt;, /\* Имя: значение. \*/  
...  
},  
"ds": &lt;text&gt;, /\* Описание. \*/  
"p": &lt;text&gt;, /\* Номер телефона. \*/  
"r": &lt;double&gt;, /\* Соотношение сторон изображения. \*/  
"ck": &lt;short&gt;, /\* Контрольная сумма изображения. \*/  
"bu": &lt;long&gt;, /\* Назначенный объект. \*/  
"pu": &lt;long&gt;, /\* Предыдущий назначенный объект. \*/  
"bt": &lt;uint&gt;, /\* Время последнего назначения/снятия. \*/  
"pos": { /\* Местоположение. \*/  
"y": &lt;double&gt;, /\* Широта. \*/  
"x": &lt;double&gt; /\* Долгота. \*/  
}  
}  
},  
"trlrsmax": &lt;long&gt; /\* Максимальное количество прицепов (-1 для неограниченного количества). \*/  
}

## Группы прицепов

Флаг групп прицепов — 0x00020000.

{  
"trlrsgr": { /\* Группы прицепов. \*/  
&lt;text&gt;: { /\* Порядковый номер группы. \*/  
"id": &lt;long&gt;, /\* ID группы. \*/  
"n": &lt;text&gt;, /\* Имя группы. \*/  
"d": &lt;text&gt;, /\* Описание группы. \*/  
"drs": \[&lt;uint&gt;\] /\* Массив ID прицепов. \*/  
}  
},  
"trlrsgrmax": &lt;long&gt; /\* Максимальное количество групп прицепов (-1 для неограниченного количества). \*/  
}

## Список объектов, на которые прицепы могут быть назначены автоматически

Флаг объектов, на которые прицепы могут быть назначены автоматически — 0x00040000.

{  
"trlrun": \[&lt;long&gt;\] /\* Массив ID объектов. \*/  
}

## Заявки

Флаг заявок — 0x00080000.

{  
"orders":{  
"&lt;uint&gt;": { /\* Номер заявки, такой же как в параметре "id". \*/  
"id":&lt;uint&gt;, /\* ID заявки в ресурсе. \*/  
"n":&lt;text&gt;, /\* Имя заявки. \*/  
"p":{ /\* Пользовательское содержимое объекта. \*/  
...  
},  
"f":&lt;bool&gt;, /\* Флаги заявки: 1 — заявка будет отмечена как выполненная, если было хотя бы одно сообщение в зоне заявки с нулевой скоростью. \*/  
"tf":&lt;uint&gt;, /\* Начало интервала выполнения заявки. \*/  
"tt":&lt;uint&gt;, /\* Конец интервала выполнения заявки. \*/  
"uid":&lt;uint&gt;, /\* Уникальный id (используется как уникальный ключ в истории заявок). \*/  
"r":&lt;uint&gt;, /\* Радиус точки заявки. \*/  
"y":&lt;double&gt;, /\* Широта точки заявки. \*/  
"x":&lt;double&gt;, /\* Долгота точки заявки. \*/  
"u":&lt;long&gt;, /\* ID объекта. \*/  
"s":&lt;uint&gt;, /\* Статус заявки: 0 — неактивна (объект не назначен), 1 — активна (объект назначен), 2 — выполнена вовремя, 3 — выполнена с опозданием, 4 — отменена (не используется). \*/  
"st":&lt;uint&gt; /\* Время последнего изменения статуса. \*/  
},  
...  
}  
}

## Группы геозон

Флаг групп геозон — 0x00100000.

{  
"zg": { /\* Группы геозон. \*/  
"&lt;text&gt;": { /\* Порядковый номер группы. \*/  
"id": &lt;long&gt;, /\* ID группы. \*/  
"n": &lt;text&gt;, /\* Имя. \*/  
"d": &lt;text&gt;, /\* Описание. \*/  
"drs": \[&lt;uint&gt;\] /\* Массив ID геозон. \*/  
},  
...  
},  
"zgmax": &lt;long&gt; /\* Максимальное количество групп геозон (-1 для неограниченного количества). \*/  
}

## Метки (пассажиры)

Флаг меток (пассажиров) — 0x00200000.

{  
"item": {  
"tags": {  
"&lt;uint&gt;": { /\* ID метки. \*/  
"id": &lt;uint&gt;, /\* ID метки. \*/  
"n": &lt;text&gt;, /\* Имя метки. \*/  
"c": &lt;text&gt;, /\* Код метки. \*/  
"jp": { /\* Произвольные поля (ключ:значение). \*/  
"&lt;text&gt;": &lt;text&gt;  
},  
"r": &lt;double&gt;, /\* Соотношение сторон изображения. \*/  
"ck": &lt;ushort&gt;, /\* Контрольная сумма (CRC16). \*/  
"bu": &lt;long&gt;, /\* Назначенный объект. \*/  
"pu": &lt;long&gt;, /\* Предыдущий назначенный объект. \*/  
"bt": &lt;uint&gt;, /\* Время последнего назначения/снятия. \*/  
"tz": &lt;int&gt;, /\* Часовой пояс. \*/  
"pos": { /\* Местоположение. \*/  
"y": &lt;double&gt;, /\* Широта. \*/  
"x": &lt;double&gt; /\* Долгота. \*/  
}  
},  
...  
},  
"tagsmax": -1 /\* Максимальное количество меток (-1 для неограниченного количества). \*/  
}  
}

## Список объектов, на которые метки могут быть назначены автоматически

Флаг объектов, на которые метки могут быть назначены автоматически — 0x00400000.

{  
"tagrun":\[&lt;long&gt;\] /\* Массив ID объектов. \*/  
}

## Группы меток (группы пассажиров)

Флаг групп меток (групп пассажиров) — 0x00800000.

{  
"tagsgr": {  
&lt;long&gt;: { /\* ID группы.\*/  
"id": &lt;long&gt;, /\* ID группы.\*/  
"n": &lt;text&gt;, /\* Имя группы. \*/  
"d": &lt;text&gt;, /\* Описание. \*/  
"tgs": \[&lt;uint&gt;\] /\* Массив ID меток. \*/  
},  
...  
}  
"tagsgrmax": -1 /\* Максимальное количество групп. \*/  
}

# Ретрансляторы

В зависимости от указанных флагов формат ответа может различаться.

В этой главе описаны флаги, которые могут быть применены к ретрансляторам. Также подробно описываются части ответа, которые содержат информацию о флагах. Если указано несколько флагов, их соответствующие части объединяются в один JSON.

Все флаги используются только в десятичном формате (DEC).

## Флаги ретранслятора

Следующие флаги можно применять к ретрансляторам:

| Значение в HEX | Значение в DEC | Описание |
| --- | --- | --- |
| 0x00000001 | 1   | Базовый флаг |
| 0x00000002 | 2   | Пользовательские свойства |
| 0x00000004 | 4   | Информация о биллинге |
| 0x00000040 | 64  | GUID |
| 0x00000080 | 128 | Административные поля |
| 0x00000100 | 256 | Состояние и конфигурация |
| 0x00000200 | 512 | Объекты ретранслятора |
| 0x3FFFFFFFFFFFFFFF | 4611686018427387903 | Установить все возможные флаги ретранслятора |

## Основные свойства

Флаг основных свойств — 0x00000001.

{  
"nm":&lt;text&gt;, /\* Название \*/  
"cls":&lt;uint&gt;, /\* ID базового класса: "avl_retranslator" \*/  
"id":&lt;long&gt;, /\* ID ретранслятора \*/  
"uacl":&lt;uint&gt; /\* Права доступа пользователя на ретранслятор \*/  
}

## Произвольные свойства

Флаг произвольных свойств — 0x00000002.

В произвольных свойствах можно хранить любые данные ретранслятора.

{  
"prp": {} /\* Произвольные свойства \*/  
}

## Информация о биллинге

Флаг информации о биллинге — 0x00000004.

{  
"crt": &lt;uint&gt;, /\* ID создателя \*/  
"bact": &lt;uint&gt; /\* ID учетной записи \*/  
}

## GUID

Флаг GUID — 0x00000040.

{  
"gd": &lt;text&gt; /\* GUID ретранслятора \*/  
}

## Административные поля

Флаг административных полей — 0x00000080.

{  
"aflds": { /\* Административные поля \*/  
&lt;text&gt;: { /\* Порядковый номер \*/  
"id": &lt;uint&gt;, /\* ID \*/  
"n": &lt;text&gt;, /\* Название \*/  
"v": &lt;text&gt; /\* Значение \*/  
},  
...  
},  
"afldsmax": &lt;long&gt; /\* Максимальное количество административных полей (-1 для неограниченного количества) \*/  
}

## Состояние и конфигурация

Флаг состояния и конфигурации — 0x00000100.

{  
"rtro": &lt;int&gt;, /\* Состояние: 0 — отключен, 1 — включен \*/  
"rtrc": { /\* Конфигурация \*/  
"protocol": &lt;text&gt;, /\* Протокол \*/  
"server": &lt;text&gt;, /\* Сервер для ретрансляции \*/  
"port": &lt;ushort&gt;, /\* Порт (для всех протоколов кроме NIS) \*/  
"auth": &lt;text&gt;, /\* Авторизация (только для NIS и Wialon IPS) \*/  
"ssl": &lt;int&gt;, /\* Защищенное соединение (для NIS): 1 — да, 0 — нет \*/  
"v6type": &lt;int&gt;, /\* Использовать протокол версии 6 (только для Granit Navigator): 0 — нет, 1 — да \*/  
"login": &lt;text&gt;, /\* Логин \*/  
"password": &lt;text&gt;, /\* Пароль \*/  
"notauth": &lt;int&gt; /\* Отключить авторизацию (только для EGTS): 0 — нет, 1 — да \*/  
}  
}

Типы протоколов описаны на странице [update_config](https://help.wialon.com/en/api/user-guide/api-reference/retranslator/update-config).

## Объекты ретранслятора

Флаг объектов ретранслятора — 0x00000200.

{  
"rtru": \[{ /\* Список объектов \*/  
"i": &lt;long&gt;, /\* ID объекта \*/  
"a": &lt;text&gt; /\* ID оборудования \*/  
}\]  
}

# Время

В этом разделе описаны разные константы даты.

В Wialon используется [Unix-время](https://en.wikipedia.org/wiki/Unix_time).

# Летнее время

Вы можете использовать следующие флаги для настройки перехода на летнее время:

| Флаг | Значение |
| --- | --- |
| 0x08000000 | Нет |
| 0x0A050000 | Россия: часовые пояса до 26 октября 2014 года |
| 0x0B030000 | Европа: с последнего воскресенья марта до последнего воскресенья октября |
| 0x0A010000 | США, Канада: со второго воскресенья марта до первого воскресенья ноября |
| 0x0A040000 | Иордания: с последней пятницы февраля до последней пятницы октября |
| 0x0A060000 | Сирия: часовые пояса до 4 октября 2022 |
| 0x0A070000 | Острова Теркс и Кайкос: с первого воскресенья апреля до последнего воскресенья октября |
| 0x0A080000 | Куба: со второго воскресенья марта до первого воскресенья ноября |
| 0x0A0C0000 | Иран: с 22 марта до 22 сентября (с 21 марта до 21 сентября в високосный год) |
| 0x0A0D0000 | Израиль: с пятницы перед последним воскресеньем марта до последнего воскресенья октября |
| 0x0A210000 | Намибия: с первого воскресенья сентября до первого воскресенья апреля |
| 0x0A220000 | Новая Зеландия: с последнего воскресенья сентября до первого воскресенья апреля |
| 0x0A230000 | Чили: с первого воскресенья сентября до первого воскресенья апреля |
| 0x0A240000 | Бразилия: с третьего воскресенья октября до третьего воскресенья февраля |
| 0x0A250000 | Парагвай: с первого воскресенья октября до последнего воскресенья марта |
| 0x0A270000 | Австралия: с первого воскресенья октября до первого воскресенья апреля |
| 0x0A280000 | Тасмания: с первого воскресенья октября до первого воскресенья апреля |
| 0x0A290000 | Фиджи: с первого воскресенья ноября до третьего воскресенья января |

# Часовые пояса

| Значение | Часовой пояс | UTC |
| --- | --- | --- |
| \-43200 | Международное западное время | \-12:00 |
| \-39600 | Остров Мидуэй, Самоа | \-11:00 |
| \-36000 | Гавайи | \-10:00 |
| \-34200 | Французская Полинезия, Маркизские острова | \-09:30 |
| \-32400 | Аляска | \-09:00 |
| \-28800 | Тихоокеанское время (США и Канада) | \-08:00 |
| \-25200 | Горное время (США и Канада) | \-07:00 |
| \-21600 | Центральное время (США и Канада), Гвадалахара, Мехико | \-06:00 |
| \-18000 | Восточное время (США и Канада) | \-05:00 |
| \-14400 | Атлантическое время (Канада), Манаус, Сантьяго, Венесуэла | \-04:00 |
| \-12600 | Ньюфаундленд | \-03:30 |
| \-10800 | Гренландия, Бразилиа, Монтевидео | \-03:00 |
| \-7200 | Центрально-Атлантическое время | \-02:00 |
| \-3600 | Азорские острова | \-01:00 |
| 0   | GMT: Дублин, Эдинбург, Лиссабон, Лондон | 00:00 |
| 3600 | Амстердам, Берлин, Рим, Вена, Прага, Брюссель | +01:00 |
| 7200 | Афины, Стамбул, Бейрут, Каир, Иерусалим, Калининград | +02:00 |
| 10800 | Санкт-Петербург, Минск, Багдад, Москва, Волгоград | +03:00 |
| 12600 | Иран | +03:30 |
| 14400 | Баку, Ереван, Ижевск, Самара | +04:00 |
| 16200 | Афганистан | +04:30 |
| 18000 | Екатеринбург, Ташкент, Астана | +05:00 |
| 19800 | Ченнаи, Калькутта, Мумбаи, Нью-Дели | +05:30 |
| 20700 | Непал | +05:45 |
| 21600 | Дакка, Омск | +06:00 |
| 23400 | Мьянма, Кокосовые острова | +06:30 |
| 25200 | Бангкок, Ханой, Джакарта, Красноярск, Кемерово, Новосибирск | +07:00 |
| 28800 | Улан-Батор, Петр, Иркутск, Чита, Куала-Лумпур | +08:00 |
| 32400 | Японское стандартное время, Якутск | +09:00 |
| 34200 | Стандартное время Центральной Австралии | +09:30 |
| 36000 | Канберра, Мельбурн, Сидней, Хобарт, Владивосток, Магадан | +10:00 |
| 37800 | Стандартное время острова Лорд-Хау | +10:30 |
| 39600 | Соломоновы острова, Новая Каледония, Чокурдах, Сахалин | +11:00 |
| 43200 | Окленд, Веллингтон, Анадырь, Петропавловск-Камчатский | +12:00 |
| 45900 | Новая Зеландия, архипелаг Чатем | +12:45 |
| 46800 | Нукуалофа | +13:00 |
| 50400 | Кирибати, острова Лайн | +14:00 |

# Пример получения параметра «tz»

Вы можете получить параметр **tz** с помощью побитовых операций, таких как математическое **И (&)** и математическое **ИЛИ (|)**.

## Пример получения «tz»

Ниже приведена инструкция для получения параметра **tz** для часового пояса Азорских островов (-01:00) без [перехода на летнее время (DST)](https://help.wialon.com/ru/api/user-guide/data-format/time/daylight-saving-time) (0x08000000).

1.  Примените математическую операцию **И** к [часовому поясу](https://help.wialon.com/ru/api/user-guide/data-format/time/time-zones) Азорских островов (-3600), используя маску 0xf000ffff.
    - Преобразуйте десятичное значение со знаком в двоичное, используя метод **дополнительного кода**.
    - Выполните операцию:

- \-3600 & 0xf000ffff  
    \-268373520

1.  Примените математическую операцию **ИЛИ** к результату, используя маску, соответствующую DST (0x08000000).

- \-268373520 | 0x8000000  
    \-134155792

Таким образом, итоговое значение для **tz** равно -134155792.

## Обратная операция

Чтобы получить исходное значение часового пояса (tz) из **tz = -134155792**, выполните следующие действия:

1.  Примените математическую операцию **И** к параметру **tz**, используя маску 0xffff:

- \-134155792 & 0xffff  
    61936

1.  Если исходное значение **tz** отрицательное (как в данном случае), примените математическую операцию **ИЛИ** к результату, используя маску 0xffff0000.

- 61936 | 0xffff0000  
    \-3600

Это подтверждает, что исходное значение часового пояса равно -3600 (UTC -01:00, Азорские острова).

**Дополнительная информация**

- Значение tz **\-134155792** в шестнадцатеричном виде равно 0xf800f1f0.
- Применение маски 0x0fff0000 выделяет компонент перехода на летнее время.
- Значение DST 0x08000000 указывает на отсутствие перехода на летнее время.

Таким образом, декодированный часовой пояс - UTC -01:00 (Азорские острова) без перехода на летнее время.

# Токены

В этом разделе описываются флаги токенов и соответствующие им флаги ACL.

Все флаги используются только в десятичном формате (DEC).

## Онлайн-мониторинг

Флаг токена **0x100(256)** включает флаги прав доступа, связанные с онлайн-мониторингом.

| Тип прав доступа | Название права доступа | Флаг права доступа в HEX | Флаг права доступа в DEC |
| --- | --- | --- | --- |
| Стандартные права доступа | Просмотр элемента и его основных свойств | 0x1 | 1   |
|     | Просмотр подробных свойств элемента | 0x2 | 2   |
|     | Просмотр пользовательских полей | 0x20 | 32  |
|     | Запрос сообщений и отчетов | 0x200 | 512 |
|     | Просмотр и скачивание файлов | 0x4000 | 6384 |
| Права доступа на объекты и группы объектов | Просмотр команд | 0x400000000 | 17179869184 |
| Права доступа на ресурсы (учетные записи) | Просмотр POI | 0x400000 | 4194304 |
|     | Просмотр геозон | 0x1000000 | 16777216 |
|     | Просмотр шаблонов отчетов | 0x10000000 | 268435456 |
|     | Просмотр водителей и групп водителей | 0x40000000 | 1073741824 |
|     | Просмотр заявок | 0x200000000 | 8589934592 |
|     | Просмотр меток (пассажиров) | 0x800000000 | 34359738368 |
|     | Просмотр прицепов и групп прицепов | 0x100000000000 | 17592186044416 |

## Просмотр данных

Флаг токена **0x200(512)** включает флаги прав доступа, связанные с просмотром данных.

| Тип прав доступа | Название права доступа | Флаг права доступа в HEX | Флаг права доступа в DEC |
| --- | --- | --- | --- |
| Права доступа на объекты и группы объектов | Просмотр интервалов техобслуживания | 0x10000000 | 268435456 |
|     | Просмотр настроек подключения | 0x0004000000 | 67108864 |
| Права доступа пользователя | Выполнение действий от имени пользователя (вход в систему, создание элементов и т. п.) | 0x200000 | 2097152 |
| Права доступа на ресурсы (учетные записи) | Просмотр уведомлений | 0x100000 | 1048576 |
|     | Просмотр заданий | 0x4000000 | 67108864 |

## Редактирование нечувствительных данных

Флаг токена **0x400(1024)** включает флаги прав доступа, связанные с редактированием нечувствительных данных.

| Тип прав доступа | Название права доступа | Флаг права доступа в HEX | Флаг права доступа в DEC |
| --- | --- | --- | --- |
| Стандартные права доступа | Переименование элемента | 0x10 | 16  |
|     | Управление пользовательскими полями | 0x40 | 64  |
|     | Изменение иконки | 0x100 | 256 |
|     | Редактирование прикрепленных файлов | 0x8000 | 32768 |
| Права доступа на объекты и группы объектов | Регистрация событий | 0x2000000 | 33554432 |
|     | Создание, редактирование и удаление команд | 0x800000000 | 34359738368 |
| Права доступа к ретрансляторам | Добавление или удаление объектов из ретранслятора, изменение их уникальных ID | 0x200000 | 2097152 |
| Права доступа на ресурсы (учетные записи) | Создание, редактирование и удаление POI | 0x800000 | 8388608 |
|     | Создание, редактирование и удаление геозон | 0x2000000 | 33554432 |

## Редактирование чувствительных данных

Флаг токена **0x400(1024)** включает флаги прав доступа, связанные с редактированием чувствительных данных.

| Тип прав доступа | Название права доступа | Флаг права доступа в HEX | Флаг права доступа в DEC |
| --- | --- | --- | --- |
| Стандартные права доступа | Управление доступом к элементу | 0x4 | 4   |
| Права доступа на объекты и группы объектов | Создание, редактирование и удаление интервалов техобслуживания | 0x20000000 | 536870912 |
|     | Редактирование настроек поездок, вождения и диагностики | 0x4000000000 | 274877906944 |
| Права доступа пользователя | Управление правами доступа пользователя | 0x100000 | 1048576 |
|     | Редактирование основных свойств пользователя | 0x400000 | 4194304 |
| Права доступа к ретрансляторам | Редактирование свойств ретранслятора, включая запуск/остановку | 0x100000 | 1048576 |
| Права доступа на ресурсы (учетные записи) | Создание, редактирование и удаление уведомлений | 0x200000 | 2097152 |
|     | Создание, редактирование и удаление заданий | 0x8000000 | 134217728 |
|     | Создание, редактирование и удаление шаблонов отчетов | 0x20000000 | 536870912 |
|     | Создание, редактирование и удаление водителей и групп водителей | 0x80000000 | 2147483648 |
|     | Создание, редактирование и удаление заявок | 0x400000000 | 17179869184 |
|     | Создание, редактирование и удаление пассажиров | 0x1000000000 | 68719476736 |
|     | Создание, редактирование и удаление прицепов и групп прицепов | 0x200000000000 | 35184372088832 |

## Редактирование чувствительных данных и удаление сообщений

Флаг токена **0x1000(4096)** включает флаги прав доступа, связанные с редактированием чувствительных данных и удалением сообщений.

| Тип прав доступа | Название права доступа | Флаг права доступа в HEX | Флаг права доступа в DEC |
| --- | --- | --- | --- |
| Стандартные права доступа | Удаление элемента | 0x8 | 8   |
|     | Управление журналом | 0x800 | 2048 |
|     | Просмотр административных полей | 0x1000 | 4096 |
|     | Редактирование административных полей | 0x2000 | 8192 |
| Права доступа на объекты и группы объектов | Редактирование настроек подключения (тип устройства, уникальный ID, телефон, пароль доступа, фильтрация сообщений) | 0x100000 | 1048576 |
|     | Создание, редактирование и удаление датчиков | 0x200000 | 2097152 |
|     | Редактирование счетчиков | 0x400000 | 4194304 |
|     | Удаление сообщений | 0x800000 | 8388608 |
|     | Импорт сообщений | 0x40000000 | 1073741824 |
|     | Экспорт сообщений | 0x80000000 | 2147483648 |

## Отправка команд

Флаг токена **0x2000(8192)** соответствует флагу права доступа **Отправка команд**.

| Тип прав доступа | Название права доступа | Флаг права доступа в HEX | Флаг права доступа в DEC |
| --- | --- | --- | --- |
| Права доступа на объекты и группы объектов | Отправка команд | 0x1000000 | 16777216 |

## Работа под авторизованным пользователем (unlimited access)

Флаг токена **\-1** включает флаги прав доступа, связанные с работой в качестве авторизованного пользователя.

| Тип прав доступа | Название права доступа | Флаг права доступа в HEX | Флаг права доступа в DEC |
| --- | --- | --- | --- |
| Стандартные права доступа | Редактирование рекурсивных элементов | 0x400 | 1024 |
| Права доступа на объекты и группы объектов | Просмотр маршрутов | 0x4000000 | 67108864 |
|     | Создание, редактирование, удаление маршрутов | 0x8000000 | 134217728 |
|     | Просмотр событий | 0x1000000000 | 68719476736 |
|     | Создание, редактирование и удаление событий | 0x2000000000 | 137438953472 |
|     | Использование объекта в заданиях, уведомлениях, маршрутах, ретрансляторах | 0x8000000000 | 549755813888 |
| Права доступа на ресурсы (учетные записи) | Управление учетной записью | 0x100000000 | 4294967296 |

# Группы объектов

В этом разделе рассмотрены флаги, применимые к группам объектов, и части возвращаемого JSON, за которые они отвечают. При указании нескольких флагов части собираются в один JSON.

В зависимости от использованных флагов формат ответа может изменяться.

Все флаги используются только в десятичном формате (DEC).

|     |     |     |
| --- | --- | --- |
| Значение HEX | Значение DEC | Описание |
| [0x00000001](#UnitGroups-generalproperties) | 1   | Основные свойства. |
| [0x00000002](#UnitGroups-customproperties) | 2   | Произвольные свойства. |
| [0x00000004](#UnitGroups-billing) | 4   | Информация об учетной записи. |
| [0x00000008](#UnitGroups-customfields) | 8   | Произвольные поля. |
| [0x00000010](#UnitGroups-unitgroupimage) | 16  | Изображение группы объектов. |
| [0x00000040](#UnitGroups-GUID) | 64  | GUID. |
| [0x00000080](#UnitGroups-adminfields) | 128 | Административные поля. |
| 0x3FFFFFFFFFFFFFFF | 4611686018427387903 | Установка всех возможных флагов для группы объектов. |

## Основные свойства

Флаг — 0x00000001.

{  
"nm":"&lt;text&gt;", /\* название \*/  
"cls":&lt;uint&gt;, /\* ID базового класса "avl_unit_group" \*/  
"id":&lt;uint&gt;, /\* ID группы \*/  
"u":\[&lt;long&gt;\], /\* массив идентификаторов объектов, входящих в группу \*/  
"uacl":&lt;uint&gt; /\* уровень доступа к группе у текущего пользователя \*/  
}

## Произвольные свойства

Флаг — 0x00000002.

В произвольных свойствах вы можете сохранять любые нужные вам данные о группе объектов.

{  
"prp":{} /\* произвольные свойства \*/  
}

## Биллинг

Флаг — 0x00000004.

{  
"crt":&lt;uint&gt;, /\* ID создателя \*/  
"bact":&lt;uint&gt; /\* ID учетной записи \*/  
}

## Произвольные поля

Флаг — 0x00000008.

{  
"flds":{  
"&lt;text&gt;":{ /\* порядковый номер произвольного поля \*/  
"id":&lt;uint&gt;, /\* ID произвольного поля \*/  
"n":"&lt;text&gt;", /\* имя произвольного поля \*/  
"v":"&lt;text&gt;" /\* значение произвольного поля \*/  
},  
...  
},  
"fldsmax":&lt;long&gt; /\* максимальное количество произвольных полей (-1 — не ограничено) \*/  
}

## Изображение группы объектов

Флаг — 0x00000010.

{  
"ugi":&lt;uint&gt; /\* счетчик изменений изображения \*/  
}

## GUID

Флаг — 0x00000040.

{  
"gd":"&lt;text&gt;" /\* GUID группы \*/  
}

## Административные поля

Флаг — 0x00000080.

{  
"aflds":{ /\* административные поля \*/  
"&lt;text&gt;":{ /\* порядковый номер \*/  
"id":&lt;uint&gt;, /\* ID \*/  
"n":"&lt;text&gt;", /\* название \*/  
"v":"&lt;text&gt;" /\* значение \*/  
},  
...  
},  
"afldsmax":&lt;long&gt;, /\* максимально допустимое количество административных записей (-1 — не ограничено) \*/  
}

# Пользователи

В зависимости от указанных флагов формат ответа может различаться. В этом разделе описаны флаги, которые можно применять к пользователям. Также подробно описываются части ответа, которые содержат информацию о флагах. Если указано несколько флагов, их соответствующие части объединяются в один JSON.

Все флаги используются только в десятичном формате (DEC).

## Флаги пользователя

К пользователям можно применить следующие флаги:

| Значение в HEX | Значение в DEC | Описание |
| --- | --- | --- |
| 0x00000001 | 1   | Основные свойства (базовый флаг) |
| 0x00000002 | 2   | Пользовательские свойства |
| 0x00000004 | 4   | Информация о биллинге |
| 0x00000008 | 8   | Пользовательские поля |
| 0x00000020 | 32  | Сообщения |
| 0x00000040 | 64  | GUID |
| 0x00000080 | 128 | Административные поля |
| 0x00000100 | 256 | Прочие свойства пользователя |
| 0x00000200 | 512 | Уведомления |
| 0x00000400 | 1024 | Настройки подключения пользователя (например, маска хоста) |
| 0x00000800 | 2048 | Мобильные приложения пользователя |
| 0x3FFFFFFFFFFFFFFF | 4611686018427387903 | Установить все флаги пользователя |

## Основные свойства

Флаг основных свойств - 0x00000001.

{  
"nm": "&lt;text&gt;", /\* Имя пользователя \*/  
"cls": &lt;uint&gt;, /\* ID базового класса: "user" \*/  
"id": &lt;uint&gt;, /\* ID пользователя \*/  
"mu": &lt;uint&gt;, /\* Система измерений:  
0 - СИ,  
1 - американская,  
2 - имперская,  
3 - метрическая с галлонами \*/  
"uacl": &lt;uint&gt; /\* Права доступа пользователя на этого пользователя \*/  
}

## Произвольные свойства

Флаг пользовательских свойств - 0x00000002.

В пользовательских свойствах можно хранить любые данные пользователя. Обычно это такие настройки, как email пользователя, позиция карты после входа в систему и т.д.

{  
"prp": {  
"cfmt": "&lt;text&gt;", /\* Формат координат: 0 - градусы и минуты, 1 - градусы \*/  
"email": "&lt;text&gt;", /\* Email пользователя \*/  
"msc": "&lt;text&gt;", /\* Позиция карты после входа: 0 - по умолчанию, 1 - сохраненная \*/  
"poisrv": "&lt;text&gt;" /\* Отрисовка POI на сервере \*/  
}  
}

## Информация о биллинге

Флаг информации о биллинге - 0x00000004.

{  
"crt": &lt;uint&gt;, /\* ID создателя \*/  
"bact": &lt;uint&gt; /\* ID учетной записи \*/  
}

## Произвольные поля

Флаг произвольных полей - 0x00000008.

{  
"flds": { /\* Произвольные поля \*/  
"&lt;text&gt;": { /\* Порядковый номер \*/  
"id": &lt;uint&gt;, /\* ID \*/  
"n": "&lt;text&gt;", /\* Название \*/  
"v": "&lt;text&gt;" /\* Значение \*/  
}  
},  
"fldsmax": &lt;long&gt; /\* Максимальное количество пользовательских полей (-1 для неограниченного количества) \*/  
}

## Сообщения

Флаг сообщений пользователя - 0x00000020.

После установки этого флага можно получать сообщения от объекта.

{}

## GUID

Флаг GUID - 0x00000040.

{  
"gd": &lt;text&gt; /\* GUID пользователя \*/  
}

## Административные поля

Флаг административных полей - 0x00000080.

{  
"aflds": { /\* Административные поля \*/  
&lt;text&gt;: { /\* Порядковый номер \*/  
"id": &lt;uint&gt;, /\* ID \*/  
"n": &lt;text&gt;, /\* Название \*/  
"v": &lt;text&gt; /\* Значение \*/  
},  
...  
},  
"afldsmax": &lt;long&gt;, /\* Максимальное количество административных полей (-1 для неограниченного количества) \*/  
}

## Другие свойтсва пользователя

Флаг других свойств пользователя - 0x00000100.

{  
"fl": &lt;uint&gt;, /\* Флаги настроек пользователя \*/  
"hm": &lt;text&gt;, /\* Маска хоста \*/  
"ld": &lt;uint&gt;, /\* Время последнего входа \*/  
"pfl": &lt;uint&gt;, /\* Флаги родительской учетной записи \*/  
"ap": {  
"type": &lt;uint&gt;, /\* Тип двухфакторной аутентификации \*/  
"phone": &lt;text&gt; /\* Тип двухфакторной аутентификации \*/  
}  
}

Флаги настроек пользователя перечислены на странице [update_user_flags](https://help.wialon.com/en/api/user-guide/api-reference/user/update_user_flags).

## Уведомления

Флаг уведомлений - 0x00000200.

{  
"usnf": { /\* Уведомления пользователя \*/  
"&lt;text&gt;": { /\* Порядковый номер \*/  
"id": &lt;long&gt;, /\* ID \*/  
"t": &lt;uint&gt;, /\* Время жизни (в секундах) \*/  
"d": "&lt;text&gt;", /\* Текст уведомления \*/  
"h": "&lt;text&gt;", /\* Тема \*/  
"s": "&lt;text&gt;" /\* Отправитель \*/  
}  
}  
}

## Флаги мобильных приложений пользователя

Флаг мобильных приложений пользователя - 0x00000800.

{  
"mobile_apps": &lt;text&gt;,  
}

# Коды ошибок

Сервер может вернуть JSON с ошибками:

{"error":&lt;code&gt;}

<div class="joplin-table-wrapper"><table><thead><tr><th><p>Код ошибки</p></th><th><p>Описание</p></th><th><p>Альтернативные варианты</p></th></tr></thead><tbody><tr><td><p>-100</p></td><td><p>Внутренняя ошибка (таймаут сети).</p></td><td><p></p></td></tr><tr><td><p>-101</p></td><td><p>Внутренняя ошибка (неверный ответ сети).</p></td><td><p></p></td></tr><tr><td><p>0</p></td><td><p>Успешная операция (например, для выхода из системы это означает успешный выход).</p></td><td><p></p></td></tr><tr><td><p>1</p></td><td><p>Невалидная сессия.</p></td><td><p></p></td></tr><tr><td><p>2</p></td><td><p>Неверное имя API-сервиса.</p></td><td><p>Нет сообщений за выбранный интервал.</p></td></tr><tr><td><p>3</p></td><td><p>Неверный результат.</p></td><td><p>Плагин библиотеки типов не включен.<br>Элемент AVL-сервера не найден.<br>Файл не найден.</p></td></tr><tr><td><p>4</p></td><td><p>Неверный ввод.</p></td><td><p>Невалидная сессия.<br>Элемент не найден.<br>Неизвестная ошибка.<br>Внутренняя ошибка.</p></td></tr><tr><td><p>5</p></td><td><p>Ошибка выполнения запроса.</p></td><td><p></p></td></tr><tr><td><p>6</p></td><td><p>Неизвестная ошибка.</p></td><td><p>Сервер авторизации недоступен, попробуйте позже.<br>Внутренняя ошибка.<br>Не удалось обработать удаленный ответ.<br>Невалидная сессия (agro/convert_plots).</p></td></tr><tr><td><p>7</p></td><td><p>Доступ запрещен.</p></td><td><p>Пользователь отключен.<br>Неверное имя пользователя или пароль.<br>Ошибка проверки кластера текущего пользователя.<br>Внутренняя ошибка сервера.<br>Неизвестная ошибка.</p></td></tr><tr><td><p>8</p></td><td><p>Неверное имя пользователя или пароль.</p></td><td><p></p></td></tr><tr><td><p>9</p></td><td><p>Сервер авторизации недоступен.</p></td><td><p></p></td></tr><tr><td><p>10</p></td><td><p>Достигнут лимит одновременных запросов.</p></td><td><p>Достигнут лимит одновременных пересчетов (5 пересчетов).</p></td></tr><tr><td><p>11</p></td><td><p>Ошибка сброса пароля.</p></td><td><p></p></td></tr><tr><td><p>12</p></td><td><p>Агро-подсистема не загружена.</p></td><td><p></p></td></tr><tr><td><p>14</p></td><td><p>Ошибка биллинга.</p></td><td><p></p></td></tr><tr><td><p>1001</p></td><td><p>Нет сообщений за выбранный интервал.</p></td><td><p></p></td></tr><tr><td><p>1002</p></td><td><p>Указывает на одну из двух ошибок:<br></p><ul><li>Элемент с таким уникальным свойством уже существует.</li><li>Элемент не может быть создан согласно ограничениям тарифного плана.</li></ul></td><td><p></p></td></tr><tr><td><p>1003</p></td><td><p>В данный момент разрешен только один запрос.</p></td><td><p>Сервис блокировки недоступен.<br>Превышен лимит.<br>Достигнут лимит одновременных событий.<br>Не удалось создать новую сессию.<br>Формат кодирования не является gzip.<br>Достигнут лимит слоев сообщений.<br>Превышено LAYERS_MAX_COUNT(50).</p></td></tr><tr><td><p>1004</p></td><td><p>Превышен лимит сообщений.</p></td><td><p>Размер файла превышает максимальный размер 1 ГБ.</p></td></tr><tr><td><p>1005</p></td><td><p>Время выполнения превысило лимит.</p></td><td><p>Неверная конфигурация оборудования.</p></td></tr><tr><td><p>1006</p></td><td><p>Превышен лимит попыток ввода кода двухфакторной авторизации.</p></td><td><p></p></td></tr><tr><td><p>1011</p></td><td><p>Ваш IP изменился, или сессия истекла.</p></td><td><p></p></td></tr><tr><td><p>2001</p></td><td><p>Неверный элемент или целевой ресурс.</p></td><td><p></p></td></tr><tr><td><p>2002</p></td><td><p>Целевой ресурс не является учетной записью.</p></td><td><p></p></td></tr><tr><td><p>2003</p></td><td><p>Неверный целевой плагин.</p></td><td><p></p></td></tr><tr><td><p>2004</p></td><td><p>Целевая учетная запись заблокирована.</p></td><td><p></p></td></tr><tr><td><p>2005</p></td><td><p>Неверный создатель целевого ресурса.</p></td><td><p></p></td></tr><tr><td><p>2006</p></td><td><p>Нет доступа к элементу для целевого создателя.</p></td><td><p></p></td></tr><tr><td><p>2007</p></td><td><p>Неверный исходный ресурс.</p></td><td><p></p></td></tr><tr><td><p>2008</p></td><td><p>Элемент уже находится в целевом ресурсе.</p></td><td><p></p></td></tr><tr><td><p>2009</p></td><td><p>Целевой ресурс принадлежит другому пользователю верхнего уровня.</p></td><td><p></p></td></tr><tr><td><p>2010</p></td><td><p>Недостаточно счетчика ресурсов элементов в target_resource.</p></td><td><p></p></td></tr><tr><td><p>2011</p></td><td><p>Неверный плагин элемента.</p></td><td><p></p></td></tr><tr><td><p>2012</p></td><td><p>Ошибка изменения тарифицируемого элемента учетной записи на target_resource.</p></td><td><p></p></td></tr><tr><td><p>2013</p></td><td><p>Ошибка изменения создателя элемента.</p></td><td><p></p></td></tr><tr><td><p>2014</p></td><td><p>Выбранный пользователь является создателем некоторых элементов системы, поэтому этот пользователь не может быть назначен новой учетной записи.</p></td><td><p></p></td></tr><tr><td><p>2015</p></td><td><p>Удаление датчика запрещено, так как он используется в другом датчике или расширенных свойствах объекта.</p></td><td><p></p></td></tr></tbody></table></div>

# Документация API

В этом разделе описаны API-методы Wialon. Здесь вы найдете структуру запросов и ответов для каждого метода. Чтобы воспользоваться методом, отправьте запрос с необходимыми данными и параметрами.

# core

В этом разделе описаны основные функции Wialon, такие как **search_items**, **reset_password_perform**, **logout** и т. п.

# batch

Функция **batch** используется для выполнения нескольких команд с помощью одного запроса.

svc=core/batch&params=\[  
{  
"svc":"&lt;text&gt;",  
"params":{}  
}  
\]

Запрос также может выглядеть следующим образом:

svc=core/batch&params={  
"params": \[{  
"svc":"&lt;text&gt;",  
"params":{}  
}\],  
"flags":&lt;uint&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>svc</p></td><td><p>Имя команды.</p></td></tr><tr><td><p>params</p></td><td><p>Параметры.</p></td></tr><tr><td><p>flags</p></td><td><p>Один из следующих:</p><ul><li>0&nbsp;— выполнить все команды (по умолчанию);</li><li>1&nbsp;—&nbsp;остановить одновременное выполнение, если при выполнении какой-либо команды возвращается ошибка.<br></li></ul></td></tr></tbody></table></div>

## Возвращаемый результат

\[  
{ /\* если все команды выполнены без ошибок, возвращается объект с данными \*/  
...  
},  
{ /\* если произошла ошибка, возвращается ее код \*/  
"error":&lt;int&gt;  
},  
...  
\]

 Если в параметре **flags** указано 1 и при выполнении одной из команд происходит ошибка, то во всех командах, следующих за ней, возвращается ошибка с кодом 10.

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Возвращаемый результат превышает допустимое количество символов. |
| 4   | Неверные входные параметры. |

# check_accessors

Функция **check_accessors** используется для получения списка прав доступа на объекты дочерних пользователей.

svc=core/check_accessors&params={"items":\[&lt;long&gt;\],  
"flags":&lt;long&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>items</p></td><td><p>Массив ID объекта.</p></td></tr><tr><td><p>flags</p></td><td><p>Флаг используется для добавления параметра&nbsp;<strong>dact&nbsp;</strong>в возвращаемый результат:</p><ul><li>1&nbsp;—&nbsp;добавлять;</li><li>0&nbsp;— не добавлять.</li></ul></td></tr></tbody></table></div>

## Возвращаемый результат

{  
"&lt;unit_id&gt;": { /\* ID объекта \*/  
"&lt;acc_id&gt;": { /\* ID пользователя \*/  
"acl": &lt;long&gt;, /\* унаследованные права доступа на объект, которые накладываются маской на прямые права; если что-то запрещено согласно унаследованным правам доступа, это также запрещено согласно результирующим правам \*/  
"dacl": &lt;long&gt; /\* если указан flags:1, права доступа на объекты прямые (от владельца объекта)\*/  
},  
... /\* другие ID пользователей (если есть) \*/  
},  
... /\* другие ID объектов (если запрошены) \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь пользователя. |
| 4   | Неверные входные параметры. |

# check_items_billing

Функция **check_items_billing** используется для проверки прав доступа пользователя на элементы.

svc=core/check_items_billing&params={"items":\[&lt;long&gt;\],  
"accessFlags":&lt;long&gt;,  
"serviceName":"&lt;text&gt;"}

При обработке запроса проверяются как доступные услуги, так и права доступа на элементы. Например, если у пользователя есть право доступа на создание отчетов в каком-либо ресурсе, но лимита по количеству разрешенных шаблонов отчета уже достигнут, то этот ресурс не показывается в массиве результатов.

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| items | Массив ID элементов. |
| accessFlags | Флаги доступа (описаны ниже). |
| serviceName | Имя услуги (см. страницу [**get_account_data**](https://help.wialon.com/help/api/ru/user-guide/api-reference/account/get_account_data)). |

## Возвращаемый результат

\[  
&lt;long&gt; /\* массив элементов, на которые у пользователя есть права доступа \*/  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 4   | Неверные входные параметры. |

## Флаги доступа

### Стандартные

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x0001 | Просмотр элемента и его основных свойств. |
| 0x0002 | Просмотр подробных свойств. |
| 0x0004 | Управление доступом к элементу. |
| 0x0008 | Удаление элемента. |
| 0x0010 | Переименование элемента. |
| 0x0020 | Просмотр произвольных полей. |
| 0x0040 | Управление произвольными полями. |
| 0x0080 | Редактирование неупомянутых свойств. |
| 0x0100 | Изменение иконки. |
| 0x0200 | Запрос сообщений и отчетов. |
| 0x0400 | Редактирование рекурсивных элементов. |
| 0x0800 | Управление журналом. |
| 0x1000 | Просмотр административных полей. |
| 0x2000 | Управление административными полями. |
| 0x4000 | Просмотр и скачивание файлов. |
| 0x8000 | Загрузка и удаление файлов. |

### Объекты и группы объектов

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x0000100000 | Редактирование настроек подключения (тип устройства, уникальный ID, телефон, пароль доступа, фильтрация валидности сообщений). |
| 0x0000200000 | Создание, редактирование и удаление датчиков. |
| 0x0000400000 | Редактирование счетчиков. |
| 0x0000800000 | Удаление сообщений. |
| 0x0001000000 | Отправка команд. |
| 0x0002000000 | Управление событиями. |
| 0x0004000000 | Просмотр настроек подключения (тип устройства, уникальный ID, телефон, пароль доступа, фильтрация валидности сообщений). |
| 0x0010000000 | Просмотр интервалов техобслуживания. |
| 0x0020000000 | Создание, редактирование и удаление интервалов техобслуживания |
| 0x0040000000 | Импорт сообщений. |
| 0x0080000000 | Экспорт сообщений. |
| 0x0400000000 | Просмотр команд. |
| 0x0800000000 | Создание, редактирование и удаление команд. |
| 0x4000000000 | Изменение детектора поездок. |
| 0x8000000000 | Использование объекта в уведомлениях, заданиях, маршрутах, ретрансляторах. |

### Пользователи

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x100000 | Управление правами доступа пользователя. |
| 0x200000 | Выполнение действий от имени пользователя (вход в систему, создание элементов и т. п.). |
| 0x400000 | Редактирование основных свойств пользователя (позволяет изменять свойства пользователя; см. функцию [**update_user_flags**](https://help.wialon.com/help/api/ru/user-guide/api-reference/user/update_user_flags)). |

### Ретрансляторы

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x100000 | Изменять настройки, включая остановку/запуск. |
| 0x200000 | Добавлять и удалять объекты из ретранслятора, изменять их уникальные ID. |

### Ресурсы/Учетные записи

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x0000000100000 | Просмотр уведомлений. |
| 0x0000000200000 | Создание, редактирование и удаление уведомлений. |
| 0x0000001000000 | Просмотр геозон. |
| 0x0000002000000 | Создание, редактирование и удаление геозон. |
| 0x0000004000000 | Просмотр заданий. |
| 0x0000008000000 | Создание, редактирование и удаление заданий. |
| 0x0000010000000 | Просмотр шаблонов отчетов. |
| 0x0000020000000 | Создание, редактирование и удаление шаблонов отчетов. |
| 0x0000040000000 | Просмотр водителей. |
| 0x0000080000000 | Создание, редактирование и удаление водителей. |
| 0x0000100000000 | Управление учетной записью. |
| 0x0000200000000 | Просмотр заявок. |
| 0x0000400000000 | Создание, редактирование и удаление заявок. |
| 0x0000800000000 | Просмотр пассажиров. |
| 0x0001000000000 | Создание, редактирование и удаление пассажиров. |
| 0x0100000000000 | Просмотр прицепов. |
| 0x0200000000000 | Создание, редактирование и удаление прицепов. |

### Маршруты

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x0000000100000 | Редактировать свойства маршрута. |

### Другие

|     |     |
| --- | --- |
| Флаг | Описание |
| 0xfffffffffffffff | Предоставляет все возможные права доступа на элемент. |

# check_unique

Функция **check_unique** используется для проверки уникальности элемента.

svc=core/check_unique&params={"type":"&lt;text&gt;",  
"value":"&lt;text&gt;"}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| type | Тип элемента (user, avl_resource). |
| value | Имя элемента. |

## Возвращаемый результат

Возвращаемый результат, если элемент уникален:

{"result":0}

Возвращаемый результат, если элемент уже существует:

{"result":1}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 1003 | Ошибка хранилища или превышен лимит на количество API-запросов по какому-либо правилу. |
| 4   | Неверные входные параметры. |

# create_auth_hash

Функция **create_auth_hash** используется для создания хэша авторизации.

Вместо функции [**duplicate**](https://help.wialon.com/ru/api/user-guide/api-reference/core/duplicate) можно использовать комбинацию функций **create_auth_hash** и [**use_auth_hash**](https://help.wialon.com/ru/api/user-guide/api-reference/core/use_auth_hash).

svc=core/create_auth_hash&params={}

 Сгенерированный хэш действителен в течение 2 минут с момента его создания.

## Возвращаемый результат

{  
"authHash":"&lt;text&gt;" /\* значение хэша авторизации \*/  
}

Коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 9   | Не удалось сгенерировать хэш авторизации. |
| 7   | Не удалось проверить верхний уровень доступа к токену или не удалось получить доступ к пакету SDK. |
| 1   | Не удалось извлечь текущего пользователя. |

# create_resource

Функция **create_resource** используется для создания новых ресурсов.

svc=core/create_resource&params={"creatorId":&lt;long&gt;,  
"name":"&lt;text&gt;",  
"dataFlags":"&lt;uint&gt;",  
"skipCreatorCheck":&lt;bool&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| creatorId | ID пользователя, который должен быть указан в качестве создателя нового ресурса. |
| name | Имя ресурса (4–50 символов). |
| dataFlags | Флаги со свойствами ресурса для возвращаемого результата. См. страницу [**resource**](https://help.wialon.com/help/api/ru/user-guide/api-reference/format/resources). |
| skipCreatorCheck | Специальный флаг. 1 — включен. Значение по умолчанию — 0.<br><br>Вы не можете создать учетную запись для пользователя, который создавал элементы в то время, когда у него не было учетной записи. Чтобы создать ресурс для такого пользователя, используйте **skipCreatorCheck=1**. Флаг используется только для этой цели. Ограничение служит для защиты иерархии. |

## Возвращаемый результат

{  
"item":{ /\* созданный ресурс \*/  
...  
},  
"flags":&lt;uint&gt; /\* примененные флаги со свойствами \*/  
}

Формат параметра **item** описан на странице [**resource**](https://help.wialon.com/ru/api/user-guide/api-reference/format/resources).

Возможные коды ошибок:

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Код</p></td><td><p>Описание</p></td></tr><tr><td><p>2014</p></td><td><p>Выбранный пользователь является создателем каких-либо элементов системы.</p></td></tr><tr><td><p>1002</p></td><td><p>Не удалось извлечь создателя с требуемым ID.</p></td></tr><tr><td><p>7</p></td><td><p>Не удалось проверить оплату услуги&nbsp;<strong>create_resources</strong>.</p></td></tr><tr><td><p>6</p></td><td><p>Одна из следующих ошибок:</p><ul><li>не удалось извлечь создателя с требуемым ID;</li><li>у текущего пользователя нет флага&nbsp;<strong>ADF_STORAGE_USER_FLAG_ITEM_CREATOR</strong>;</li><li>не удалось создать ресурс из-за правил оплаты.</li></ul></td></tr><tr><td><p>4</p></td><td><p>Неверные входные параметры или имя параметра&nbsp;<strong>name&nbsp;</strong>выходит за допустимые границы&nbsp;(4–50 символов).</p></td></tr></tbody></table></div>

# create_retranslator

Функция **create_retranslator** используется для создания нового ретранслятора.

svc=core/create_retranslator&params={"creatorId":&lt;long&gt;,  
"name":"&lt;text&gt;",  
"config":{  
"protocol":"&lt;text&gt;",  
"server":"&lt;text&gt;",  
"port":&lt;ushort&gt;,  
"auth":"&lt;text&gt;",  
"ssl":&lt;int&gt;,  
"debug":&lt;int&gt;,  
"v6type":&lt;int&gt;  
},  
"dataFlags":&lt;uint&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>creatorId</p></td><td><p>ID пользователя, который должен быть создателем ретранслятора.</p></td></tr><tr><td><p>name</p></td><td><p>Имя ретранслятора (4–50&nbsp;символов).</p></td></tr><tr><td><p>config</p></td><td><p>Конфигурация ретранслятора.</p></td></tr><tr><td><p>protocol</p></td><td><p>ID протокола (см. страницу&nbsp;<a href="https://help.wialon.com/help/api/ru/user-guide/api-reference/retranslator/update_config"><strong>update_config</strong></a>).</p></td></tr><tr><td><p>server</p></td><td><p>Сервер для ретрансляции.</p></td></tr><tr><td><p>port</p></td><td><p>Порт (для всех протоколов кроме NIS).</p></td></tr><tr><td><p>auth</p></td><td><p>Авторизация (только для протоколов NIS и Wialon IPS).</p></td></tr><tr><td><p>ssl</p></td><td><p>Использование SSL (для NIS):</p><ul><li>0&nbsp;—&nbsp;нет;</li><li>1&nbsp;—&nbsp;да.</li></ul></td></tr><tr><td><p>debug</p></td><td><p>Использование режима отладки:&nbsp;</p><ul><li>0&nbsp;—&nbsp;нет;</li><li>1&nbsp;—&nbsp;да.</li></ul></td></tr><tr><td><p>v6type</p></td><td><p>Использование протокола ver. 6 (только для Granit Navigator):&nbsp;</p><ul><li>0&nbsp;—&nbsp;нет;</li><li>1&nbsp;—&nbsp;да.</li></ul></td></tr><tr><td><p>dataFlags</p></td><td><p>Флаги со свойствами ретранслятора для возвращаемого результата (см. страницу&nbsp;<a href="https://help.wialon.com/help/api/ru/user-guide/api-reference/format/retranslators"><strong>retranslator</strong></a>).</p></td></tr></tbody></table></div>

## Возвращаемый результат

{  
"item":{ /\* ретранслятор создан \*/  
...  
},  
"flags":&lt;uint&gt; /\* примененные флаги со свойствами \*/  
}

Формат параметра **item** описан на странице [**retranslator**](https://help.wialon.com/ru/api/user-guide/api-reference/format/retranslators).

Возможные коды ошибок:

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Код</p></td><td><p>Описание</p></td></tr><tr><td><p>6</p></td><td><p>Не удалось извлечь создателя или не удалось создать ретранслятор.</p></td></tr><tr><td><p>4</p></td><td><p>Одна из следующих ошибок:</p><ul><li>неверные входные параметры;</li><li>не удалось проверить конфигурацию;</li><li>не удалось создать ретранслятор с указанным протоколом (см. подробности в поле&nbsp;<strong>reason</strong>).</li></ul></td></tr></tbody></table></div>

# create_route

Функция **create_route** используется для создания новых маршрутов.

svc=core/create_route&params={"creatorId":&lt;long&gt;,  
"name":"&lt;text&gt;",  
"dataFlags":&lt;uint&gt;}

## Параметры

| Параметр | Описание |
| --- | --- |
| creatorId | ID пользователя, который должен быть создателем нового маршрута. |
| name | Имя маршрута (4–50 символов). |
| dataFlags | Флаги со свойствами маршрута для возвращаемого результата (см. страницу [routes](https://help.wialon.com/en/api/user-guide/data-format/routes)). |

## Возвращаемый результат

{  
"item":{ /\* маршрут создан \*/  
...  
},  
"flags":&lt;uint&gt; /\* примененные флаги со свойствами \*/  
}

Формат параметра **item** описан на странице [**routes**](https://help.wialon.com/ru/api/user-guide/api-reference/format/routes).

Возможные коды ошибок:

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Код</p></td><td><p>Описание</p></td></tr><tr><td><p>7</p></td><td><p>Не загружена библиотека маршрута.</p></td></tr><tr><td><p>6</p></td><td><p>Одна из следующих ошибок:</p><ul><li>не удалось извлечь создателя маршрута;</li><li>не удалось создать маршрут;</li><li>не удалось проверить права доступа текущего пользователя на маршрут.&nbsp;</li></ul></td></tr><tr><td><p>4</p></td><td><p>Неверных входные параметры.</p></td></tr></tbody></table></div>

# create_unit

Функция **create_unit** используется для создания новых объектов.

svc=core/create_unit&params={"creatorId":&lt;long&gt;,  
"name":"&lt;text&gt;",  
"hwTypeId":&lt;long&gt;,  
"dataFlags":&lt;long&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| creatorId | ID пользователя, который должен быть создателем объекта. |
| name | Имя объекта (4–50 символов). |
| hwTypeId | ID устройства (оборудования). |
| dataFlags | Флаги со свойствами объекта для возвращаемого результата (см. страницу [**unit**](https://help.wialon.com/help/api/ru/user-guide/api-reference/format/units)). |

## Возвращаемый результат

{  
"item":{ /\* объект создан \*/  
...  
},  
"flags":&lt;uint&gt; /\* примененные флаги со свойствами \*/  
}

Формат параметра **item** описан на странице [**unit**](https://help.wialon.com/ru/api/user-guide/api-reference/format/units).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Создатель является пользователем верхнего уровня или не удалось проверить оплату услуги **create_units**. |
| 6   | Не удалось извлечь пользователя-создателя или не удалось создать объект. |
| 4   | Неверные входные параметры. |

# create_unit_group

Функция **create_unit_group** используется для создания групп объектов.

svc=core/create_unit_group&params={"creatorId":&lt;long&gt;,  
"name":"&lt;text&gt;",  
"dataFlags":&lt;uint&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| creatorId | ID пользователя, который должен быть создателем группы объектов. |
| name | Имя группы объектов (4–50 символов). |
| dataFlags | Флаги со свойствами группы объектов для возвращаемого результата (см. страницу [**g**](https://help.wialon.com/help/api/en/user-guide/api-reference/format/user?scroll-translations:language-key=en)[**roup**](https://help.wialon.com/help/api/ru/user-guide/api-reference/format/unit-groups)). |

## Возвращаемый результат

{  
"item":{ /\* группа объектов создана \*/  
...  
},  
"flags":&lt;uint&gt; /\* примененные флаги со свойствами \*/  
}

Формат параметра **item** описан на странице [**g**](https://help.wialon.com/help/api/en/user-guide/api-reference/format/user?scroll-translations:language-key=en)[**roup**](https://help.wialon.com/ru/api/user-guide/api-reference/format/unit-groups).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Создатель является пользователем верхнего уровня или не удалось проверить оплату услуги **create_unit_groups**. |
| 6   | Не удалось извлечь создателя или не удалось создать группу объектов. |
| 4   | Неверные входные параметры. |

# create_user

Функция **create_user** используется для создания пользователей.

svc=core/create_user&params={"creatorId":&lt;long&gt;,  
"name":"&lt;text&gt;",  
"password":"&lt;text&gt;",  
"dataFlags":&lt;uint&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| creatorId | ID пользователя, который должен быть создателем нового пользователя. |
| name | Имя нового пользователя (4–50 символов). |
| password | Пароль нового пользователя. |
| dataFlags | Флаги со свойствами пользователя для возвращаемого результата (см. страницу [**users**](https://help.wialon.com/help/api/ru/user-guide/api-reference/format/users)). |

## Возвращаемый результат

{  
"item":{ /\* пользователь создан \*/  
...  
},  
"flags":&lt;uint&gt; /\* примененные флаги со свойствами \*/  
}

Формат параметра **item** описан на странице [**users**](https://help.wialon.com/ru/api/user-guide/api-reference/format/users).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 1002 | Пользователь с таким именем уже существует. |
| 7   | Создатель является пользователем верхнего уровня или не удалось проверить оплату услуги **create_users**. |
| 6   | Не удалось извлечь создателя или не удалось создать пользователя. |
| 4   | Неверные входные параметры. |

# duplicate

Функция **duplicate** используется для входа в систему от имени другого пользователя. Она дублирует активную сессию.

svc=core/duplicate&params={"operateAs":"&lt;text&gt;",  
"continueCurrentSession":&lt;bool&gt;,  
"appName":"&lt;text&gt;",  
"checkService":"&lt;text&gt;"}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>operateAs</p></td><td><p>Имя пользователя, от имени которого необходимо войти в систему. Если необходимо войти от имени основного пользователя, этот параметр должен быть пустым.</p></td></tr><tr><td><p>continueCurrentSession</p></td><td><p>Параметр, определяющий продолжение предыдущей сессии. Возможные значения:</p><ul><li>false (по умолчанию);</li><li>true — оба SID остаются валидными.&nbsp;</li></ul></td></tr><tr><td><p>appName</p></td><td><p>Дополнительная возможность переименовать приложение в дублированной сессии.</p></td></tr><tr><td><p>checkService</p></td><td><p>Дополнительная возможность проверить оплату услуг текущего пользователя.</p></td></tr></tbody></table></div>

Для получения информации о текущей сессии без создания новой сессии используйте функцию **duplicate** со следующим параметром:

svc=core/duplicate&params={"restore": 1}

## Возвращаемый результат

Формат возвращаемого результата такой же, как для функции [**login**](https://help.wialon.com/ru/api/user-guide/api-reference/token/login).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 1003 | Нет сессии. |
| 8   | Не удалось извлечь подчиненного пользователя (параметр **operateAs**) или не удалось установить права доступа на токены для новой сессии. |
| 7   | Доступ запрещен в соответствии с тарифными правилами (только для параметра **checkService**). |
| 1   | Недопустимая сессия. |

# export_file

Функция **export_file** используется, чтобы эскортировать результаты поиска элементов в файл XLSX.

svc=core/export_file&params={"spec":{  
"itemsType":"&lt;text&gt;",  
"propName":"&lt;text&gt;",  
"propValueMask":"&lt;text&gt;",  
"sortType":"&lt;text&gt;"  
},  
"force":&lt;uint&gt;,  
"flags":&lt;long&gt; /\* флаги колонок \*/  
}

 Другие параметры описаны на странице [**search_items**](https://help.wialon.com/ru/api/user-guide/api-reference/core/search_items).

Флаги:

|     |     |
| --- | --- |
| Значение | Описание |
| Для параметра itemsType типа "user" |     |
| 0x0001 | Имя. |
| 0x0002 | Создатель. |
| 0x0004 | Учетная запись. |
| 0x0008 | Тарифный план. |
| 0x0010 | Последний вход. |
| 0x0020 | Электронная почта. |
| 0x0040 | Хост. |
| 0x0080 | Тип аутентификации. |
| 0x0100 | Телефонный номер для двухфакторной аутентификации. |
| 0x0200 | Статус. |
| 0x0400 | Разрешение на изменение пароля. |
| 0x0800 | Разрешение на создание элементов. |
| 0x1000 | Разрешение на изменение настроек. |
| 0x2000 | Разрешение на отправку SMS. |
| 0x4000 | Временнáя зона. |
| Для параметра itemsType типа "avl_unit" |     |
| 0x0001 | Имя. |
| 0x0002 | Создатель. |
| 0x0004 | Учетная запись. |
| 0x0008 | Тип устройства. |
| 0x0010 | Уникальный ID. |
| 0x0020 | Телефонный номер. |
| 0x0040 | Последнее сообщение. |
| 0x0080 | Создан. |
| 0x0100 | Произвольные поля. |
| 0x0200 | Группы. |
| 0x0400 | Деактивация. |
| Для параметра itemsType типа "avl_unit_group" |     |
| 0x0001 | Имя. |
| 0x0002 | Создатель. |
| 0x0004 | Учетная запись. |
| 0x0008 | Объекты. |
| Для параметра itemsType типа "avl_resource" |     |
| 0x0001 | Имя. |
| 0x0002 | Создатель. |
| 0x0004 | Родительская учетная запись. |
| 0x0008 | Тарифный план. |
| 0x0010 | Права дилера. |
| 0x0020 | Объекты. |
| 0x0040 | Баланс. |
| 0x0080 | Дни. |
| 0x0100 | Статус. |
| 0x0200 | Заблокирована. |
| 0x0400 | Активированные объекты. |
| Для параметра itemsType типа "avl_retranslator" |     |
| 0x0001 | Имя. |
| 0x0002 | Создатель. |
| 0x0004 | Учетная запись. |
| 0x0008 | Протокол. |
| 0x0010 | Сервер. |
| 0x0020 | Состояние. |
| 0x0040 | Объекты для ретрансляции. |
| 0x0080 | Уникальный ID объекта. |

## Возвращаемый результат

В результате возвращается файл XLSX.

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 5   | Не удалось извлечь текущего пользователя. |
| 4   | Неверные входные параметры. |

# export_to_file

Запрос **export_to_file** используется для экспорта результатов поиска из раздела **Корзина** в таблицу в формате XLSX.

svc=core/export_to_file&params={  
"sheets":\[  
{  
"title":"&lt;text&gt;",  
"rows":\[  
\["&lt;text&gt;"\]  
\]  
}  
\],  
"format":&lt;uint&gt;  
}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| sheets\* | Массив объектов таблиц. |
| title\* | Заголовок таблицы. |
| rows\* | Столбцы и строки таблицы. |
| format\* | Формат таблицы. 8 — XLSX. |

## Возвращаемый результат

Если выполнено успешно, возвращается файл в формате XLSX.

### Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 4   | Предоставлены невалидные параметры или указан неподходящий формат. Подходит только формат XLSX, то есть в запросе должно быть указано "format": 8. |
| 5   | Ошибка выполнения запроса (не удалось создать временные директории и/или выполнить метод создания файла). |

# get_hw_cmds

Функция **get_hw_cmds** используется для получения списка команд, доступных для объекта или типа оборудования, или для получения шаблонов команд.

svc=core/get_hw_cmds&params={"deviceTypeId":&lt;long&gt;,  
"unitId":&lt;long&gt;,  
"template":&lt;bool&gt;  
"lang":"&lt;text&gt;"}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| deviceTypeId | ID типа оборудования. |
| unitId | ID объекта. |
| template | Флаг. Если указано 1 (on), возвращается JSON с данными шаблона команды. Необязательный параметр. |
| lang | Флаг. Переводит значения параметров "title" и "label". Необязательный параметр. |

Можно указать один или сразу два параметра. Поиск начинается с ID типа оборудования, а в случае ошибки продолжается по ID объекта. Если необходимо пропустить параметр, укажите в нем 0.

## Возвращаемый результат

В возвращаемом результате содержится список доступных команд если **template:0** или параметра нет:

{  
"&lt;text&gt;":\[ /\* тип связи: GSM, TCP, UDP, VRT \*/  
"&lt;text&gt;", /\* тип команды \*/  
...  
\],  
...  
}

Если во флаге **template** указано 1, возвращается шаблон команды. Это может быть произвольный набор полей. Пример JSON:

{  
"&lt;cmd_template_name&gt;": { /\* имя \*/  
"icon": "&lt;text&gt;", /\* иконка \*/  
"props": \[ /\* свойства \*/  
{  
"label":"&lt;text&gt;", /\* название поля \*/  
"type":"&lt;text&gt;", /\* тип \*/  
"validate":"&lt;text&gt;", /\* правило для валидации \*/  
"value": \[ /\* массив ключей-значений \*/  
{  
"n":"&lt;text&gt;", /\* ключ \*/  
"v":"&lt;text&gt;" /\* значение \*/  
},  
...  
\],  
"default":"&lt;text&gt;", /\* значение по умолчанию (например, порт IP-адреса) \*/  
"title":"&lt;text&gt;", /\* заголовок \*/  
"maxlength":&lt;uint&gt; /\* максимальная длина \*/  
},  
...  
\]  
},  
...  
}

Возможные коды ошибок:

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Код</p></td><td><p>Описание</p></td></tr><tr><td><p>6</p></td><td><p>Не удалось извлечь текущего пользователя.</p></td></tr><tr><td><p>4</p></td><td><p>Одна из следующих ошибок:</p><ul><li>неверные входные параметры;</li><li>не удалось извлечь оборудование по ID;&nbsp;</li><li>не удалось извлечь тарифный план для оборудования.</li></ul></td></tr></tbody></table></div>

# get_hw_types

Функция **get_hw_types** используется для получения списка доступных типов оборудования.

svc=core/get_hw_types&params={"filterType":"&lt;text&gt;",  
"filterValue":\["&lt;text&gt;"|&lt;uint&gt;\],  
"includeType":&lt;bool&gt;,  
"ignoreRename":&lt;bool&gt;}

## Параметры

Все параметры необязательны.

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>filterType</p></td><td><p>Тип фильтра:</p><ul><li>name;</li><li>id;</li><li>type;</li><li>feature.</li></ul></td></tr><tr><td><p>filterValue</p></td><td><p>Массив значений фильтра (через запятую).&nbsp;Значения для разных&nbsp;<strong>filterType</strong> могут быть следующими:</p><ul><li>name&nbsp;—&nbsp;полное имя (имена) оборудования;</li><li>id&nbsp;—&nbsp;ID оборудования;</li><li>type&nbsp;—&nbsp;значения (auto, tracker, mobile, soft).</li></ul></td></tr><tr><td><p>includeType</p></td><td><p>Флаг, который позволяет показывать тип устройства в возвращаемом результате. Значение по умолчанию&nbsp;—&nbsp;<strong>false</strong>.</p></td></tr><tr><td><p>ignoreRename</p></td><td><p>Флаг, который позволяет не переименовывать тип устройства.&nbsp;Значение по умолчанию&nbsp;—&nbsp;<strong>false</strong>.</p></td></tr></tbody></table></div>

## Возвращаемый результат

\[ /\* типы оборудования \*/  
{  
"id":&lt;uint&gt;, /\* ID \*/  
"uid2":&lt;uint&gt;, /\* второй ID \*/  
"name":"&lt;text&gt;", /\* имя \*/  
"hw_category":"&lt;text&gt;", /\* тип оборудования \*/  
"hw_features":"&lt;text&gt;", /\* категория оборудования \*/  
"tp":"&lt;text&gt;", /\* порт TCP \*/  
"up":"&lt;text&gt;" /\* порт UDP \*/  
},  
...  
\]

# get_statistics

Функция **get_statistics** используется для получения сводной статистической информации.

svc=core/get_statistics&params={"resourceId":&lt;long&gt;,  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;,  
"type":"&lt;text&gt;",  
"interval_type":&lt;uint&gt;,  
"recursive":&lt;uint&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Названия</p></td><td><p>Описание</p></td></tr><tr><td><p>resourceId</p></td><td><p>ID ресурса.</p></td></tr><tr><td><p>timeFrom</p></td><td><p>Время (от) в формате Unix.</p></td></tr><tr><td><p>timeTo</p></td><td><p>Время (до) в формате&nbsp;Unix.</p></td></tr><tr><td><p>type</p></td><td><p>Один из следующих: items, logins, hw, sms.</p></td></tr><tr><td><p>interval_type</p></td><td><p>Тип группировки результатов:</p><ul><li>1&nbsp;—&nbsp;по дням;</li><li>2&nbsp;—&nbsp;по неделям;</li><li>4&nbsp;—&nbsp;по месяцам;</li><li>8&nbsp;— по кварталам.</li></ul><p>Значение по умолчанию&nbsp;— 1.</p></td></tr><tr><td><p>recursive</p></td><td><p>В зависимости от значения:</p><ul><li>0&nbsp;—&nbsp;использовать сообщения только из необходимого ресурса;</li><li>1&nbsp;—&nbsp;использовать также сообщения из дочерних ресурсов.</li></ul></td></tr></tbody></table></div>

## Возвращаемый результат

{  
"&lt;timestamp&gt;":{  
"&lt;resource_id&gt;":{  
"&lt;parameter_name&gt;": &lt;int&gt;, /\* пары Имя-Значения параметра статистики \*/  
...  
}  
},  
...,  
"users": {  
"&lt;user_id&gt;": "&lt;text&gt;", /\* ID — пары имен \*/  
...  
<br/>}  
}

Список доступных параметров статистики:

- sms_count;
- sms_nf_count;
- sms_count_&lt;user_id&gt;;
- sms_job_count;
- sms_order_count;
- sms_manual_count;
- sms_auth_count;
- sms_cmd_&lt;sms_type&gt;\_count;
- logins_count_&lt;user_id&gt;;
- logins_duration_&lt;user_id&gt;;
- &lt;unit_type_name&gt;\_deleted;
- &lt;unit_type_name&gt;\_created;
- &lt;item_type_name&gt;\_created;
- &lt;resource_type_name&gt;\_created;
- &lt;type_name&gt;\_created;
- hw_&lt;hw_type_id&gt;;
- &lt;user_type_name&gt;\_created;
- avl_driver_created;
- avl_driver_deleted;
- avl_job_created;
- avl_job_deleted;
- avl_notification_created;
- avl_notification_deleted;
- avl_tag_created;
- avl_tag_deleted;
- avl_trailer_created;
- avl_trailer_deleted;
- avl_geozone_created;
- avl_geozone_deleted;
- avl_unit_sensor_created;
- avl_unit_sensor_deleted;
- avl_unit_activated;
- avl_unit_deactivated;
- avl_unit_total.

Параметр avl_unit_total приходит в ответ на запрос с параметром “type”: “items”**.** Он показывает общее количество объектов, которые относятся к указанной учетной записи и ее дочерним учетным записям.

## Коды ошибок

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь пользователя с требуемым ACL (ADF_ACL_ITEM_VIEW) или непредвиденное значение типа. |
| 4   | Неверные входные параметры. |

# logout

Функция **logout** используется для правильного выхода из системы Wialon.

svc=core/logout&params={}

## Возвращаемый результат

{  
"error":&lt;int&gt; /\* код ошибки \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 0   | Выход выполнен успешно. |
| 1   | Ошибка подключения к серверу. |
| 4   | Неавторизованный пользователь. |

# reset_password_perform

Функция **reset_password_perform** используется для завершения смены пароля.

svc=core/reset_password_perform&params={"user":"&lt;text&gt;",  
"code":"&lt;text&gt;"}

## Параметры

После выполнения запроса [**reset_password_request**](https://help.wialon.com/ru/api/user-guide/api-reference/core/reset_password_request) пользователь получает электронное письмо со ссылкой. Ссылка ведет на URL-адрес, указанный в запросе, и содержит в себе два параметра, необходимых для завершения смены пароля:

|     |     |
| --- | --- |
| Название | Описание |
| user | Имя пользователя. |
| code | Код, сгенерированный после выполнения запроса **reset_password_request** и отправленный на электронную почту пользователя. |

## Возвращаемый результат

{  
"newPassword":"&lt;text&gt;" /\* новый пароль \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 4   | Неверные входные параметры или ошибка при сбросе пароля. |

# reset_password_request

Функция **reset_password_request** используется для сброса пароля.

svc=core/reset_password_request&params={"user":"&lt;text&gt;",  
"url":"&lt;text&gt;",  
"email":"&lt;text&gt;"}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| user | Имя пользователя. |
| url | URL-адрес, отправленный на электронную почту после выполнения запроса на смену пароля: &lt;url&gt;?user=&lt;login&gt;&passcode=&lt;passcode&gt;. См. значение **passcode** на странице [**reset_password_perform**](https://help.wialon.com/help/api/ru/user-guide/api-reference/core/reset_password_perform). |
| email | Электронный адрес пользователя. |

## Возвращаемый результат

{  
"error":0 /\* успешный запрос \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 11  | См. подробности в поле **reason**. |

# search_item

Функция **search_item** используется для поиска элемента по определенному ID.

svc=core/search_item&params={"id":&lt;long&gt;,  
"flags":&lt;long&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| id  | ID элемента. |
| flags | Флаги со свойствами для возвращаемого результата. Значение этого параметра зависит от типа элемента. Форматы данных всех типов элементов и их флаги описаны в разделе [**format**](https://help.wialon.com/help/api/ru/user-guide/api-reference/format). |

## Возвращаемый результат

{  
"item":{ /\* найденный элемент \*/  
...  
},  
"flags":&lt;uint&gt; /\* примененные флаги со свойствами \*/  
}

Формат параметра **item** зависит от типа элемента. Все форматы описаны в разделе [**format**](https://help.wialon.com/ru/api/user-guide/api-reference/format).

Возможные коды ошибок:

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Код</p></td><td><p>Описание</p></td></tr><tr><td><p>7</p></td><td><p>Одна из следующих ошибок:</p><ul><li>не удалось получить текущего пользователя;</li><li>не удалось найти элемент с указанным ID;</li><li>элемент неактивен.&nbsp;</li></ul></td></tr><tr><td><p>6</p></td><td><p>Нет сессии.</p></td></tr></tbody></table></div>

# search_items

Функция search_items используется для поиска элементов по определенным свойствам.

svc = core/search_items  
params = {  
"spec": {  
"itemsType": "&lt;text&gt;",  
"propName": "&lt;text&gt;",  
"propValueMask": "&lt;text&gt;",  
"sortType": "&lt;text&gt;",  
"propType": "&lt;text&gt;",  
"or_logic": &lt;bool&gt;  
},  
"force": &lt;uint&gt;,  
"flags": &lt;long&gt;,  
"from": &lt;uint&gt;,  
"to": &lt;uint&gt;  
}

## Параметры

<div class="joplin-table-wrapper"><table><thead><tr><th><p>Название</p></th><th><p>Описание</p></th></tr></thead><tbody><tr><td><p>spec</p></td><td><p>Условия поиска.</p></td></tr><tr><td><p>itemsType</p></td><td><p>Тип элементов (см. список ниже).</p></td></tr><tr><td><p>propName</p></td><td><p>Имя свойства, по значению которого выполняется поиск (см. список возможных свойств ниже). Можно использовать символ |.</p></td></tr><tr><td><p>propValueMask</p></td><td><p>Маска значения свойства. Можно использовать следующие символы: * | , &gt; &lt; =.</p></td></tr><tr><td><p>sortType</p></td><td><p>Имя свойства, используемого для сортировки.</p></td></tr><tr><td><p>propType</p></td><td><p>Тип свойства (см. список ниже).</p></td></tr><tr><td><p>or_logic</p></td><td><p>Флаг логики ИЛИ для параметра propName (см. раздел <a href="#search-items-ms">Поиск по нескольким свойствам</a>).</p></td></tr><tr><td><p>force</p></td><td><p>В зависимости от значения:<br></p><ul><li>0 — если такой поиск уже был, вернуть результат;</li><li>1 — выполнить новый поиск.</li></ul></td></tr><tr><td><p>flags</p></td><td><p>Флаги со свойствами для возвращаемого результата. Значение этого параметра зависит от типа элемента. Форматы данных всех типов элементов и их флаги описаны в разделе <a href="https://help.wialon.com/ru/api/user-guide/data-format">Формат данных</a>.</p></td></tr><tr><td><p>from</p></td><td><p>Индекс первого возвращаемого элемента. Для нового поиска укажите 0.</p></td></tr><tr><td><p>to</p></td><td><p>Индекс последнего возвращаемого элемента. Если указано 0, возвращаются все элементы, начиная с индекса, указанного в параметре from.</p></td></tr></tbody></table></div>

## Типы элементов

Типы элементов (параметр itemsType):

- avl_hw — тип оборудования;
- avl_resource — ресурс;
- avl_retranslator — ретранслятор;
- avl_unit — объект;
- avl_unit_group — группа объектов;
- user — пользователь;
- avl_route — маршрут.

## Свойства элементов

Свойства элементов (параметры propName и sortType):

- sys_name — имя элемента;
- sys_id — ID элемента;
- sys_unique_id — уникальный ID объекта (IMEI);
- sys_phone_number — телефонный номер объекта;
- sys_phone_number2 — второй телефонный номер объекта;
- sys_user_creator — ID создателя;
- rel_user_creator_name — имя создателя;
- sys_billing_account_guid — ID учетной записи;
- rel_billing_account_name — имя учетной записи;
- rel_billing_parent_account_name — имя родительской учётной записи;
- rel_billing_plan_name — имя тарифного плана;
- sys_comm_state — состояние оборудования (1 — подключено, 0 — отключено);
- rel_hw_type_name — имя оборудования;
- rel_hw_type_id — ID оборудования;
- sys_account_balance — баланс учётной записи;
- sys_account_days — количество дней для учётной записи;
- sys_account_enable_parent — права дилера (1 — есть, 0 — нет);
- sys_account_disabled — учетная запись заблокирована (1 — да, 0 — нет);
- rel_account_disabled_mod_time — время последнего изменения свойства sys_account_disabled, время UNIX;
- rel_account_units_usage — количество объектов в учетной записи;
- rel_last_msg_date — время последнего сообщения, время UNIX;
- rel_is_account — является ли ресурс учетной записью (1 — да, 0 — нет);
- login_date — время последнего входа в систему, время UNIX;
- retranslator_enabled — состояние ретранслятора ( 1 — запущен, 0 — остановлен);
- rel_creation_time — время создания;
- rel_group_unit_count — количество объектов в группе;
- rel_customfield_name — имя произвольного поля объекта;
- rel_customfield_value — значение произвольного поля объекта;
- rel_profilefield_name — имя характеристики объекта;
- rel_profilefield_value — значение поля характеристики объекта;
- rel_adminfield_name — имя административного поля объекта;
- rel_adminfield_value — значение административного поля объекта;
- rel_customfield_name — имя и значение произвольного поля объекта, разделены :;
- rel_profilefield_name — имя и значение поля характеристики объекта, разделены :;
- rel_adminfield_name — имя и значение административного поля объекта, разделены :.

Другие значения этого параметра описаны в таблице ниже.

## Тип свойства

Типы свойств (параметр propType):

- property — свойство;
- list — список;
- propitemname — имя подэлемента (например, геозона является подэлементом ресурса);
- creatortree — цепочка создателей (в результате поиска такого типа возвращается список элементов, в цепочке создателей которых есть пользователь, указанный в параметре propValueMask);
- accounttree — цепочка учетных записей (в результате поиска такого типа возвращается список элементов, в цепочке учетных записей которых есть учетная запись, указанная в параметре propValueMask);
- customfield — произвольные поля;
- profilefield — характеристики объекта;
- adminfield — административные поля;
- servicename — услуги.

## Подэлементы

Для поиска подэлементов укажите значение propitemname в параметре propType. Другие параметры могут иметь следующие значения:

| Элемент (параметр itemsType) | Подэлемент (параметры propName и sortType) | Описание |
| --- | --- | --- |
| avl_unit | unit_sensors | Датчики. |
| avl_unit | unit_commands | Команды. |
| avl_unit | service_intervals | Интервалы техобслуживания. |
| avl_resource | drivers | Водители |
| avl_resource | driver_groups | Группы водителей. |
| avl_resource | jobs | Задания. |
| avl_resource | notifications | Уведомления. |
| avl_resource | trailers | Прицепы. |
| avl_resource | trailer_groups | Группы прицепов. |
| avl_resource | zones_library | Геозоны. |
| avl_resource | reporttemplates | Шаблоны отчетов. |
| avl_resource | orders | Заявки. |
| avl_route | rounds | Рейсы. |
| avl_route | route_schedules | Расписания. |
| avl_retranslator | retranslator_units | Ретранслируемые объекты. |
| avl_unit  <br>user  <br>avl_resource | custom_fields | Произвольные поля. |
| avl_unit  <br>user  <br>avl_resource | admin_fields | Административные поля. |

## Типы сортировки 

По умолчанию прямая сортировка работает следующим образом:

- любое имя разбивается на составляющие для сортировки (символы и числа);
- сначала сортируются числа, а затем символы;
- символ - считается дефисом и сортируется до символов и чисел (см. [специальную сортировку](#special));
- в системе поддерживается сортировка чисел с точкой (3.12) и чисел с плавающей точкой (2e10; 5.1E-2).

Доступны следующие типа сортировки:

| Сортировка | Описание |
| --- | --- |
| Прямая | Возвращаются значения, отсортированные по возрастанию:  <br>"sortType":"&lt;item_property&gt;" |
| Обратная | Возвращаются значения, отсортированные по убыванию:  <br>"sortType":"!&lt;item_property&gt;" |
| Комбинированная | Возвращаются значения, отсортированные по первому свойству, а в случае равенства значений — по второму свойству и т. д.:  <br>"sortType":"&lt;property1&gt;,!&lt;property2&gt;" |
| Специальная | Согласно этому типу сортировки символ - считается обозначением отрицательного числа. По умолчанию символ “-” считается дефисом, а не минусом.  <br>"sortType":"-&lt;item_property&gt;" |

## Поиск по нескольким свойствам

Можно искать элементы по нескольким свойствам сразу. Например:

"itemsType":"avl_resource",  
"propName":"rel_is_account,\*",  
"propValueMask":"1,qwe",  
"sortType":"sys_name",  
"propType":"property,customfield"

Количество свойств в параметрах propName, propType и propValueMask должно быть одинаковым, поскольку они учитываются вместе.

По умолчанию для параметра propName работает логика И. Это значит, что в результате поиска будут перечислены все учетные записи (rel_is_account:1), имена которых начинаются с “foo” (sys_name:"foo\\\*").

Чтобы включить логику ИЛИ для параметра propName, укажите ''or_logic'':1 в запросе.

## Использование операторов сравнения в поиске

В параметре propValueMask можно использовать следующие операторы сравнения: &lt;, &gt;, =, >=, <=. Если поле для поиска строковое, то будет поиск чисел только в начале значения. Если поле числовое, анализируется все значение.

### Пример 1

"itemsType": "avl_unit",  
"propName": "sys_name,sys_name",  
"propValueMask": ">=32,<33.5"

В результате поиска будут перечислены все объекты, имена которых начинаются с чисел в диапазоне от 32 до 33.5.

### Пример 2

"itemsType": "avl_resource",  
"propName": "sys_account_balance,sys_account_balance",  
"propValueMask": ">2,<=23"

В результате поиска будут перечислены все ресурсы и учетные записи, баланс которых больше 2, но меньше или равен 23.

Вы также можете использовать оператор =, если значение поля начинается с > или <.

### Пример 3

"itemsType":"avl_unit",  
"propName":"sys_name",  
"propValueMask":"=>123&lt;,=<123&gt;"

В результате поиска будут перечислены все доступные объекты с именами >123&lt; и <123&gt;.

## Возвращаемый результат

{  
"searchSpec": { /\* условия поиска \*/  
"itemsType": "&lt;text&gt;", /\* тип элементов \*/  
"propName": "&lt;text&gt;", /\* имя свойства \*/  
"propValueMask": "&lt;text&gt;", /\* маска значения \*/  
"sortType": "&lt;text&gt;", /\* свойство для сортировки \*/  
"propType": "&lt;text&gt;" /\* тип свойства \*/  
},  
<br/>"dataFlags": &lt;uint&gt;, /\* примененные флаги \*/  
"totalItemsCount": &lt;uint&gt;, /\* количество найденных элементов \*/  
"indexFrom": &lt;uint&gt;, /\* начальный индекс \*/  
"indexTo": &lt;uint&gt;, /\* конечный индекс \*/  
<br/>"items": \[  
{ ... } /\* найденные элементы \*/  
\]  
}

Формат массива items зависит от типа элемента. Все форматы описаны в разделе [Формат данных](https://help.wialon.com/ru/api/user-guide/data-format).

Коды ошибок:

| Код | Описание |
| --- | --- |
| 4   | Неверные входные параметры. |

# set_session_property

Запрос **set_session_property** используется для настройки некоторых параметров текущей сессии.

svc=core/set_session_property&params={"prop_name":"&lt;text&gt;", "prop_value":"&lt;text&gt;"}

## Параметры

Допустимые имена свойств (prop_name):

- skip_nonactive_items — позволяет скрывать деактивированные объекты (по умолчанию показываются все объекты сессии);
- long_values — если указано 1, с сервера отправляются длинные числа в виде строк (в скобках).

Для обоих случаев **prop_value** должен быть:

- 1 — активировать;
- 2 — деактивировать.

## Пример

svc=core/set_session_property&params={"prop_name": "skip_nonactive_items","prop_value": "1"}

## Возвращаемый результат

{ }

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Сессия не найдена или не удалось задать свойство. |
| 4   | Неверные входные параметры. |

# update_data_flags

Функция **update_data_flags** используется для добавления и удаления элементов из сессии. Добавление элементов в сессию необходимо для того, чтобы получать события от них.

svc=core/update_data_flags&params={"spec":\[  
{  
"type":"&lt;text&gt;",  
"data":&lt;long|text|\[long\]&gt;,  
"flags":&lt;long&gt;,  
"mode":&lt;uint&gt;,  
"max_items":&lt;uint&gt;  
}  
\]}

## Параметры 

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>spec</p></td><td><p>Массив объектов с конфигурацией для запроса на изменение элементов, находящихся в сессии.</p></td></tr><tr><td><p>type</p></td><td><p>Метод передачи элементов в сессию:</p><ul><li><strong>id</strong>&nbsp;— по ID. Если выбран этот метод, в параметре&nbsp;<strong>data</strong>&nbsp;необходимо указать ID элемента.</li><li><strong>type</strong>&nbsp;— по типу. Если выбран этот метод, то в параметре&nbsp;<strong>data</strong>&nbsp;необходимо указать тип элементов (см.&nbsp;<a href="https://help.wialon.com/ru/api/user-guide/api-reference/core/search_items"><strong>search_items</strong></a>).</li><li><strong>col</strong>&nbsp;— по списку ID. Если выбран этот метод, то в параметре&nbsp;<strong>data</strong>&nbsp;необходимо указать массив ID интересующих вас элементов.</li><li><strong>access</strong>&nbsp;— подписка на события о создании/удалении, получении/лишении прав доступа items, в параметре&nbsp;<strong>data</strong>: 1 — включить, 0 — выключить.</li></ul></td></tr><tr><td><p>data</p></td><td><p>Данные. Этот параметр зависит от предыдущего.&nbsp;</p></td></tr><tr><td><p>flags</p></td><td><p>Флаги, определяющие, какая информация об элементах должна добавляться в сессию. Флаги элементов каждого типа описаны в разделе&nbsp;<a href="https://help.wialon.com/ru/api/user-guide/data-format"><strong>Формат данных</strong></a>.</p></td></tr><tr><td><p>mode</p></td><td><p>Режим применения флагов:</p><ul><li>0 — переопределить флаги для указанных элементов.</li><li>1 — добавить указанные флаги к ужé имеющимся в сессии.</li><li>2 — удалить указанные флаги из сессии (при удалении базового флага элемент удаляется из сессии).</li></ul><p>Флаги устанавливаются для того, чтобы следить за изменениями каких-либо конкретных свойств элемента. Количество установленных флагов зависит от ваших нужд. Если вам необходимо получать все события, то все флаги должны быть установлены. Получить события можно, используя функцию <a href="https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_evts"><strong>avl_evts</strong></a>.</p></td></tr><tr><td><p>max_items</p></td><td><p>Максимальное количество подписанных items. Доступен только при&nbsp;type='type'.</p></td></tr></tbody></table></div>

## Возвращаемый результат

\[ /\* массив элементов \*/  
{  
"i":&lt;long&gt;, /\* ID \*/  
"d":{ /\* другие поля \*/  
...  
},  
"f":&lt;long&gt; /\* примененные флаги со свойствами \*/  
},  
...  
\]

Формат поля **“d”** зависит от типа возвращаемого элемента. Если при отправке этого запроса указан режим применения флагов **“2”**, то в поле “d” возвращается значение **null.** Форматы всех типов элементов описаны в разделе [**Формат данных**](https://help.wialon.com/ru/api/user-guide/data-format).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 4   | Неверные входные параметры или ошибка при обновлении флагов. |

# use_auth_hash

Функцию **use_auth_hash** можно использовать вместе с [**create_auth_hash**](https://help.wialon.com/ru/api/user-guide/api-reference/core/create_auth_hash) вместо функции [**duplicate**](https://help.wialon.com/ru/api/user-guide/api-reference/core/duplicate). В поле **authHash** необходимо ввести результат запроса **create_auth_hash**.

svc=core/use_auth_hash&params={"authHash":"&lt;text&gt;",  
"operateAs":"&lt;text&gt;",  
"checkService":"&lt;text&gt;"}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| authHash | Хэш авторизации, который можно получить с помощью запроса [**create_auth_hash**](https://help.wialon.com/help/api/ru/user-guide/api-reference/core/create_auth_hash). |
| operateAs | Имя подчиненного пользователя, от имени которого необходимо войти в систему. |
| checkService | Можно проверить с помощью [**get_account_data**](https://help.wialon.com/help/api/ru/user-guide/api-reference/account/get_account_data) (см. раздел **Service list**). |

## Возвращаемый результат

{  
"eid":"&lt;text&gt;", /\* ID сессии \*/  
"gis_sid":"&lt;text&gt;", /\* ID сессии для GIS-сервисов \*/  
"host":"&lt;text&gt;", /\* хост \*/  
"hw_gw_ip":"&lt;text&gt;", /\* IP шлюза оборудования \*/  
"au":"&lt;text&gt;", /\* имя пользователя \*/  
"hl":&lt;int&gt;, /\* есть ID входа в систему; при наличии поля — true (значение всегда 1) \*/  
"tm":&lt;uint&gt;, /\* текущее время (UTC) \*/  
"wsdk_version":"&lt;text&gt;", /\* версия SDK \*/  
"base_url":"&lt;text&gt;",  
"hw_gw_ip":"&lt;text&gt;", /\* IP шлюза оборудования \*/  
"hw_gw_dns":"&lt;text&gt;", /\* DNS шлюза оборудования \*/  
"gis_search":"&lt;text&gt;", /\* URL-адрес поиска GIS \*/  
"gis_render":"&lt;text&gt;", /\* URL-адрес отрисовки GIS \*/  
"gis_geocode":"&lt;text&gt;", /\* URL-адрес геокодирования GIS \*/  
"gis_routing":"&lt;text&gt;", /\* URL-адрес маршрутизации GIS \*/  
"token":"&lt;text&gt;", /\* токен сессии \*/  
"th":"&lt;text&gt;", /\* хэш токена \*/  
"web_site":"&lt;text&gt;", /\* URL-адрес системы мониторинга Wialon \*/  
"web_cms_manager_site":"&lt;text&gt;" /\* URL-адрес системы управления Wialon \*/  
"user":{ /\* пользователь, от имени которого необходимо войти в систему \*/  
"nm":"&lt;text&gt;", /\* имя \*/  
"cls":&lt;uint&gt;, /\* ID суперкласса "пользователь" \*/  
"id":&lt;long&gt;, /\* ID \*/  
"prp":{ /\* произвольные свойства, например: \*/  
"dst":"&lt;text&gt;", /\* переход на летнее время \*/  
"language":"&lt;text&gt;", /\* язык (двухбуквенный код) \*/  
"msakey":"&lt;text&gt;", /\* ключ доступа к мобильному сайту \*/  
"pcal":"&lt;text&gt;", /\* Персидский календарь \*/  
"tz":"&lt;text&gt;", /\* временнáя зона \*/  
"us_units":"&lt;text&gt;", /\* американские единицы измерения (мили и галлоны) \*/  
...  
},  
"crt":&lt;uint&gt;, /\* ID создателя \*/  
"bact":&lt;uint&gt;, /\* ID учетной записи \*/  
"fl":&lt;uint&gt;, /\* флаги пользователя \*/  
"hm":"&lt;text&gt;", /\* маска хоста \*/  
"uacl":&lt;uint&gt;, /\* доступ пользователя на самого себя \*/  
"mu": &lt;uint&gt;, /\* система мер \*/  
"ct": &lt;uint&gt;, /\* дата создания пользователя \*/  
"ftp": {"&lt;text&gt;"}, /\* настройки FTP-сервера \*/  
"ld": &lt;uint&gt;, /\* дата предыдущего входа \*/  
"pfl": &lt;uint&gt;, /\* флаг создателя \*/  
"ap": { /\* настройки двухфакторной аутентификации \*/  
"type":&lt;uint&gt;, /\* тип аутентификации (0 — выключено, 1 — email, 2 — SMS) \*/  
"phone":"&lt;text&gt;" /\* телефонный номер \*/  
},  
"mapps": {"&lt;text&gt;"}, /\* список мобильных приложений \*/  
"mappsmax": &lt;int&gt; /\* ограничения для мобильных приложений в соответствии с тарифным планом \*/  
},  
"classes":{ /\* суперклассы, доступные текущему пользователю (ключ — имя суперкласса, значение — ID суперкласса): \*/  
"avl_hw":&lt;uint&gt;, /\* тип оборудования \*/  
"avl_resource":&lt;uint&gt;, /\* ресурс \*/  
"avl_retranslator":&lt;uint&gt;, /\* ретранслятор \*/  
"avl_unit":&lt;uint&gt;, /\* объект \*/  
"avl_unit_group":&lt;uint&gt;, /\* группа объектов \*/  
"user":&lt;uint&gt;, /\* пользователь \*/  
"avl_route":&lt;uint&gt; /\* маршрут \*/  
}  
"features":{  
"unlim":&lt;bool&gt;, /\* тип тарифного плана: 0 — обычный, 1 — специальный (для разработки/тестирования) \*/  
"svcs":{ /\* хэш-набор разрешенных услуг; если в нем нет какой-либо услуги, она запрещена \*/  
"&lt;service_name&gt;":&lt;bool&gt;, /\* ключ — имя услуги; значение: 0 — услуга доступна, но достигнут лимит, 1 — услуга доступна для использования \*/  
...  
}  
}  
}

 Для получения дополнительной информации о **&lt;service_name&gt;** см. [список услуг](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_data#get_account_data-Services).

Флаги пользователя описаны на странице [**update_user_flags**](https://help.wialon.com/ru/api/user-guide/api-reference/user/update_user_flags).

Подробнее об FTP-настройках читайте на странице [**update_ftp_property**](https://help.wialon.com/ru/api/user-guide/api-reference/item/update_ftp_property).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 1003 | См. подробности в поле **reason**. |
| 8   | Ошибка входа. |
| 7   | Доступ запрещен. |
| 4   | Неверные входные параметры. |

# events

В этом разделе описаны методы для работы с событиями.

# check_updates

Чтобы получить изменения событий по всем объектам в сессии, используйте команду **events/check_updates**:

svc=events/check_updates&params={"lang":&lt;text&gt;,  
"measure":&lt;uint&gt;,  
"detalization":&lt;uint&gt;}

## Параметры

Все параметры необязательны.

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Параметр</p></td><td><p>Описание</p></td><td><p>Значение по умолчанию</p></td></tr><tr><td><p>lang</p></td><td><p>Язык (двухсимвольный код).</p></td><td><p>en</p></td></tr><tr><td><p>measure</p></td><td><p>Система измерения:</p><ul><li>0 —&nbsp;СИ;</li><li>1 —&nbsp;американская;</li><li>2 —&nbsp;имперская.</li></ul></td><td><p>0</p></td></tr><tr><td><p>detalization</p></td><td><p>Флаги вывода (см. ниже). Должны быть указаны в десятичном формате.</p></td><td><p>0x7</p></td></tr></tbody></table></div>

### Флаги вывода

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x1 | Базовый JSON: начало — конец события. |
| 0x2 | Данные конкретного детектора. |
| 0x4 | Пользовательские параметры (те, которые пользователь указал для этого события). |
| 0x10 | Полный JSON. Каждый детектор интерпретирует его по-своему. |
| 0x20 | Форматированное значение. |

### Типы датчиков

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Значение type</p></td><td><p>Описание</p></td><td><p>Регистрация событий</p></td></tr><tr><td><p>1</p></td><td><p><strong>Датчики-переключатели:</strong></p><ul><li>engine operation&nbsp;— датчик зажигания;</li><li>digital&nbsp;— произвольный цифровой датчик;</li><li>engine efficiency&nbsp;— датчик полезной работы двигателя;</li><li>private mode&nbsp;— частный режим;</li><li>alarm trigger&nbsp;— тревожная кнопка;</li><li>counter&nbsp;— счетчик (переключатель на ВКЛ/на ВЫКЛ).</li></ul></td><td><p>События регистрируются от<br>момента включения датчика до его выключения.</p></td></tr><tr><td><p>2</p></td><td><p><strong>Мгновенные датчики:</strong></p><ul><li>odometer&nbsp;— относительный одометр;</li><li>relative engine hours&nbsp;— относительные моточасы;</li><li>instant fuel consumption&nbsp;— датчик мгновенного расхода топлива;</li><li>counter&nbsp;— счетчик (мгновенный).</li></ul></td><td><p>События регистрируются от<br>первого ненулевого значения датчика до последнего.</p></td></tr><tr><td><p>3</p></td><td><p><strong>Дифференциальные датчики:</strong></p><ul><li>mileage&nbsp;— датчик пробега;</li><li>engine hours - абсолютные моточасы;</li><li>impulse fuel consumption&nbsp;— импульсный датчик расхода топлива;</li><li>absolute fuel consumption&nbsp;— датчик абсолютного расхода топлива;</li><li>counter&nbsp;— счетчик (с переполнением/без переполнения);</li><li>fuel level impulse sensor&nbsp;— импульсный датчик уровня топлива.</li></ul></td><td><p>События регистрируются от<br>начала роста значения датчика до<br>окончания.</p></td></tr><tr><td><p>4</p></td><td><p><strong>Аналоговые датчики:</strong>&nbsp;</p><ul><li>temperature&nbsp;— датчик температуры;</li><li>engine rpm&nbsp;— датчик оборотов двигателя;</li><li>voltage -— датчик напряжения;</li><li>weight sensor&nbsp;— датчик веса;</li><li>accelerometer&nbsp;— акселерометр;</li><li>temperature coefficient&nbsp;— коэффициент температуры;</li><li>custom&nbsp;— произвольный датчик</li></ul></td><td><p>События не регистрируются.</p></td></tr></tbody></table></div>

## Возвращаемый результат

Результат зависит от используемого флага.

### Флаг 0x1

Возвращается базовый JSON (для всех групп датчиков).

"&lt;type_name&gt;": {  
"&lt;sensor_id&gt;": {  
"from": {  
"t":&lt;uint&gt;, /\* время (UNIX-время) \*/  
"y":&lt;double&gt;, /\* широта\*/  
"x":&lt;double&gt; /\* долгота\*/  
},  
"to": {  
"t":&lt;uint&gt;, /\* время (UNIX-время) \*/  
"y":&lt;double&gt;, /\* широта\*/  
"x":&lt;double&gt; /\* долгота\*/  
},  
"m":&lt;uint&gt;, /\* время последнего сообщения \*/  
"f":&lt;uint&gt; /\* служебный флаг \*/  
}  
}

### Флаг 0x2 

Возвращаются данные конкретного детектора.

"ignition": {  
"&lt;sensor_id&gt;":  
{  
"state":&lt;uint&gt;, /\* состояние: 0 -— выключен, 1 -— включен\*/  
"type": 1, /\* тип датчика: датчик-переключатель \*/  
"hours":&lt;uint&gt;, /\* моточасы за всю историю, с \*/  
"switches":&lt;uint&gt;, /\* количество срабатываний за всю историю \*/  
"value":&lt;bool&gt; /\* текущее значение \*/  
}  
...  
}

Все типы датчиков для **sensors**:

"sensors": {  
"&lt;sensor_id1&gt;":  
{  
"state":&lt;uint&gt;, /\* состояние: 0 -— выключен, 1 -— включен \*/  
"type": 1, /\* тип датчика: датчик-переключатель \*/  
"hours":&lt;uint&gt;, /\* моточасы за всю историю, с \*/  
"switches":&lt;uint&gt;, /\* количество срабатываний за всю историю \*/  
"value":&lt;bool&gt; /\* текущее значение \*/  
},  
"&lt;sensor_id2&gt;":  
{  
"type": 2, /\* тип датчика: мгновенный датчик \*/  
"counter":&lt;uint&gt;, /\* сообщений подряд в событии \*/  
"summary":&lt;uint&gt;, /\* сумма значений в событии \*/  
"total_counter":&lt;uint&gt;, /\* количество сообщений за всю историю \*/  
"total_summary"&lt;uint&gt;, /\* сумма значений за всю историю \*/  
"value":&lt;double&gt; /\* последнее значение; если -348201.3876, значение неизвестно \*/  
},  
"&lt;sensor_id3&gt;":  
{  
"type": 3, /\* тип датчика: дифференциальный датчик \*/  
"counter":&lt;uint&gt;, /\* сумма значений в событии \*/  
"total_counter":&lt;uint&gt;, /\* сумма значений за всю историю \*/  
"value":&lt;double&gt; /\* последнее значение; если -348201.3876, значение неизвестно \*/  
},  
"&lt;sensor_id4&gt;":  
{  
"type": 4, /\* тип датчика: аналоговый датчик \*/  
"value":&lt;double&gt; /\* последнее значение; если -348201.3876, значение неизвестно \*/  
}  
}

"lls": {  
"&lt;sensor_id&gt;":  
{  
"value":&lt;double&gt;, /\* последнее значение из сообщения, для которого рассчитано level \*/  
"level":&lt;double&gt;, /\* среднее медианное значение (используется указанное значение фильтрации ДУТ) \*/  
"filled":&lt;double&gt; /\* объем заправленного топлива \*/  
}  
}

"trips": {  
"state":&lt;bool&gt;, /\* состояние: 0 -— стоянка, 1 -— поездка, 2 -— остановка \*/  
"max_speed":&lt;uint&gt;, /\* максимальная скорость в поездке \*/  
"curr_speed":&lt;uint&gt;, /\* текущая скорость \*/  
"avg_speed":&lt;uint&gt;, /\* средняя скорость относительно distance \*/  
"distance":&lt;uint&gt;, /\* пробег по GPS в поездке \*/  
"odometer":&lt;uint&gt;, /\* расстояние за все поездки \*/  
"course":&lt;uint&gt;, /\* направление движения\*/  
"altitude":&lt;uint&gt; /\* высота\*/  
}

"counters": {  
"engine_hours": &lt;uint&gt;, /\* счетчик моточасов \*/  
"mileage": &lt;uint&gt;, /\* счетчик пробега \*/  
"bytes": &lt;uint&gt; /\* счетчик GPRS-трафика \*/  
}

### Флаг 0x4

Возвращаются пользовательские параметры. Зависит от того, что пользователь указал для конкретного события.

"&lt;type_name&gt;": {  
"&lt;sensor_id&gt;": {  
"p":{ /\* определенный пользователем контент объекта \*/  
"test":2,  
"foo":"bar",  
"trips":1  
}  
}  
}

### Флаг 0x10 

Возвращается полный JSON.

Для датчиков с ‘‘type=2’’ и ‘‘type=3’’ (кроме датчика уровня топлива) возвращается следующий результат:

"sensors": {  
"&lt;sensor_id&gt;":  
{  
"msgs": \[  
{  
"tm":&lt;uint&gt;, /\* время сообщения (UNIX-время) \*/  
"v":&lt;double&gt; /\* значение\*/  
},  
...  
\]  
},  
...  
}

Для датчиков уровня топлива возвращается следующий результат:

"lls": {  
"&lt;sensor_id&gt;": {  
"msgs": \[  
{  
"tm":&lt;uint&gt;, /\* время сообщения (UNIX-время) \*/  
"v":&lt;double&gt;, /\* значение \*/  
"l":&lt;double&gt; /\* среднее медианное значение (используется указанное значение фильтрации ДУТ) \*/  
},  
...  
\]  
}  
},  
...  
}

### Флаг 0x20

Возвращаются форматированные значения.

"ignition": {  
"sensor_id": {  
"format": {  
"value":&lt;text&gt; /\* форматированное значение (обычно «Вкл.»/«Выкл.») \*/  
}  
}  
}

"sensors": {  
"sensor_id": {  
"format": {  
"value":&lt;text&gt; /\* форматированное значение, зависит от типа датчика и установленного формата \*/  
}  
}  
}

"trips": {  
"format": {  
"distance":&lt;text&gt;, /\* пробег относительно предыдущего сообщения \*/  
"avg_speed":&lt;text&gt; /\* средняя скорость относительно distance \*/  
}  
}

"lls": {  
"sensor_id": {  
"format": {  
"value":&lt;text&gt;, /\* форматированное значение, зависит от типа датчика и установленного формата \*/  
"filled":&lt;text&gt; /\* объем заправленного топлива \*/  
}  
}  
}

"counters": {  
"format": {  
"engine_hours":&lt;uint&gt;, /\* форматированное значение счетчика моточасов \*/  
"mileage":&lt;text&gt;, /\* форматированное значение счетчика пробега \*/  
"bytes":&lt;uint&gt; /\* форматированное значение счетчика GPRS-трафика \*/  
}  
}

### Коды ошибок

Если запрос не выполнен, возвращается код ошибки.

|     |     |
| --- | --- |
| Код | Описание |
| 1   | Неверный или устаревший SID запроса. |
| 4   | Ошибка валидации параметров. |
| 7   | Не удалось загрузить библиотеку **adf_avl_events** или получить запись в формате JSON. |

# unload

Чтобы выгрузить события из сессии, используйте команду **events/unload.**

svc=events/unload&params={}

## Возвращаемый результат

При успешном выполнении запроса возвращается пустой ответ.

{ }

В обратном случае возвращается код ошибки.

### Коды ошибок

| Код | Описание |
| --- | --- |
| 1   | Неправильный или устаревший SID запроса. |
| 4   | Ошибка валидации параметров. |
| 7   | Не удалось загрузить библиотеку **adf_avl_events**. |

# update_units

Для добавления объектов в сессию используйте запрос **events/update_units**.

svc=events/update_units&params={"mode":"add",  
"units":\[  
{  
"id":&lt;long&gt;,  
"detect":  
{  
"trips":&lt;uint&gt;,  
"lls":&lt;uint&gt;,  
"sensors":&lt;uint&gt;,  
"ignition":&lt;uint&gt;,  
"counters":&lt;uint&gt;  
}  
},  
...  
\]}

Для удаления определенных объектов из сессии используйте следующую сигнатуру:

svc=events/update_units&params={"mode":"remove",  
"units":\[&lt;long&gt;\]}

Для удаления всех объектов из сессии используйте следующую сигнатуру:

svc=events/update_units&params={"mode":"clear"}

## Параметры

| Параметр | Описание |
| --- | --- |
| mode | Режим: добавление объектов в сессию (add), удаление определенных объектов из сессии (remove), удаление всех объектов из сессии (clear). |
| id  | ID объекта. |
| detect | Типы датчиков (что отслеживать). |
| trips | Поездки (см. ниже). |
| lls | Датчик уровня топлива (см. ниже). |
| ignition | Датчик зажигания (см. ниже). |
| sensors | Другие датчики, не упомянутые выше (см. ниже). |
| counters | Счетчики. |
| evt_flags | Флаги событий. |

Для работы с элементами **detect** (trips, lls, sensors, ignition), используйте ID конкретного датчика или укажите 0, чтобы добавить все датчики одного типа. С поездками всегда используйте 0, так как нет датчика поездок.

Чтобы добавить все датчики объекта, используйте:

"detect":{"\*":0}

### Пример 1

Чтобы добавить все датчики зажигания или другие датчики, используйте

"detect":{"ignition":0,"sensors":0}

или

"detect":{"ignition,sensors":0}

### Пример 2

Чтобы добавить все датчики уровня топлива с ID 2 и другие датчики с ID 6:

"detect":{"lls":2,"sensors":6}

## Возвращаемый результат

При успешном выполнении запроса возвращается следующий результат:

{  
units:&lt;uint&gt; /\* количество объектов, добавленных в сессию \*/  
}

В обратном случае возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 1   | Неправильный или устаревший SID запроса. |
| 4   | Ошибка валидации параметров. |
| 7   | Не удалось загрузить библиотеку **adf_avl_events**. |

# exchange

В этом разделе описаны функции, связанные с импортом и экспортом данных, а также конвертацией файлов в формат JSON.

# convert_file

Для конвертации файлов в формате XLSX и CSV в формат JSON, используйте метод **exchange/convert_file**:

svc=exchange/convert_file&params={"format":"csv", "separator":","}

Максимальный размер файла для конвертации — 64 Мбайт.

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| format\* | Формат файла. Поддерживаемые форматы: XLSX, CSV. |
| separator\* | Разделитель. Только для формата CSV. |
| eventHash | Имя события, которое будет сгенерировано после прочтения данных. |

Чтобы загрузить файл, используйте POST-запрос с несколькими параметрами (multipart/form-data). В form-data необходимо сделать отдельный параметр типа file и указать имя файла. Например, в Postman это можно сделать в query params.

Пример запроса:

Request URL: https://hst-api.wialon.com/wialon/ajax.html?svc=exchange/convert_file&sid=8157df114c0e601f0f31091c3c2ac53d  
Request Method: POST  
Connection: keep-alive  
Content-Length: 1901  
Cache-Control: no-cache  
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryhAXcAjtvh1D61XpC  
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8  
Accept-Charset: windows-1251,utf-8;q=0.7,\*;q=0.3  
Accept-Encoding: gzip,deflate,sdch  
Accept-Language: ru,en-US;q=0.8,en;q=0.6  
\------WebKitFormBoundaryhAXcAjtvh1D61XpC  
Content-Disposition: form-data; name="params"  
jUploadForm1372772377019  
\------WebKitFormBoundaryhAXcAjtvh1D61XpC  
Content-Disposition: form-data; name="import_file"; filename="file.zip"  
Content-Type: application/zip  
\------WebKitFormBoundaryhAXcAjtvh1D61XpC--

## Возвращаемый результат

При успешной конвертации возвращается результат в формате JSON. Если в запросе не было параметра eventHash, результат возвращается сразу. Если этот параметр содержался в запросе, необходимо выполнить команду [**avl_evts**](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_evts), чтобы увидеть результат.

Пример возвращаемого результата:

{  
<br/>      "filename": "test.xlsx",  
<br/>      "sheets": \[  
<br/>           {  
<br/>                  "rows": \[  
<br/>                          \[  
<br/>                              "№",  
<br/>                              "Время",  
<br/>                              "Пользователь",  
<br/>                              "Тип элемента",  
<br/>                              "Действие",  
<br/>                              "Хост",  
<br/>                              "Заметки"  
<br/>                        \],  
<br/>                       \[  
<br/>                             "1",  
<br/>                             "2023-09-13 10:45:15",  
<br/>                             "maqsat",  
<br/>                              "Ресурс",  
<br/>                              "Ресурс 'Radares Maqsat' создан.",  
<br/>                              "167.61.60.214",  
<br/>                              " "  
<br/>                      \],  
<br/>                     \[  
<br/>                           "2",  
<br/>                           "2023-09-13 10:45:16",  
<br/>                           "maqsat",  
<br/>                           "Ресурс",  
<br/>                           "Учетная запись 'Radares Maqsat' создана.",  
<br/>                           "167.61.60.214",  
<br/>                           " "  
<br/>                     \]  
<br/>              \]  
<br/>      }  
<br/>\]  
<br/>}

Если файл не удалось конвертировать, возвращается код ошибки.

### Коды ошибок 

|     |     |
| --- | --- |
| Код | Описание |
| 4   | Превышен максимальный допустимый размер файла, параметры запроса невалидны, или передан неизвестный формат. |
| 5   | Не удалось открыть или конвертировать файл. |
| 6   | Неизвестная ошибка. |
| 7   | Нет доступа. |

# export_json

Чтобы экспортировать данные в файл в формате WLP, используйте команду **exchange/export_json**.

svc=exchange/export_json&params={"fileName":&lt;text&gt;,  
"json":{}}

Этот запрос нельзя выполнить одновременно с другими запросами из этого раздела, а также со следующими запросами:

- […/report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report),
- […/report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result),
- […/report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart),
- […/report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map),
- […/messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval),
- […/render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer),
- […/unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips),
- […/resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings),
- […/resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings),
- […/account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

|     |     |
| --- | --- |
| **Параметры** | **Описание** |
| fileName | Имя файла |
| json | Экспортируемый JSON |

## Возвращаемый результат

При успешном выполнении запроса возвращается файл в формате WLP. В обратном случае возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| **Код** | **Описание** |
| 1   | Неверный или устаревший SID запроса. |
| 3   | Ошибка валидации параметров или другой тип ошибки. |

# export_messages

Чтобы экспортировать в файл сообщения, загруженные в слой или по времени, используйте команду **exchange/export_messages**.

svc=exchange/export_messages&params={"layerName":&lt;text&gt;,  
"format":&lt;text&gt;,  
"itemId":&lt;long&gt;,  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;,  
"compress":&lt;bool&gt;}

Этот запрос нельзя выполнить одновременно с другими запросами из этого раздела, а также со следующими запросами:

- […/report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report),
- […/report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result),
- […/report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart),
- […/report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map),
- […/messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval),
- […/render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer),
- […/unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips),
- […/resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings),
- […/resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings),
- […/account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

Обязательные параметры обозначены звездочкой (\*).

|     |     |
| --- | --- |
| **Имя** | **Описание** |
| layerName | Имя слоя с сообщениями. Укажите для экспорта сообщений из слоя. |
| itemId | ID объекта. Укажите для экспорта сообщений без загрузки в слой. |
| format\* | Формат файла: txt, kml, plt, wln, wlb. |
| timeFrom | Начало интервала. Укажите для экспорта сообщений без загрузки в слой. |
| timeTo | Конец интервала. Укажите для экспорта сообщений без загрузки в слой. |
| compress\* | Укажите 1, чтобы получить сжатый файл, или 0, чтобы получить файл в несжатом виде. |

## Возвращаемый результат

При успешном выполнении запроса возвращается файл в указанном формате.

Если в параметрах запроса содержатся поля **itemId**, **timeFrom**, **timeTo**, **format** и **compress**, то по значению поля **itemId** определяется объект, а затем возвращаются его сообщения от **timeFrom** до **timeTo**. Поле **layerName** в этом случае не учитывается, даже если оно указано в запросе. Если же хотя бы одно из полей **temId**, **timeFrom**, **timeTo**, **format**, **compress** отсутствует, то по значению поля **layerName** определяется слой, затем по слою определяется объект и возвращаются все его сообщения (в этом случае поля **timeFrom** и **timeTo** не учитываются). Таким образом, команду можно использовать двумя способами. Для первого необходимы поля **itemId**, **timeFrom**, **timeTo**, **format** и **compress**, а для второго — **layerName**, **format** и **compress**.

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

<div class="joplin-table-wrapper"><table><tbody><tr><td><p><strong>Код ошибки</strong></p></td><td><p><strong>Описание</strong></p></td></tr><tr><td><p>1</p></td><td><p>Неверный или устаревший SID запроса.</p></td></tr><tr><td><p>4</p></td><td><p>Одна из следующих ошибок:</p><ul><li>ошибка валидации параметров,</li><li>слой не найден,</li><li>не удалось сохранить сообщения во временный файл.</li></ul></td></tr><tr><td><p>6</p></td><td><p>Одна из следующих ошибок:</p><ul><li>не удалось получить данные о пользователе,</li><li>не удалось получить рендерер,</li><li>ошибка сжатия файла.</li></ul></td></tr><tr><td><p>7</p></td><td><p>Одна из следующих ошибок:</p><ul><li>объект не найден,</li><li>не удалось получить объект, на который есть необходимые права доступа (для первого способа необходимо ADF_ACL_ITEM_EXECUTE_REPORTS, для второго&nbsp;— ADF_ACL_AVL_UNIT_EXPORT_MSGS).</li></ul></td></tr><tr><td><p>1001</p></td><td><p>У объекта нет сообщений за указанный период или за все время.</p></td></tr></tbody></table></div>

# export_zones

Чтобы экспортировать геозоны в файл в формате KML или KMZ, используйте команду **exchange/export_zones**.

svc=exchange/export_zones&params={"fileName":&lt;text&gt;,  
"zones":\[  
{  
"itemId":&lt;long&gt;,  
"id":&lt;long&gt;  
}  
\],  
"compress":&lt;bool&gt;}

Этот запрос нельзя выполнить одновременно с другими запросами из этого раздела, а также со следующими запросами:

- […/report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report),
- […/report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result),
- […/report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart),
- […/report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map),
- […/messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval),
- […/render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer),
- […/unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips),
- […/resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings),
- […/resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings),
- […/account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| fileName | Имя файла. |
| zones | Массив геозон. |
| itemId | ID ресурса. |
| id  | ID геозоны. |
| compress | Укажите 1 для сжатия файла или 0, чтобы получить несжатый файл. |

## Возвращаемый результат

При успешном выполнении запроса возвращается файл в формате KML или KMZ.

Если ресурс или геозона с указанным ID не найдены на сервере, генерируется ответ в формате XML с именем файла:

**Request**

{"fileName":"export_zones_result","zones":\[{"itemId":&lt;nonexisting-resource-id&gt;,"id":&lt;nonexisting-geofence-id&gt;}\],"compress":0}

**Response**

&lt;?xml version="1.0" encoding="utf-8"?&gt;  
<br/>&lt;kml&gt;  
&lt;Document&gt;  
&lt;name&gt;  
export_zones_result  
&lt;/name&gt;  
&lt;/Document&gt;  
&lt;/kml&gt;

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

<div class="joplin-table-wrapper"><table><tbody><tr><td><p><strong>Код</strong></p></td><td><p><strong>Описание</strong></p></td></tr><tr><td><p>1</p></td><td><p>Невалидный или устаревший SID запроса.</p></td></tr><tr><td><p>4</p></td><td><p>Одна из следующих ошибок:</p><ul><li>ошибка валидации параметров,</li><li>пустой массив геозон в запросе,</li><li>не удалось создать директорию для временных результатов.</li></ul></td></tr><tr><td><p>6</p></td><td><p>Одна из следующих ошибок:</p><ul><li>не удалось получить данные о пользователе,</li><li>ошибка обработки XML,</li><li>ошибка сжатия файла.</li></ul></td></tr></tbody></table></div>

# import_json

Чтобы прочитать данные из файла в формате WLP, используйте метод exchange/import_json.

svc=exchange/import_json&params={"eventHash":&lt;text&gt;}

Этот запрос нельзя выполнить одновременно с другими запросами из этого раздела, а также со следующими запросами:

- […/report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report),
- […/report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result),
- […/report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart),
- […/report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map),
- […/messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval),
- […/render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer),
- […/unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips),
- […/resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings),
- […/resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings),
- […/account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

В запрос можно включить необязательный параметр **eventHash**. Он позволяет указать имя события, которое будет сгенерировано после чтения данных.

## Загрузка файла

Чтобы загрузить файл в формате WLP, используйте запрос POST с множественным содержимым (multipart/form-data). Например:

Request URL: https://hst-api.wialon.com/wialon/ajax.html?svc=exchange/import_json&sid=8157df114c0e601f0f31091c3c2ac53d  
Request Method: POST  
Connection: keep-alive  
Content-Length: 1901  
Cache-Control: no-cache  
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryhAXcAjtvh1D61XpC  
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8  
Accept-Charset: windows-1251,utf-8;q=0.7,\*;q=0.3  
Accept-Encoding: gzip,deflate,sdch  
Accept-Language: ru,en-US;q=0.8,en;q=0.6  
<br/>\------WebKitFormBoundaryhAXcAjtvh1D61XpC  
Content-Disposition: form-data; name="params"  
<br/>{"eventHash":"jUploadForm1372772377019"}  
\------WebKitFormBoundaryhAXcAjtvh1D61XpC  
Content-Disposition: form-data; name="eventHash"  
<br/>jUploadForm1372772377019  
\------WebKitFormBoundaryhAXcAjtvh1D61XpC  
Content-Disposition: form-data; name="import_file"; filename="file.zip"  
Content-Type: application/zip  
<br/><br/>\------WebKitFormBoundaryhAXcAjtvh1D61XpC--

## Возвращаемый результат

При успешном выполнении запроса возвращается пустой ответ.

{ }

Чтобы убедиться, что данные были прочитаны, используйте метод [avl_evts](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_evts):

{  
"tm":&lt;uint&gt;, /\* текущее время сервера (UTC) \*/  
"events":\[  
{  
"i":-1,  
"d":{ /\* данные \*/  
"hash":&lt;text&gt;, /\* загрузка завершена \*/  
files: { /\* файлы загружены \*/  
&lt;text&gt;:&lt;Object&gt;, /\* имя файла: данные файла \*/  
...  
}  
}  
}  
\]  
}

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 1   | Неверный или устаревший SID запроса. |
| 4   | Нет прикрепленных файлов. |
| 7   | Не удалось получить данные о пользователе. |

# import_messages

Для импорта сообщений из файла используйте методexchange/import_messages.

svc=exchange/import_messages&params={  
"itemId": &lt;long&gt;,  
"eventHash": &lt;text&gt;  
}

Этот запрос нельзя выполнить одновременно в другими запросами из этого раздела, а также со следующими запросами:

- […/report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report),
- […/report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result),
- […/report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart),
- […/report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map),
- […/messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval),
- […/render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer),
- […/unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips),
- […/resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings),
- […/resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings),
- […/account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

Обязательный параметр отмечен звездочкой (\*).

| Параметр | Описание |
| --- | --- |
| itemId\* | ID элемента. |
| eventHash | Имя события, которое будет сгенерировано после импорта сообщений. |
| dontMarkImported | Если этот параметр имеет значение 1, импортированные сообщения будут отмечаться не как импортированные (imported), а как сообщения из черного ящика (blackbox); время регистрации может отличаться от времени сообщения. Если этот параметр отсутствует или имеет значение, отличное от 1, сообщения будут помечены как импортированные (imported). |

## Загрузка файла

Чтобы загрузить файл, используйте POST-запрос с множественным содержимым (multipart/form-data). Например:

Request URL: https://hst-api.wialon.com/wialon/ajax.html?svc=exchange/import_messages&sid=8157df114c0e601f0f31091c3c2ac53d  
Request Method: POST  
Connection: keep-alive  
Content-Length: 2744  
Cache-Control: no-cache  
Content-Type: multipart/form-data; boundary=----WebKitFormBoundarylvunQiir9AesO8qB  
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8  
Accept-Charset: windows-1251,utf-8;q=0.7,\*;q=0.3  
Accept-Encoding: gzip,deflate,sdch  
Accept-Language: ru,en-US;q=0.8,en;q=0.6  
<br/>\------WebKitFormBoundarylvunQiir9AesO8qB  
Content-Disposition: form-data; name="params"  
<br/>{"itemId":898446,"eventHash":"jUploadForm1372773585167"}  
\------WebKitFormBoundarylvunQiir9AesO8qB  
Content-Disposition: form-data; name="eventHash"  
<br/>jUploadForm1372773585167  
\------WebKitFormBoundarylvunQiir9AesO8qB  
Content-Disposition: form-data; name="messages_filter_import_file"; filename="4100.zip"  
Content-Type: application/zip  
<br/><br/>\------WebKitFormBoundarylvunQiir9AesO8qB--

## Возвращаемый результат

При успешном выполнении запроса возвращается пустая строка.

{ }

Чтобы убедиться, что сообщения были импортированы, используйте метод [avl_evts](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_evts).

{  
"tm": &lt;uint&gt;, /\* текущее время сервера (UTC) \*/  
"events": \[  
{  
"i": -1,  
"d": { /\* данные \*/  
"hash": &lt;text&gt;, /\* загрузка завершена \*/  
"msgCount": &lt;text&gt; /\* количество импортированных сообщений \*/  
}  
}  
\]  
}

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

<div class="joplin-table-wrapper"><table><thead><tr><th><p>Код</p></th><th><p>Описание</p></th></tr></thead><tbody><tr><td><p>1</p></td><td><p>Неверный или устаревший SID запроса.</p></td></tr><tr><td><p>4</p></td><td><p>Нет прикрепленных файлов.</p></td></tr><tr><td><p>6</p></td><td><p>Внутренняя ошибка.</p></td></tr><tr><td><p>7</p></td><td><p>Одна из следующих ошибок:<br></p><ul><li>не удалось получить данные о пользователе,</li><li>объект не найден,</li><li>не удалось получить объект, на который есть необходимое право доступа (ADF_ACL_AVL_UNIT_IMPORT_MSGS).</li></ul></td></tr></tbody></table></div>

# import_pois_read

Эта команда устарела и не используется. При попытке выполнить запрос возвращается код ошибки.

## Коды ошибок

|     |     |
| --- | --- |
| **Код** | **Описание** |
| 1   | Неверный или устаревший SID запроса. |
| 7   | Возвращается во всех других случаях. |

# import_pois_save

Эта команда устарела и не используется. При попытке выполнить запрос возвращается код ошибки.

## Коды ошибок

|     |     |
| --- | --- |
| **Код** | **Описание** |
| 1   | Неверный или устаревший SID запроса. |
| 7   | Возвращается во всех других случаях. |

# import_zones_read

Чтобы прочитать геозоны из файла, используйте команду **exchange/import_zones_read**:

svc=exchange/import_zones_read&params={"eventHash":&lt;text&gt;}

Этот запрос нельзя выполнить одновременно с другими запросами из этого раздела и следующими запросами:

- […/report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report),
- […/report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result),
- […/report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart),
- […/report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map),
- […/messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval),
- […/render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer),
- […/unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips),
- […/resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings),
- […/resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings),
- […/account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

В запрос можно включить необязательный параметр **eventHash**. Он позволяет указать имя события, которое будет сгенерировано после чтения данных.

## Загрузка файла

Чтобы загрузить файл с геозонами, используйте POST-запрос с множественным содержимым (multipart/form-data). Например:

Request URL: https://hst-api.wialon.com/wialon/ajax.html?svc=exchange/import_zones_read&sid=8157df114c0e601f0f31091c3c2ac53d  
Request Method: POST  
Connection: keep-alive  
Content-Length: 1281  
Cache-Control: no-cache  
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryzmBiAUFQVzA8mRkx  
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8  
Accept-Charset: windows-1251,utf-8;q=0.7,\*;q=0.3  
Accept-Encoding: gzip,deflate,sdch  
Accept-Language: ru,en-US;q=0.8,en;q=0.6  
<br/>\------WebKitFormBoundaryzmBiAUFQVzA8mRkx  
Content-Disposition: form-data; name="params"  
<br/>{"eventHash":"jUploadForm1372771850650"}  
\------WebKitFormBoundaryzmBiAUFQVzA8mRkx  
Content-Disposition: form-data; name="eventHash"  
<br/>jUploadForm1372771850650  
\------WebKitFormBoundaryzmBiAUFQVzA8mRkx  
Content-Disposition: form-data; name="import_file"; filename="geofence.kml"  
Content-Type: application/vnd.google-earth.kml+xml  
<br/><br/>\------WebKitFormBoundaryzmBiAUFQVzA8mRkx--

## Возвращаемый результат

При успешном выполнении запроса возвращается пустая строка.

{ }

Чтобы убедиться, что геозоны прочитаны, выполните команду […/requests/avl_evts](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_evts):

{  
"tm":&lt;uint&gt;, /\* текущее время сервера (UTC) \*/  
"events":\[  
{  
"i":-1,  
"d":{ /\* данные \*/  
"hash":&lt;text&gt;, /\* загрузка завершена \*/  
"zones":\[&lt;Object&gt;\] /\* массив прочитанных геозон \*/  
}  
}  
\]  
}

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| **Код** | **Описание** |
| 1   | Невалидный или устаревший SID запроса. |
| 4   | Нет прикрепленных файлов. |
| 7   | Не удалось получить данные о пользователе. |

# file

В этом разделе описаны все методы, которые используются для работы с файлами.

# get

Чтобы получить файл из файлового хранилища, используйте метод **file/get**.

svc=file/get&params={  
"itemId":&lt;long&gt;,  
"storageType":&lt;uint&gt;,  
"path":&lt;text&gt;,  
"format":&lt;uint&gt;  
}

## Парамметры

|     |     |
| --- | --- |
| Параметр | Описание |
| **itemId** | ID элемента. |
| **storageType** | Тип хранилища:  <br>1 - общедоступное (все пользователи могут видеть и скачивать файлы),  <br>2 - закрытое (только пользователи с правами доступа могут видеть и скачивать файлы). |
| **path** | Относительный путь от корневой папки к файлу. |
| **format** | Укажите **"format":1** для выгрузки DDD-файла в формате VDO. |

## Возвращаемый результат

При успешном выполнении запроса возвращается файл.

Если файл не найден, возвращается код ошибки:

Invalid input{"error":3}

# library

Чтобы получить файлы PNG, SVG, GIF и JPG из стандартных или пользовательских библиотек, используйте метод **file/library**.

svc=file/library&params={  
"type":&lt;text&gt;,  
"flags":&lt;uint&gt;  
}

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| **type** | Имя библиотеки. По умолчанию используются следующие значения:  **unit**, **group**, **poi**. |
| **flags** | Укажите одно из значений:  <br>**0** - перечислить файлы из стандартной библиотеки (допускаются только значения параметра  <br>**type** по умолчанию);  <br>**1** - рекурсивно перечислить файлы из всех доступных библиотек иерархии (ваша учетная запись, родительская, родительская родительской и т. д.). |

## Создание и поиск пользовательской библиотеки

Чтобы **создать** пользовательскую библиотеку, выполните следующие действия:

1\. Создайте директорию **library** в общедоступном файловом хранилище учетной записи: **&lt;account_id&gt;/1/library** 2. Поместите пользовательскую библиотеку в папку **library**. Например, если пользовательская библиотека называется **cust_lib**, путь к ней будет таким: **&lt;account_id&gt;/1/library/cust_lib**

Чтобы **найти** пользовательскую библиотеку и вывести список ее содержимого, укажите имя библиотеки в качестве значения параметра **type**. Например, **type:‘cust_lib’**

## Возвращаемый результат

При успешном выполнении запроса возвращается список файлов.

{  
"&lt;account_id&gt;": \[ /\* ID учетной записи, 0 — стандартная библиотека \*/  
{  
"n": &lt;text&gt;, /\* имя файла \*/  
"s": &lt;uint&gt;, /\* размер файла в байтах \*/  
"ct": &lt;uint&gt;, /\* время создания файла, UNIX-время \*/  
"mt": &lt;uint&gt; /\* время последнего изменения файла, UNIX-время \*/  
},  
...  
\],  
... /\* ID других учётных записей (если применимо) \*/  
}

Если запрос не выполнен, возвращается код ошибки:

### Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 1   | Пользователь не авторизован. |
| 4   | Невалидные входные параметры. |
| 5   | Не удалось извлечь список файлов из библиотеки и учетных записей. |
| 7   | Не удалось извлечь учетную запись или элемент со стандартной библиотекой. |

# list

Чтобы увидеть структуру хранилища, используйте метод **file/list**.

svc=file/list&params={  
"itemId":&lt;long&gt;,  
"storageType":&lt;uint&gt;,  
"path":&lt;text&gt;,  
"mask":&lt;text&gt;,  
"recursive":&lt;bool&gt;,  
"fullPath":&lt;bool&gt;  
}

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| **itemId** | ID элемента. |
| **storageType** | Тип хранилища:  <br>1 - общедоступное (все пользователи могут видеть и скачивать файлы),  <br>2 - закрытое (только пользователи с правами доступа могут видеть и скачивать файлы). |
| **path** | Относительный путь от корневой папки к файлу. |
| **mask** | Маска имени файла. Она может содержать звездочку (\*), которая заменяет 0 или более символов, и вопросительный знак (?), который заменяет 1 символ. Если вы указываете несколько масок, используйте запятую в качестве разделителя. |
| **recursive** | Используйте этот флаг, чтобы указать, должно ли содержимое отображаться рекурсивно со вложенными папками. |
| **fullPath** | Используйте этот флаг, чтобы указать, должен ли показываться полный путь к элементам. |

 Только создатель элемента может размещать и удалять файлы.

## Возвращаемый результат

При успешном выполнении запроса возвращается структура хранилища. Сигнатура **n/c** означает, что элемент иерархии — папка, сигнатура **n/s** — файл.

\[  
{  
"n": &lt;text&gt;, /\* путь к указанной папке, начинается с «public» или «protected» \*/  
"c": \[ /\* содержимое корневой папки, может включать файлы и/или вложенные папки \*/  
{  
"n": &lt;text&gt;, /\* имя папки \*/  
"c": \[ ... \] /\* содержимое папки, может включать файлы и/или вложенные папки \*/  
},  
{  
"n": &lt;text&gt;, /\* имя файла \*/  
"s": &lt;text&gt; /\* размер файла (байт) \*/  
}  
// ...  
\]  
}  
\]

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 1   | Пользователь не авторизован. |
| 4   | Пользователь не авторизован. |
| 5   | Не удалось получить список файлов по указанному пути. |
| 7   | IНедостаточно прав на элемент, указанный в параметре **itemId**. |

# mkdir

Для создания новой папки в файловом хранилище, используйте метод **file/mkdir**:

svc=file/mkdir&params={  
"itemId":&lt;long&gt;,  
"storageType":&lt;uint&gt;,  
"path":&lt;text&gt;  
}

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| **itemId** | ID элемента. |
| **storageType** | Тип хранилища:  <br>1 — общедоступное (все пользователи могут видеть и скачивать файлы),  <br>2 — закрытое (только пользователи с правами доступа могут видеть и скачивать файлы). |
| **path** | Относительный путь от корневой папки к той, которую вы хотите создать. |

## Возвращаемый результат

При успешном выполнении запроса возвращается пустой ответ:

{ }

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 1   | Пользователь не авторизован. |
| 4   | Невалидные входные параметры. |
| 5   | Не удалось создать папку по указанному пути. |
| 7   | Недостаточно прав на элемент, указанный в параметре **itemId**. |

# put

Чтобы загрузить файлы в файловое хранилище, используйте метод **file/put**.

svc=file/put&params={  
"itemId": &lt;long&gt;,  
"storageType": &lt;uint&gt;,  
"path": &lt;text&gt;,  
"writeType": &lt;uint&gt;,  
"eventHash": &lt;text&gt;  
}  
&sid=&lt;text&gt;

## Параметры

|     |     |
| --- | --- |
| **Параметр** | **Описание** |
| **itemId** | ID элемента. |
| **storageType** | Тип хранилища:  <br>**1** — общедоступное (все пользователи могут видеть и скачивать файлы),  <br>**2** — закрытое (только пользователи с правами доступа могут видеть и скачивать файлы). |
| **path** | Относительный путь от корневой папки к файлу. |
| **writeType** | Тип записи:  <br>**0** — перезаписать файл,  <br>**1** — добавить в конец,  <br>**2** — не записывать, если такой файл уже существует. |
| **eventHash** | Имя события, которое будет сгенерировано после прочтения данных. |

 Имена файла и папки не должны совпадать.

Чтобы загрузить несколько файлов, отправьте их с помощью POST-запроса с параметрами (multipart/form-data). Например:

Request URL: https://hst-api.wialon.com/wialon/ajax.html?svc=file/put  
Request Method: POST  
Connection: keep-alive  
Content-Length:333998  
Cache-Control:max-age=0  
Content-Type:multipart/form-data; boundary=----WebKitFormBoundaryMpLUirMexsfCGaJP  
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/ \*;q=0.8  
Accept-Charset: windows-1251,utf-8;q=0.7,\*;q=0.3  
Accept-Encoding: gzip,deflate,sdch  
Accept-Language: ru,en-US;q=0.8,en;q=0.6  
<br/><br/>\------WebKitFormBoundaryhJ0ZukEcpN7MgFnC  
Content-Disposition: form-data; name="params"  
<br/>{"itemId":439,"storageType":"1","path":"1","writeType":0,"eventHash":"jUploadForm1414572405484"}  
\------WebKitFormBoundaryhJ0ZukEcpN7MgFnC  
Content-Disposition: form-data; name="eventHash"  
<br/>jUploadForm1414572405484  
\------WebKitFormBoundaryhJ0ZukEcpN7MgFnC  
Content-Disposition: form-data; name="f"; filename="one-file"  
Content-Type: application/octet-stream  
<br/><br/>\------WebKitFormBoundaryhJ0ZukEcpN7MgFnC--

## Возвращаемый результат

При успешном выполнении запроса возвращается следующий результат:

{  
"error":0  
}

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

| Код | Описание |
| --- | --- |
| 1   | Пользователь не авторизован. |
| 4   | Невалидные входные параметры. |
| 7   | Недостаточно прав на элемент, указанный в параметре **itemId**. |

# read

Чтобы прочитать текстовый файл, используйте метод **file/read**.

svc=file/read&params={  
"itemId": &lt;long&gt;,  
"storageType": &lt;uint&gt;,  
"path": &lt;text&gt;,  
"contentType": &lt;uint&gt;  
}

## Параметры

|     |     |
| --- | --- |
| **Параметр** | **Описание** |
| **itemId** | ID элемента. |
| **storageType** | Тип хранилища:  <br>1 — общедоступное (все пользователи могут видеть и скачивать файлы),  <br>2 — закрытое (только пользователи с правами доступа могут видеть и скачивать файлы). |
| **path** | Относительный путь от корневой папки к файлу. |
| **contentType** | Тип содержимого. Содержимое может возвращаться как:  <br>0 — текст,  <br>1 — шестнадцатеричная строка,  <br>2 — строка в кодировке Base64. |

## Возвращаемый результат

При успешном выполнении запроса возвращается содержимое файла.

{  
"content": &lt;content&gt;  
}

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| **Код** | **Описание** |
| 1   | Пользователь не авторизован. |
| 3   | Файл не найден. |
| 4   | Невалидные входные параметры. |
| 7   | Недостаточно прав на элемент, указанный в параметре **itemId**. |

# rm

Для удаления файла используйте метод **file/rm**:

svc=file/rm&params={  
"itemId": &lt;long&gt;,  
"storageType": &lt;uint&gt;,  
"path": &lt;text&gt;  
}

## Параметры

|     |     |
| --- | --- |
| **Параметр** | **Описание** |
| **itemId** | ID элемента. |
| **storageType** | Тип хранилища:  <br>1 — общедоступное (все пользователи могут видеть и скачивать файлы),  <br>2 — закрытое (только пользователи с правами доступа могут видеть и скачивать файлы). |
| **path** | Относительный путь от корневой папки к файлу. |

 Чтобы полностью очистить общедоступное или закрытое хранилище, используйте **“path”:“/”** в запросе.

## Возвращаемый результат

При успешном выполнении запроса возвращается пустой ответ.

{}

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| **Код** | **Описание** |
| 1   | Пользователь не авторизован. |
| 4   | Невалидные входные параметры. |
| 5   | Файл не найден. |
| 7   | Недостаточно прав на элемент, указанный в параметре  **itemId** . |

# write

Чтобы записать информацию в текстовый файл, используйте метод **file/write**:

svc=file/write&params={  
"itemId":&lt;long&gt;,  
"storageType":&lt;uint&gt;,  
"path":&lt;text&gt;,  
"content":&lt;text&gt;,  
"writeType":&lt;uint&gt;,  
"contentType":&lt;uint&gt;  
}

## Параметры

|     |     |
| --- | --- |
| **Параметр** | **Описание** |
| **itemId** | ID элемента. |
| **storageType** | Тип хранилища:  <br>1 — общедоступное (все пользователи могут видеть и скачивать файлы),  <br>2 — закрытое (только пользователи с правами доступа могут видеть и скачивать файлы). |
| **path** | Относительный путь от корневой папки к файлу. |
| **content** | Содержимое файла. |
| **writeType** | Тип записи:  <br>**0** — перезаписать файл,  <br>**1** — добавить в конец,  <br>**2** — не записывать, если такой файл уже существует. |
| **contentType** | Тип содержимого. Содержимое может возвращаться как:  <br>0 — текст,  <br>1 — шестнадцатеричная строка,  <br>2 — строка в кодировке Base64. |

## Возвращаемый результат

При успешном выполнении запроса возвращается пустая строка.

{}

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| **Код** | **Описание** |
| 1   | Пользователь не авторизован. |
| 4   | Невалидные входные параметры. |
| 5   | Не удалось перезаписать файл, поскольку файл с таким же именем уже существует, и в запросе указано **"writeType":2**. |
| 7   | Недостаточно прав на элемент, указанный в параметре **itemId** . |

# item

В этом разделе описаны общие функции, которые можно применить к элементу в Wialon: [объект](https://help.wialon.com/ru/api/user-guide/api-reference/unit), [группа объектов](https://help.wialon.com/ru/api/user-guide/api-reference/unit_group), [пользователь](https://help.wialon.com/ru/api/user-guide/api-reference/user), [ретранслятор](https://help.wialon.com/ru/api/user-guide/api-reference/retranslator), [ресурс](https://help.wialon.com/ru/api/user-guide/api-reference/resource) ([учетная запись](https://help.wialon.com/ru/api/user-guide/api-reference/account)), [маршрут](https://help.wialon.com/ru/api/user-guide/api-reference/route). Для получения информации о создании элементов смотрите раздел [**core**](https://help.wialon.com/ru/api/user-guide/api-reference/core).

# add_log_record

Функция **add_log_record** используется для добавления записи в журнал.

svc=item/add_log_record&params={"itemId":&lt;long&gt;,  
"action":&lt;text&gt;,  
"newValue":&lt;text&gt;,  
"oldValue":&lt;text&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID элемента. |
| action | Действие. Смотрите список доступных действий ниже. |
| newValue | Новое значение. |
| oldValue | Старое значение. |

Доступны следующие действия:

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>ID действия</p></td><td><p>Действие</p></td><td><p>Текст действия</p></td></tr><tr><td><p>custom_msg</p></td><td><p>Произвольная запись</p></td><td><p>Произвольная запись: '%s'.</p></td></tr><tr><td><p>create_unit</p></td><td><p>Создание элемента</p></td><td><p>Объект '%s' создан.</p></td></tr><tr><td><p>update_name</p></td><td><p>Изменение имени</p></td><td><p>Имя объекта изменено с '%s' на '%s'.</p></td></tr><tr><td><p>update_access</p></td><td><p>Изменени доступа</p></td><td><p>Доступ к *** '%s' изменен (*** заменяет один из вариантов: пользователь, объект, группа объектов, ресурс, маршрут, права доступа пользователя).</p></td></tr><tr><td><p>update_unit_icon</p></td><td><p>Изменение иконки</p></td><td><p>Изменена иконка объекта.</p></td></tr><tr><td><p>update_unit_pass</p></td><td><p>Изменение пароля доступа</p></td><td><p>Изменен пароль доступа к объекту.</p></td></tr><tr><td><p>update_unit_phone</p></td><td><p>Изменение телефонного номера</p></td><td><p>Телефонный номер изменен с '%s' на '%s'.</p></td></tr><tr><td><p>update_unit_phone2</p></td><td><p>Изменение телефонного номера</p></td><td><p>Второй телефонный номер изменен с '%s' на '%s'.</p></td></tr><tr><td><p>update_unit_calcflags&nbsp;(обновление настроек расчета для датчика)</p></td><td><p>Счетчики</p></td><td><p>Изменены флаги расчета.</p></td></tr><tr><td><p>update_unit_drat (активность водителя)</p></td><td><p>Настройки отчета</p></td><td><p>Изменен метод определения активности водителя.</p></td></tr><tr><td><p>update_unit_milcounter</p></td><td><p>Счетчики</p></td><td><p>Счетчик пробега изменен с %d %s на %d %s..</p></td></tr><tr><td><p>update_unit_bytecounter (обновление значения счетчика трафика GPRS)</p></td><td><p>Счетчики</p></td><td><p>Счетчик GPRS-трафика изменен с %d Кбайт на %d Кбайт.</p></td></tr><tr><td><p>update_unit_ehcounter</p></td><td><p>Счетчики</p></td><td><p>Счетчик моточасов изменен с %.2f ч. на %.2f ч.&nbsp;</p></td></tr><tr><td><p>update_unit_uid</p></td><td><p>Изменение уникального ID</p></td><td><p>Уникальный ID изменен с '%s' на '%s'.</p></td></tr><tr><td><p>update_unit_uid2</p></td><td><p>Изменение уникального ID</p></td><td><p>Уникальный ID изменен с '%s' на '%s'.</p></td></tr><tr><td><p>update_unit_hw</p></td><td><p>Изменение устройства</p></td><td><p>Тип устройства изменен с '%s' на '%s'.</p></td></tr><tr><td><p>update_unit_hw_cfg</p></td><td><p>Изменение устройства</p></td><td><p>Изменена конфигурация устройства.</p></td></tr><tr><td><p>update_unit_fuel_cfg</p></td><td><p>Настройки отчета</p></td><td><p>Изменены настройки расхода топлива.</p></td></tr><tr><td><p>update_unit_trip_cfg</p></td><td><p>Настройки отчета</p></td><td><p>Изменены настройки детектора поездок.</p></td></tr><tr><td><p>create_sensor</p></td><td><p>Датчики</p></td><td><p>Создан датчик '%s'.</p></td></tr><tr><td><p>update_sensor</p></td><td><p>Датчики</p></td><td><p>Датчик '%s' изменен.</p></td></tr><tr><td><p>delete_sensor</p></td><td><p>Датчики</p></td><td><p>Датчик '%s' удален.</p></td></tr><tr><td><p>create_alias</p></td><td><p>Команды</p></td><td><p>Команда '%s' создана.</p></td></tr><tr><td><p>update_alias</p></td><td><p>Команды</p></td><td><p>Команда '%s' изменена.</p></td></tr><tr><td><p>delete_alias</p></td><td><p>Команды</p></td><td><p>Команда '%s' удалена.</p></td></tr><tr><td><p>create_service_interval</p></td><td><p>Интервалы техобслуживания</p></td><td><p>Интервал техобслуживания '%s' создан.</p></td></tr><tr><td><p>update_service_interval</p></td><td><p>Интервалы техобслуживания</p></td><td><p>Интервал техобслуживания '%s' изменен.</p></td></tr><tr><td><p>delete_service_interval</p></td><td><p>Интервалы техобслуживания</p></td><td><p>Интервал техобслуживания '%s' удален.</p></td></tr><tr><td><p>create_custom_field</p></td><td><p>Поля</p></td><td><p>Произвольное поле '%s' создано.</p></td></tr><tr><td><p>update_custom_field</p></td><td><p>Поля</p></td><td><p>Произвольное поле '%s' изменено.</p></td></tr><tr><td><p>delete_custom_field</p></td><td><p>Поля</p></td><td><p>Произвольное поле '%s' удалено.</p></td></tr><tr><td><p>create_admin_field</p></td><td><p>Поля</p></td><td><p>Административное поле '%s' создано.</p></td></tr><tr><td><p>update_admin_field</p></td><td><p>Поля</p></td><td><p>Административное поле '%s' изменено.</p></td></tr><tr><td><p>delete_admin_field</p></td><td><p>Поля</p></td><td><p>Административное поле '%s' удалено.</p></td></tr><tr><td><p>update_profile_field</p></td><td><p>Поля</p></td><td><p>Характеристика '%s' изменена.</p></td></tr><tr><td><p>delete_profile_field</p></td><td><p>Поля</p></td><td><p>Характеристика '%s' удалена.</p></td></tr><tr><td><p>import_item_cfg</p></td><td><p>Импорт</p></td><td><p>Свойства импортированы.</p></td></tr><tr><td><p>import_unit_cfg</p></td><td><p>Импорт</p></td><td><p>Свойства импортированы.</p></td></tr><tr><td><p>export_unit_msgs</p></td><td><p>Экспорт</p></td><td><p>Cообщения экспортированы.</p></td></tr><tr><td><p>import_unit_msgs</p></td><td><p>Импорт</p></td><td><p>Свойства импортированы.</p></td></tr><tr><td><p>delete_unit_msg</p></td><td><p>Удаление сообщений</p></td><td><p>Удалено *** сообщение от %s (*** заменяет SMS, команду, событие, or data).</p></td></tr><tr><td><p>delete_unit_msgs</p></td><td><p>Удаление сообщений</p></td><td><p>Удалено %s сообщений *** (*** заменяет SMS, отправленные команды, зарегистрированные события, данные).</p></td></tr><tr><td><p>bind_unit_driver</p></td><td><p>Водители</p></td><td><p>Водитель '%s' был назначен в '%s'.</p></td></tr><tr><td><p>unbind_unit_driver</p></td><td><p>Водители</p></td><td><p>Водитель '%s' был снят в '%s'.</p></td></tr><tr><td><p>bind_unit_tag</p></td><td><p>Пассажиры</p></td><td><p>Пассажир '%s' был назначен в '%s'.</p></td></tr><tr><td><p>unbind_unit_tag</p></td><td><p>Пассажиры</p></td><td><p>Пассажир '%s' был снят в '%s'.</p></td></tr><tr><td><p>bind_unit_trailer</p></td><td><p>Прицепы</p></td><td><p>Прицеп '%s' был назначен в '%s'.</p></td></tr><tr><td><p>unbind_unit_trailer</p></td><td><p>Прицепы</p></td><td><p>Прицеп '%s' был снят в '%s'.</p></td></tr><tr><td><p>update_unit_report_cfg (обновление параметров, используемых в отчетах)</p></td><td><p>Настройки отчета</p></td><td><p>Изменены параметры объекта, используемые в отчетах.</p></td></tr><tr><td><p>update_msgs_filter_cfg (обновление настроек фильтрации о местоположении объекта в сообщениях)</p></td><td><p>Настройки отчета</p></td><td><p>Изменены настройки фильтрации сообщений.</p></td></tr><tr><td><p>delete_item</p></td><td><p>Удаление элемента</p></td><td><p>Элемент '%s' удален.</p></td></tr><tr><td><p>create_user</p></td><td><p>Создание элемента</p></td><td><p>Пользователь '%s' создан.</p></td></tr><tr><td><p>update_hosts_mask</p></td><td><p>Настройки пользователя</p></td><td><p>Маска хоста изменена на '%s'.</p></td></tr><tr><td><p>update_user_pass</p></td><td><p>Настройки пользователя</p></td><td><p>Пароль пользователя изменен.</p></td></tr><tr><td><p>update_user_flags</p></td><td><p>Настройки пользователя</p></td><td><p>Флаги пользователя изменены.</p></td></tr><tr><td><p>update_user_locale</p></td><td><p>Настройки пользователя</p></td><td><p>Первый день недели изменен.</p></td></tr><tr><td><p>create_user_notify</p></td><td><p>Настройки пользователя</p></td><td><p>Информационное сообщение пользователю: '%s'.</p></td></tr><tr><td><p>delete_user_notify</p></td><td><p>Настройки пользователя</p></td><td><p>Удалено сообщение пользователю: '%s'.</p></td></tr><tr><td><p>create_group</p></td><td><p>Создание элемента</p></td><td><p>Группа объектов '%s' создана.</p></td></tr><tr><td><p>units_group (добавление в группы/удаление объектов из группы)</p></td><td><p>Изменение групп</p></td><td><ul><li>Объект добавлен в группу '%s'.</li><li>Объект удален из группы '%s'.</li><li>Объекты в группе обновлены.</li></ul></td></tr><tr><td><p>update_driver_units&nbsp;(обновление списка водителей, которые должны назначаться на объекты автоматически)</p></td><td><p>Изменение групп</p></td><td><ul><li>Объект прикреплен к ресурсу водителей '%s'.</li><li>Объект откреплен от ресурса водителей '%s'.</li><li>Список автоматического назначения водителей обновлен.</li></ul></td></tr><tr><td><p>update_trailer_units (обновление списка прицепов, которые должны назначаться на объекты автоматически)</p></td><td><p>Изменение групп</p></td><td><ul><li>Объект прикреплен к ресурсу прицепов '%s'.</li><li>Объект откреплен от ресурса прицепов '%s'.</li><li>Список автоматического назначения прицепов обновлен.</li></ul></td></tr><tr><td><p>create_resource</p></td><td><p>Создание элемента</p></td><td><p>Ресурс '%s' создан.</p></td></tr><tr><td><p>create_zone</p></td><td><p>Геозоны</p></td><td><p>Геозона '%s' создана.</p></td></tr><tr><td><p>update_zone</p></td><td><p>Геозоны</p></td><td><p>Геозона '%s' обновлена.</p></td></tr><tr><td><p>update_track_color_setting</p></td><td><p>Треки</p></td><td><ul><li>Настройки цвета трека изменены на «По поездкам».</li><li>Настройки цвета трека изменены на «Однотонный».</li><li>Настройки цвета трека изменены на «По скорости».</li><li>Настройки цвета трека изменены на «По датчику».</li></ul></td></tr><tr><td><p>delete_zone</p></td><td><p>Геозоны</p></td><td><p>Геозона '%s' удалена.</p></td></tr><tr><td><p>create_job</p></td><td><p>Задания</p></td><td><p>Задание '%s' создано.</p></td></tr><tr><td><p>switch_job</p></td><td><p>Задания</p></td><td><p>Задание '%s' включено/выключено.</p></td></tr><tr><td><p>update_job</p></td><td><p>Задания</p></td><td><p>Задание '%s' обновлено.</p></td></tr><tr><td><p>delete_job</p></td><td><p>Задания</p></td><td><p>Задание '%s' удалено.</p></td></tr><tr><td><p>create_notify</p></td><td><p>Уведомления</p></td><td><p>Уведомление '%s' создано.</p></td></tr><tr><td><p>switch_notify</p></td><td><p>Уведомления</p></td><td><p>Уведомление '%s' включено/выключено.</p></td></tr><tr><td><p>update_notify</p></td><td><p>Уведомления</p></td><td><p>Уведомление '%s' обновлено.</p></td></tr><tr><td><p>delete_notify</p></td><td><p>Уведомления</p></td><td><p>Уведомление '%s' удалено.</p></td></tr><tr><td><p>create_driver</p></td><td><p>Водители</p></td><td><p>Водитель '%s' создан.</p></td></tr><tr><td><p>update_driver</p></td><td><p>Водители</p></td><td><p>Водитель '%s' обновлен.</p></td></tr><tr><td><p>delete_driver</p></td><td><p>Водители</p></td><td><p>Водитель '%s' удален.</p></td></tr><tr><td><p>create_trailer</p></td><td><p>Прицепы</p></td><td><p>Прицеп '%s' создан.</p></td></tr><tr><td><p>update_trailer</p></td><td><p>Прицепы</p></td><td><p>Прицеп '%s' обновлен.</p></td></tr><tr><td><p>delete_trailer</p></td><td><p>Прицепы</p></td><td><p>Прицеп '%s' удален.</p></td></tr><tr><td><p>create_drivers_group</p></td><td><p>Водители</p></td><td><p>Группа водителей '%s' создана.</p></td></tr><tr><td><p>update_drivers_group</p></td><td><p>Водители</p></td><td><p>Группа водителей '%s' обновлена.</p></td></tr><tr><td><p>delete_drivers_group</p></td><td><p>Водители</p></td><td><p>Группа водителей '%s' удалена.</p></td></tr><tr><td><p>create_trailers_group</p></td><td><p>Прицепы</p></td><td><p>Группа прицепов '%s' создана.</p></td></tr><tr><td><p>update_trailers_group</p></td><td><p>Прицепы</p></td><td><p>Группа прицепов '%s' обновлена.</p></td></tr><tr><td><p>delete_trailers_group</p></td><td><p>Прицепы</p></td><td><p>Группа прицепов '%s' удалена.</p></td></tr><tr><td><p>create_report</p></td><td><p>Шаблоны отчетов</p></td><td><p>Шаблон отчета '%s' создан.</p></td></tr><tr><td><p>update_report</p></td><td><p>Шаблоны отчетов</p></td><td><p>Шаблон отчета '%s' обновлен.</p></td></tr><tr><td><p>delete_report</p></td><td><p>Шаблоны отчетов</p></td><td><p>Шаблон отчета '%s' удален.</p></td></tr><tr><td><p>import_zones</p></td><td><p>Геозоны</p></td><td><p>Геозоны импортированы.</p></td></tr><tr><td><p>create_retranslator</p></td><td><p>Ретрансляторы</p></td><td><p>Ретранслятор '%s' создан.</p></td></tr><tr><td><p>update_retranslator</p></td><td><p>Ретрансляторы</p></td><td><p>Свойства изменены.</p></td></tr><tr><td><p>units_retranslator</p></td><td><p>Ретрансляторы</p></td><td><p>Объекты обновлены.</p></td></tr><tr><td><p>switch_retranslator</p></td><td><p>Ретрансляторы</p></td><td><p>Запущен/Остановлен.</p></td></tr><tr><td><p>msgs_history_retranslator</p></td><td><p>Ретрансляторы</p></td><td><p>Ретранслятор за прошедший период '%s' запущен/остановлен.</p></td></tr><tr><td><p>create_route</p></td><td><p>Маршруты</p></td><td><p>Маршрут '%s' создан.</p></td></tr><tr><td><p>update_route_points</p></td><td><p>Маршруты</p></td><td><p>Контрольные точки обновлены.</p></td></tr><tr><td><p>update_route_cfg</p></td><td><p>Маршруты</p></td><td><p>Свойства изменены.</p></td></tr><tr><td><p>create_round</p></td><td><p>Маршруты</p></td><td><p>Рейс '%s' создан.</p></td></tr><tr><td><p>update_round</p></td><td><p>Маршруты</p></td><td><p>Рейс '%s' обновлен.</p></td></tr><tr><td><p>delete_round</p></td><td><p>Маршруты</p></td><td><p>Рейс '%s' удален.</p></td></tr><tr><td><p>create_schedule</p></td><td><p>Маршруты</p></td><td><p>Расписание '%s' создано.</p></td></tr><tr><td><p>update_schedule</p></td><td><p>Маршруты</p></td><td><p>Расписание '%s' обновлено.</p></td></tr><tr><td><p>delete_schedule</p></td><td><p>Маршруты</p></td><td><p>Расписание '%s' удалено.</p></td></tr><tr><td><p>create_account</p></td><td><p>Создание элемента</p></td><td><p>Учетная запись '%s' создана.</p></td></tr><tr><td><p>delete_account</p></td><td><p>Создание элемента</p></td><td><p>Учетная запись '%s' удалена.</p></td></tr><tr><td><p>change_account</p></td><td><p>Учетная запись</p></td><td><p>Учетная запись изменена с '%s' на '%s'.</p></td></tr><tr><td><p>switch_account</p></td><td><p>Учетная запись</p></td><td><p>Учетная запись заблокирована/</p><p>Учетная запись разблокирована.</p></td></tr><tr><td><p>update_dealer_rights</p></td><td><p>Учетная запись</p></td><td><p>Права дилера включены/выключены.</p></td></tr><tr><td><p>do_payment</p></td><td><p>Учетная запись</p></td><td><p>Зарегистрирована оплата или дни.</p></td></tr><tr><td><p>update_account_flags</p></td><td><p>Учетная запись</p></td><td><p>Флаги учетной записи изменены.</p></td></tr><tr><td><p>update_account_block_balance</p></td><td><p>Учетная запись</p></td><td><p>Изменен баланс для блокировки учетной записи.</p></td></tr><tr><td><p>update_account_deny_balance</p></td><td><p>Учетная запись</p></td><td><p>Изменен баланс для ограничения активности.</p></td></tr><tr><td><p>update_account_min_days</p></td><td><p>Учетная запись</p></td><td><p>Изменен счетчик лимита дней.</p></td></tr><tr><td><p>update_account_plan</p></td><td><p>Учетная запись</p></td><td><p>Тарифный план изменен на '%s'.</p></td></tr><tr><td><p>update_account_history_period</p></td><td><p>Учетная запись</p></td><td><p>Срок хранения истории изменен на %s дней.</p></td></tr><tr><td><p>update_account_subplans</p></td><td><p>Учетная запись</p></td><td><p>Перечень доступных тарифных планов изменен.</p></td></tr><tr><td><p>update_service</p></td><td><p>Учетная запись</p></td><td><p>Сервис '%s' обновлен.</p></td></tr><tr><td><p>delete_driver_msg</p></td><td><p>Водители</p></td><td><p>Удалено сообщение от %s о назначении/снятии водителя '%s'.</p></td></tr><tr><td><p>delete_trailer_msg</p></td><td><p>Прицепы</p></td><td><p>Удалено сообщение от %s о назначении/снятии прицепа '%s'.</p></td></tr><tr><td><p>convert_measure_units</p></td><td><p>Настройки отчета</p></td><td><ul><li>Система мер изменена на&nbsp;%s.</li><li>Конвертация в %s.</li></ul></td></tr><tr><td><p>delete_zones_group</p></td><td><p>Геозоны</p></td><td><p>Группа геозон удалена.</p></td></tr><tr><td><p>create_zones_group</p></td><td><p>Геозоны</p></td><td><p>Группа геозон '%s' создана.</p></td></tr><tr><td><p>update_zones_group</p></td><td><p>Геозоны</p></td><td><p>Группа геозон '%s' обновлена.</p></td></tr><tr><td><p>trailer_reset_image</p></td><td><p>Прицепы</p></td><td><p>Прицеп '%s' обновлен.</p></td></tr><tr><td><p>driver_reset_image</p></td><td><p>Водители</p></td><td><p>Водитель '%s' обновлен.</p></td></tr><tr><td><p>zone_reset_image</p></td><td><p>Геозоны</p></td><td><p>Геозона '%s' обновлена.</p></td></tr><tr><td><p>create_order</p></td><td><p>Заявки</p></td><td><p>Заявка '%s' создана.</p></td></tr><tr><td><p>update_order</p></td><td><p>Заявки</p></td><td><p>Заявка '%s' обновлена.</p></td></tr><tr><td><p>delete_order</p></td><td><p>Заявки</p></td><td><p>Заявка '%s' удалена.</p></td></tr><tr><td><p>create_order_route</p></td><td><p>Заявки</p></td><td><p>Order route '%s' created.&nbsp;</p></td></tr><tr><td><p>update_order_route</p></td><td><p>Заявки</p></td><td><p>Order route '%s' updated.&nbsp;</p></td></tr><tr><td><p>delete_order_route</p></td><td><p>Заявки</p></td><td><p>Order route '%s' deleted.</p></td></tr><tr><td><p>create_tag</p></td><td><p>Метки</p></td><td><p>Пассажир '%s' создан.</p></td></tr><tr><td><p>update_tag</p></td><td><p>Метки</p></td><td><p>Пассажир '%s' обновлен.</p></td></tr><tr><td><p>tag_reset_image</p></td><td><p>Метки</p></td><td><p>Пассажир '%s' обновлен.</p></td></tr><tr><td><p>delete_tag</p></td><td><p>Метки</p></td><td><p>Пассажир '%s' удален.</p></td></tr><tr><td><p>delete_tag_msg</p></td><td><p>Метки</p></td><td><p>Удалено сообщение от %s о посадке/высадке пассажира '%s'.</p></td></tr><tr><td><p>update_tag_units</p></td><td><p>Метки</p></td><td><p>Список автоматического назначения пассажиров обновлен.</p></td></tr><tr><td><p>criteria_updated</p></td><td><p>Критерии</p></td><td><p>Критерии обновлены.</p></td></tr><tr><td><p>set_active</p></td><td><p>Деактивация</p></td><td><ul><li>Объект деактивирован.</li><li>Объект активирован.</li><li>Объект активирован автоматически.</li></ul></td></tr></tbody></table></div>

## Возвращаемый результат

Если запрос успешно выполнен, то возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_ITEM_MANAGE_LOG). |
| 4   | Неверные входные параметры. |

# delete_item

Функция **delete_item** используется для удаления элемента.

## Точка доступа

Чтобы удалить элемент в Wialon Hosting или Local, используйте следующую сигнатуру:

svc=item/delete_item  
&params={  
"itemId": &lt;long&gt;  
}

Для удаления 10 и более объектов в Wialon Hosting используйте сигнатуру:

svc=item/delete_item  
&params={  
"itemId": &lt;long&gt;,  
"reasons": \[{"reason_key"}\]  
}

## Parameters

| Параметр | Описание |
| --- | --- |
| itemId | ID элемента, который вы хотите удалить. |
| reasons | Массив с причинами удаления объектов. Если вы хотите удалить 10 или более объектов в Wialon Hosting, необходимо указать причину. Ключи причин и их описание смотрите на странице [delete_account](https://help.wialon.com/ru/api/user-guide/api-reference/account/delete_account#reasons). |

## Возвращаемый результат

Если запрос выполняется успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_ITEM_DELETE) или это не разрешено тарифным планом. |
| 4   | Неверные входные параметры. |

# get_backup

Функция **get_backup** используется для получения файлов автоматического резервного копирования для указанного элемента.

svc=item/get_backup&params={"itemId":&lt;long&gt;,  
"fileId": &lt;uint&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID элемента. |
| fileId | ID файла. |

## Возвращаемый результат

{  
"result": {  
"date":"&lt;text&gt;", /\* дата \*/  
"t":&lt;uint&gt;, /\* время создания \*/  
"unitId":&lt;long&gt;, /\* ID объекта \*/  
"id":&lt;long&gt;, /\* ID файла\*/  
"name": /\* имя файла \*/  
"content": /\* содержимое файла резервного копирования \*/  
},  
}

Возможные коды ошибок:

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Код</p></td><td><p>Описание</p></td></tr><tr><td><p>6</p></td><td><p>Неопределенная ошибка.</p></td></tr><tr><td><p>4</p></td><td><p>Неверные входные параметры или не удалось извлечь элемент с требуемым ACL:</p><ul><li><strong>Объект/Группа объектов</strong>&nbsp;—&nbsp;ADF_ACL_ITEM_DELETE, ADF_ACL_ITEM_EDIT_AFIELDS, ADF_ACL_ITEM_EDIT_CFIELDS, ADF_ACL_ITEM_EDIT_FILE, ADF_ACL_ITEM_EDIT_IMAGE, ADF_ACL_ITEM_EDIT_NAME, ADF_ACL_ITEM_EDIT_OTHER, ADF_ACL_AVL_UNIT_EDIT_CMD_ALIASES, ADF_ACL_AVL_UNIT_EDIT_COUNTERS, ADF_ACL_AVL_UNIT_EDIT_HW, ADF_ACL_AVL_UNIT_REG_EVENTS, ADF_ACL_AVL_UNIT_EDIT_REPORT_SETTINGS, ADF_ACL_AVL_UNIT_EDIT_SENSORS, ADF_ACL_AVL_UNIT_EDIT_MAINTENANCE;</li><li><strong>Ресурс&nbsp;</strong>—&nbsp;ADF_ACL_ITEM_DELETE, ADF_ACL_ITEM_EDIT_FILE, ADF_ACL_AVL_RES_EDIT_DRIVERS, ADF_ACL_AVL_RES_EDIT_JOBS, ADF_ACL_AVL_RES_EDIT_NF, ADF_ACL_AVL_RES_EDIT_POI, ADF_ACL_AVL_RES_EDIT_REPORTS, ADF_ACL_AVL_RES_EDIT_TRAILERS, ADF_ACL_AVL_RES_EDIT_ZONES;</li><li><strong>Пользователь&nbsp;</strong>—&nbsp;ADF_ACL_ITEM_DELETE, ADF_ACL_USER_SET_ITEMS_ACCESS, ADF_ACL_USER_OPERATE_AS, ADF_ACL_USER_EDIT_FLAGS;</li><li><strong>Маршрут&nbsp;</strong>—&nbsp;ADF_ACL_ITEM_DELETE, ADF_ACL_AVL_ROUTE_EDIT_SETTINGS;</li><li><strong>Ретранслятор&nbsp;</strong>—&nbsp;ADF_ACL_ITEM_DELETE, ADF_ACL_AVL_RETR_EDIT_SETTINGS, ADF_ACL_AVL_RETR_EDIT_UNITS;</li><li><strong>Прочие&nbsp;</strong>—&nbsp;ADF_ACL_ITEM_DELETE, ADF_ACL_ITEM_EDIT_NAME, ADF_ACL_ITEM_EDIT_CFIELDS, ADF_ACL_ITEM_EDIT_OTHER, ADF_ACL_ITEM_EDIT_SUB_ITEMS, ADF_ACL_ITEM_EDIT_AFIELDS, ADF_ACL_ITEM_EDIT_FILE, ADF_ACL_AVL_UNIT_EDIT_HW, ADF_ACL_AVL_UNIT_EDIT_SENSORS, ADF_ACL_AVL_UNIT_EDIT_COUNTERS, ADF_ACL_AVL_UNIT_EDIT_MAINTENANCE, ADF_ACL_AVL_UNIT_EDIT_CMD_ALIASES, ADF_ACL_AVL_UNIT_EDIT_REPORT_SETTINGS.</li></ul></td></tr></tbody></table></div>

# list_backups

Функция **list_backups** используется для просмотра всех файлов автоматического резервного копирования.

svc=item/list_backups&params={"itemId":&lt;long&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID элемента. |

## Возвращаемый результат

{  
"result": \[  
{  
"date":"&lt;text&gt;", /\* дата \*/  
"t":&lt;uint&gt;, /\* время создания \*/  
"unitId":&lt;long&gt;, /\* ID объекта \*/  
"id":&lt;long&gt;, /\* ID файла \*/  
"name": /\* имя файла \*/  
},  
...  
\]  
}

Возможные коды ошибок:

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Код</p></td><td><p>Описание</p></td></tr><tr><td><p>7</p></td><td><p>Не удалось извлечь элемент с требуемым ACL:</p><ul><li><strong>Объект/Группа объектов</strong>&nbsp;—&nbsp;ADF_ACL_ITEM_DELETE, ADF_ACL_ITEM_EDIT_AFIELDS, ADF_ACL_ITEM_EDIT_CFIELDS, ADF_ACL_ITEM_EDIT_FILE, ADF_ACL_ITEM_EDIT_IMAGE, ADF_ACL_ITEM_EDIT_NAME, ADF_ACL_ITEM_EDIT_OTHER, ADF_ACL_AVL_UNIT_EDIT_CMD_ALIASES, ADF_ACL_AVL_UNIT_EDIT_COUNTERS, ADF_ACL_AVL_UNIT_EDIT_HW, ADF_ACL_AVL_UNIT_REG_EVENTS, ADF_ACL_AVL_UNIT_EDIT_REPORT_SETTINGS, ADF_ACL_AVL_UNIT_EDIT_SENSORS, ADF_ACL_AVL_UNIT_EDIT_MAINTENANCE;</li><li><strong>Ресурс&nbsp;</strong>— ADF_ACL_ITEM_DELETE, ADF_ACL_ITEM_EDIT_FILE, ADF_ACL_AVL_RES_EDIT_DRIVERS, ADF_ACL_AVL_RES_EDIT_JOBS, ADF_ACL_AVL_RES_EDIT_NF, ADF_ACL_AVL_RES_EDIT_POI, ADF_ACL_AVL_RES_EDIT_REPORTS, ADF_ACL_AVL_RES_EDIT_TRAILERS, ADF_ACL_AVL_RES_EDIT_ZONES;</li><li><strong>Пользователь&nbsp;</strong>—&nbsp;ADF_ACL_ITEM_DELETE, ADF_ACL_USER_SET_ITEMS_ACCESS, ADF_ACL_USER_OPERATE_AS, ADF_ACL_USER_EDIT_FLAGS;</li><li>Route&nbsp;—&nbsp;ADF_ACL_ITEM_DELETE, ADF_ACL_AVL_ROUTE_EDIT_SETTINGS;</li><li><strong>Ретранслятор&nbsp;</strong>—&nbsp;ADF_ACL_ITEM_DELETE, ADF_ACL_AVL_RETR_EDIT_SETTINGS, ADF_ACL_AVL_RETR_EDIT_UNITS;</li><li><strong>Прочее&nbsp;</strong>—&nbsp;ADF_ACL_ITEM_DELETE, ADF_ACL_ITEM_EDIT_NAME, ADF_ACL_ITEM_EDIT_CFIELDS, ADF_ACL_ITEM_EDIT_OTHER, ADF_ACL_ITEM_EDIT_SUB_ITEMS, ADF_ACL_ITEM_EDIT_AFIELDS, ADF_ACL_ITEM_EDIT_FILE, ADF_ACL_AVL_UNIT_EDIT_HW, ADF_ACL_AVL_UNIT_EDIT_SENSORS, ADF_ACL_AVL_UNIT_EDIT_COUNTERS, ADF_ACL_AVL_UNIT_EDIT_MAINTENANCE, ADF_ACL_AVL_UNIT_EDIT_CMD_ALIASES, ADF_ACL_AVL_UNIT_EDIT_REPORT_SETTINGS.</li></ul></td></tr><tr><td><p>6</p></td><td><p>Неопределенная ошибка.</p></td></tr><tr><td><p>4</p></td><td><p>Неверные входные параметры.</p></td></tr></tbody></table></div>

# restore_icons

Функция **restore_icons** используется для восстановления иконок элемента.

svc=item/restore_icons&params={"resId":&lt;long&gt;,  
"trailerIcons":{&lt;long&gt;:"&lt;text&gt;"},  
"driverIcons":{&lt;long&gt;:"&lt;text&gt;"},  
"zoneIcons":{&lt;long&gt;:"&lt;text&gt;"},  
"unitIcons":{&lt;long&gt;:"&lt;text&gt;"}}

&nbsp;— ID элемента или свойства.  
 — URL иконки на сервере резервного копирования.

 Вы можете восстановить иконки для нескольких элементов одновременно, разделяя запятыми пары ID-URL.

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| resId | ID ресурса. |
| trailerIcons | Параметры иконки прицепа. |
| driverIcons | Параметры иконки водителя. |
| zoneIcons | Параметры иконки геозоны. |
| unitIcons | Параметры иконки объекта. |

## Возвращаемый результат

Если запрос выполняется успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_ZONES или ADF_ACL_AVL_RES_EDIT_DRIVERS или ADF_ACL_AVL_RES_EDIT_TRAILERS). |
| 4   | Неверные входные параметры. |

# update_admin_field

Функция **update_admin_field** используется для создания, изменения или удаления административных полей.

svc=item/update_admin_field&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"callMode":"&lt;text&gt;",  
"n":"&lt;text&gt;",  
"v":"&lt;text&gt;"}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>itemId</p></td><td><p>ID элемента.</p></td></tr><tr><td><p>id</p></td><td><p>ID административного поля. Не учитывается во время создания,&nbsp;ID административного поля генерируются системой.</p></td></tr><tr><td><p>callMode</p></td><td><p>Действие:</p><ul><li>создание;&nbsp;</li><li>изменение;&nbsp;</li><li>удаление.</li></ul></td></tr></tbody></table></div>

Следующие параметры требуются только для создания и изменения административных полей:

|     |     |
| --- | --- |
| Название | Описание |
| n   | Имя административного поля. |
| v   | Значение административного поля. |

## Возвращаемый результат

При создании или изменении административных полей возвращаемый результат следующий:

\[  
&lt;long&gt;, /\* ID административного поля \*/  
{  
"id":&lt;long&gt;, /\* ID административного поля \*/  
"n":"&lt;text&gt;", /\* имя \*/  
"v":"&lt;text&gt;" /\* значение \*/  
}  
\]

При удалении административных полей возвращаемый результат следующий:

\[  
&lt;long&gt;, /\* ID административного поля \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_ITEM_VIEW_AFIELDS, ADF_ACL_ITEM_EDIT_AFIELDS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_custom_field

Функция **update_custom_field** используется для создания, изменения или удаления произвольных полей.

svc=item/update_custom_field&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"callMode":"&lt;text&gt;"  
"n":"&lt;text&gt;",  
"v":"&lt;text&gt;"}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>itemId</p></td><td><p>ID элемента.</p></td></tr><tr><td><p>id</p></td><td><p>ID произвольного поля. Не учитывается во время создания,&nbsp;ID произвольных полей генерируются системой.</p></td></tr><tr><td><p>callMode</p></td><td><p>Действие:</p><ul><li>создание;&nbsp;</li><li>изменение;&nbsp;</li><li>удаление.</li></ul></td></tr></tbody></table></div>

Следующие параметры требуются только для создания и изменения произвольных полей:

|     |     |
| --- | --- |
| Название | Описание |
| n   | Имя произвольного поля. |
| v   | Значение произвольного поля. |

## Возвращаемый результат

При создании и изменении произвольных полей возвращаемый результат следующий:

\[  
&lt;long&gt;, /\* ID произвольного поля \*/  
{  
"id":&lt;long&gt;, /\* ID произвольного поля \*/  
"n":"&lt;text&gt;", /\* имя \*/  
"v":"&lt;text&gt;" /\* значение \*/  
}  
\]

При удалении произвольных полей возвращаемый результат следующий:

\[  
&lt;long&gt;, /\* ID произвольного поля \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_ITEM_VIEW_CFIELDS, ADF_ACL_ITEM_EDIT_CFIELDS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_custom_property

Функция **update_custom_property** используется для создания или изменения произвольного свойства элемента.

svc=item/update_custom_property&params={"itemId":&lt;long&gt;,  
"name":"&lt;text&gt;",  
"value":"&lt;text&gt;"}  
&sid="&lt;text&gt;"

Для удаления произвольного свойства используйте ту же функцию с пустым параметром **value**.

svc=item/update_custom_property&params={"itemId":&lt;long&gt;,  
"name":"&lt;text&gt;",  
"value":""}  
&sid="&lt;text&gt;"

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID элемента. |
| name | Имя произвольного свойства. |
| value | Значение произвольного свойства. |

## Возвращаемый результат

{  
"n":"&lt;text&gt;", /\* имя произвольного свойства \*/  
"v":"&lt;text&gt;" /\* значение произвольного свойства \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_ITEM_EDIT_OTHER). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_ftp_property

Функция **update_ftp_property** используется для изменения настроек собственного FTP-сервера.

svc=item/update_ftp_property&params={"itemId":&lt;long&gt;,  
"host":"&lt;text&gt;",  
"login":"&lt;text&gt;",  
"pass":"&lt;text&gt;",  
"path":"&lt;text&gt;",  
"check":&lt;uint&gt;,  
"hostingFtp":&lt;uint&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>itemId</p></td><td><p>ID ресурса.</p></td></tr><tr><td><p>host</p></td><td><p>URL FTP.</p></td></tr><tr><td><p>login</p></td><td><p>Логин FTP.</p></td></tr><tr><td><p>pass</p></td><td><p>Пароль FTP.</p></td></tr><tr><td><p>path</p></td><td><p>Путь.</p></td></tr><tr><td><p>check</p></td><td><p>Валидность настроек FTP:</p><ul><li>0&nbsp;— нет;</li><li>1&nbsp;— да.</li></ul></td></tr><tr><td><p>hostingFtp</p></td><td><p>Отправлять данные на FTP-сервер&nbsp;Wialon Hosting:&nbsp;</p><ul><li>0&nbsp;— нет;</li><li>1&nbsp;— да.</li></ul></td></tr></tbody></table></div>

 Для отправки данных на собственный FTP, значение “hostingFtp” должно быть 0, значение “check” — 1.

## Возвращаемый результат

{  
"hs":"&lt;text&gt;", /\* URL FTP \*/  
"lg":"&lt;text&gt;", /\* логин FTP \*/  
"pt":"&lt;text&gt;", /\* путь \*/  
"ch":"&lt;text&gt;", /\* валидность настроек FTP \*/  
"tp":&lt;uint&gt; /\* отправлять данные на FTP Wialon Hosting \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_ITEM_EDIT_OTHER). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_measure_units

Функция **update_measure_units** используется для изменения системы мер элемента.

svc=item/update_measure_units&params={"itemId":&lt;long&gt;,  
"type":&lt;uint&gt;,  
"flags":&lt;uint&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>itemId</p></td><td><p>ID элемента.</p></td></tr><tr><td><p>type</p></td><td><p>Целевая система мер:</p><ul><li>0&nbsp;— метрическая;&nbsp;</li><li>1&nbsp;— американская;</li><li>2&nbsp;— имперская.</li></ul></td></tr><tr><td><p>flags</p></td><td><ul><li>0&nbsp;— установить единицу измерения;</li><li>1&nbsp;— конвертировать значения и установить единицу измерения.</li></ul></td></tr></tbody></table></div>

## Возвращаемый результат

Если запрос выполняется успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_ITEM_EDIT_OTHER), не удалось извлечь пользователя или ошибка "не пользователь верхнего уровня". |
| 6   | Новый тип == старый тип или неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_name

Функция **update_name** используется для переименования элемента.

svc=item/update_name&params={"itemId":&lt;long&gt;,  
"name":"&lt;text&gt;"}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID элемента. |
| name | Новое имя (4-50 символов). |

## Возвращаемый результат

{  
"nm":"&lt;text&gt;" /\* новое имя элемента \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_ITEM_EDIT_NAME). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_profile_field

Функция **update_profile_field** используется для изменения полей характеристик.

svc=item/update_profile_field&params={"itemId":&lt;long&gt;,  
"n":"&lt;text&gt;",  
"v":"&lt;text&gt;"}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID элемента. |
| n   | Имя поля характеристик. |
| v   | Значение поля характеристик. |

Можно использовать следующие поля характеристик:

|     |     |
| --- | --- |
| Имя | Описание |
| vehicle_type | Тип транспортного средства. |
| vehicle_class | Класс транспортного средства. |
| vin | VIN. |
| registration_plate | Регистрационный знак. |
| brand | Марка. |
| model | Модель. |
| year | Год. |
| color | Цвет. |
| engine_model | Модель двигателя. |
| engine_power | Мощность двигателя, кВт. |
| engine_displacement | Объем двигателя, куб. см. |
| primary_fuel_type | Вид топлива. |
| co2_emission | Средние выбросы CO<sub>2</sub>. |
| cargo_type | Тип груза. |
| carrying_capacity | Грузоподъемность, т. |
| width | Ширина, мм. |
| height | Высота, мм. |
| depth | Глубина, мм. |
| effective_capacity | Полезный объем. |
| gross_vehicle_weight | Допустимая общая масса. |
| axles | Количество осей. |

## Возвращаемый результат

\[  
&lt;long&gt;, /\* ID поля \*/  
{  
"id":&lt;long&gt;, /\* ID поля \*/  
"n":"&lt;text&gt;", /\* имя поля \*/  
"v":"&lt;text&gt;" /\* значение поля \*/  
}  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_ITEM_VIEW_CFIELDS, ADF_ACL_ITEM_EDIT_CFIELDS). |
| 6   | Неопределенная ошибка. |
| 3   | Не найден элемент сервера AVL или не подключен плагин библиотеки типов. |
| 4   | Неверные входные параметры. |

# messages

В этом разделе описаны команды для работы с загрузчиком сообщений. С помощью команды [load_last](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_last) или [load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval) можно загружать сообщения в загрузчик и работать с ними. Чтобы загрузить другую коллекцию сообщений, достаточно добавить ее в загрузчик. Очистить загрузчик можно с помощью команды [unload](https://help.wialon.com/ru/api/user-guide/api-reference/messages/unload).

 Загрузчик позволяет работать только с одной коллекцией сообщений, которая сохраняется в сессии на стороне сервера. Для нее можно вызывать команды типа **…/unit/calc_sensors**. Добавление следующей коллекции сообщений приводит к автоматической очистке предыдущей.

# delete_message

Чтобы удалить сообщение, используйте запрос **messages/delete_message**:

svc=messages/delete_message&params={"msgIndex":&lt;uint&gt;}

Использование этого запроса рассмотрено в примере [messages](https://help.wialon.com/ru/api/user-guide/api-reference/messages/message-request-examples).

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| msgIndex\* | Индекс сообщения. |

## Возвращаемый результат

{ } /\* пустой объект при удачном выполнении, при неудачном — код ошибки \*/

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 4   | Нет такого сообщения, либо это последнее сообщение, которое нельзя удалить, либо не удалось извлечь объект. |
| 6   | Не удалось удалить сообщение. |
| 7   | Пользователь не найден или нет прав на удаление сообщений. |

# get_task_messages

Запрос **messages/get_task_messages** позволяет вам загружать сообщения о зарегистрированных событиях для всех объектов, на которые у вас есть право доступа **Просмотр элемента и его основных свойств**.

svc=messages/get_task_messages&params={  
"itemIds": \[&lt;long&gt;\],  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;,  
"loadCount":&lt;uint&gt;  
}

Пример запроса:

https://hst-api.wialon.com/wialon/ajax.html?sid=b8c179f636baedfd43e1890bd48a8ee9&svc=messages/get_task_messages&params={  
"itemIds":\[1546, 1545\],  
"timeFrom": 1724347800,  
"timeTo": 1724693399,  
"loadCount": 10000  
}

## Параметры

Ниже перечислены обязательные параметры.

|     |     |
| --- | --- |
| **Параметр** | **Описание** |
| itemIds | Идентификаторы объектов. |
| timeFrom | Начало интервала. |
| timeTo | Конец интервала. |
| loadCount | Количество сообщений для загрузки. Максимальное значение — 20000. |

## Возвращаемый результат

Пример результата при успешном выполнении запроса:

{  
"count": 5,  
"messages": \[  
{  
"item_id": 1546,  
"t": 1724420460,  
"f": 1536,  
"tp": "evt",  
"et": "adf",  
"x": 0,  
"y": 0,  
"rt": 1724420493,  
"p": {  
"task_sub_type": 21,  
"task_reg_type": 1,  
"task_evt_name": "Custom event",  
"task_id": "b1978b93a308c5c3be0697223bf0c5002ee87de02ce7937b23a34830516c330466c8916c",  
"task_update_time": 1724420460,  
"task_status": 1,  
"task_priority": 2,  
"task_assignee": 0,  
"task_comments": "\[\]",  
"task_account": 1063  
}  
},  
{  
"item_id": 1546,  
"t": 1724420460,  
"f": 1536,  
"tp": "evt",  
"et": "adf",  
"x": 0,  
"y": 0,  
"rt": 1724420497,  
"p": {  
"task_sub_type": 21,  
"task_reg_type": 1,  
"task_evt_name": "Custom event",  
"task_id": "c52f1f15dd9a2c5b3258102cde5ad75a24b76820b4cf0d2438c835d796a2fd5966c8916c",  
"task_update_time": 1724420460,  
"task_status": 1,  
"task_priority": 2,  
"task_assignee": 0,  
"task_comments": "\[\]",  
"task_account": 1063  
}  
},  
{  
"item_id": 1546,  
"t": 1724420460,  
"f": 1536,  
"tp": "evt",  
"et": "adf",  
"x": 0,  
"y": 0,  
"rt": 1724420496,  
"p": {  
"task_sub_type": 21,  
"task_reg_type": 1,  
"task_evt_name": "Custom event",  
"task_id": "cec6ce7c7bb4ae44304494eb6659e2952ad3ca0dab62093e2482403d62b1157466c8916c",  
"task_update_time": 1724420460,  
"task_status": 1,  
"task_priority": 2,  
"task_assignee": 0,  
"task_comments": "\[\]",  
"task_account": 1063  
}  
},  
{  
"item_id": 1546,  
"t": 1724420460,  
"f": 1536,  
"tp": "evt",  
"et": "adf",  
"x": 0,  
"y": 0,  
"rt": 1724420494,  
"p": {  
"task_sub_type": 21,  
"task_reg_type": 1,  
"task_evt_name": "Custom event",  
"task_id": "7674dbcfae5776e0847d7239401c0b9384a99226c0245b9501ba8917b38e8d6b66c8916c",  
"task_update_time": 1724420460,  
"task_status": 1,  
"task_priority": 2,  
"task_assignee": 0,  
"task_comments": "\[\]",  
"task_account": 1063  
}  
},  
{  
"item_id": 1546,  
"t": 1724420460,  
"f": 1536,  
"tp": "evt",  
"et": "adf",  
"x": 0,  
"y": 0,  
"rt": 1724420495,  
"p": {  
"task_sub_type": 21,  
"task_reg_type": 1,  
"task_evt_name": "Custom event",  
"task_id": "e15b634b9750481a951ffac6bbbbd76411669aa829c78c925b5b2f08b3f5a77066c8916c",  
"task_update_time": 1724420460,  
"task_status": 1,  
"task_priority": 2,  
"task_assignee": 0,  
"task_comments": "\[\]",  
"task_account": 1063  
}  
}  
\]  
}

Если запрос не выполнен, возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| **Код** | **Описание** |
| 4   | Невалидные входные параметры. |
| 5   | Ошибка выполнения запроса. |
| 7   | Доступ запрещен. Требуется право доступа на объект **Просмотр элемента и его основных свойств**. |
| 1004 | Превышено максимальное количество сообщений (параметр loadCount). |

# unload

Чтобы очистить загрузчик сообщений, используйте запрос **messages/unload**:

svc=messages/unload&params={}

Использование этого запроса рассмотрено в примере [messages](https://help.wialon.com/ru/api/user-guide/api-reference/messages/message-request-examples).

## Возвращаемый результат

{} /\* пустой объект при удачном выполнении, при неудачном — код ошибки \*/

# get_message_file

Чтобы получить фотографию из сообщения от водителя, используйте запрос **messages/get_message_file**:

svc=messages/get_message_file&params={"itemId":&lt;uint&gt;,  
"fileId":"&lt;text&gt;"}  
/\*Alternative request form:\*/  
svc=messages/get_message_file&params={"msgIndex":&lt;uint&gt;,  
"fileName":"&lt;text&gt;"}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| itemId\* | ID водителя. |
| fileId\* | ID файла изображения. |

**Альтернативные параметры запроса**

|     |     |
| --- | --- |
| Параметр | Описание |
| msgIndex\* | Индекс сообщения. |
| fileName\* | Имя файла. |

Параметр **fileID** приходит в [JSON сообщения](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_evts).

## Возвращаемый результат

Если запрос выполнен успешно, возвращается изображение. В обратном случае возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Не удалось извлечь менеджер сообщений с ACL (ADF_ACL_ITEM_EXECUTE_REPORTS). |
| 4   | Неверные параметры, либо файл не найден, либо не удалось извлечь сообщения. |

# load_interval

Чтобы загрузить сообщения за определенный интервал в загрузчик сообщений, используйте запрос messages/load_interval:

svc=messages/load_interval&params={"itemId":&lt;long&gt;,  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;,  
"flags":&lt;uint&gt;,  
"flagsMask":&lt;uint&gt;,  
"loadCount":&lt;uint&gt;}

Этот запрос нельзя выполнять одновременно со следующими запросами:

- […/report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report),
- […/report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result),
- […/report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart),
- […/report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map),
- […/render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer),
- […/unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips),
- […/resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings),
- […/resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings),
- все запросы из раздела [exchange](https://help.wialon.com/ru/api/user-guide/api-reference/exchange),
- […/account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

Использование этого запроса рассмотрено в примере [messages](https://help.wialon.com/ru/api/user-guide/api-reference/messages/message-request-examples).

## Параметры

Обязательные параметры отмечены звездочкой (\*).

| Параметр | Описание |
| --- | --- |
| itemId\* | ID объекта или ресурса (зависит от типа сообщений, которые нужно получить). |
| timeFrom\* | Начало интервала. |
| timeTo\* | Конец интервала. |
| flags\* | Флаги для загрузки сообщений. См. описание ниже. |
| flagsMask\* | Маска. См. описание ниже. |
| loadCount\* | Количество сообщений, которые необходимо вернуть (0xffffffff — все найденные). |

**Примеры использования масок и флагов сообщений:**

| Маска | Флаг | Результат |
| --- | --- | --- |
| 0xFF00 | 0x0000 | Все сообщения с данными. |
| 0xFF10 | 0x0010 | Сообщения с данными, в которых содержится бит тревожного сообщения (0x10). |
| 0xFFF0 | 0x0010 | Сообщения с данными, в которых содержится бит тревожного сообщения (0x10), но не содержится информации о коде водителя (0x20). |
| 0xFFF2 | 0x0022 | Сообщения с данными, в которых содержится информация о коде водителя (0x20) и о входящих данных (0x02), но нет бита тревожного сообщения (0x10). |
| 0xFF01 | 0x0601 | События, которые являются нарушениями. |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается следующий ответ:

{  
"count":&lt;uint&gt;, /\* количество сообщений \*/  
"messages":\[ /\* массив сообщений \*/  
{  
...  
}  
\]  
}

Форматы, маски и флаги сообщений рассмотрены [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/format/messages).

При неудачном выполнении возвращается код ошибки.

### Коды ошибок

| Код ошибки | Описание |
| --- | --- |
| 7   | Не удалось извлечь менеджер сообщений. |
| 6   | Не удалось извлечь сообщения за интервал. |
| 4   | Не удалось извлечь пользователя. |
| 1003 | Accept-encoding не gzip. |

# load_last

Чтобы загрузить последние несколько сообщений за указанный период, используйте запрос **messages/load_last**:

svc=messages/load_last&params={"itemId":&lt;long&gt;,  
"lastTime":&lt;uint&gt;,  
"lastCount":&lt;uint&gt;,  
"flags":&lt;uint&gt;,  
"flagsMask":&lt;uint&gt;,  
"loadCount":&lt;uint&gt;}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| itemId\* | ID объекта или ресурса (зависист от типа сообщений, которые необходимо получить). |
| lastTime\* | Время, за которое запрашиваются сообщения. |
| lastCount\* | Количество сообщений, которые необходимо загрузить. |
| flags\* | Флаги сообщений. Загружаются только те сообщения, которые соответствуют указанным флагам. См. [подробнее](https://help.wialon.com/help/api/ru/user-guide/api-reference/format/messages). |
| flagsMask\* | Маска. См. [load_interval](https://help.wialon.com/help/api/ru/user-guide/api-reference/messages/load_interval). |
| loadCount\* | Количество сообщений, которое необходимо возвратить. |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается следующий результат:

{  
"count":&lt;uint&gt;, /\* количество сообщений \*/  
"messages":\[ /\* массив сообщений \*/  
{  
...  
}  
\]  
}

Форматы сообщений представлены [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/format/messages).

При неудачном выполнении возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Не удалось извлечь менеджер сообщений с необходимым ACL (ADF_ACL_ITEM_EXECUTE_REPORTS). |
| 6   | Не удалось извлечь сообщения объекта. |
| 4   | Сообщения за указанный период не найдены, или превышено допустимое количество сообщений (10 000). |

# Примеры запросов сообщений

Работать с сообщениями можно с помощью загрузчика сообщений. Для этого необходимо загрузить их туда с помощью одной из двух команд: [messages/load_last](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_last) или [messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval). Если затем вы хотите загрузить другие сообщения, то сначала необходимо очистить загрузчик с помощью команды [messages/unload](https://help.wialon.com/ru/api/user-guide/api-reference/messages/unload).

## Загрузка сообщений

Загрузим позиционные сообщения с данными за интервал с 01.04.2013 по 20.04.2013 с помощью запроса [messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval) и получим первые три сообщения. Чтобы запросить только позиционные сообщения с данными, используйте маску 0xFF01 (65281). Маска 0xFF00 (65280) определяет тип сообщения, 0x0001 (1) — наличие в сообщениях информации о местоположении. Также необходимо использовать флаг 0x0001 (1), который является суммой флага 0x0000 (0) для сообщений с данными и флага 0x0001 (1) для позиционных сообщений.

https://hst-api.wialon.com/wialon/ajax.html?svc=messages/load_interval&  
params={  
"itemId":34868,  
"timeFrom":1364760000,  
"timeTo":1366487999,  
"flags":1,  
"flagsMask":65281,  
"loadCount":3  
}&sid=&lt;your_sid&gt;

Ответ:

{  
"count": 9172,  
"messages": \[{  
"t": 1364760081,  
"f": 3,  
"tp": "ud",  
"pos": {  
"y": 53.8396544,  
"x": 27.5608672,  
"z": 213,  
"s": 0,  
"c": 51,  
"sc": 9  
},  
"i": 0,  
"p": {  
"param22": 3,  
"adc1": 12.606,  
"pwr_ext": 12.598,  
"param199": 0,  
"param241": 25701,  
"battery_charge": 0  
}  
}, {  
"t": 1364760381,  
"f": 3,  
"tp": "ud",  
"pos": {  
"y": 53.8396544,  
"x": 27.5609312,  
"z": 213,  
"s": 0,  
"c": 73,  
"sc": 9  
},  
"i": 0,  
"p": {  
"param22": 3,  
"adc1": 12.545,  
"pwr_ext": 12.547,  
"param199": 0,  
"param241": 25701,  
"battery_charge": 0  
}  
}, {  
"t": 1364760682,  
"f": 3,  
"tp": "ud",  
"pos": {  
"y": 53.8396736,  
"x": 27.5609664,  
"z": 215,  
"s": 0,  
"c": 64,  
"sc": 9  
},  
"i": 0,  
"p": {  
"param22": 3,  
"adc1": 12.6,  
"pwr_ext": 12.569,  
"param199": 0,  
"param241": 25701,  
"battery_charge": 0  
}  
}\]  
}

После загрузки вы можете выбрать любое количество сообщений для дальнейшей обработки. Например, выберем девятое сообщение из загрузчика. Для этого воспользуемся запросом [messages/get_messages](https://help.wialon.com/ru/api/user-guide/api-reference/messages/get_messages):

https://hst-api.wialon.com/wialon/ajax.html?svc=messages/get_messages&  
params={  
"indexFrom":8,  
"indexTo":9  
}&sid=&lt;your_sid&gt;

Ответ:

\[{  
"t": 1364762485,  
"f": 3,  
"tp": "ud",  
"pos": {  
"y": 53.8396992,  
"x": 27.5609216,  
"z": 223,  
"s": 0,  
"c": 45,  
"sc": 7  
},  
"i": 0,  
"p": {  
"param22": 3,  
"adc1": 12.584,  
"pwr_ext": 12.569,  
"param199": 0,  
"param241": 25701,  
"battery_charge": 0  
}  
}\]

## Удаление сообщений

Удалим первое сообщение, используя запрос [messages/delete_message](https://help.wialon.com/ru/api/user-guide/api-reference/messages/delete_message):

https://hst-api.wialon.com/wialon/ajax.html?svc=messages/delete_message&  
params={  
"msgIndex":0  
}&sid=&lt;your_sid&gt;

Ответ:

{ }

## Очистка загрузчика сообщений

Если вы хотите загрузить сообщения за другой интервал или от другого объекта, сначала [очистите](https://help.wialon.com/ru/api/user-guide/api-reference/messages/unload) загрузчик сообщений:

https://hst-api.wialon.com/wialon/ajax.html?svc=messages/unload&params={}&sid=&lt;your_sid&gt;

Ответ:

{ }

# order

В этом разделе описаны команды для работы с заявками.

# optimize

Чтобы при планировании маршрута и распределении заявок применялась оптимизация, используйте команду **order/optimize**.

svc=order/optimize&params={"itemId":&lt;long&gt;,  
"orders":\[&lt;uint&gt;,{JSOn},...\],  
"warehouses":\[&lt;uint&gt;\],  
"units":\[&lt;uint&gt;\],  
"flags":&lt;uint&gt;,  
"gis":{  
"provider":&lt;uint&gt;,  
"addPoints":&lt;uint&gt;,  
"speed":&lt;uint&gt;,  
"mode":"&lt;text&gt;",  
"avoid":"&lt;text&gt;",  
"departure_time":&lt;uint&gt;,  
"traffic_model":"&lt;text&gt;",  
"transit_mode":"&lt;text&gt;",  
"transit_routing_preference":"&lt;text&gt;"  
},  
"busyRoutes":{  
"&lt;uint&gt;":\[  
{  
"tf":&lt;uint&gt;,  
"tt":&lt;uint&gt;,  
"pf":{&lt;uint&gt; || {JSON}},  
"pt":{&lt;uint&gt; || {JSON}  
},  
...  
\]  
},  
"addPoints":&lt;bool&gt;,  
"priority":{&lt;uint&gt;:{&lt;uint&gt;:&lt;uint&gt;},...},  
"criterions":{"&lt;text&gt;":&lt;uint&gt;,...},  
"preference":{&lt;uint&gt;:&lt;uint&gt;,...}  
}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Параметр</p></td><td><p>Описание</p></td></tr><tr><td><p>itemId*</p></td><td><p>ID ресурса.</p></td></tr><tr><td><p>orders*</p></td><td><p>Массив оптимизируемых заявок (индексы/JSON заявок через запятую).</p></td></tr><tr><td><p>warehouses</p></td><td><p>Массив складов.</p></td></tr><tr><td><p>flags*</p></td><td><p>Флаги оптимизации.</p></td></tr><tr><td><p>gis</p></td><td><p>Настройки GIS.</p></td></tr><tr><td><p>busyRoutes</p></td><td><p>Период занятости.</p></td></tr><tr><td><p>tf</p></td><td><p>Время начала периода занятости.</p></td></tr><tr><td><p>tt</p></td><td><p>Время конца периода занятости.</p></td></tr><tr><td><p>pf</p></td><td><p>Точка начала периода занятости: ID или JSON заявки.</p></td></tr><tr><td><p>pt</p></td><td><p>Точка конца периода занятости: ID или JSON заявки.</p></td></tr><tr><td><p>provider</p></td><td><p>Источник данных для оптимизации:</p><ul><li>0&nbsp;— нет;</li><li>1&nbsp;— Gurtam Maps (по умолчанию);</li><li>2&nbsp;— Google.</li></ul></td></tr><tr><td><p>mode</p></td><td><p>Способ передвижения (только для Google):</p><ul><li>driving —&nbsp;на автомобиле;</li><li>walking —&nbsp;пешком;</li><li>bicycling —&nbsp;на велосипеде;</li><li>transit —&nbsp;на общественном транспорте.</li></ul></td></tr><tr><td><p>avoid</p></td><td><p>Ограничения (только для Google):</p><ul><li>tolls&nbsp;— платные дороги;</li><li>highways —&nbsp;шоссе;</li><li>ferries —&nbsp;паромные переправы;</li><li>indoor —&nbsp;помещения.</li></ul></td></tr><tr><td><p>departure_time</p></td><td><p>Запланированное время отправления (только для Google).</p></td></tr><tr><td><p>traffic_model</p></td><td><p>Модель движения (только для Google):</p><ul><li>best guess —&nbsp;сбалансированная;</li><li>optimistic —&nbsp;оптимистичная;</li><li>pessimistic —&nbsp;пессимистичная.</li></ul></td></tr><tr><td><p>transit_mode</p></td><td><p>Предпочитаемые виды транспорта (только для Google):</p><ul><li>bus — автобус;</li><li>subway — метро;</li><li>train — поезд;</li><li>tram — трамвай;</li><li>rail —&nbsp;железнодорожный транспорт.</li></ul></td></tr><tr><td><p>transit_routing_preference</p></td><td><p>Приоритет маршрутов на общественном транспорте (только для Google).</p></td></tr><tr><td><p>addPoints</p></td><td><p>Вернуть трек в ответе: 1&nbsp;— да, 0&nbsp;— нет.</p></td></tr><tr><td><p>speed</p></td><td><p>Скорость, которая должна использоваться для оптимизации, км/ч (по умолчанию 60).</p></td></tr><tr><td><p>units</p></td><td><p>Массив объектов.</p></td></tr><tr><td><p>priority</p></td><td><p>Порядок заявок:&nbsp;{индекс объекта:{индекс заявки: ожидаемое положение заявки в маршруте}}&nbsp;</p><p>Заявка с положением равным -1 всегда считается последней в маршруте.</p></td></tr><tr><td><p>criterions</p></td><td><p>Критерии завершения маршрута:</p><ul><li>max_mileage —&nbsp;максимальный пробег,&nbsp;м;</li><li>max_duration —&nbsp;максимальная длительность, с;</li><li>max_order_count —&nbsp;максимальное количество заявок;</li><li>max_idling —&nbsp;максимальное время простоя между заявками, с;</li></ul></td></tr><tr><td><p>preference</p></td><td><p>Приоритет заявки в маршруте.</p></td></tr></tbody></table></div>

 Формат JSON заявки такой же, как в запросе [update](https://help.wialon.com/ru/api/user-guide/api-reference/order/update).

 Подробнее о настройках Google смотрите [здесь](https://developers.google.com/maps/documentation/distance-matrix/intro?hl=ru#travel_modes).

## Флаги

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x1 | Оптимизировать по расписанию заявки. Используются параметры **tf** и **tt**. |
| 0x2 | Оптимизировать по времени выполнения всех заявок. |
| 0x20 | Оптимизировать по грузоподъемности объекта. |
| 0x40 | Оптимизировать по полезному объему объекта. |
| 0x80 | Оптимизировать только заявки, у которых **tt** больше текущего времени. Если **tf** меньше текущего времени, значит **tf** = текущее время. |

Если лимиты превышены:

|     |     |
| --- | --- |
| 0x100 | Маршрут завершается. |
| 0x200 | Посещается промежуточный склад. |
| 0x300 | Маршрут разделяется на несколько. |

## Возвращаемый результат

{  
"1":{ /\* оптимизация для первого объекта \*/  
"orders":\[  
{  
"ml":&lt;uint&gt;, /\* пробег \*/  
"tm":&lt;uint&gt;, /\* время посещения области заявки \*/  
"id":&lt;uint&gt; /\* индекс заявки в переданном в запросе массиве (нумерация от 0) \*/  
},  
{  
"ml":&lt;uint&gt;, /\* пробег \*/  
"tm":&lt;uint&gt;, /\* время посещения области заявки \*/  
"id":&lt;uint&gt; /\* индекс заявки в переданном в запросе массиве (нумерация от 0) \*/  
}  
\]  
},  
"2":{ /\* optimization for the second unit (if the number of units is greater than one) \*/  
"orders":\[  
{  
"ml":&lt;uint&gt;, /\* пробег \*/  
"tm":&lt;uint&gt;, /\* время посещения области заявки \*/  
"id":&lt;uint&gt; /\* индекс заявки в переданном в запросе массиве (нумерация от 0) \*/  
},  
{  
"ml":&lt;uint&gt;, /\* пробег \*/  
"tm":&lt;uint&gt;, /\* время посещения области заявки \*/  
"id":&lt;uint&gt; /\* индекс заявки в переданном в запросе массиве (нумерация от 0) \*/  
}  
\]  
},  
..., /\* оптимизация для других объектов (если количество объектов больше 1) \*/  
"success":&lt;bool&gt; /\* статус оптимизации:  
1 — выполнена успешно (есть решение, которое соответстует всем требованиям),  
0 — не удалось выполнить \*/  
}

 Если на объект назначены только заявки склада (флаг **0x4**), то склад не будет показываться в ответе.

 Если маршрут разделился на несколько, то в ответе будет массив маршрутов.

## Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Невалидный параметр itemId. |
| 6   | Внутренняя ошибка. |
| 4   | Логическая ошибка. Причина указана в ответе. |

# attach

Чтобы прикрепить файл к заявке, используйте команду **order/attach**:

svc=order/attach&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"eventHash":"&lt;text&gt;"}  
&sid="&lt;text&gt;"

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| itemId | ID ресурса. |
| id  | ID заявки внутри ресурса. |
| eventHash | Имя события, которое генерируется после прочтения данных. |

Чтобы прикрепить файл к заявке, отправьте запрос POST. Пример:

Request URL:https://hst-api.wialon.com/wialon/ajax.html?svc=order/attach  
Request Method:POST  
Content-Type:multipart/form-data; boundary=----WebKitFormBoundarya38SwBwyXw5BFPQ1  
<br/><br/>\------WebKitFormBoundarya38SwBwyXw5BFPQ1  
Content-Disposition: form-data; name="params"  
<br/>{"itemId":39801,"id":3,"eventHash":"jUploadForm1435580226231"}  
\------WebKitFormBoundarya38SwBwyXw5BFPQ1  
Content-Disposition: form-data; name="eventHash"  
<br/>jUploadForm1435580226231  
\------WebKitFormBoundarya38SwBwyXw5BFPQ1  
Content-Disposition: form-data; name="file_upload"; filename="attachment.txt"  
Content-Type: application/octet-stream  
<br/><br/>\------WebKitFormBoundarya38SwBwyXw5BFPQ1--

## Возвращаемый результат

{  
"error":0  
}

## Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Не удалось извлечь элемент с указанным itemId. |
| 5   | Возникла ошибка при записи файла. |
| 4   | Нет предоставленных файлов или один из файлов пуст. |

# detach

Чтобы открепить файл от заявки, используйте команду **order/detach**.

svc=order/detach&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"path":"&lt;text&gt;"}

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| itemId | ID ресурса. |
| id  | ID заявки внутри ресурса. |
| path | Имя файла. |

 Получить список прикрепленных к заявке файлов можно с помощью команды **order/list_attachments**.

## Возвращаемый результат

{ }

## Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Ну удалось извлечь элемент с указанным itemId. |
| 5   | Возникла ошибка при удалении файла. |

# get_attachment

Чтобы получить прикрепленный файл, используйте команду **order/get_attachment**.

svc=order/get_attachment&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"path":"&lt;text&gt;"}

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| itemId | ID ресурса. |
| id  | ID заявки внутри ресурса. |
| path | Имя файла. |

## Возвращаемый результат

В случае успеха сервер возвращает запрашиваемый файл.

В случае неудачи:

Invalid input{"error":3}

# get_orders_history

Чтобы получить историю заявок, используйте команду **order/get_orders_history**.

svc=order/get_orders_history&params={  
"itemId":&lt;long&gt;,  
"ivalType":&lt;int&gt;,  
"ivalFrom":&lt;uint&gt;,  
"ivalTo":&lt;uint&gt;,  
"name":"&lt;text&gt;",  
"unitId":&lt;long&gt;,  
"orderId":&lt;long&gt;,  
"orderUid":&lt;long&gt;,  
"routeId":&lt;long&gt;  
}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |     |
| --- | --- | --- |
| Параметр | Значение по умолчанию | Описание |
| itemId\* |     | ID ресурса. |
| ivalType | 1   | Запрашиваемый тип интервала, как в сообщениях. Возможные значения: 1,2,3,4. |
| ivalFrom | 0   | Время начала интервала. |
| ivalTo | UINT_MAX | Время окончания интервала. |
| name |     | Маски имен заявок. Например, при поиске "name": "Vil\*,Berl\*" будут найдены заявки, которые начинаются на «Vil» и «Berl». |
| unitId |     | ID объекта. |
| orderId |     | ID заявки (может повторяться в истории). |
| orderUid |     | Уникальный ID заявки. |
| routeId |     | ID маршрута. |

## Возвращаемый результат

{  
"orders":\[  
{...}.  
{...},  
...  
\],  
"count":&lt;uint&gt;, /\* количество отфильтрованных заявок (размер "orders") \*/  
"total":&lt;uint&gt; /\* общее количество заявок за запрашиваемый период \*/  
}

## Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Невалидный ID ресурса. |
| 6   | Внутренняя ошибка. |

# get_route_from_history

Чтобы получить маршрут из истории, используйте команду **order/get_route_from_history**.

svc=order/get_route_from_history&params={  
"itemId":&lt;long&gt;,  
"routeId":&lt;long&gt;,  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;,  
"addPoints":&lt;uint&gt;  
}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| itemId\* | ID ресурса. |
| routeId\* | ID маршрута. |
| timeFrom\* | Время начала. |
| timeTo\* | Время окончания. |
| addPoints | Добавить точки маршрута к маршруту. По умолчанию 1. |

## Возвращаемый результат

{  
"routes":\[  
{...},  
{...},  
...  
\],  
"count":&lt;uint&gt;,  
"total":&lt;uint&gt;  
}

## Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Некорректный ID ресурса. |
| 6   | Внутренняя ошибка. |

# get_routes_history

Чтобы получить историю маршрутов, используйте команду **order/get_routes_history**.

svc=order/get_routes_history&params={  
"itemId":&lt;long&gt;,  
"ivalType":&lt;int&gt;,  
"ivalFrom":&lt;uint&gt;,  
"ivalTo":&lt;uint&gt;,  
"name":"&lt;text&gt;",  
"unitId":&lt;long&gt;,  
"routeId":&lt;long&gt;  
}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |     |
| --- | --- | --- |
| Параметры | Значение по умолчанию | Описание |
| itemId\* |     | ID ресурса. |
| ivalType | 1   | Запрашиваемый тип интервала, как в сообщениях. Возможные значения: 1,2,3,4. |
| ivalFrom | 0   | Время начала интервала. |
| ivalTo | UINT_MAX | Время окончания интервала. |
| name |     | Маски имен маршрутов. Например, при поиске "name": "Vil\*,Berl\*" будут найдены маршруты, которые начинаются на «Vil» и «Berl». |
| unitId |     | ID объекта. |
| routeId |     | ID маршрута. |

## Возвращаемый результат

{  
"routes":\[  
{...}.  
{...},  
...  
\],  
"count":&lt;uint&gt;, /\* количество отфильтрованных маршрутов (размер "routes") \*/  
"total":&lt;uint&gt; /\* общее количество маршрутов за запрошенный период \*/  
}

## Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Невалидный ID ресурса. |
| 6   | Внутренняя ошибка. |

# list_attachments

Чтобы получить список всех файлов, прикрепленных к заявке, используйте следующую команду:

svc=order/list_attachments&params={"itemId":&lt;long&gt;,  
"id":&lt;uint&gt;}

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| itemId | ID ресурса. |
| id  | ID заявки внутри ресурса. |

## Возвращаемый результат

\[  
{  
"n":"&lt;text&gt;", /\* имя файла \*/  
"s":&lt;uint&gt;, /\* размер, байт \*/  
"ct":&lt;uint&gt;, /\* время создания \*/  
"mt":&lt;uint&gt; /\* время последнего изменения \*/  
},  
...  
\]  

## Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Невалидный ID ресурса. |
| 5   | Заявки не найдены. |

# list_virtual_order_routes

Чтобы получить список виртуальных маршрутов, используйте команду **order/list_virtual_order_routes**.

svc=order/list_virtual_order_routes&params={  
"itemId":&lt;long&gt;  
}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| itemId\* | ID ресурса. |

## Возвращаемый результат

{  
{...},  
{...},  
...  
}

## Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Неверный ID ресурса. |

# route_update

Чтобы создать, редактировать или удалить маршрут, используйте команду **order/route_update**.

svc=order/route_update&params={ "itemId":&lt;long&gt;,  
"orders":\\\[\\\],  
"routeId":&lt;long&gt;,  
"callMode":"&lt;text&gt;"}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Parameter | Description |
| itemId\* | ID ресурса. |
| orders\* | Массив JSON заявок и callmode для каждой из них. |
| routeId\* | ID маршрута. |
| callMode\* | Действие: создание, редактирование, удаление. |

 Результат аналогичен пакету **order/update**.

## Возвращаемый результат

{  
"orders":\[{  
"id":&lt;uint&gt;, /\* ID заявки \*/  
"f":&lt;uint&gt;, /\* флаги заявки \*/  
"u":&lt;uint&gt;, /\* ID объекта \*/  
"uid":&lt;uint&gt;, /\* уникальный ID заявки \*/  
"callMode":"&lt;text&gt;"  
},  
...  
\]  
}

## Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Некорректный ID ресурса. |
| 4   | Логическая ошибка. Причина указана в результате. |

# render

В этом разделе описаны методы работы с различными графическими слоями и получения информации из них.

# calculate_polygon

Функция **calculate_polygon** используется для получения площади и/или параметра полигона.

svc=render/calculate_polygon&params={"p":\[  
{  
"x":&lt;double&gt;,  
"y":&lt;double&gt;  
},  
...  
\],  
"flags":&lt;uint&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>p</p></td><td><p>Массив точек полигона.</p></td></tr><tr><td><p>x</p></td><td><p>Долгота.</p></td></tr><tr><td><p>y</p></td><td><p>Широта.</p></td></tr><tr><td><p>flags</p></td><td><p>Флаги отображения:<br></p><ul><li>0x1&nbsp;—&nbsp;показать площадь;</li><li>0x2&nbsp;—&nbsp;показать периметр;</li><li>0x3&nbsp;—&nbsp;показать оба параметра.</li></ul></td></tr></tbody></table></div>

## Возвращаемый результат

{  
"area":&lt;double&gt;, /\* площадь \*/  
"perimeter":&lt;double&gt; /\* периметр \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 4   | Неверные входные параметры. |

# calculate_polyline

Функция **calculate_polyline** используется для получения площади и/или периметра геозоны-линии.

svc=render/calculate_polyline&params={"p":\[  
{  
"x":&lt;double&gt;,  
"y":&lt;double&gt;  
},  
...  
\],  
"flags":&lt;uint&gt;,  
"w":&lt;uint&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>p</p></td><td><p>Массив точек координат.</p></td></tr><tr><td><p>x</p></td><td><p>Долгота.</p></td></tr><tr><td><p>y</p></td><td><p>Широта.</p></td></tr><tr><td><p>flags</p></td><td><p>Флаги отображения:<br></p><ul><li>0x1&nbsp;—&nbsp;показать площадь;</li><li>0x2&nbsp;— показать периметр;</li><li>0x3&nbsp;— показать оба параметра.</li></ul></td></tr><tr><td><p>w</p></td><td><p>Толщина линии, метры.</p></td></tr></tbody></table></div>

## Возвращаемый результат

{  
"area":&lt;double&gt;, /\* площадь \*/  
"perimeter":&lt;double&gt; /\* периметр \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 4   | Неверные входные параметры. |

# create_messages_layer

Функция **create_messages_layer** используется для создания графического слоя на основе координат из сообщений.

svc=render/create_messages_layer&params={"layerName":"&lt;text&gt;",  
"itemId":&lt;long&gt;,  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;,  
"tripDetector":&lt;bool&gt;,  
"trackColor":"&lt;text&gt;",  
"trackWidth":&lt;int&gt;,  
"arrows":&lt;bool&gt;,  
"points":&lt;bool&gt;,  
"pointColor":"&lt;text&gt;",  
"annotations":&lt;bool&gt;,  
"flags":&lt;uint&gt;}

 Этот запрос нельзя выполнить одновременно со следующими запросами:

- [report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report);
- [report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result);
- [report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart);
- [report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map);
- [messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval);
- [resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings);
- [resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings);
- запросы из раздела [**exchange**](https://help.wialon.com/ru/api/user-guide/api-reference/exchange);
- [account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>layerName</p></td><td><p>Имя слоя.</p></td></tr><tr><td><p>itemId</p></td><td><p>ID объекта, сообщения которого должен быть запрошены.</p></td></tr><tr><td><p>timeFrom</p></td><td><p>Начало интервала.</p></td></tr><tr><td><p>timeTo</p></td><td><p>Конец интервала.</p></td></tr><tr><td><p>tripDetector</p></td><td><p>Использование детектора поездок:</p><ul><li>0&nbsp;— нет;</li><li>1&nbsp;— да.</li></ul></td></tr><tr><td><p>trackColor</p></td><td><p>Цвет трека в формате&nbsp;ARGB (А — альфа-канал или уровень прозрачности) или&nbsp;"<strong>trip</strong>" для окрашивания треков по поездкам (требуется значение&nbsp;"tripDetector":1).</p></td></tr><tr><td><p>trackWidth</p></td><td><p>Толщина трека в пикселях.</p></td></tr><tr><td><p>arrows</p></td><td><p>Стрелки направления движения:</p><ul><li>0&nbsp;— да;</li><li>1&nbsp;— нет.</li></ul></td></tr><tr><td><p>points</p></td><td><p>Точки в местах получения сообщений:</p><ul><li>0&nbsp;— нет;</li><li>1&nbsp;— да.</li></ul></td></tr><tr><td><p>pointColor</p></td><td><p>Цвет точек.</p></td></tr><tr><td><p>annotations</p></td><td><p>Подписи к точкам:&nbsp;</p><ul><li>0&nbsp;— нет;</li><li>1&nbsp;— да.</li></ul></td></tr><tr><td><p>flags</p></td><td><p>Флаги для отображения маркеров (необязательный параметр).</p></td></tr></tbody></table></div>

Примеры параметра **trackColor**:

|     |     |     |
| --- | --- | --- |
| Цвет | Название | Код ARGB |
|     | Непрозрачный красный. | "FFFF0000" |
|     | Полупрозрачный зеленый. | "7F00FF00" |
|     | Очень прозрачный синий. | "500000FF" |

Флаги маркеров:

|     |     |
| --- | --- |
| Флаг | Значение |
| 0x0001 | Группировка маркеров. |
| 0x0002 | Нумерация маркеров. |
| 0x0004 | Маркеры событий. |
| 0x0008 | Маркеров заправок. |
| 0x0010 | Маркеры изображений. |
| 0x0020 | Маркеры стоянок. |
| 0x0040 | Маркеры превышений скорости. |
| 0x0080 | Маркеры остановок. |
| 0x0100 | Маркеры сливов топлива. |
| 0x0800 | Маркеры видео. |

## Возвращаемый результат

{  
"name":"&lt;text&gt;", /\* имя слоя \*/  
"bounds":\[ /\* границы слоя \*/  
&lt;double&gt;, /\* минимальная широта \*/  
&lt;double&gt;, /\* минимальная долгота \*/  
&lt;double&gt;, /\* максимальная широта \*/  
&lt;double&gt; /\* максимальная долгота \*/  
\],  
"units":\[ /\* массив объектов \*/  
{  
"id":&lt;long&gt;, /\* ID объекта \*/  
"msgs":{ /\* информация о сообщениях \*/  
"count":&lt;uint&gt;, /\* количество сообщений \*/  
"first":{ /\* первое сообщение \*/  
"time":&lt;uint&gt;, /\* время \*/  
"lat":&lt;double&gt;, /\* широта \*/  
"lon":&lt;double&gt; /\* долгота \*/  
},  
"last":{ /\* последнее сообщение \*/  
"time":&lt;uint&gt;, /\* время \*/  
"lat":&lt;double&gt;, /\* широта \*/  
"lon":&lt;double&gt; /\* долгота \*/  
}  
},  
"mileage":&lt;double&gt;, /\* пробег за интервал (метры) \*/  
"max_speed":&lt;unit&gt; /\* максимальная скорость за интервал \*/  
}  
\],  
"trips":\[ /\* только если tripDetector 1 \*/  
{  
"first":{ /\* первое сообщение \*/  
"time":&lt;uint&gt;, /\* время \*/  
"lat":&lt;double&gt;, /\* широта \*/  
"lon":&lt;double&gt; /\* долгота \*/  
},  
"last":{ /\* последнее сообщение \*/  
"time":&lt;uint&gt;, /\* время \*/  
"lat":&lt;double&gt;, /\* широта \*/  
"lon":&lt;double&gt; /\* долгота \*/  
},  
"mileage":&lt;double&gt;, /\* пробег за интервал (метры) \*/  
"max_speed":&lt;unit&gt; /\* максимальная скорость за интервал \*/  
"color":"&lt;text&gt;" /\* цвет интервала в формате '#RRGGBB' \*/  
}  
\]  
}

См. также [avl_render](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_render).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 1004 | Достигнут лимит сообщений. |
| 1003 | Достигнут лимит слоев. |
| 1001 | Нет сообщений для обработки. |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_ITEM_EXECUTE_REPORTS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# create_zones_layer

Функция **create_zones_layer** используется для создания графического слоя с геозонами.

svc=render/create_zones_layer&params={"layerName":"&lt;text&gt;",  
"flags":&lt;uint&gt;,  
"zones":\[  
{  
"resourceId":&lt;long&gt;,  
"zoneId":\[&lt;long&gt;\]  
}  
\]}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>layerName</p></td><td><p>Имя слоя.</p></td></tr><tr><td><p>flags</p></td><td><p>Флаги:</p><ul><li>0x1&nbsp;—&nbsp;показывать имена геозон;</li><li>0x2&nbsp;—&nbsp;группировать геозоны.</li></ul></td></tr><tr><td><p>zones</p></td><td><p>Массив геозон.</p></td></tr><tr><td><p>resourceId</p></td><td><p>ID ресурса.</p></td></tr><tr><td><p>zoneId</p></td><td><p>ID геозоны.</p></td></tr></tbody></table></div>

## Возвращаемый результат

{  
"name":"&lt;text&gt;", /\* имя слоя \*/  
"bounds":\[  
&lt;double&gt;, /\* минимальная широта \*/  
&lt;double&gt;, /\* минимальная долгота \*/  
&lt;double&gt;, /\* максимальная широта \*/  
&lt;double&gt; /\* максимальная долгота \*/  
\]  
}

См. также [avl_render](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_render).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# delete_message

Функция **delete_message** используется для удаления сообщений.

svc=render/delete_message&params={"layerName":"&lt;text&gt;",  
"msgIndex":&lt;uint&gt;,  
"unitId":&lt;long&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| layerName | Имя слоя. |
| msgIndex | Индекс сообщения. |
| unitId | ID объекта. |

## Возвращаемый результат

Если запрос выполняется успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_AVL_UNIT_DEL_MSGS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# enable_layer

Функция **enable_layer** используется для активации графического слоя.

svc=render/enable_layer&params={"layerName":"&lt;text&gt;",  
"enable":&lt;bool&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>layerName</p></td><td><p>Имя слоя.</p></td></tr><tr><td><p>enable</p></td><td><p>Сделать слой активным:</p><ul><li>0&nbsp;— нет;</li><li>1 — да.</li></ul></td></tr></tbody></table></div>

## Возвращаемый результат

{  
"enabled":&lt;int&gt; /\* state: 0— inactive; 1 — active \*/  
}

См. также [avl_render](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_render).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# get_messages

Функция **get_messages** используется для получения сообщений из слоя.

svc=render/get_messages&params={"layerName":"&lt;text&gt;",  
"indexFrom":&lt;uint&gt;,  
"indexTo":&lt;uint&gt;,  
"unitId":&lt;long&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| layerName | Имя слоя. |
| indexFrom | Индекс первого запрошенного сообщения. |
| indexTo | Индекс последнего запрошенного сообщения. |
| unitId | ID объекта. |

## Возвращаемый результат

\[ /\* массив сообщений \*/  
{  
...  
}  
\]

Форматы сообщений рассмотрены [здесь](https://help.wialon.com/help/api/en/user-guide/data-format/messages).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# remove_all_layers

Функция **remove_all_layers** используется для удаления всех графических слоев.

svc=render/remove_all_layers&params={}

## Возвращаемый результат

Если запрос выполняется успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Неопределенная ошибка. |

# remove_layer

Функция **remove_layer** используется для удаления слоев.

svc=render/remove_layer&params={"layerName":"&lt;text&gt;"}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| layerName | Имя слоя. |

## Возвращаемый результат

Если запрос выполняется успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# render_json

 Может использоваться только в Wialon Hosting и Wialon Local 2204.

Функция **render_json** используется для получения JSON графика.

svc=report/render_json&params={"uintId":&lt;long&gt;,  
"width":&lt;uint&gt;,  
"useCrop":&lt;uint&gt;,  
"cropBegin":&lt;uint&gt;,  
"cropEnd":&lt;uint&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>uintId</p></td><td><p>ID объекта.</p></td></tr><tr><td><p>width</p></td><td><p>Ширина графика. В соответствии с этим параметром возвращается оптимальное количество пикселей для графика.</p></td></tr><tr><td><p>useCrop</p></td><td><p>Обрезать временной интервал:</p><ul><li>1&nbsp;— да;</li><li>0&nbsp;— нет.</li></ul></td></tr><tr><td><p>cropBegin</p></td><td><p>Начало интервала, время Unix.</p></td></tr><tr><td><p>cropEnd</p></td><td><p>Конец интервала, время Unix.</p></td></tr></tbody></table></div>

## Возвращаемый результат

{  
"data":{  
"PARAM_NAME_1": {  
"x": \[&lt;double&gt;,...\],  
"y": \[&lt;double&gt;,...\],  
},  
"PARAM_NAME_2": { ... }  
},  
"possitions": {  
"time": \[&lt;double&gt;,...\],  
"lat": \[&lt;double&gt;,...\],  
"lon": \[&lt;double&gt;,...\],  
}  
}

Вместо PARAM_NAME должно быть указано название параметра сообщения.

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# set_locale

Функция **set_locale** используется для выбора часового пояса, языка, формата даты или плотности изображения для слоев.

svc=render/set_locale&params={"tzOffset":&lt;uint&gt;,  
"language":"&lt;text&gt;",  
"flags":&lt;uint&gt;,  
"formatDate":"&lt;text&gt;",  
"density":&lt;uint&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>tzOffset</p></td><td><p>Часовой пояс.</p></td></tr><tr><td><p>language</p></td><td><p>Язык (двухбуквенный код).</p></td></tr><tr><td><p>flags</p></td><td><p>Флаги системы мер (необязательно):</p><ul><li>0&nbsp;—&nbsp;метрическая;</li><li>1&nbsp;— американская;</li><li>2&nbsp;—&nbsp;имперская.</li></ul></td></tr><tr><td><p>formatDate</p></td><td><p>Формат даты и времени (см. ниже).</p></td></tr><tr><td><p>density</p></td><td><p>Размер тайла (необязательно).</p></td></tr></tbody></table></div>

Формат даты и времени:

|     |     |
| --- | --- |
| Параметр | Описание |
| %H  | Час суток с начальным нулем при необходимости (от "00" до "23"). |
| %B  | Полное имя месяца (от "Январь" до "Декабрь"). |
| %b  | Сокращенное имя месяца (от "Янв" до "Дек"). |
| %m  | Номер месяца с начальным нулем при необходимости (от "01" до "12"). |
| %l  | Месяц года (от "1" до "12"). |
| %P  | Формат персидского календаря ("01 Фарвардин 1392 00:00:00"). |
| %A  | Полное имя дня недели (от "Понедельник" до "Воскресенье"). |
| %a  | Сокращенное имя дня недели (от "Пон" до "Вос"). |
| %E  | День месяца с начальным нулем при необходимости (от "01" до "31"). |
| %e  | День месяца (от "1" до "31"). |
| %I  | Час дня с начальным нулем при необходимости (от "01" до "12"). |
| %M  | Минуты часа с начальным нулем при необходимости (от "00" до "59"). |
| %S  | Секунды минуты с начальным нулем при необходимости (от "00" до "59"). |
| %p  | Обозначение A.M./P.M. ("AM" или "PM"). |
| %Y  | Полное четырехзначное число года ("1999" или "2008"). |
| %y  | Двухзначное число года ("99" или "08"). |

Пример:

"formatDate":"%Y-%m-%E %H:%M:%S"

Результат:

2013-01-26 12:34:56

Плотность:

|     |     |     |
| --- | --- | --- |
| Значение | Размер тайла | Коэффициент |
| 1   | 256\*256 | 1   |
| 2   | 378\*378 | 1.5 |
| 3   | 512\*512 | 2   |
| 4   | 768\*768 | 3   |
| 5   | 1024\*1024 | 4   |

Размер по умолчанию — 256\*256.

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# report

В этом разделе описаны функции, которые могут применяться к отчетам.

# abort_report

Функция **abort_report** используется для отмены выполнения асинхронного отчета.

svc=report/abort_report&params={}

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Неопределенная ошибка. |

# apply_report_result

 Используется только отчетов, запрашиваемых с параметром “**remoteExec**”.

Функция **remoteExec** используется для получения результата выполнения асинхронного отчета.

svc=report/apply_report_result&params={}

 Результат может быть получен только после успешного выполнения асинхронного отчета (**“status”:4** в полученном результате для запроса **get_report_status**).

## Возвращаемый результат

Возвращаемый результат такой же, как и для запроса [**exec_report**](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report#exec_report-returnedresult).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 1004 | Достигнут лимит сообщений. Смотрите подробности в поле **reason**. |
| 1003 | Достигнут лимит. Смотрите подробности в поле **reason**. |
| 6   | Неопределенная ошибка. |

# cleanup_result

В сессии может быть только один результат отчета. Функция **cleanup_result** используется для удаления результатов предыдущего выполнения, если они есть в сессии.

svc=report/cleanup_result&params={}

## Возвращаемый результат

{  
"error":&lt;int&gt; /\* код ошибки (0 — в случае успешного выполнения) \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Неопределенная ошибка. |

# exec_report

Функция **exec_report** используется для выполнения отчета.

svc=report/exec_report&params={  
"reportResourceId": &lt;long&gt;,  
"reportTemplateId": &lt;long&gt;,  
"reportObjectId": &lt;long&gt;,  
"reportObjectSecId": &lt;long&gt;,  
"reportObjectIdList": \[  
&lt;uint&gt;,  
...  
\],  
"interval": {  
"from": &lt;uint&gt;,  
"to": &lt;uint&gt;,  
"flags": &lt;uint&gt;  
},  
"remoteExec": &lt;uint&gt;,  
"reportTemplate": &lt;object&gt;  
}

В одной сессии не может выполняться несколько отчетов одновременно, поэтому если в сессии уже есть результат отчета, необходимо удалить его перед выполнением следующего. Для этого используется функция [cleanup_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/cleanup_result).

Этот запрос нельзя выполнять одновременно со следующими запросами:

- [report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result);
- [report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart);
- [report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map);
- [messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval);
- [render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer);
- [unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips);
- [resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings);
- [resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings),
- запросы из раздела [exchange](https://help.wialon.com/ru/api/user-guide/api-reference/exchange);
- [account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| reportResourceId | ID ресурса. Требуется параметр. Отчет выполняется от имени создателя ресурса, если **reportTemplateId** 0. |
| reportTemplateId | ID шаблона. |
| reportObjectId | ID элемента. |
| reportObjectSecId | ID подчиненного элемента (водителя, прицепа или их группы); 0, если у элемента нет подчиненных элементов. |
| reportObjectIdList | Массив ID дополнительных элементов (для отчета по группам объектов). |
| interval | Настройки интервала отчета. |
| from | Начало интервала, время Unix. |
| to  | Конец интервала, время Unix. |
| flags | Флаги интервала. |
| remoteExec | Укажите значение **1** для этого параметра, чтобы отчет выполнялся на сервере Webreport. Параметр необязателен и используется, только если после этого выполняется запрос **report/get_report_status**. Если в возвращаемом результате содержится "remoteExec":1, отчет принят сервером в обработку, и время его выполнения ограничено 5 минутами.<br><br>Укажите **0** или не указывайте этот параметр, чтобы отчет выполнялся на сервере Web. В этом случае время его выполнения ограничено 3 минутами. |
| reportTemplate | JSON шаблона отчета, который может быть получен после запроса [**get_report_data**](https://help.wialon.com/help/api/ru/user-guide/api-reference/report/get_report_data). Параметр необязателен и используется, только если **reportTemplateId** 0. |

Флаги интервала:

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x00 | Указанный интервал. |
| 0x01 | От... до сегодня. |
| 0x02 | За предыдущие n дней. |
| 0x04 | За предыдущие n недель. |
| 0x08 | За предыдущие n месяцев. |
| 0x10 | За предыдущие n лет. |
| 0x20 | Включая текущее. |
| 0x40 | За предыдущие n часов. |
| 0x80 | За предыдущие n минут. |

## Возвращаемый результат

{  
"reportResult":{ /\* результат выполнения отчета \*/  
"msgsRendered":&lt;int&gt;, /\* загружены сообщения: 0 — нет, 1 — да \*/  
"stats":\[ /\* массив статистических параметров \*/  
\["&lt;text&gt;","&lt;text&gt;"\] /\* \[название, значение параметра\] \*/  
\],  
"tables":\[ /\* массив таблиц \*/  
{  
"name":"&lt;text&gt;", /\* тип таблицы \*/  
"label":"&lt;text&gt;", /\* название \*/  
"grouping": {  
"type":"&lt;text&gt;" /\* тип группировки \*/  
},  
"flags":&lt;uint&gt;, /\* флаги таблицы (см. ниже) \*/  
"rows":&lt;uint&gt;, /\* количество строк \*/  
"level":&lt;uint&gt;, /\* максимальный уровень в таблице \*/  
"columns":&lt;uint&gt;, /\* количество столбцов \*/  
"header":\["&lt;text&gt;"\], /\* массив заголовков таблицы \*/  
"total":\[ /\* итого \*/  
"&lt;text&gt;" /\* массив ячеек \*/  
\],  
"header_type" \["&lt;text&gt;"\], /\* массив типов заголовков таблицы \*/  
"totalRaw" \[ /\* массив значений строки "Итого" \*/  
{  
"v":&lt;double&gt;, /\* исходное значение ячейки \*/  
"vt":&lt;double&gt;, /\* тип значения \*/  
},  
...  
\]  
}  
\],  
<br/>"attachments":\[ /\* массив вложений (графиков, фотографий) \*/  
{ /\* для графиков \*/  
"name":"&lt;text&gt;", /\* название \*/  
"type":"&lt;text&gt;", /\* тип: chart — график, photo — фотография \*/  
"datasets":\["&lt;text&gt;"\] /\* массив с названиями кривых графика \*/  
"axis_y": \["&lt;text&gt;"\] /\* массив наименований для оси 'Y' \*/  
"axis_x": "&lt;text&gt;", /\* наименование оси 'X' \*/  
"flags": &lt;uint&gt;, /\* формат оси, см. описание ниже \*/  
"p":"&lt;text&gt;", /\* настройки графика \*/  
},  
{ /\* для фотографий и видео \*/  
"name":"&lt;text&gt;", /\* название и нижеописанные параметры через ";" \*/  
"ftm":"&lt;text&gt;", /\* форматированная дата \*/  
"uid":"&lt;text&gt;", /\* ID объекта \*/  
"tm":"&lt;text&gt;", /\* Время в формате Unix \*/  
"idx":"&lt;text&gt;", /\* индекс одновременно зарегистрированных однотипных вложений \*/  
"lat":"&lt;text&gt;", /\* широта \*/  
"lon":"&lt;text&gt;", /\* долгота \*/  
"type":"&lt;text&gt;", /\* тип вложения \*/  
"zone":&lt;JSON&gt;, /\* информация о геозоне \*/  
"tags":&lt;JSON&gt;, /\* информация о тегах \*/  
}  
\]  
},  
"reportLayer":{ /\* графический слой \*/  
"name":"&lt;text&gt;", /\* название слоя \*/  
"bounds":\[  
&lt;double&gt;, /\* минимальная широта \*/  
&lt;double&gt;, /\* минимальная долгота \*/  
&lt;double&gt;, /\* максимальная широта \*/  
&lt;double&gt; /\* максимальная долгота \*/  
\]  
},  
"layerCount":&lt;uint&gt; /\* количество слоев, которые должны быть объединены в слое отчета \*/  
}

Для получения всех доступных типов таблиц используйте функцию [**get_report_tables**](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_report_tables).

См. подробности о поле **zone** на странице [**get_zone_data**](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_zone_data).

См. подробности о поле **tags** на странице [**update_tag**](https://help.wialon.com/ru/api/user-guide/api-reference/resource/update_tag).

Флаги таблиц:

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x1 | Группировка по дате. |
| 0x2 | Ограничение по времени. |
| 0x4 | Группировка по неделям. |
| 0x8 | Группировка по месяцам. |
| 0x10 | Итого. |
| 0x20 | Графики: разделять датчики. |
| 0x100 | Детализация: частичная. |
| 0x200 | Графики: отчет с нуля. |
| 0x400 | Накапливать интервалы. |
| 0x800 | Детализация: полная. |
| 0x1000 | Нумерация строк. |
| 0x2000 | Выполнение отчета только по элементу отчета (не по подчиненным элементам). |
| 0x4000 | Группировка записей по сменам. |
| 0x8000 | Обрезать интервалы в таблице. |
| 0x200000 | Группировка по поездкам. |
| 0x400000 | Группировка по типам нарушения. |
| 0x10000000 | Группировка по дням недели. |
| 0x20000000 | Группировка по дням месяца. |
| 0x40000000 | Группировка по годам. |

Флаги графиков:

|     |     |     |
| --- | --- | --- |
| Флаг | Дополнительный флаг | Описание |
| 0x4 |     | Корректируемый максимум для оси **Y**. |
| 0x10 |     | Формат, указанный в настройках шаблона. |
|     | 0x1 | Добавочный для 0x10 (установить формат "H:M:S"). |
|     | 0x2 | Добавочный для 0x10 (установить формат "Y-m-E"). |
| 0x80 |     | Общий тип. |
| 0x100 |     | 24-часовой формат. |
|     | 0x20 | 24-часовой формат (добавочный для 0x100). |
|     | 0x2 | 12-часовой формат (добавочный для 0x20). |
|     | 0x40 | Отображение дней недели (добавочный для 0x100). |

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь объект отчета и ресурс отчета с требуемым ACL (ADF_ACL_ITEM_EXECUTE_REPORTS, ADF_ACL_AVL_RES_VIEW_REPORTS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# export_result

Функция **export_result** используется для экспорта результатов отчета в файл.

svc=report/export_result&params={"format":&lt;uint&gt;,  
"pageOrientation":"&lt;text&gt;",  
"hideGoogleLinks":&lt;uint&gt;,  
"pageSize":"&lt;text&gt;",  
"pageWidth":"&lt;text&gt;",  
"coding":"&lt;text&gt;",  
"delimiter":"&lt;text&gt;",  
"headings":"&lt;text&gt;",  
"compress":"&lt;text&gt;",  
"attachMap":"&lt;text&gt;",  
"extendBounds":&lt;bool&gt;,  
"hideMapBasis":"&lt;text&gt;",  
"outputFileName":"&lt;text&gt;",  
"splitChart":"&lt;text&gt;",  
"appendTreeAnchorRows":"&lt;text&gt;"}

 Этот запрос нельзя выполнять одновременно со следующими запросами:

- [report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report);
- [report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart);
- [report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map);
- [messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval);
- [render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer);
- [unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips);
- [resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings);
- [resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings);
- запросы из раздела [**exchange**](https://help.wialon.com/ru/api/user-guide/api-reference/exchange);
- [account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

|     |     |
| --- | --- |
| Имя | Описание |
| format | Формат файла (см. ниже). |

Необязательные параметры:

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td><td><p>Значение по умолчанию</p></td></tr><tr><td><p>compress</p></td><td><p>Сжатие файла отчета:</p><ul><li>0&nbsp;—&nbsp;нет;</li><li>1 —&nbsp;да.</li></ul></td><td><p>1</p></td></tr><tr><td><p>pageOrientation</p></td><td><p>Ориентация страницы (PDF): portrait - книжная, landscap - альбомная.</p></td><td><p>portrait</p></td></tr><tr><td><p>pageSize</p></td><td><p>Формат страницы (PDF): a4, a3.</p></td><td><p>a4</p></td></tr><tr><td><p>pageWidth</p></td><td><p>Ширина страницы (PDF):</p><ul><li>0&nbsp;— фиксированная;</li><li>1&nbsp;— компактная;</li><li>2&nbsp;—&nbsp;без переносов.</li></ul></td><td><p>0</p></td></tr><tr><td><p>coding</p></td><td><p>Кодировка (CSV): utf8, cp1251.</p></td><td><p>utf8</p></td></tr><tr><td><p>delimiter</p></td><td><p>Разделитель (CSV): точка с запятой, двоеточие.</p></td><td><p>двоеточие</p></td></tr><tr><td><p>headings</p></td><td><p>Отображение заголовков:</p><ul><li>0&nbsp;—&nbsp;нет;</li><li>1 —&nbsp;да.</li></ul></td><td><p>0</p></td></tr><tr><td><p>attachMap</p></td><td><p>Прикрепить карту (только PDF и HTML):</p><ul><li>0&nbsp;—&nbsp;нет;</li><li>1 —&nbsp;да.</li></ul></td><td><p>0</p></td></tr><tr><td><p>extendBounds</p></td><td><p>Расширить карту, чтобы включить геозоны:&nbsp;</p><ul><li>0&nbsp;—&nbsp;нет;</li><li>1 —&nbsp;да.</li></ul></td><td><p>0</p></td></tr><tr><td><p>hideMapBasis</p></td><td><p>Скрыть слой карты:</p><ul><li>0&nbsp;—&nbsp;нет;</li><li>1 —&nbsp;да.</li></ul></td><td><p>0</p></td></tr><tr><td><p>outputFileName</p></td><td><p>Имя файла.</p></td><td><p>Online_report</p></td></tr><tr><td><p>hideGoogleLinks</p></td><td><p>Скрыть ссылки Google в ячейках координат (PDF и XLSX):&nbsp;</p><ul><li>0&nbsp;—&nbsp;нет;</li><li>1 —&nbsp;да.</li></ul></td><td><p>0</p></td></tr><tr><td><p>splitChart</p></td><td><p>Разбивать по дням или неделям.</p></td><td><p>&lt;empty&gt;</p></td></tr><tr><td><p>appendTreeAnchorRows</p></td><td><p>Добавление пустой строки для корректной группировки строк в Excel:</p><ul><li>0&nbsp;—&nbsp;нет;</li><li>1 —&nbsp;да.</li></ul></td><td><p>0</p></td></tr></tbody></table></div>

Согласно новой логике для параметра **“extendedBounds”** по умолчанию масштаб карты настраивается таким образом, чтобы вместить треки, маркеры и иконки. Если опция включена, масштаб карты меняется, чтобы также вместить геозоны. Если нет графических элементов (треков, маркеров, иконок для ситуации по умолчанию и геозон для включенной опции **extended bounds**), карта не показывается совсем.

Форматы файлов:

- 1 — HTML;
- 2 — PDF;
- 4 — XLS;
- 8 — XLSX;
- 16 — XML;
- 32 — CSV.

## Возвращаемый результат

Возвращает файл выбранного формата.

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Не удалось извлечь пользователя. |
| 5   | Ошибка чтения/записи файла. |
| 4   | Неверные входные параметры. |

# get_report_data

Функция **get_report_data** используется для получения данных о шаблоне отчета.

svc=report/get_report_data&params={"itemId":&lt;long&gt;,  
"col":\[&lt;long&gt;\],  
"flags":&lt;uint&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| col | Массив ID шаблонов. |
| flags | Флаги ответа. |

Флаги ответа:

|     |     |     |
| --- | --- | --- |
| Флаг HEX | Флаг DEC | Описание |
| 0x0 | 0   | Полный JSON (по умолчанию). |
| 0x1 | 1   | Основная информация и связанные объекты/группы. |
| 0x2 | 2   | Основная информация и краткая информация о таблицах. |
| 0x4 | 4   | Основная информация и полная информация о таблицах. |

## Возвращаемый результат

\[  
{  
"id":&lt;long&gt;, /\* ID шаблона \*/  
"n":"&lt;text&gt;", /\* название \*/  
"ct":"&lt;text&gt;", /\* тип (см. ниже) \*/  
"c":"&lt;text&gt;", /\* data CRC16 \*/  
"p":"&lt;text&gt;", /\* параметры \*/  
"tbl":\[ /\* таблицы \*/  
{  
"n":"&lt;text&gt;", /\* тип таблицы \*/  
"l":"&lt;text&gt;", /\* название \*/  
"c":"&lt;text&gt;", /\* список столбцов \*/  
"cl":"&lt;text&gt;", /\* список названий столбцов \*/  
"cp":"&lt;text&gt;", /\* список параметров столбцов \*/  
"s":"&lt;text&gt;", /\* список столбцов (если это таблица статистики) \*/  
"sl":"&lt;text&gt;", /\* список названий столбцов (если это таблица статистики) \*/  
"filter_order":"&lt;text&gt;", /\* порядок фильтров \*/  
"p":"&lt;text&gt;", /\* параметры таблицы \*/  
"sch":{ /\* ограничение по времени \*/  
"f1":&lt;uint&gt;, /\* начало интервала 1 \*/  
"f2":&lt;uint&gt;, /\* начало интервала 2 \*/  
"t1":&lt;uint&gt;, /\* конец интервала 1 \*/  
"t2":&lt;uint&gt;, /\* конец интервала 2 \*/  
"m":&lt;uint&gt;, /\* маска дней месяца \*/  
"y":&lt;uint&gt;, /\* маска месяцев \*/  
"w":&lt;uint&gt; /\* маска дней недели \*/  
"fl":&lt;uint&gt; /\* неполный интервал (0 — не обрезать, 1 — вывести и оборвать, 2 — не выводить в отчет, 3 — вывести и пометить как неполный) \*/  
<br/>},  
"f":&lt;uint&gt; /\* флаги таблиц \*/  
}  
\]  
}  
\]

Типы шаблонов:

- avl_unit;
- avl_unit_group;
- storage_user;
- avl_driver;
- avl_trailer;
- avl_resource;
- avl_retranslator;
- avl_route;
- avl_drivers_group;
- avl_trailers_group;
- avl_tag;
- avl_tags_group;
- avl_geozone;
- avl_geozones_group;

Флаги таблиц рассмотрены в разделе [**exec_report**](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report).

Чтобы получить типы таблиц, которые могут быть включены в отчеты, используйте функцию [**get_report_tables**](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_report_tables).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент отчета и ресурс отчета с требуемым ACL (ADF_ACL_AVL_RES_VIEW_REPORTS). |
| 4   | Неверные входные параметры. |

# get_report_status

Функция **get_report_status** без параметров должна использоваться после выполнения запроса [**exec_report**](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report) с параметром **“remoteExec”:1**.

svc=report/get_report_status&params={}

## Возвращаемый результат

{"status":{code}}

|     |     |
| --- | --- |
| Код статуса | Описание |
| 1   | В очереди. |
| 2   | Выполняется. |
| 4   | Готов. |
| 8   | Отменен. |
| 16  | Недопустимый отчет или отсутствие отчета. |

После получения успешного результата (“status”:“4” в ответе), выполните запрос **report/apply_report_result** без параметров:

svc=report/apply_report_result&params={}

Полученный результат с информацией об отчете такой же, как и после выполнения запроса [**exec_report**](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Неопределенная ошибка. |

# get_report_tables

Функция **get_report_tables** используется для получения списка таблиц, которые можно включить в отчеты.

svc=report/get_report_tables&params={}

## Возвращаемый результат

\[  
{  
"id":&lt;uint&gt;, /\* ID таблицы \*/  
"n":"&lt;text&gt;", /\* системное название таблицы \*/  
"l":"&lt;text&gt;", /\* название таблицы по умолчанию \*/  
"t":"&lt;text&gt;", /\* тип таблицы \*/  
"ct":"&lt;text&gt;", /\* тип шаблона, в котором может использоваться эта таблица \*/  
"pt":"&lt;text&gt;", /\* текстовые параметры \*/  
"gt":"&lt;text&gt;", /\* дополнительные настройки группировки \*/  
"col":\[ /\* массив столбцов \*/  
{  
"n":"&lt;text&gt;", /\* системное название столбца \*/  
"l":"&lt;text&gt;", /\* название столбца по умолчанию \*/  
"sl":"&lt;text&gt;", /\* список названий столбцов (если это таблица статистики) \*/  
"t":"&lt;text&gt;", /\* тип столбца \*/  
"f":&lt;uint&gt; /\* флаги столбцов (см. ниже) \*/  
}  
\]  
}  
\]

Типы шаблонов отчетов рассматриваются на странице [**get_report_data**](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_report_data).

Флаги столбцов:

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x01 | Показывать как столбец таблицы. |
| 0x02 | Показывать как столбец статистики. |
| 0x04 | Показывать как глобальный переключатель. |
| 0x08 | Показывать как столбец с позиционными данными. |
| 0x10 | Показывать как ось графика. |

Значения параметра “pt”:

|     |     |
| --- | --- |
| Значение | Описание |
| geozones | Геозоны/Объекты. |
| unfinished_ival | Неполный интервал. |
| duration | Длительность. |
| mileage | Пробег. |
| base_eh_sensor | Датчик моточасов. |
| engine_hours | Моточасы. |
| speed | Скорость. |
| trips | Поездки. |
| stops | Остановки. |
| parkings | Стоянки. |
| sensors | Датчики. |
| sensor_name | Маска датчиков. |
| driver | Водитель. |
| trailer | Прицеп. |
| fillings | Заправки. |
| thefts | Сливы. |
| duration_format | Формат длительности. |
| geozones_ex | Расширенные геозоны/объекты. |
| username | Маска пользователя. |
| route_points | Точки маршрута. |
| event_mask | Маска событий. |
| rides | Поездки. Применяется для таблиц **Объект** и **Поездки**. |
| fields_config | Тип поля. Применяется для таблиц **Произвольные поля**. |
| units | Объекты. Применяется для таблицы **Маневры**. |
| interval | Интервал трассировки в минутах. Применяется для таблицы **Объект** → **Трассировка датчиков**. |
| group_zones_pass | Доступна опция **Рассматривать группу как целое**. Применяется для таблицы **Группа объектов** → **Пропущенные геозоны**. |
| routes | Применяется для таблиц типа **Маршруты**. |
| last_location | Доступна опция **Учитывать интервал отчета**. Применяется для таблицы **Последние данные**. |
| hide_total | Опция **Итого** скрыта для этой таблицы. |
| groupitem | Доступна опция **Сама** **группа**. Применяется для таблиц **Группа объектов** → **Журнал** и **Произвольные поля**. |
| noschedule | Доступна опция **Ограничение по времени**. Применяется для таблиц **Сводка** и **Последние данные**. |
| hide_driver_split | Опция **Извлечь интервалы** скрыта для фильтра водителей. |
| account_tree | Иерархия учетных записей. |
| custom_fields_mask | Маска произвольных полей. |
| drv_activity | Активность водителя. |
| movement_chronology | Хронология движения. |
| sensor_val | Значение датчика. |
| timeout_sensor | Таймаут датчика. |
| custom_sensor_name | Имя произвольного датчика. |
| filter_notifications | Сохранять только сообщения с текстом уведомления. |

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Неопределенная ошибка. |

# get_result_chart

Функция **get_result_chart** используется для получения графика.

svc=report/get_result_chart&params={"attachmentIndex":&lt;uint&gt;,  
"action":&lt;uint&gt;,  
"width":&lt;uint&gt;,  
"height":&lt;uint&gt;,  
"autoScaleY":&lt;uint&gt;,  
"pixelFrom":&lt;int&gt;,  
"pixelTo":&lt;int&gt;,  
"flags":&lt;uint&gt;}

 Этот запрос нельзя выполнять одновременно со следующими запросами:

- [report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report);
- [report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result);
- [report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map);
- [messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval);
- [render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer);
- [unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips);
- [resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings);
- [resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings);
- запросы из раздела [**exchange**](https://help.wialon.com/ru/api/user-guide/api-reference/exchange);
- [account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>attachmentIndex</p></td><td><p>Индекс приложения.</p></td></tr><tr><td><p>action</p></td><td><p>Действия:</p><ul><li>0&nbsp;—&nbsp;установить флаги и отрисовать;</li><li>1&nbsp;— масштабирование;</li><li>2&nbsp;—&nbsp;автомасштабирование оси Y.</li></ul></td></tr><tr><td><p>width</p></td><td><p>Ширина.</p></td></tr><tr><td><p>height</p></td><td><p>Высота.</p></td></tr><tr><td><p>autoScaleY</p></td><td><p>Автомасштабирование оси Y:</p><ul><li>0&nbsp;— выключить;</li><li>1&nbsp;— включить.</li></ul></td></tr><tr><td><p>pixelFrom</p></td><td><p>Масштаб: от указанного пикселя.</p></td></tr><tr><td><p>pixelTo</p></td><td><p>Масштаб: до указанного пикселя.</p></td></tr><tr><td><p>flags</p></td><td><p>Флаги графика.</p></td></tr></tbody></table></div>

Флаги графика:

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x01 | Поместить заголовок над графиком. |
| 0x02 | Поместить заголовок под графиком. |
| 0x04 | Не показывать заголовок. |
| 0x40 | Установить направление сверху вниз для подписей оси X. |
| 0x80 | Установить направление снизу вверх для подписей оси X. |
| 0x100 | Поместить легенду графика над графиком. |
| 0x200 | Поместить легенду графика под графиком. |
| 0x400 | Поместить легенду графика слева от графика. |
| 0x800 | Поместить легенду графика справа от графика. |
| 0x1000 | Всегда показывать легенду, даже если есть только один комплект данных. |

## Возвращаемый результат

В результате возвращается изображение PNG.

# get_result_map

Функция **get_result_map** используется для получения карты с треками и маркерами.

svc=report/get_result_map&params={"width":&lt;uint&gt;,  
"height":&lt;uint&gt;}

 Этот запрос нельзя выполнять одновременно со следующими запросами:

- [report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report);
- [report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result);
- [report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart);
- [messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval);
- [render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer);
- [unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips);
- [resource/get_driver_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_driver_bindings);
- [resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings);
- запросы из раздела [**exchange**](https://help.wialon.com/ru/api/user-guide/api-reference/exchange);
- [account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

|     |     |
| --- | --- |
| Имя | Описание |
| width | Ширина. |
| height | Высота. |

## Возвращаемый результат

В результате возвращается изображение PNG карты с отрисованными на ней треками и маркерами.

# get_result_photo

Функция **get_result_photo** используется для получения изображения из отчета.

svc=report/get_result_photo&params={"attachmentIndex":&lt;uint&gt;, // or \[&lt;uint&gt;\] to get many zipped images at once  
"border":&lt;uint&gt;,  
"type":&lt;ubyte&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>attachmentIndex</p></td><td><p>Индекс вложения.</p></td></tr><tr><td><p>border</p></td><td><p>Максимальный размер изображения (0&nbsp;— исходный размер).</p><p></p><p>Максимальное значение для&nbsp;Wialon Hosting и Wialon Local 2204&nbsp;— 1920.</p></td></tr><tr><td><p>type</p></td><td><p>Тип изображения:</p><ul><li>0&nbsp;— исходное изображение (значение по умолчанию);</li><li>1&nbsp;— изображение в рамке с описанием (временнáя метка + адрес).</li></ul><p></p><p>Используется только в Wialon Hosting и Wialon Local 2204.</p></td></tr></tbody></table></div>

## Возвращаемый результат

В версиях Wialon Local до 1804 включительно возвращается изображение в формате PNG, а в версиях 1904-2104 — в формате JPEG.

В Wialon Hosting и Wialon Local 2204 возвращается изображение в формате JPEG, если в параметре **attachmentIndex** содержится одно значение. Если значений несколько, возвращается ZIP-архив с изображениями.

# get_result_rows

Функция **get_result_rows** используется для получения указанного количества строк из таблицы отчета.

svc=report/get_result_rows&params={"tableIndex":&lt;uint&gt;,  
"indexFrom":&lt;uint&gt;,  
"indexTo":&lt;uint&gt;}

 После выполнения запроса строки возвращаются в виде массива независимо от их уровня вложенности.

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| tableIndex | Индекс таблицы отчета. |
| indexFrom | Индекс первой запрошенной строки. |
| indexTo | Индекс последней запрошенной строки. |

## Возвращаемый результат

\[  
{  
"n":&lt;uint&gt;, /\* индекс строки (от 0) \*/  
"i1":&lt;uint&gt;, /\* номер первого сообщения в указанном интервале \*/  
"i2":&lt;uint&gt;, /\* номер последнего сообщения в указанном интервале \*/  
"t1":&lt;uint&gt;, /\* время первого сообщения в указанном интервале \*/  
"t2":&lt;uint&gt;, /\* время последнего сообщения в указанном интервале \*/  
"d":&lt;int&gt;, /\* количество строк следующего уровня вложенности \*/  
"c":\[ /\* массив ячеек \*/  
{ /\* общий тип ячеек \*/  
"t":"&lt;text&gt;", /\* значение ячейки \*/  
"y":&lt;double&gt;, /\* широта \*/  
"x":&lt;double&gt;, /\* долгота \*/  
"v":&lt;double&gt; /\* только для значений ячеек с меткой даты/времени \*/  
},  
{ /\* тип ячейки: видео или изображение \*/  
"t":"&lt;text&gt;", /\* текст значения ячейки \*/  
"j":&lt;JSON&gt;, /\* значение ячейки в формате JSON \*/  
"v":&lt;double&gt;, /\* значение ячейки \*/  
"vt":&lt;int&gt; /\* тип значения ячейки \*/  
},  
...  
\]  
}  
\]

См. описание типов значений [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/report/value_types).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Не удалось извлечь пользователя. |
| 5   | Не удалось извлечь результат отчета. |
| 4   | Неверные входные параметры. |

# get_result_subrows

Функция **get_result_subrows** используется для получения вложенных строк следующего уровня из таблицы отчета.

svc=report/get_result_subrows&params={"tableIndex":&lt;uint&gt;,  
"rowIndex":&lt;uint&gt;}

 Запрос позволяется получить подстроки только до второго уровня. Если необходимо получить больше вложенных строк, используйте запрос **report/select_result_rows**.

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| tableIndex | Индекс таблицы. |
| rowIndex | Индекс строки. |

## Возвращаемый результат

\[  
{  
"n":&lt;uint&gt;, /\* индекс строки (от 0) \*/  
"i1":&lt;uint&gt;, /\* номер первого сообщения в указанном интервале \*/  
"i2":&lt;uint&gt;, /\* номер последнего сообщения в указанном интервале \*/  
"t1":&lt;uint&gt;, /\* время первого сообщения в указанном интервале \*/  
"t2":&lt;uint&gt;, /\* время последнего сообщения в указанном интервале \*/  
"d":&lt;int&gt;, /\* количество строк в следующем уровне вложенности \*/  
"c":\[ /\* массив ячеек \*/  
{ /\* общий тип ячейки \*/  
"t":"&lt;text&gt;", /\* значение ячейки \*/  
"y":&lt;double&gt;, /\* широта \*/  
"x":&lt;double&gt;, /\* долгота \*/  
"v":&lt;double&gt; /\* только для значений ячеек с отметками даты/времени \*/  
},  
{ /\* тип ячейки: видео или изображение \*/  
"t":"&lt;text&gt;", /\* текст значения ячейки \*/  
"j":&lt;JSON&gt;, /\* значение ячейки в формате JSON \*/  
"v":&lt;double&gt;, /\* значение ячейки \*/  
"vt":&lt;int&gt; /\* тип значения ячейки \*/  
},  
\]  
}  
\]

Если в указанной строке не содержатся вложенные строки, возвращается следующий результат:

{  
"error":0  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Не удалось извлечь пользователя. |
| 5   | Не удалось извлечь результат отчета. |
| 4   | Неверные входные параметры. |

# get_result_video

Функция **get_result_video** используется для получения видео из отчета.

svc=report/get_result_video&params={"attachmentIndex":&lt;uint&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| attachmentIndex | Индекс приложения. |

## Возвращаемый результат

{  
"video_uri": "&lt;text&gt;", /\* ссылка на видео \*/  
"video_type": "&lt;text&gt;" /\* тип видео \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь объект с требуемым ACL (ADF_ACL_ITEM_EXECUTE_REPORTS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# hittest_chart

Функция **hittest_chart** используется для получения информации об определенной точке графика.

svc=report/hittest_chart&params={"attachmentIndex":&lt;uint&gt;,  
"datasetIndex":&lt;uint&gt;,  
"valueX":&lt;int&gt;,  
"valueY":&lt;int&gt;,  
"flags":&lt;int&gt;

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| attachmentIndex | Индекс графика. |
| datasetIndex | Индекс набора данных (-1 — все наборы данных). |
| valueX | Координата X, пикселей. |
| valueY | Координата Y, пикселей. |
| flags | Флаги. |

Флаги:

|     |     |
| --- | --- |
| Флаг HEX | Описание |
| 0x1 | Получить подсказку к графику. |
| 0x2 | Получить подсказку к графику. |
| 0x4 | Использовать valueX как время. |

## Возвращаемый результат

{  
"x":&lt;double&gt;, /\* значение по оси X \*/  
"textX":"&lt;text&gt;", /\* текстовое значение для координаты X \*/  
"axisX":"&lt;text&gt;", /\* подпись оси X \*/  
"y":\[  
{  
"y":&lt;int&gt;, /\* координата Y \*/  
"textY":"&lt;text&gt;", /\* координата текстом \*/  
"axisY":"&lt;text&gt;", /\* ось Y \*/  
"name":"&lt;text&gt;", /\* имя графика \*/  
"color":&lt;uint&gt; /\* цвет \*/  
},  
...  
\]  
"msg":{ /\* сообщение \*/  
...  
}  
}  
<br/><br/>

Форматы сообщений рассмотрены на странице [**messages**](https://help.wialon.com/ru/api/user-guide/api-reference/format/messages).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Не удалось извлечь пользователя. |
| 5   | Ошибка чтения/записи файла отчета. |
| 4   | Неверные входные параметры. |

# render_json

Функция **render_json** используется для получения JSON графика.

svc=report/render_json&params={"attachmentIndex":&lt;uint&gt;,  
"width":&lt;uint&gt;,  
"useCrop":&lt;uint&gt;,  
"cropBegin":&lt;uint&gt;,  
"cropEnd":&lt;uint&gt;}  

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>attachmentIndex</p></td><td><p>Индекс приложения.</p></td></tr><tr><td><p>width</p></td><td><p>Согласно этому параметру возвращается оптимальное количество пикселей для графика.&nbsp;</p></td></tr><tr><td><p>useCrop</p></td><td><p>Обрезать временной интервал:</p><ul><li>1&nbsp;—&nbsp;да;</li><li>0&nbsp;—&nbsp;нет.</li></ul></td></tr><tr><td><p>cropBegin</p></td><td><p>Начало интервала, время Unix.</p></td></tr><tr><td><p>cropEnd</p></td><td><p>Конец интервала, время Unix.</p></td></tr></tbody></table></div>

## Возвращаемый результат

 Следующие поля доступны только в Wialon Hosting и Wialon Local 2204: units, mmi, interruptions, possitions.

{  
"datasets":{ /\* данные \*/  
"&lt;text&gt;":{ /\* индекс графика \*/  
"name":"&lt;text&gt;", /\* имя графика \*/  
"color":&lt;uint&gt;, /\* цвет линии \*/  
"y_axis":&lt;uint&gt;, /\* использовать вторую ось Y (для совмещенных графиков с разными единицами измерения): 0 — нет, 1 — да \*/  
"units": "&lt;text&gt;", /\* единицы измерения графика по оси Y; ноль, если у линии нет единиц измерения \*/  
"data": {  
"x": \[  
&lt;uint&gt;, /\* трассировка точек графика (время) \*/  
...  
\],  
"y": \[ /\* трассировка точек графика (значение) \*/  
&lt;int&gt;,  
...  
\]  
},  
"colors": \[ /\* цветовые интервалы графика \*/  
<br/>\[&lt;uint&gt;, /\* время начала интервала \*/  
&lt;uint&gt;\], /\* цвет \*/  
...  
\],  
},  
...  
},  
"mmi":\[&lt;uint&gt;\], /\* массив значений по оси X из необработанного набора данных, интервал между которыми больше указанного времени (dt) > "Максимальный интервал между сообщениями" \*/  
"interruptions":\[&lt;uint&gt;\], /\* массив значений по оси X из отфильтрованного набора данных, интервал между которыми больше указанного времени (dt) > "Максимальный интервал между сообщениями" \*/  
"markers":\[ /\* маркеры \*/  
{  
"type":&lt;uint&gt;, /\* тип \*/  
"x": \[  
&lt;uint&gt;, /\* время \*/  
...  
\]  
},  
...  
\],  
"background_regions": \[ /\* фоновые интервалы \*/  
{  
"name":"&lt;text&gt;", /\* имя \*/  
"color":&lt;uint&gt;, /\* цвет \*/  
"priority":&lt;uint&gt;, /\* приоритет \*/  
"regions":\[  
\[&lt;uint&gt;, /\* время начала интервала \*/  
&lt;uint&gt; /\* время окончания интервала \*/  
\],  
...  
\]  
},  
...  
\],  
"possitions":{ /\* значения координат возвращенных точек всех линий на графике \*/  
"time":\[&lt;uint&gt;\],  
"lat":\[&lt;double&gt;\],  
"lon":\[&lt;double&gt;\]  
}  
}  

Флаги маркеров:

|     |     |     |
| --- | --- | --- |
| Флаг HEX | Флаг DEC | Описание |
| 0x4 | 4   | Событие/Нарушение. |
| 0x8 | 8   | Заправка. |
| 0x10 | 16  | Изображение. |
| 0x20 | 32  | Стоянка. |
| 0x40 | 64  | Превышение скорости. |
| 0x80 | 128 | Остановка. |
| 0x100 | 256 | Слив топлива. |
| 0x800 | 2048 | Видео. |
| 0x1000 | 4096 | Нарушение. |

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Не удалось извлечь пользователя. |
| 5   | Ошибка чтения/записи отчета. |
| 4   | Неверные входные параметры. |

# select_result_rows

Функция **select_result_rows** используется для выбора строк в многоуровневых отчетах.

svc = report/select_result_rows&params={  
"tableIndex": &lt;int&gt;,  
"config": {  
"type": "&lt;text&gt;",  
"data": {}  
}  
}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>tableIndex</p></td><td><p>Индекс таблицы.</p></td></tr><tr><td><p>config</p></td><td><p>Конфигурация.</p></td></tr><tr><td><p>type</p></td><td><p>Тип запроса:<br></p><ul><li><strong>range</strong>&nbsp;— последовательность строк;</li><li><strong>row</strong>&nbsp;— строка.</li></ul></td></tr><tr><td><p>data</p></td><td><p>Данные для конфигурации.</p></td></tr></tbody></table></div>

Если параметр **type** равен **range**, параметр **data** имеет следующий формат:

"data":{  
"from":&lt;uint&gt;,  
"to":&lt;uint&gt;,  
"level":&lt;uint&gt;,  
"flat":&lt;uint&gt;,  
"rawValues":&lt;uint&gt;,  
"unitInfo":&lt;uint&gt;  
}

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Опция</p></td><td><p>Описание</p></td></tr><tr><td><p>from</p></td><td><p>Индекс первой строки.</p></td></tr><tr><td><p>to</p></td><td><p>Индекс последней строки.</p></td></tr><tr><td><p>level</p></td><td><p>Уровень вложенности.</p></td></tr><tr><td><p>flat</p></td><td><p>Показывать вложенный уровень на одном уровнем с родительским:</p><ul><li>0&nbsp;— нет;</li><li>1 — да.</li></ul><p>Необязательный параметр. Значение по умолчанию 0.</p></td></tr><tr><td><p>rawValues</p></td><td><p>Показывать параметры <strong>v</strong>, <strong>vt</strong>:</p><ul><li>0&nbsp;— нет;</li><li>1 — да.</li></ul><p>Необязательный параметр. Значение по умолчанию 0.</p></td></tr><tr><td><p>unitInfo</p></td><td><p>Показывать id объекта:&nbsp;</p><ul><li>0&nbsp;— нет;</li><li>1 — да.</li></ul><p>Необязательный параметр. Значение по умолчанию 0.</p></td></tr></tbody></table></div>

Если параметр **type** равен **row**, параметр **data** имеет следующий формат:

"data":{  
"rows":\[&lt;int&gt;\],  
"level":&lt;uint&gt;,  
"flat":&lt;int&gt;,  
"rawValues":&lt;uint&gt;,  
"unitInfo":&lt;uint&gt;,  
"from":&lt;int&gt;,  
"to":&lt;int&gt;  
}

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Опция</p></td><td><p>Описание</p></td></tr><tr><td><p>rows</p></td><td><p>Индекс строки. Можно указать индекс вложенной строки до предпоследнего уровня вложенности.</p></td></tr><tr><td><p>level</p></td><td><p>Уровень вложенности.</p></td></tr><tr><td><p>flat</p></td><td><p>Показывать вложенный уровень на одном уровнем с родительским:</p><ul><li>0&nbsp;— нет;</li><li>1 — да.</li></ul><p>Необязательный параметр. Значение по умолчанию 0.</p></td></tr><tr><td><p>from</p></td><td><p>Индекс первой вложенной строки (необязательный) параметр.</p></td></tr><tr><td><p>to</p></td><td><p>Индекс последней вложенной строки (необязательный) параметр.</p></td></tr><tr><td><p>rawValues</p></td><td><p>Показывать необработанные данные значений:&nbsp;</p><ul><li>0&nbsp;— нет;</li><li>1 — да.</li></ul><p>Необязательный параметр. Значение по умолчанию 0.</p></td></tr><tr><td><p>unitInfo</p></td><td><p>Показывать id объекта:&nbsp;</p><ul><li>0&nbsp;— нет;</li><li>1 — да.</li></ul><p>Необязательный параметр. Значение по умолчанию 0.</p></td></tr></tbody></table></div>

## Возвращаемый результат

\[  
{  
"n":&lt;uint&gt;, /\* индекс строки (от 0) \*/  
"i1":&lt;uint&gt;, /\* номер первого сообщения в указанном интервале \*/  
"i2":&lt;uint&gt;, /\* номер последнего сообщения в указанном интервале \*/  
"t1":&lt;uint&gt;, /\* время первого сообщения в указанном интервале \*/  
"t2":&lt;uint&gt;, /\* время последнего сообщения в указанном интервале \*/  
"d":&lt;int&gt;, /\* количество строк следующего уровня вложенности \*/  
"uid":&lt;long&gt;, /\* ID объекта; только если unitInfo равен 1 \*/  
"c":\[ /\* массив ячеек \*/  
{ /\* общий тип ячеек \*/  
"t":"&lt;text&gt;", /\* форматированное значение ячейки \*/  
"v":&lt;double&gt;, /\* исходное значение ячейки \*/  
"vt":&lt;double&gt;, /\* тип значения \*/  
"pi": { /\* свойства \*/  
"t":"&lt;text&gt;", /\* тип свойства \*/  
"ids": \[ /\* массив ID свойств \*/  
\]  
},  
"y":&lt;double&gt;, /\* широта \*/  
"x":&lt;double&gt;, /\* долгота \*/  
"c":"&lt;text&gt;" /\* цвет ячейки (только если у ячейки есть цвет) в формате "RRGGBB" \*/  
},  
{ /\* тип ячейки: видео или изображение \*/  
"t":"&lt;text&gt;", /\* текст значения ячейки \*/  
"j":&lt;JSON&gt;, /\* значение ячейки в формате JSON \*/  
"v":&lt;double&gt;, /\* значение ячейки \*/  
"vt":&lt;int&gt; /\* тип значения ячейки \*/  
},  
\],  
"r":\[ /\* содержит подстроки, которые соответствуют запрошенному уровню вложенности \*/  
{ /\* набор полей строки будет такой же, как и для родительской строки \*/  
"n":&lt;uint&gt;,  
"i1":&lt;uint&gt;,  
"i2":&lt;uint&gt;,  
...  
}  
\]  
}  
\]  

Типы значений описаны [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/report/value_types).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь библиотеку отчетов. |
| 6   | Не удалось извлечь пользователя. |
| 5   | Ошибка чтения/записи файла отчета. |
| 4   | Неверные входные параметры. |

# update_report

Функция **update_report** используется для создания, изменения и удаления шаблонов отчетов.

svc=report/update_report&params={  
"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"callMode":"&lt;text&gt;",  
"n":"&lt;text&gt;",  
"ct":"&lt;text&gt;",  
"p":"&lt;text&gt;",  
"tbl":\[  
{  
"n":"&lt;text&gt;",  
"l":"&lt;text&gt;",  
"c":"&lt;text&gt;",  
"cl":"&lt;text&gt;",  
"cp":"&lt;text&gt;",  
"s":"&lt;text&gt;",  
"sl":"&lt;text&gt;",  
"filter_order":"&lt;text&gt;",  
"p":"&lt;text&gt;",  
"sch":{"f1":&lt;uint&gt;,"f2":&lt;uint&gt;,"t1":&lt;uint&gt;,"t2":&lt;uint&gt;,"m":&lt;uint&gt;,"y":&lt;uint&gt;,"w":&lt;uint&gt;,"fl":&lt;uint&gt;},  
"f":&lt;uint&gt;  
}  
\]  
}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| id  | ID шаблона. |
| callMode | Действие: создание, изменение, удаление. |

Остальные параметры нужны только для создания и изменения шаблонов. Они рассмотрены на странице [get_report_data](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_report_data).

Параметр “**p**” определяет группировку таблицы и другие настройки. Пример:

"p":"{  
\\"grouping\\":\\"  
{\\"type\\":\\"total\\",\\"nested\\": /\* включить группировку \\"Итого\\" \*/  
{\\"type\\":\\"year\\"}}\\" /\* включить вложенную группировку \\"Год\\" \*/  
}"

Основные типы группировки:

|     |     |
| --- | --- |
| Тип | Описание |
| total | Итого. |
| year | Год. |
| month | Месяц. |
| week | Неделя. |
| wday | День недели. |
| mday | День месяца. |
| day | Дата. |
| shift | Смена. |

Вы можете найти дополнительные типы группировки в информации о таблице, полученной с помощью запроса [**get_report_tables**](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_report_tables) (параметр “**gt**”).

Для таблицы **account_tree** можно использовать следующие параметры:

"p": "{  
\\"account_tree\\": {  
\\"group\\": &lt;bool&gt;,  
\\"types\\": \\"&lt;text&gt;\\"  
}  
}"

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>group</p></td><td><p>Группировка элементов:</p><ul><li>0&nbsp;— нет;</li><li>1&nbsp;— да.</li></ul><p>Значение по умолчанию&nbsp;— 0.</p></td></tr><tr><td><p>types</p></td><td><p>Типы элементов, включенные в результаты таблицы:</p><ul><li>avl_account;</li><li>avl_resource;</li><li>user;</li><li>avl_unit;</li><li>avl_unit_group;</li><li>avl_retranslator;</li><li>avl_route.</li></ul><p>По умолчанию включены все типы элементов.</p></td></tr></tbody></table></div>

Пример (все двойные кавычки внутри значения должны быть экранированы):

"p":"{\\"account_tree\\":{\\"group\\":1,\\"types\\":\\"avl_account,avl_resource,user,avl_unit,avl_unit_group,avl_retranslator,avl_route\\"}}"

Для таблицы **driver_ddd** можно использовать параметр **drv_activity** (метод определения активности):

"p": "{  
\\"drv_activity\\":"&lt;text&gt;"  
}"

|     |     |
| --- | --- |
| Значение | Описание |
| ddd | Использовать данные из файлов .ddd (по умолчанию). |
| online | Использовать онлайн-данные. |
| binds_and_trips | Использовать данные назначений и поездок. |

Для таблицы **driver_orders** (Заявки) можно использовать параметр **order_filter** (Фильтрация):

"p":"{  
\\"order_filter\\":&lt;uint&gt;  
}"

|     |     |
| --- | --- |
| Значение | Описание |
| 0x1 | Посещенные заявки. Устарел. |
| 0x2 | Непосещенные заявки. Устарел. |
| 0x4 | Заявки, посещенные вовремя. Устарел. |
| 0x8 | Заявки, посещенные с опозданием. Устарел. |
| 0x10 | Подтвержденные и отклоненные заявки. |
| 0x20 | Неподтвержденные и неотклоненные заявки. |
| 0x40 | Подтвержденные заявки. |
| 0x80 | Отклоненные заявки. |
| 0x100 | Посещенные заявки. |
| 0x200 | Непосещенные заявки. |
| 0x400 | Заявки, посещенные вовремя. |
| 0x800 | Заявки, посещенные с опозданием. |

Для таблицы **unit_counter_sensors** (Датчики счетчиков) можно использовать следующие параметры:

- **sensor_val:min** (минимальное значение датчика);
- **sensor_val:max** (максимальное значение датчика).

"p": "{  
\\"sensor_val\\":{\\"min\\":\\"10\\",\\"max\\":\\"14\\"}  
}"

Для графиков:

"p":"{  
\\"sensor_mask\\":"&lt;text&gt;", /\* маска датчика \*/  
\\"instant_speed_base\\":{  
\\"mask\\":"&lt;text&gt;"}} /\* маска датчика для раскрашивания линии графика по датчику \*/

Для разделения на смены в таблицах используйте следующие параметры:

"p":{\\"split_shifts\\":1},  
"s":{\\"split_shifts\\"}

## Графики

График представляет собой таблицу в шаблоне.

Для добавления маркеров в график добавьте таблицу маркеров в шаблон и флаги маркеров в таблицу графика.

Пример таблицы маркеров:

{"n":"unit_events",  
"l":"",  
"f":0,  
"c":"",  
"cl":"",  
"p":"",  
"sch":{  
"y":0,  
"m":0,  
"w":0,  
"f1":0,  
"f2":0,  
"t1":0,  
"t2":0},  
"sl":"",  
"s":"\[\\"chart_unit_events\\"\]"},

Пример флагов маркеров:

"p":"{  
\\"chart_markers\\":{  
\\"f\\":2556}  
}"  
}

Доступные маркеры/состояния:

|     |     |     |
| --- | --- | --- |
| Маркер | Флаг | Описание |
| unit_events | 0x4 | События. |
| unit_fillings | 0x8 | Заправки. |
| unit_photos | 0x10 | Изображения. |
| unit_stays | 0x20 | Стоянки. |
| unit_speedings | 0x40 | Превышения скорости. |
| unit_stops | 0x80 | Остановки. |
| unit_thefts | 0x100 | Сливы топлива. |
| unit_videos | 0x800 | Видео. |

Для изменения фона графиков в зависимости от состояния объекта добавьте маркер/состояние в шаблон и параметр **chart_regions** в таблицу графика.

|     |     |
| --- | --- |
| ID  | Описание |
| chart_stops_regions | Остановки. |
| chart_engine_hours_regions | Моточасы. |
| chart_conn_quality_regions | Потеря связи. |
| chart_stays_regions | Стоянки |
| chart_trips_regions | Поездки. |
| chart_speedings_regions | Превышения скорости. |
| chart_digital_sensors_regions | Цифровые датчики. |

## Дополнительные настройки

Каждая настройка шаблона представляет собой столбец таблицы. Для активации опции добавьте в шаблон соответствующий столбец.

Доступны следующие настройки:

|     |     |     |
| --- | --- | --- |
| Таблица | Столбец | Описание |
| unit_stats | multi_drivers | Несколько водителей/прицепов. |
| unit_stats | precise_calculations | Пробег/Топливо/Счетчики с точностью до двух знаков после запятой. |
| unit_stats | exclude_thefts | Исключить сливы из расхода топлива. |
| unit_stats | trips_mileage | Считать пробег только по поездкам. |
| unit_stats | intersect_zone | Учитывать пересечение геозоны треком. |
| unit_stats | address_format | Формат адреса. |
| unit_stats | time_format | Формат времени. |
| unit_stats | us_units | Система измерения. |
| unit_stats | shifts | Смены. |
| unit_trips | render_msgs | Все сообщения на карте. |
| unit_trips | render_trips | Треки поездок. |
| geozones | render_geozones | Геозоны. |
| unit_videos | render_unit_videos | Маркеры видео. |
| unit_fillings | render_filling_markers | Маркеры заправок. |
| unit_photos | render_unit_photos | Маркеры изображений. |
| unit_stops | render_stops_markers | Маркеров остановок. |
| unit_speedings | render_speedings_markers | Маркеры превышений скорости. |
| unit_thefts | render_theft_markers | Маркеры сливов. |
| unit_events | render_events_markers | Маркеры событий. |
| unit_stays | render_stays_markers | Маркеры стоянок. |
| unit_location | render_location_markers | Последнее местоположение объекта. |
| unit_stats_zones | all_resources | Геозоны из всех ресурсов. |
| unit_stats_zones | desc_address | Добавить поле описания к адресу. |
| unit_stats_zones | address_zones | Использовать геозоны в качестве адресов. |

 Формат адреса, формат времени, смены и система измерения указываются в параметре **“p”**.

## Возвращаемый результат

Для запросов, связанных с созданием и редактированием:

\[  
&lt;long&gt;, /\* ID шаблона \*/  
{  
"id":&lt;long&gt;, /\* ID шаблона \*/  
"n":"&lt;text&gt;", /\* название \*/  
"ct":"&lt;text&gt;", /\* тип шаблона \*/  
"c":&lt;uint&gt; /\* контрольная сумма (crc16) \*/  
}  
\]

Типы шаблонов описаны в разделе [**get_report_data**](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_report_data).

Для запросов, связанных с удалением:

\[  
&lt;long&gt;, /\* ID шаблона \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_AVL_RES_EDIT_REPORTS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# value_types

Если в запрос **select_result_rows** включен параметры **rawValues** каждая ячейка содержит параметры **v** (исходное значение ячейки) и **vt** (тип).

Доступные типы:

|     |     |
| --- | --- |
| Тип | Значение |
| 0   | Произвольное текстовое значение. |
| 1   | Адрес. |
| 2   | Произвольное &lt;int&gt; значение. |
| 3   | Произвольное &lt;double&gt; значение. |
| 4   | Значение счетчика. |
| 5   | Произвольный тип: текст+значение. |
| 10  | Расстояние, км. |
| 20  | Скорость, км/ч. |
| 30  | Время (YYYY/MM/DD HH:MM:SS). |
| 31  | Время (HH:MM:SS). |
| 32  | Время (YYYY/MM/DD). |
| 40  | Временной интервал, с. |
| 41  | Временной интервал, ч. |
| 42  | Временной интервал, относительные часы. |
| 50  | Объем, л. |
| 51  | Расход, л/100 км. |
| 52  | Расход, л/ч. |
| 53  | Расход, л/га. |
| 54  | Уровень топлива, л. |
| 55  | Расход, км/1 л. |
| 60  | Процентное значение. |
| 61  | Процентное значение с ежедневным сбросом. |
| 70  | Площадь, га. |
| 72  | Площадь, м<sup>2</sup>. |
| 73  | Площадь зоны в га или фт<sup>2</sup>. |
| 74  | Периметр зоны в м или фт. |
| 80  | Размер данных, байты, Кбайты, Мбайты. |
| 90  | Вес, т. |
| 91  | Вес, кг. |
| 100 | Температура, °C. |
| 110 | Штрафы за вождение. |
| 111 | Оценка за вождение. |
| 112 | Рейтинг за вождение. |
| 113 | Столбец пользователя. |
| 120 | Пустой столбец. |
| 130 | Значение столбца видео, количество: текст — JSON. |
| 140 | Значение столбца изображения, количество: текст — JSON. |

# resource

В этом разделе описаны функции, которые можно применить к следующим подчиненным элементам ресурса: геозоны, прицепы, уведомления и задания. Отчеты также относятся к ресурсам, но они рассмотрены отдельно в разделе [**report**](https://help.wialon.com/ru/api/user-guide/api-reference/report). См. о создании ресурсов [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/core/create_resource).

# bind_unit_driver

Функция **bind_unit_driver** используется для назначения водителей на объекты или их снятия с объектов.

svc=resource/bind_unit_driver&params={"resourceId":&lt;long&gt;,  
"unitId":&lt;long&gt;,  
"driverId":&lt;long&gt;,  
"time":&lt;uint&gt;,  
"mode":&lt;bool&gt;  
}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>resourceId</p></td><td><p>ID ресурса.</p></td></tr><tr><td><p>unitId</p></td><td><p>ID объекта.</p></td></tr><tr><td><p>driverId</p></td><td><p>ID водителя.</p></td></tr><tr><td><p>time</p></td><td><p>Время (0&nbsp;—&nbsp;текущее время).</p></td></tr><tr><td><p>mode</p></td><td><p>Режимы:</p><ul><li>1/true&nbsp;— назначение;</li><li>0/false&nbsp;—&nbsp;снятие.</li></ul></td></tr></tbody></table></div>

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_DRIVERS) или не удалось извлечь объект с требуемым ACL (ADF_ACL_ITEM_VIEW). |
| 6   | Не удалось назначить водителя. |
| 4   | Не удалось извлечь водителя с требуемым **driverId** или неверные входные параметры. |

## Примеры запросов

Отправить запрос для назначения водителя:

svc=resource/bind_unit_driver&params={"resourceId":930849,"driverId":2,"time":0,"unitId":24675341,"mode":1}

Возвращаемый результат:

{ }

Отправить запрос для снятия водителя:

svc=resource/bind_unit_driver&params={"resourceId":930849,"driverId":2,"time":0,"unitId":24675341,"mode":0}

Возвращаемый результат:

{ }

Назначить водителя 07 февраля 2022 07:07:00:

svc=resource/bind_unit_driver&params={"resourceId":930849, "driverId":17, "time":1644217620, "unitId":22361100, "mode":1}

Возвращаемый результат:

{ }

Снять водителя 07 февраля 2022 09:08:00:

svc=resource/bind_unit_driver&params={"resourceId":930849,"driverId":17,"time":1644224880,"unitId":22361100,"mode":0}

Возвращаемый результат:

{ }

Вы также можете объединить эти два запроса в один, используя core/batch:

svc=core/batch&params={"params":\[{"svc":"resource/bind_unit_driver","params":{"resourceId":930849,"driverId":17,"time":1644217620,"unitId":22361100,"mode":true}},{"svc":"resource/bind_unit_driver","params":{"resourceId":930849,"driverId":17,"time":1644224880,"unitId":22361100,"mode":false}}\],"flags":0}

Возвращаемый результат такой же, как и для функции [**batch**](https://help.wialon.com/ru/api/user-guide/api-reference/core/batch).

# bind_unit_tag

Функция **bind_unit_tag** используется, чтобы вручную прикрепить метку к объекту или снять ее. Метки используются при назначении или снятии пассажиров.

 Рекомендуется назначать пассажиров [автоматически](https://help.wialon.com/help/wialon-hosting/en/user-guide/monitoring-system/passengers/assigning-passengers).

svc=resource/bind_unit_tag&params={"resourceId":&lt;long&gt;,  
"unitId":&lt;long&gt;,  
"tagId":&lt;long&gt;,  
"time":&lt;uint&gt;,  
"mode":&lt;bool&gt;  
}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>resourceId</p></td><td><p>ID ресурса.</p></td></tr><tr><td><p>unitId</p></td><td><p>ID объекта.</p></td></tr><tr><td><p>tagId</p></td><td><p>ID метки.</p></td></tr><tr><td><p>time</p></td><td><p>Время (0&nbsp;— текущее время). Значение времени&nbsp;Unix во временнóм поясе GMT+0.</p></td></tr><tr><td><p>mode</p></td><td><p>Режимы:</p><ul><li>1/true&nbsp;—&nbsp;прикрепить;</li><li>0/false&nbsp;—&nbsp;снять.</li></ul></td></tr></tbody></table></div>

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_TAGS) или не удалось извлечь объект с требуемым ACL (ADF_ACL_ITEM_VIEW). |
| 6   | Не удалось прикрепить метку. |
| 4   | Не удалось извлечь метку с требуемым **tagId** или неверные входные параметры. |

# bind_unit_trailer

Функция **bind_unit_trailer** используется для назначения прицепов на объекты или их снятия с объектов.

svc=resource/bind_unit_trailer&params={"resourceId":&lt;long&gt;,  
"unitId":&lt;long&gt;,  
"trailerId":&lt;long&gt;,  
"time":&lt;uint&gt;,  
"mode":&lt;bool&gt;  
}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>resourceId</p></td><td><p>ID ресурса.</p></td></tr><tr><td><p>unitId</p></td><td><p>ID объекта.</p></td></tr><tr><td><p>trailerId</p></td><td><p>ID прицепа.</p></td></tr><tr><td><p>time</p></td><td><p>Время (0&nbsp;—&nbsp;текущее время).</p></td></tr><tr><td><p>mode</p></td><td><p>Режимы:</p><ul><li>1/true&nbsp;— назначить;</li><li>0/false&nbsp;—&nbsp;снять.</li></ul></td></tr></tbody></table></div>

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_TRAILERS) или не удалось извлечь объект с требуемым ACL (ADF_ACL_ITEM_VIEW). |
| 6   | Не удалось назначить прицеп. |
| 4   | Не удалось извлечь прицеп с требуемым **trailerId** или неверные входные параметры. |

# cleanup_driver_interval

Функция **cleanup_driver_interval** используется для удаления записей о назначении водителя на объект или о его снятии с объекта за указанный интервал.

svc=resource/cleanup_driver_interval&params={"resourceId":&lt;long&gt;,  
"driverId":&lt;long&gt;,  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;  
}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| resourceId | ID ресурса. |
| driverId | ID водителя. |
| timeFrom | Начало интервала. |
| timeTo | Конец интервала. |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Код</p></td><td><p>Описание</p></td></tr><tr><td><p>7</p></td><td><p>Не удалось извлечь ресурс с требуемым&nbsp;ACL (ACL_RES_EDIT_DRIVERS и ACL_ITEM_EXECUTE_REPORTS).</p></td></tr><tr><td><p>4</p></td><td><p>Одна из следующих ошибок:</p><ul><li>Не удалось извлечь водителя с требуемым&nbsp;<strong>driverId</strong>.</li><li>Если интервал заканчивается после времени получения последнего сообщения от объекта, то удаляются все сообщения, кроме последнего, и в возвращаемом результате содержится предупреждение «удаление последнего сообщения запрещено‎».</li><li>Неверные входные параметры.</li></ul></td></tr><tr><td><p>3</p></td><td><p>Не удалось извлечь сообщения.</p></td></tr></tbody></table></div>

# cleanup_trailer_interval

Функция **cleanup_trailer_interval** используется для удаления записей о назначении прицепа на объект или о его снятии с объекта за указанный интервал.

svc=resource/cleanup_trailer_interval&params={"resourceId":&lt;long&gt;,  
"trailerId":&lt;long&gt;,  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;  
}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| resourceId | ID ресурса. |
| trailerId | ID прицепа. |
| timeFrom | Начало интервала. |
| timeTo | Конец интервала. |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ACL_RES_EDIT_TRAILERS и ACL_ITEM_EXECUTE_REPORTS). |
| 4   | Не удалось извлечь прицеп с требуемым **trailerId** или неверные входные параметры. |
| 3   | Не удалось извлечь сообщения. |

# create_zone_by_track

Функция **create_zone_by_track** используется для создания геозон из треков.

svc=resource/create_zone_by_track&params={"layerName":"&lt;text&gt;",  
"itemId":&lt;uint&gt;,  
"unitId":&lt;uint&gt;,  
"n":"&lt;text&gt;",  
"c":&lt;int&gt;,  
"w":&lt;int&gt;  
}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| layerName | Имя слоя трека. |
| itemId | ID ресурса. |
| unitId | ID объекта. |
| n   | Имя геозоны. |
| c   | Цвет (ARGB). Необязательно. Значение по умолчанию — 0x009933. |
| w   | Толщина линии. Необязательно. Значение по умолчанию — 100. |

## Возвращаемый результат

{  
"all_zones":&lt;uint&gt;, /\* количество новых геозон (максимальное количество точек в одной геозоне — 10000) \*/  
"created_zone":&lt;uint&gt; /\* количество созданных геозон \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_ZONES). |
| 6   | Не удалось извлечь графический слой или нет созданных геозон. |
| 4   | Не удалось получить сообщения или неверные входные параметры. |

# driver_status

Функция **driver_status** используется для проверки статуса объекта, на который назначен водитель.

svc=resource/driver_status&params={"phoneNumber":"&lt;text&gt;",  
"password":"&lt;text&gt;",  
"app":"&lt;text&gt;",  
"fl":&lt;uint&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>phoneNumber</p></td><td><p>Телефонный номер водителя.</p></td></tr><tr><td><p>password</p></td><td><p>Мобильный ключ.&nbsp;</p><p></p><p>Поле не может быть пустым.</p></td></tr><tr><td><p>app</p></td><td><p>Имя приложения для сгенерированного токена. Необязательное поле. Значение по умолчанию&nbsp;—&nbsp;«‎Wialon Logistics».</p></td></tr><tr><td><p>fl</p></td><td><p>Дополнительные флаги:</p><ul><li>1&nbsp;— возвращает токен;</li><li>2&nbsp;— возвращает статус, даже если водитель не назначен на объект.</li></ul></td></tr></tbody></table></div>

## Возвращаемый результат

{  
"drv":{ /\* параметры водителя \*/  
"rid":&lt;uint&gt;, /\* ID ресурса \*/  
"id":"&lt;text&gt;", /\* ID водителя \*/  
"nm":"&lt;text&gt;"} /\* имя водителя \*/  
},  
"un":{ /\* параметры объекта \*/  
"nm":"&lt;text&gt;",  
"cls":&lt;uint&gt;,  
"id":&lt;uint&gt;,  
"mu":&lt;uint&gt;,  
"ct":&lt;uint&gt;,  
"ftp":{ ... },  
"pos":{ ... },  
"lmsg":{ ... },  
"uri":"&lt;text&gt;",  
"ugi":&lt;uint&gt;,  
"uacl":&lt;int&gt;  
},  
"uh":"&lt;text&gt;", /\* зашифрованная информация об устройстве (для WiaTag) \*/  
"ul":"&lt;text&gt;", /\* зашифрованный телефонный номер \*/  
"h":"&lt;text&gt;" /\* токен \*/  
}

 Описание параметров и ввода для “**pos**”, “**lmsg**” читайте [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/format/units).

Возможные коды ошибок:

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Код</p></td><td><p>Описание</p></td></tr><tr><td><p>8</p></td><td><p>Неверный пароль или телефонный номер.</p></td></tr><tr><td><p>7</p></td><td><p>Не удалось&nbsp;извлечь объект, учетную запись объекта, пользователя-создателя или модуль водителя.</p></td></tr><tr><td><p>6</p></td><td><p>Не удалось найти первого назначенного водителя или неопределенная ошибка.&nbsp;</p></td></tr><tr><td><p>4</p></td><td><p>Одна из следующих ошибок в запросе:</p><ul><li>Нет поля&nbsp;<strong>phoneNumber</strong>&nbsp;или&nbsp;<strong>password</strong>.</li><li>Поле&nbsp;<strong>password</strong> пустое.</li><li>Элемент с требуемым&nbsp;<strong>phoneNumber</strong> не найден.</li><li>Неверные входные параметры.</li></ul></td></tr></tbody></table></div>

# get_driver_bindings

Функция **get_driver_bindings** используется для получения информации о назначениях и снятиях водителя за указанный интервал.

svc=resource/get_driver_bindings&params={"resourceId":&lt;long&gt;,  
"unitId":&lt;long&gt;,  
"driverId":&lt;long&gt;,  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;}

 Этот запрос нельзя выполнить одновременно со следующими запросами:

- [report/exec_report](http://helpcenter:4001/);
- [report/export_result](http://helpcenter:4001/);
- [report/get_result_chart](http://helpcenter:4001/);
- [report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map);
- [messages/load_interval](http://helpcenter:4001/);
- [render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer);
- [unit/get_trips](http://helpcenter:4001/);
- [resource/get_trailer_bindings](http://helpcenter:4001/);
- запросы из раздела [**exchange**](https://help.wialon.com/help/api/en/user-guide/api-reference/exchange);
- [account/get_account_history](http://helpcenter:4001/).

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| resourceId | ID ресурса. |
| unitId | ID объекта (0 — все объекты). |
| driverId | ID водителя (0 — все водители). |
| timeFrom | Начало интервала. |
| timeTo | Конец интервала. |

## Возвращаемый результат

{  
"&lt;text&gt;":\[{ /\* ID водителя \*/  
"t":&lt;unit&gt;, /\* время назначения/снятия \*/  
"u":&lt;long&gt; /\* ID объекта — назначение, 0 — снятие \*/  
},  
...\],  
...  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_ITEM_EXECUTE_REPORTS и ADF_ACL_AVL_RES_VIEW_DRIVERS), или не удалось извлечь объект с требуемым ACL (ADF_ACL_ITEM_VIEW). |
| 4   | Не удалось извлечь список водителей или неверные входные параметры. |

# get_email_template

Функция **get_email_template** используется для получения шаблона электронного письма (тема и тело).

svc=resource/get_email_template&params={"resourceId":&lt;long&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| resourceId | ID ресурса. |

## Возвращаемый результат

{  
"subject":"&lt;text&gt;",  
"body":"&lt;text&gt;",  
"flags":&lt;int&gt;  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_ITEM_VIEW_PROPERTIES). |
| 4   | Неверные входные параметры. |

# get_job_data

Функция **get_job_data** используется для получения подробной информации об указанных заданиях.

svc=resource/get_job_data&params={"itemId":&lt;long&gt;,  
"col":\[&lt;long&gt;\]}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| col | Массив ID заданий. <br><br>Необязательное поле. Если его нет, функция выполняется для всех заданий. |

## Возвращаемый результат

\[  
{  
"id":&lt;long&gt;, /\* ID задания \*/  
"n":"&lt;text&gt;", /\* имя \*/  
"d":"&lt;text&gt;", /\* описание \*/  
"r":"&lt;text&gt;", /\* тип выполнения (см. ниже) \*/  
"at":&lt;uint&gt;, /\* время активации \*/  
"m":&lt;uint&gt;, /\* максимальное количество выполнений, 0 — неограниченное количество \*/  
"fl":&lt;uint&gt;, /\* удалить задание при достижении максимального количества выполнений, 1 — да \*/  
"tz":&lt;int&gt;, /\* временнáя зона, сек. \*/  
"l":"&lt;text&gt;", /\* язык, используемый для задания \*/  
"st":{ /\* состояние \*/  
"e":&lt;int&gt;, /\* включено/отключено \*/  
"c":&lt;uint&gt;, /\* количество выполнений \*/  
"l":&lt;uint&gt; /\* время последнего выполнения \*/  
},  
"sch":{ /\* ограничение по времени \*/  
"f1":&lt;uint&gt;, /\* начало интервала 1 \*/  
"f2":&lt;uint&gt;, /\* начало интервала 2 \*/  
"t1":&lt;uint&gt;, /\* конец интервала 1 \*/  
"t2":&lt;uint&gt;, /\* конец интервала 2 \*/  
"m":&lt;uint&gt;, /\* маска дней месяца \*/  
"y":&lt;uint&gt;, /\* маска месяцев \*/  
"w":&lt;uint&gt;, /\* маска дней недели \*/  
"fl":&lt;int&gt; /\* флаги расписания \*/  
},  
"act":{ /\* действия (см. список действий ниже) \*/  
"t":"&lt;text&gt;", /\* тип \*/  
"p":{ /\* параметры \*/  
"&lt;text&gt;":"&lt;text&gt;", /\* имя: значение \*/  
...  
}  
},  
"ct":&lt;uint&gt;, /\* время создания \*/  
"mt":&lt;uint&gt; /\* время последнего изменения \*/  
}  
\]

Доступно два типа выполнения:

- Составьте подробный список выполнений в соответствии с точным графиком. В таком случае, формат поля **r** — «‎1 …», где после 1 должно быть указано время выполнения. Если выполнений должно быть несколько, укажите их время через пробел. Формат времени — «‎часы:минуты» или «‎часы».
- Установите интервал между выполнениями заданий. Если необходимо использовать определенный интервал, то формат поля **r** — «‎2 …», где после 2 в формате Unix необходимо указать интервал, после которого задание должно выполняться повторно.

## Типы действий

Для заданий доступны следующие типы действий:

- [Отправить команду на объекты](#get_job_data-sendacommand);
- [Изменить доступ к объектам](#get_job_data-changeaccess);
- [Отправить отчет по email](#get_job_data-sendareport);
- [Отправить информацию о топливе по email или SMS](#get_job_data-sendfuelinformation);
- [Учет пробега](#get_job_data-mileagecounters);
- [Учет моточасов](#get_job_data-enginehourscounters);
- [Учет GPRS-трафика](#get_job_data-gprstrafficcounters).

### Отправить команду на объекты

"act":{  
"t":"exec_unit_cmd", /\* тип действия \*/  
"p":{  
"cmd_name":"&lt;text&gt;", /\* имя команды \*/  
"cmd_type":"&lt;text&gt;", /\* тип команды \*/  
"cmd_param":"&lt;text&gt;", /\* параметр команды \*/  
"link_type":"&lt;text&gt;", /\* тип связи \*/  
"timeout":"&lt;text&gt;", /\* время, в течение которого команда должна быть выполнена, сек. \*/  
"units":"&lt;text&gt;" /\* список ID объектов/групп объектов (через запятую) \*/  
}  
}

Список доступных типов команд можно найти [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/core/get_hw_cmds).

### Изменить доступ к объектам

"act":{  
"t":"change_access_user", /\* тип действия \*/  
"p":{  
"acl_bits":"&lt;text&gt;", /\* 1 — установить бит, 0 — снять бит \*/  
"acl_mask":"&lt;text&gt;", /\* маски битов, которые должны быть изменены \*/  
"units":"&lt;text&gt;", /\* список ID объектов/групп объектов (через запятую) \*/  
"users":"&lt;text&gt;" /\* список ID пользователей (через запятую) \*/  
}  
}

### Отправить отчет по email

"act":{  
"t":"send_email_report", /\* тип действия \*/  
"p":{  
"email_to":"&lt;text&gt;", /\* список электронных адресов (через запятую) \*/  
"file_type":"&lt;text&gt;", /\* формат файла \*/  
"flags":"&lt;text&gt;", /\* флаги интервалов \*/  
"params":"&lt;text&gt;", /\* конфигурация отчета (XML) \*/  
"report_guid":"&lt;text&gt;", /\* ID ресурса \*/  
"report_id":"&lt;text&gt;", /\* ID шаблона отчета \*/  
"report_objects":"&lt;text&gt;",/\* список ID объектов (через запятую) \*/  
"time_from":"&lt;text&gt;", /\* начало временнóго интервала \*/  
"time_to":"&lt;text&gt;" /\* конец временнóго интервала \*/  
}  
}

Флаги интервалов описаны [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report#exec_report-parameters).

Форматы файлов (содержимое ZIP-архива):

- 1 — HTML;
- 2 — PDF;
- 4 — XLS;
- 8 — XLSX;
- 16 — XML;
- 32 — CSV.

### Отправить информацию о топливе по email или SMS

"act":{  
"t":"send_email_sms_fuel", /\* тип действия \*/  
"p":{  
"email_to":"&lt;text&gt;", /\* список электронных адресов (через запятую) \*/  
"flags":"&lt;text&gt;", /\* флаги (см. ниже) \*/  
"phone_to":"&lt;text&gt;", /\* телефонные номера \*/  
"time_offset":"&lt;text&gt;", /\* временнóе смещение, мин. \*/  
"units":"&lt;text&gt;" /\* список ID объектов/групп объектов (через запятую) \*/  
}  
}

Флаги:

|     |     |
| --- | --- |
| Значение | Описание |
| 0x01 | Отдельное сообщение для каждого объекта. |
| 0x02 | Все объекты в одном сообщении. |
| 0x04 | Тип события: заправка. |
| 0x08 | Тип события: слив. |
| 0x10 | Тип события: уровень топлива. |
| 0x20 | Способ отправки: email. |
| 0x40 | Способ отправки: SMS. |

### Учет пробега

"act":{  
"t":"reset_unit_mileage_counter", /\* тип действия \*/  
"p":{  
"param_name":"&lt;text&gt;", /\* имя параметра; если поле пустое, значение счетчика не сохраняется в качестве параметра сообщения с данными объекта \*/  
"skip_reset":"&lt;text&gt;", /\* установить новое значение для счетчика пробега (0 — да, 1 — нет) \*/  
"store_mileage":"&lt;text&gt;", /\* сохранить значение счетчика в истории объекта \*/  
"units":"&lt;text&gt;", /\* список ID объектов/групп объектов (через запятую) \*/  
"value_mileage":"&lt;text&gt;" /\* новое значение счетчика пробега, м \*/  
}  
}

### Учет моточасов

"act":{  
"t":"reset_unit_engine_hours_counter", /\* тип действия \*/  
"p":{  
"param_name":"&lt;text&gt;", /\* имя параметра; если поле пустое, значение счетчика не сохраняется в качестве параметра сообщения с данными объекта \*/  
"skip_reset":"&lt;text&gt;", /\* установить новое значение для моточасов (0 — да, 1 — нет) \*/  
"store_eh":"&lt;text&gt;", /\* сохранить значение счетчика в истории объекта \*/  
"units":"&lt;text&gt;", /\* список ID объектов/групп объектов (через запятую) \*/  
"value_eh":"&lt;text&gt;" /\* новое значение моточасов, сек. \*/  
}  
}

### Учет GPRS-трафика

"act":{  
"t":"reset_unit_bytes_counter", /\* тип действия \*/  
"p":{  
"reset_bytes":"&lt;text&gt;", /\* сбросить значение счетчика (1 — да, 2 — нет) \*/  
"store_bytes":"&lt;text&gt;", /\* сохранить значение счетчика в истории объекта (1 — да, 0 — нет) \*/  
"units":"&lt;text&gt;" /\* список ID объектов/групп объектов (через запятую) \*/  
}  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_VIEW_JOBS). |
| 4   | Неверные входные параметры. |

# get_notification_data

Функция **get_notification_data** используется для получения подробной информации об указанных уведомлениях.

svc=resource/get_notification_data&params={"itemId":&lt;long&gt;,"col":\[&lt;long&gt;\]}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| col | Массив ID уведомлений.<br><br>Необязательное поле. Если его нет, функция выполняется для всех уведомлений. |

## Возвращаемый результат

При успешном выполнении запроса возвращается результат в следующем формате:

\[  
{  
"id":&lt;long&gt;, /\* ID уведомления \*/  
"n":"&lt;text&gt;", /\* имя \*/  
"txt":"&lt;text&gt;", /\* текст уведомления \*/  
"ta":&lt;uint&gt;, /\* время активации (формат Unix) \*/  
"td":&lt;uint&gt;, /\* время деактивации (формат Unix) \*/  
"ma":&lt;uint&gt;, /\* максимальное количество срабатываний (0 — не ограничено) \*/  
"mmtd":&lt;uint&gt;, /\* максимальный временнóй интервал между сообщениями, сек. \*/  
"cdt":&lt;uint&gt;, /\* таймаут срабатывания, сек. \*/  
"mast":&lt;uint&gt;, /\* минимальная продолжительность тревожного состояния, сек. \*/  
"mpst":&lt;uint&gt;, /\* минимальная продолжительность предыдущего состояния, сек. \*/  
"cp":&lt;uint&gt;, /\* период контроля относительно текущего времени, сек. \*/  
"fl":&lt;uint&gt;, /\* флаги уведомления (см. ниже) \*/  
"tz":&lt;uint&gt;, /\* временнáя зона \*/  
"la":"&lt;text&gt;", /\* язык пользователя (двухбуквенный код) \*/  
"ac":&lt;uint&gt;, /\* количество срабатываний \*/  
"d":"&lt;text&gt;", /\* описание уведомления \*/  
"sch":{ /\* ограничение по времени \*/  
"f1":&lt;uint&gt;, /\* начало интервала 1 (количество минут от полуночи) \*/  
"f2":&lt;uint&gt;, /\* начало интервала 2 (количество минут от полуночи) \*/  
"t1":&lt;uint&gt;, /\* конец интервала 1 (количество минут от полуночи) \*/  
"t2":&lt;uint&gt;, /\* конец интервала 2 (количество минут от полуночи) \*/  
"m":&lt;uint&gt;, /\* маска дней месяца \[1: 2||0, 31: 2||30\] \*/  
"y":&lt;uint&gt;, /\* маска месяцев \[Jan: 2||0, Dec: 2||11\] \*/  
"w":&lt;uint&gt;, /\* маска дней недели \[Mon: 2||0, Sun: 2||6\] \*/  
"fl":&lt;int&gt; /\* флаги расписания \*/  
},  
"ctrl_sch":{ /\* расписание максимального количества интервалов срабатывания \*/  
"f1":&lt;uint&gt;, /\* начало интервала 1 (количество минут от полуночи) \*/  
"f2":&lt;uint&gt;, /\* начало интервала 2 (количество минут от полуночи) \*/  
"t1":&lt;uint&gt;, /\* конец интервала 1 (количество минут от полуночи) \*/  
"t2":&lt;uint&gt;, /\* конец интервала 2 (количество минут от полуночи) \*/  
"m":&lt;uint&gt;, /\* маска дней месяца \[1: 2||0, 31: 2||30\] \*/  
"y":&lt;uint&gt;, /\* маска месяцев \[Jan: 2||0, Dec: 2||11\] \*/  
"w":&lt;uint&gt; /\* маска дней недели \[Mon: 2||0, Sun: 2||6\] \*/  
"fl":&lt;int&gt; /\* флаги расписания \*/  
},  
"un":\[&lt;long&gt;\], /\* массив ID объектов/групп объектов \*/  
"act":\[ /\* действия \*/  
{  
"t":"&lt;text&gt;", /\* тип действия (см. ниже) \*/  
"p":{ /\* параметры \*/  
"blink": "&lt;text&gt;", /\* мигание мини-окна при срабатывании \*/  
"color": "&lt;text&gt;", /\* цвет онлайн-уведомления \*/  
"url": "&lt;text&gt;", /\* URL-адрес звука уведомления \*/  
...  
},  
...  
}  
\],  
"trg":{ /\* контроль \*/  
"t":"&lt;text&gt;", /\* тип контроля (см. ниже) \*/  
"p":{ /\* параметры \*/  
"&lt;text&gt;":"&lt;text&gt;", /\* название параметра: значение \*/  
...  
}  
},  
"ct":&lt;uint&gt;, /\* время создания \*/  
"mt":&lt;uint&gt; /\* время последнего изменения \*/  
}  
\]

Флаги уведомлений:

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x0 | Уведомление срабатывает на первое сообщение. |
| 0x1 | Уведомление срабатывает на каждое сообщение. |
| 0x2 | Уведомление выключено. |

Для уведомления с [типом контроля **Простой**](#get_notification_data-idling_ru) значение параметра **mast** в секундах должно соответствовать параметру **min_idle_time** в минутах. Например, чтобы уведомление срабатывало после 10 минут простоя, укажите 10 в параметре **min_idle_time** и 600 в **mast**.

Если запрос выполнить не удалось, возвращается [код ошибки](#errors).

## Типы действий

Для уведомлений доступны следующие типы действий:

- [Уведомить по email](#get_notification_data-email_ru);
- [Уведомить при помощи SMS](#get_notification_data-sms_ru);
- [Отобразить онлайн-уведомление во всплывающем окне](#get_notification_data-pop-upwindow_ru);
- [Отправить мобильное уведомление](#get_notification_data-mobile_ru);
- [Отправить уведомление в Telegram](#get_notification_data-telegram_ru);
- [Выполнить запрос](#get_notification_data-request_ru);
- [Зарегистрировать событие в истории объекта](#get_notification_data-event_ru);
- [Отправить команду](#get_notification_data-command_ru);
- [Изменить доступ к объектам](#get_notification_data-access_ru);
- [Установить значение счетчика](#get_notification_data-value_ru);
- [Сохранить значение счетчика как параметр](#get_notification_data-param_ru);
- [Зарегистрировать статус объекта](#get_notification_data-status_ru);
- [Изменить состав групп объектов](#get_notification_data-edit_ru);
- [Отправить отчет по email](#get_notification_data-report_ru);
- [Создать рейс](#get_notification_data-ride_ru);
- [Снять водителя](#get_notification_data-driver_ru);
- [Снять прицеп](#get_notification_data-trailer_ru);
- [Создать задачу](#task).

### Уведомить по email

{  
"t":"email", /\* тип действия \*/  
"p":{  
"email_to":"&lt;text&gt;", /\* адрес электронной почты \*/  
"html":"&lt;text&gt;", /\* использовать HTML-теги: 0 — нет, 1 — да \*/  
"img_attach":"&lt;text&gt;", /\* прикрепить изображение из уведомления: 1 — да, 0 — нет \*/  
"subj":"&lt;text&gt;" /\* текст сообщения \*/  
}  
}

### Уведомить при помощи SMS

{  
"t":"sms", /\* тип действия \*/  
"p":{  
"phones":"&lt;text&gt;" /\* список телефонных номеров (через точку с запятой) \*/  
}  
}

### Отобразить онлайн-уведомление во всплывающем окне

{  
"t":"message", /\* тип действия \*/  
"p":{  
"color":"&lt;text&gt;", /\* цвет уведомления \*/  
"name":"&lt;text&gt;", /\* имя уведомления \*/  
"url":"&lt;text&gt;" /\* URL-адрес звука уведомления \*/  
}  
}

### Отправить мобильное уведомление

{  
"t":"mobile_apps", /\* тип действия \*/  
"p":{  
"apps":"{\\"&lt;text&gt;\\":\[ /\* название мобильного приложения \*/  
&lt;uint&gt; /\* ID пользователя \*/  
\]}"  
}  
}

### Отправить уведомление в Telegram

{  
"t":"messenger_messages", /\* тип действия \*/  
"p":{  
"chat_id":"&lt;text&gt;", /\* ID канала в Telegram \*/  
"token":"&lt;text&gt;" /\* токен пользователя в Telegram \*/  
}  
}

### Выполнить запрос

{  
"t":"push_messages", /\* тип действия \*/  
"p":{  
"url":"&lt;text&gt;", /\* имя сервера (можно указать порт), начните с "http(s)" \*/  
"get":&lt;bool&gt; /\* тип запроса: 1 — GET, 0 — POST \*/  
}  
}

### Зарегистрировать событие в истории объекта

{  
"t":"event", /\* тип действия \*/  
"p":{  
"flags":"&lt;text&gt;" /\* зарегистрировать как: 0 — событие, 1 — нарушение \*/  
}  
}

### Отправить команду

{  
"t":"exec_cmd", /\* тип действия \*/  
"p":{  
"cmd_type":"&lt;text&gt;", /\* тип команды \*/  
"link":"&lt;text&gt;", /\* тип ссылки \*/  
"name":"&lt;text&gt;", /\* имя команды \*/  
"param":"&lt;text&gt;" /\* параметры \*/  
}  
}

Список доступных типов команд можно найти [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/core/get_hw_cmds).

### Изменить доступ к объектам

{  
"t":"user_access", /\* тип действия \*/  
"p":{  
"acl_bits":"&lt;text&gt;", /\* 1 — установить бит, 0 — удалить бит \*/  
"acl_mask":"&lt;text&gt;", /\* маска битов, которые нужно изменить \*/  
"units":"&lt;text&gt;", /\* список ID объектов (через запятую) \*/  
"users":"&lt;text&gt;" /\* список ID пользователей (через запятую) \*/  
}  
}

### Установить значение счетчика

{  
"t":"counter", /\* тип действия \*/  
"p":{  
"engine_hours":"&lt;text&gt;", /\* значение счетчика моточасов \*/  
"flags":"&lt;text&gt;", /\* флаги (см. ниже) \*/  
"mileage":"&lt;text&gt;", /\* значение счетчика пробега \*/  
"traffic":"&lt;text&gt;" /\* значение счетчика GPRS-трафика \*/  
}  
}

Флаги счетчиков:

|     |     |
| --- | --- |
| Флаг | Описание |
| 1   | Установить значение счетчика пробега |
| 2   | Установить значение счетчика моточасов. |
| 4   | Установить значение счетчика GPRS-трафика. |

### Сохранить значение счетчика как параметр

{  
"t":"store_counter", /\* тип действия \*/  
"p":{  
"engine_hours":"&lt;text&gt;", /\* название параметра для счетчика моточасов \*/  
"flags":"&lt;text&gt;", /\* флаги (см. ниже) \*/  
"mileage":"&lt;text&gt;" /\* название параметра для счетчика пробега \*/  
}  
}

Флаги:

|     |     |
| --- | --- |
| Флаг | Описание |
| 1   | Сохранить значение счетчика пробега как параметр. |
| 2   | Сохранить значение счетчика моточасов как параметр. |

### Зарегистрировать статус объекта

{  
"t":"status", /\* тип действия \*/  
"p":{  
"ui_text":"&lt;text&gt;" /\* статус \*/  
}  
}

### Изменить состав групп объектов

{  
"t":"group_manipulation", /\* тип действия \*/  
"p":{  
"add_to":"&lt;text&gt;", /\* добавить в указанные группы \*/  
"remove_from":"&lt;text&gt;" /\* удалить из указанных групп \*/  
}  
}

### Отправить отчет по email

{  
"t":"email_report", /\* тип действия \*/  
"p":{  
"email_to":"&lt;text&gt;", /\* адрес электронной почты \*/  
"file_type":"&lt;text&gt;", /\* формат файла (см. нижу) \*/  
"flags":"&lt;text&gt;", /\* флаги интервала \*/  
"params":"&lt;text&gt;", /\* конфигурация отчета (XML) \*/  
"report_guid":"&lt;text&gt;", /\* ID ресурса \*/  
"report_id":"&lt;text&gt;", /\* ID шаблона \*/  
"report_object_guid":"&lt;text&gt;", /\* ID элемента для отчета \*/  
"report_object_id":"&lt;text&gt;", /\* ID подэлемента (0 — если отчет выполняется для элемента) \*/  
"time_from":"&lt;text&gt;", /\* начало временнóго интервала \*/  
"time_to":"&lt;text&gt;" /\* конец временнóго интервала \*/  
}  
}

Флаги интервалов описаны [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report).

Форматы файлов:

- 1 — HTML;
- 2 — PDF;
- 4 — XLS;
- 8 — XLSX;
- 16 — XML;
- 32 — CSV.

### Создать рейс

{  
"t":"route_control", /\* тип действия \*/  
"p":{  
"description":"&lt;text&gt;", /\* описание \*/  
"expiration":"&lt;text&gt;", /\* срок действия \*/  
"flags":"&lt;text&gt;", /\* флаги рейса \*/  
"name":"&lt;text&gt;", /\* имя \*/  
"route":"&lt;text&gt;", /\* ID маршрута \*/  
"schedule":"&lt;text&gt;" /\* ID расписания \*/  
}  
}

Флаги рейса описаны [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/route).

### Снять водителя

{  
"t":"drivers_reset", /\* тип действия \*/  
"p":{}  
}

### Снять прицеп

{  
"t":"trailers_reset", /\* тип действия \*/  
"p":{}  
}

### Создать задачу

{  
"t": "create_task", /\* тип действия \*/  
"p": {  
"task_priority": "&lt;int&gt;", /\* приоритет задачи \*/  
"task_assignee": "&lt;int&gt;" /\* ID пользователя, на которого назначена задача \*/  
}  
}

## Типы контроля

Для уведомлений доступны следующие типы контроля:

- [Геозона](#get_notification_data-geofence_ru);
- [Адрес](#get_notification_data-address_ru);
- [Скорость](#get_notification_data-speed_ru);
- [Тревога (SOS)](#get_notification_data-alarm_ru);
- [Цифровой вход](#get_notification_data-input_ru);
- [Параметр в сообщении](#get_notification_data-parameter_ru);
- [Значение датчика](#get_notification_data-sensorvalue_ru);
- [Потеря связи](#get_notification_data-loss_ru);
- [Простой](#get_notification_data-idling_ru);
- [SMS](#get_notification_data-smscontrol_ru);
- [Взаиморасположение объектов](#get_notification_data-interposition_ru);
- [Превышение количества сообщений](#get_notification_data-excess_ru);
- [Прохождение маршрута](#get_notification_data-progress_ru);
- [Водитель](#get_notification_data-dr_ru);
- [Прицеп](#get_notification_data-tr_ru);
- [Техобслуживание](#get_notification_data-maintenance_ru);
- [Заправка или зарядка батареи](#get_notification_data-filling_ru);
- [Слив](#get_notification_data-theft_ru)
- [Состояние устройств](#health-check).

### Геозона

"trg":{  
"t":"geozone", /\* тип контроля \*/  
"p":{  
"sensor_type":"&lt;text&gt;", /\* тип датчика \*/  
"sensor_name_mask":"&lt;text&gt;", /\* маска имени датчика \*/  
"lower_bound":&lt;uint&gt;, /\* значение датчика от \*/  
"upper_bound":&lt;uint&gt;, /\* значение датчика до \*/  
"prev_msg_diff":&lt;uint&gt;, /\* флаг позволяет создать диапазон для текущего значения в соответствии с предыдущим значением(prev) следующим образом: \[prev+lower_bound ; prev+upper_bound\]; таким образом, диапазон для текущего значения является относительным к предыдущему значению; 0 — выключить опцию, 1 — включить опцию \*/  
"merge":&lt;uint&gt;, /\* одинаковые датчики: 0 — считать отдельно, 1 — суммировать значения \*/  
"reversed":&lt;uint&gt;, /\* срабатывать: 0 — в рамках указанного диапазона, 1 — за пределами указанного диапазона \*/  
"geozone_ids":"&lt;text&gt;", /\* список ID геозон (через запятую) \*/  
"type":&lt;uint&gt;, /\* тип контроля: 0 — контролировать вход в геозону, 1 — контролировать выход из геозоны \*/  
"min_speed":&lt;uint&gt;, /\* минимальная скорость, км/ч \*/  
"max_speed":&lt;uint&gt;, /\* максимальная скорость, км/ч \*/  
"include_lbs":&lt;uint&gt;, /\* обрабатывать LBS-сообщения: 1 — да, 0 — нет \*/  
"lo":"&lt;text&gt;" /\* логический оператор (необязательно): "AND", "OR" \*/  
}  
}

### Адрес

"trg":{  
"t":"address", /\* тип контроля \*/  
"p":{  
"sensor_type":"&lt;text&gt;", /\* тип датчика \*/  
"sensor_name_mask":"&lt;text&gt;", /\* маска имени датчика \*/  
"lower_bound":&lt;uint&gt;, /\* значение датчика от \*/  
"upper_bound":&lt;uint&gt;, /\* значение датчика до \*/  
"prev_msg_diff":&lt;uint&gt;, /\* флаг позволяет создать диапазон для текущего значения в соответствии с предыдущим значением(prev) следующим образом: \[prev+lower_bound ; prev+upper_bound\]; таким образом, диапазон для текущего значения является относительным к предыдущему значению; 0 — выключить опцию, 1 — включить опцию \*/  
"merge":&lt;uint&gt;, /\* одинаковые датчики: 0 — считать отдельно, 1 — суммировать значения \*/  
"reversed":&lt;uint&gt;, /\* срабатывать: 0 — в рамках указанного диапазона, 1 — за пределами указанного диапазона \*/  
"radius":&lt;uint&gt;, /\* радиус срабатывания \*/  
"type":&lt;uint&gt;, /\* тип контроля: 0 — контролировать в радиусе адреса, 1 — контролировать за пределами радиуса адреса \*/  
"min_speed":&lt;uint&gt;, /\* минимальная скорость, км/ч \*/  
"max_speed":&lt;uint&gt;, /\* максимальная скорость, км/ч \*/  
"country":"&lt;text&gt;", /\* страна \*/  
"region":"&lt;text&gt;", /\* регион \*/  
"city":"&lt;text&gt;", /\* город \*/  
"street":"&lt;text&gt;", /\* улица \*/  
"house":"&lt;text&gt;", /\* дом \*/  
"include_lbs":&lt;uint&gt; /\* обрабатывать LBS-сообщения: 1 — да, 0 — нет \*/  
}  
}

### Скорость

"trg":{  
"t":"speed", /\* тип контроля \*/  
"p":{  
"lower_bound":"&lt;text&gt;", /\* значение датчика от \*/  
"max_speed":"&lt;text&gt;", /\* максимальная скорость, км/ч \*/  
"merge":"&lt;text&gt;", /\* одинаковые датчики: 0 — считать отдельно, 1 — суммировать значения \*/  
"min_speed":"&lt;text&gt;", /\* минимальная скорость, км/ч \*/  
"prev_msg_diff":"&lt;text&gt;", /\* флаг позволяет создать диапазон для текущего значения в соответствии с предыдущим значением(prev) следующим образом: \[prev+lower_bound ; prev+upper_bound\]; таким образом, диапазон для текущего значения является относительным к предыдущему значению; 0 — выключить опцию, 1 — включить опцию \*/  
"reversed":"&lt;text&gt;", /\* срабатывать: 0 — в рамках указанного диапазона, 1 — за пределами указанного диапазона \*/  
"sensor_name_mask":"&lt;text&gt;", /\* маска имени датчика \*/  
"sensor_type":"&lt;text&gt;", /\* тип датчика \*/  
"upper_bound":"&lt;text&gt;" /\* значение датчика до \*/  
}  
}

### Тревога (SOS)

"trg":{  
"t":"alarm", /\* тип контроля \*/  
"p":{}  
}

### Цифровой вход

"trg":{  
"t":"digital_input", /\* тип контроля \*/  
"p":{  
"input_index":"&lt;text&gt;", /\* цифровой вход (1-32) \*/  
"type":"&lt;text&gt;" /\* тип контроля: 0 — проверять на активацию, 1 — проверять на деактивацию \*/  
}  
}

### Параметр в сообщении

"trg":{  
"t":"msg_param", /\* тип контроля \*/  
"p":{  
"kind":"&lt;text&gt;", /\* тип контроля параметра (см. ниже) \*/  
"lower_bound":"&lt;text&gt;", /\* значение параметра от \*/  
"param":"&lt;text&gt;", /\* название параметра \*/  
"text_mask":"&lt;text&gt;", /\* текстовая маска \*/  
"type":"&lt;text&gt;", /\* срабатывать: 0 — в рамках указанного диапазона, 1 — за пределами указанного диапазона \*/  
"upper_bound":"&lt;text&gt;" /\* значение параметра до \*/  
}  
}

Типы контроля параметра:

|     |     |
| --- | --- |
| Тип | Описание |
| 0   | Диапазон значений. |
| 1   | Текстовая маска. |
| 2   | Наличие параметра. |
| 3   | Отсутствие параметра. |

### Значение датчика

"trg":{  
"t":"sensor_value", /\* тип контроля \*/  
"p":{  
"lower_bound":"&lt;text&gt;", /\* значение датчика от \*/  
"merge":"&lt;text&gt;", /\* одинаковые датчики: 0 — считать отдельно, 1 — суммировать значения \*/  
"prev_msg_diff":"&lt;text&gt;", /\* флаг позволяет создать диапазон для текущего значения в соответствии с предыдущим значением(prev) следующим образом: \[prev+lower_bound ; prev+upper_bound\]; таким образом, диапазон для текущего значения является относительным к предыдущему значению; 0 — выключить опцию, 1 — включить опцию \*/  
"sensor_name_mask":"&lt;text&gt;", /\* маска имени датчика \*/  
"sensor_type":"&lt;text&gt;", /\* тип дптчика \*/  
"type":"&lt;text&gt;", /\* срабатывать: 0 — в рамках указанного диапазона, 1 — за пределами указанного диапазона \*/  
"upper_bound":"&lt;text&gt;" /\* значение датчика до \*/  
}  
}

### Потеря связи

"trg":{  
"t":"outage", /\* тип контроля \*/  
"p":{  
"time":"&lt;text&gt;", /\* временнóй интервал, сек. \*/  
"type":"&lt;text&gt;", /\* тип контроля: 0 — потеря координат, 1 — потеря связи \*/  
"include_lbs":&lt;uint&gt;, /\* обрабатывать LBS-сообщения: 1 — да, 0 — нет \*/  
"check_restore":&lt;uint&gt;, /\* уведомлять о: 0 — потере связи, 1 — потере и восстановлении связи, 2 — восстановлении связи \*/  
"geozones_type":"&lt;text&gt;", /\* тип контроля: 0 — за пределами геозоны, 1 — в геозоне \*/  
"geozones_list":"&lt;text&gt;" /\* список ID геозон (через запятую) \*/  
}  
}

### Простой

"trg":{  
"t":"speed", /\* тип контроля \*/  
"p":{  
"lower_bound":"&lt;text&gt;", /\* значение датчика от \*/  
"max_speed":"&lt;text&gt;", /\* максимальная скорость, км/ч \*/  
"merge":"&lt;text&gt;", /\* одинаковые датчики: 0 — считать отдельно, 1 — суммировать значения \*/  
"min_idle_time":"&lt;text&gt;", /\* минимальное время простоя, мин. \*/  
"min_speed":"&lt;text&gt;", /\* минимальная скорость, км/ч \*/  
"prev_msg_diff":"&lt;text&gt;", /\* флаг позволяет создать диапазон для текущего значения в соответствии с предыдущим значением(prev) следующим образом: \[prev+lower_bound ; prev+upper_bound\]; таким образом, диапазон для текущего значения является относительным к предыдущему значению; 0 — выключить опцию, 1 — включить опцию \*/  
"reversed":"&lt;text&gt;", /\* срабатывать: 0 — в рамках указанного диапазона, 1 — за пределами указанного диапазона \*/  
"sensor_name_mask":"&lt;text&gt;", /\* маска имени датчика \*/  
"sensor_type":"&lt;text&gt;", /\* тип датчика \*/  
"upper_bound":"&lt;text&gt;", /\* значение датчика до \*/  
"geozones_type":"&lt;text&gt;", /\* тип контроля: 0 — за пределами геозоны, 1 — в геозоне \*/  
"geozones_list":"&lt;text&gt;" /\* список ID геозон (через запятую) \*/  
}  
}

Значение параметра **min_idle_time** в минутах должно соответствовать значению параметра **mast** в секундах. Например, чтобы уведомление срабатывало после 10 минут простоя, укажите 10 в параметре **min_idle_time** и 600 в **mast**

### SMS

"trg":{  
"t":"sms", /\* тип контроля \*/  
"p":{  
"mask":"&lt;text&gt;" /\* маска текста SMS-сообщения \*/  
}  
}

### Взаиморасположение объектов

"trg":{  
"t":"interposition", /\* тип контроля \*/  
"p":{  
"sensor_name_mask":"&lt;text&gt;", /\* маска имени датчика \*/  
"sensor_type":"&lt;text&gt;", /\* тип датчика \*/  
"lower_bound":"&lt;text&gt;", /\* значение датчика от \*/  
"upper_bound":"&lt;text&gt;" /\* значение датчика до \*/  
"merge":"&lt;text&gt;", /\* одинаковые датчики: 0 — считать отдельно, 1 — суммировать значения \*/  
"max_speed":"&lt;text&gt;", /\* максимальная скорость, км/ч \*/  
"min_speed":"&lt;text&gt;", /\* минимальная скорость, км/ч \*/  
"reversed":"&lt;text&gt;", /\* срабатывать: 0 — в рамках указанного диапазона, 1 — за пределами указанного диапазона \*/  
"prev_msg_diff":"&lt;text&gt;", /\* флаг позволяет создать диапазон для текущего значения в соответствии с предыдущим значением(prev) следующим образом: \[prev+lower_bound ; prev+upper_bound\]; таким образом, диапазон для текущего значения является относительным к предыдущему значению; 0 — выключить опцию, 1 — включить опцию \*/  
"radius":"&lt;text&gt;", /\* радиус, м \*/  
"type":"&lt;text&gt;", /\* тип контроля: 0 — контролировать приближение к объектам, 1 — контролировать удаление от объектов \*/  
"unit_guids":"&lt;text&gt;", /\* список ID контролируемыx объектов (через запятую) \*/  
"include_lbs":&lt;uint&gt;, /\* обрабатывать LBS-сообщения: 1 — да, 0 — нет \*/  
"lo":"&lt;text&gt;" /\* логический оператор (необязательно): "AND", "OR" \*/  
}  
}

### Превышение количества сообщений

"trg":{  
"t":"msgs_counter", /\* тип контроля \*/  
"p":{  
"flags":"&lt;text&gt;", /\* тип сообщений: 1 — сообщения с данными, 2 — SMS-сообщения \*/  
"msgs_limit":"&lt;text&gt;", /\* лимит сообщений \*/  
"time_offset":"&lt;text&gt;" /\* интервал сброса значений датчика (лимит — 24 ч.), сек. \*/  
}  
}

### Прохождение маршрута

"trg":{  
"t":"route_control", /\* тип контроля \*/  
"p":{  
"mask":"&lt;text&gt;", /\* маска имени маршрута \*/  
"round_mask":"&lt;text&gt;", /\* маска имени рейса \*/  
"schedule_mask":"&lt;text&gt;", /\* маска имени расписания \*/  
"types":"&lt;text&gt;" /\* типы контроля маршрута (через запятую) \*/  
}  
}

Типы контроля маршрута:

|     |     |
| --- | --- |
| Тип | Описание |
| 1   | Начало рейса. |
| 2   | Завершение рейса. |
| 4   | Прерывание рейса. |
| 8   | Прибытие в контрольную точку. |
| 16  | Пропуск контрольной точки. |
| 32  | Отправление из контрольной точки. |
| 64  | Опоздание. |
| 128 | Опережение. |
| 256 | Возвращение к расписанию. |

### Водитель

"trg":{  
"t":"driver", /\* тип контроля \*/  
"p":{  
"driver_code_mask":"&lt;text&gt;", /\* маска кода водителя \*/  
"flags":"&lt;text&gt;" /\* тип контроля: 1 — назначение водителя, 2 — снятие водителя \*/  
}  
}

### Прицеп

"trg": {  
"t": "trailer", /\* тип контроля \*/  
"p": {  
"driver_code_mask": "&lt;text&gt;", /\* маска кода прицепа \*/  
"flags": "&lt;text&gt;" /\* тип контроля: 1 — назначение прицепа, 2 — снятие прицепа \*/  
}  
}

### Техобслуживание

"trg":{  
"t":"service_intervals", /\* тип контроля \*/  
"p":{  
"days":"&lt;text&gt;", /\* интервал в днях \*/  
"engine_hours":"&lt;text&gt;", /\* интервал по моточасам, ч. \*/  
"flags":"&lt;text&gt;", /\* флаги контроля техобслуживания (см. ниже) \*/  
"mask":"&lt;text&gt;", /\* маска фильтра инревалов \*/  
"mileage":"&lt;text&gt;", /\* интервал по пробегу, км \*/  
"val":"&lt;text&gt;" /\* уведомлять о: 1 — приближении срока сервиса, -1 — просрочке срока сервиса \*/  
}  
}

Флаги контроля техобслуживания:

|     |     |
| --- | --- |
| Флаг | Описание |
| 0   | Контролировать все сервисные интервалы. |
| 1   | Интервал по пробегу. |
| 2   | Интервал по моточасам. |
| 4   | Интервал по дням. |

### Заправка или зарядка батареи

"trg":{  
"t":"fuel_filling", /\* тип контроля \*/  
"p":{  
"sensor_name_mask":"&lt;text&gt;", /\* маска имени датчика \*/  
"geozones_type":&lt;uint&gt;, /\* тип контроля геозон: 0 — выкл или за пределами геозоны, 1 — в геозоне \*/  
"geozones_list":"&lt;text&gt;", /\* список ID геозон (через запятую) в формате "resourceID_geozone ID" \*/  
"realtime_only":&lt;uint&gt;, /\* игнорировать пересчет исторических данных: 0 — выключить, 1 — включить \*/  
}  
}

### Состояние устройств

"trg": {  
"t": "health_check", /\* Тип контроля \*/  
"p": {  
"healthy": &lt;uint&gt;, /\* Показывает, является ли устройство рабочим: 0 — нет, 1 — да \*/  
"unhealthy": &lt;uint&gt;, /\* Показывает, является ли устройство нерабочим: 0 — нет, 1 — да \*/  
"needAttention": &lt;uint&gt;, /\* Показывает, требует ли устройство внимания: 0 — нет, 1 — да \*/  
"triggerForEachIncident": &lt;uint&gt; /\* Срабатывать при каждом инциденте: 0 — опция выключена, 1 — опция включена \*/  
}  
}

## Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 4   | Неверные входные параметры. |
| 7   | У пользователя нет необходимого права доступа на ресурс (ADF_ACL_AVL_RES_VIEW_NF). |

# get_orders_notification

Функция **get_orders_notification** используется для получения настроек шаблона уведомления о заявке.

svc=resource/get_orders_notification&params={"resourceId":&lt;long&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| resourceId | ID ресурса. |

## Возвращаемый результат

{} /\* настройки шаблона уведомления о заявке в формате JSON \*/

См. формат JSON [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/resource/update_orders_notification).

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_VIEW_ORDERS). |
| 4   | Неверные входные параметры. |

# get_tag_bindings

Функция **get_tag_bindings** используется для получения информации о назначениях и снятиях меток за указанный интервал. Метки используются при назначении и снятии пассажиров.

svc=resource/get_tag_bindings&params={"resourceId":&lt;long&gt;,  
"unitId":&lt;long&gt;,  
"tagId":&lt;long&gt;,  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;}

 Этот запрос нельзя выполнять одновременно со следующими запросами:

- [report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report);
- [report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result);
- [report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart);
- [report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map);
- [messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval);
- [render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer);
- [unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips);
- [resource/get_trailer_bindings](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_trailer_bindings);
- запросы из раздела [**exchange**](https://help.wialon.com/ru/api/user-guide/api-reference/exchange);
- [account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| resourceId | ID ресурса. |
| unitId | ID объекта (0 — все объекты). |
| tagId | ID метки (0 — все метки). |
| timeFrom | Начало интервала. |
| timeTo | Конец интервала. |

## Возвращаемый результат

{  
"&lt;text&gt;":\[{ /\* ID метки \*/  
"t":&lt;unit&gt;, /\* время назначения/снятия \*/  
"u":&lt;uint&gt;, /\* ID объекта — назначение, 0 — снятие \*/  
"pu":&lt;uint&gt;, /\* ID предыдущего объекта — снятие, 0 — назначение \*/  
"f":&lt;uint&gt; /\* таймаут снятия, 4 — да \*/  
}, ...\],  
...  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_VIEW_TAGS и ADF_ACL_ITEM_EXECUTE_REPORTS) или не удалось извлечь объект с требуемым ACL (ADF_ACL_ITEM_VIEW). |
| 4   | Не удалось извлечь список меток или неверные входные параметры. |

# get_trailer_bindings

Функция **get_trailer_bindings** используется для получения информации о назначениях и снятиях прицепа за указанный интервал.

svc=resource/get_trailer_bindings&params={"resourceId":&lt;long&gt;,  
"unitId":&lt;long&gt;,  
"trailerId":&lt;long&gt;,  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;}

 Этот запрос нельзя выполнять одновременно со следующими запросами:

- [report/exec_report](https://help.wialon.com/ru/api/user-guide/api-reference/report/exec_report);
- [report/export_result](https://help.wialon.com/ru/api/user-guide/api-reference/report/export_result);
- [report/get_result_chart](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_chart);
- [report/get_result_map](https://help.wialon.com/ru/api/user-guide/api-reference/report/get_result_map);
- [messages/load_interval](https://help.wialon.com/ru/api/user-guide/api-reference/messages/load_interval);
- [render/create_messages_layer](https://help.wialon.com/ru/api/user-guide/api-reference/render/create_messages_layer);
- [unit/get_trips](https://help.wialon.com/ru/api/user-guide/api-reference/unit/get_trips);
- [resource/get_trailer_bindings](http://helpcenter:4001/);
- запросы из раздела [**exchange**](https://help.wialon.com/ru/api/user-guide/api-reference/exchange);
- [account/get_account_history](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_history).

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| resourceId | ID ресурса. |
| unitId | ID объекта (0 — все объекты). |
| trailerId | ID прицепа (0 — все прицепы). |
| timeFrom | Начало интервала. |
| timeTo | Конец интервала. |

## Возвращаемый результат

{  
"&lt;text&gt;":\[{ /\* ID прицепа \*/  
"t":&lt;unit&gt;, /\* время назначения/снятия \*/  
"u":&lt;long&gt; /\* ID объекта — назначение, 0 — снятие \*/  
}, ...\],  
...  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_VIEW_TRAILERS и ADF_ACL_ITEM_EXECUTE_REPORTS) или не удалось извлечь объект с требуемым ACL (ADF_ACL_ITEM_VIEW). |
| 4   | Не удалось извлечь список прицепов или неверные входные параметры. |

# get_unit_drivers

Функция **get_unit_drivers** используется для получения списка водителей, назначенных на объект.

svc=resource/get_unit_drivers&params={"unitId":&lt;long&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| unitId | ID объекта. |

## Возвращаемый результат

{  
"&lt;text&gt;":\[ /\* ID ресурса \*/  
{  
"id":"&lt;text&gt;", /\* ID водителя \*/  
"nm":"&lt;text&gt;", /\* имя водителя \*/  
"ph":"&lt;text&gt;" /\* телефонный номер водителя \*/  
}, ...  
\], ...  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь объект с требуемым ACL (ADF_ACL_ITEM_VIEW). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# get_zone_data

Функция **get_zone_data** используется для получения подробной информации о геозонах.

svc=resource/get_zone_data&params={"itemId":&lt;long&gt;,  
"col":\[&lt;long&gt;\],  
"flags":&lt;uint&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| col | Массив ID геозон.<br><br>Необязательное поле. Если его нет, функция выполняется для всех ID. |
| flags | Флаги, определяющие формат возвращаемого JSON (необязательно). Значение по умолчанию — **0x1C**. |

Доступные следующие значения флагов:

|     |     |
| --- | --- |
| Значение | Описание |
| 0x01 | Площадь. |
| 0X02 | Периметр. |
| 0X04 | Координаты центра и границ геозоны. |
| 0X08 | Все точки. |
| 0X10 | Основные свойства. |

## Возвращаемый результат

\[ /\* массив с данными о геозонах \*/  
{  
"n":"&lt;text&gt;", /\* имя геозоны \*/  
"d":"&lt;text&gt;", /\* описание \*/  
"id":&lt;long&gt;, /\* ID геозоны в ресурсе/учетной записи \*/  
"rid":&lt;long&gt;, /\* ID ресурса/учетной записи \*/  
"t":&lt;byte&gt;, /\* тип: 1 — линия, 2 — полигон, 3 — круг \*/  
"w":&lt;uint&gt;, /\* толщина линии или радиус круга \*/  
"f":&lt;uint&gt;, /\* флаги геозоны (см. ниже) \*/  
"c":&lt;uint&gt;, /\* цвет (ARGB) \*/  
"tc":&lt;uint&gt;, /\* цвет текста (RGB) \*/  
"ts":&lt;uint&gt;, /\* размер шрифта \*/  
"min":&lt;uint&gt;, /\* показать на карте, начиная от этого масштаба \*/  
"max":&lt;uint&gt;, /\* показать на карте до этого масштаба \*/  
"i":&lt;ushort&gt;, /\* контрольная сумма изображения (CRC16) \*/  
"icon":"&lt;text&gt;", /\* URI изображения элемента зоны \*/  
"path":"&lt;text&gt;", /\* короткий путь к иконке по умолчанию \*/  
"ar":&lt;double&gt;, /\* площадь \*/  
"pr":&lt;double&gt;, /\* периметр \*/  
"libId":&lt;long&gt;, /\* ID библиотеки иконок, 0 — ID библиотеки иконок по умолчанию \*/  
"jp":&lt;JSON&gt;, /\* произвольный JSON \*/  
"b":{ /\* границы \*/  
"min_x":&lt;double&gt;, /\* минимальная долгота \*/  
"min_y":&lt;double&gt;, /\* минимальная широта \*/  
"max_x":&lt;double&gt;, /\* максимальная долгота \*/  
"max_y":&lt;double&gt;, /\* максимальная широта \*/  
"cen_x":&lt;double&gt;, /\* долгота центра \*/  
"cen_y":&lt;double&gt; /\* широта центра \*/  
},  
"p":\[ /\* массив точек геозоны \*/  
{  
"x":&lt;double&gt;, /\* долгота \*/  
"y":&lt;double&gt;, /\* широта \*/  
"r":&lt;uint&gt; /\* радиус \*/  
},  
...  
\],  
"ct":&lt;uint&gt;, /\* время создания \*/  
"mt":&lt;uint&gt; /\* время последнего изменения \*/  
},  
...  
\]

Флаги геозоны (“f”):

|     |     |
| --- | --- |
| Значение | Описание |
| 0x20 | Показать форму. |
| 0X40 | Не упрощать геозону. |

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_VIEW_ZONES и ADF_ACL_ITEM_EXECUTE_REPORTS) или не удалось извлечь объект с требуемым ACL (ADF_ACL_ITEM_VIEW). |
| 4   | Неверные входные параметры. |

# get_zones_by_point

Функция **get_zones_by_point** используется для проверки наличия какой-либо точки в пределах определенных геозон или для поиска ближайшей геозоны.

svc=resource/get_zones_by_point&params={"spec": {  
"lat":&lt;double&gt;,  
"lon":&lt;double&gt;,  
"radius":&lt;double&gt;,  
"zoneId":{  
"&lt;long&gt;":\[&lt;uint&gt;,  
...  
\],  
...  
},  
}  
}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| zoneId | Список геозон: {“ID ресурса”:\[ID геозоны,…\], …}. |
| lat | Широта. |
| lon | Долгота. |
| radius | Радиус поиска геозон, м. Необязательное поле. |

 Если массив ID геозон для указанного “ID ресурса” пустой, то берутся все геозоны ресурса.

## Возвращаемый результат

Если точка находится в пределах геозоны, возвращается следующий результат:

\[  
{  
"&lt;text&gt;": { /\* ID ресурса \*/  
"&lt;text&gt;": 0, /\* ID геозоны, расстояние до геозоны, м (в этом случае всегда 0) \*/  
...  
},  
...  
}  
\]

Если точка находится за пределами геозоны, возвращается следующий результат:

\[  
{  
"&lt;text&gt;":{ /\* ID ресурса \*/  
"&lt;text&gt;": &lt;double&gt;, /\* ID геозоны, расстояние до геозоны, м \*/  
}  
}  
\]

Если нет поля **radius**, возвращается следующий результат:

\[  
{  
"&lt;text&gt;": \[ /\* ID ресурса \*/  
&lt;long&gt;, /\* ID геозон \*/  
...  
\],  
...  
}  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 6   | Общая ошибка. |
| 4   | Неверные входные параметры. |

# update_driver

Функция **update_driver** используется для создания, редактирования или удаления водителей.

svc=resource/update_driver&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"callMode":"&lt;text&gt;",  
"ej":{"apps":\[{"appId":"&lt;text&gt;","type":"&lt;text&gt;","uid":"&lt;text&gt;","sn":"&lt;text&gt;"},...\]},  
"c":"&lt;text&gt;",  
"ck":&lt;short&gt;,  
"ds":"&lt;text&gt;",  
"n":"&lt;text&gt;",  
"p":"&lt;text&gt;",  
"r":&lt;double&gt;,  
"f":&lt;uint&gt;,  
"pwd":"&lt;text&gt;",  
"jp":{  
"&lt;text&gt;":"&lt;text&gt;",  
...  
}}

## Параметры

|     |     |     |     |     |     |
| --- | --- | --- | --- | --- | --- |
| Название | Описание | Необходим для |     |     |     |
| itemId | ID ресурса. | <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/> |     |     |     |
| id  | ID водителя (0 — создать). |
| callMode | Действие: создание, редактирование, удаление, удаление изображения (create, update, delete, reset_image). |
|     |     | создания | редактирования | reset_image | удаления |
| ej  | Расширенный JSON (с примером для push-уведомлений). | { } | { } | \-  | \-  |
| c   | Код. | +   | +   | \-  | \-  |
| ck  | Контрольная сумма изображения водителя. | \-  | \-  | \-  | \-  |
| ds  | Описание. | +   | +   | \-  | \-  |
| n   | Название. | +   | +   | \-  | \-  |
| p   | Телефонный номер. Например, +1234567890 ( + должен быть закодирован в %2B). | +   | +   | \-  | \-  |
| r   | Пропорции изображения водителя. | \-  | \-  | \-  | \-  |
| f   | Флаги (4 — исключающий). | 0   | 0   | \-  | \-  |
| pwd | Пароль для авторизации с мобильного устройства. | +   | +   | \-  | \-  |
| jp  | Произвольные поля в формате **"имя":"значение"**. | { } | { } | \-  | \-  |

“{ }” и “0” — значения по умолчанию.

## Возвращаемый результат

Для запросов, связанных с созданием и редактированием водителей и с удалением изображений (reset_image):

\[  
&lt;long&gt;, /\* ID водителя \*/  
{  
"id":&lt;long&gt;, /\* ID водителя \*/  
"n":"&lt;text&gt;", /\* имя \*/  
"c":"&lt;text&gt;", /\* код \*/  
"ej":{ ... }, /\* расширенный JSON \*/  
"jp": { /\* произвольные поля \*/  
"&lt;text&gt;":"&lt;text&gt;", /\* имя:значение \*/  
...  
},  
"pwd":"&lt;text&gt;", /\* пароль для авторизации с мобильного устройства \*/  
"ds":"&lt;text&gt;", /\* описание \*/  
"p":"&lt;text&gt;", /\* телефонный номер \*/  
"r":&lt;double&gt;, /\* пропорции изображения водителя \*/  
"f":&lt;uint&gt;, /\* флаги (см. ниже) \*/  
"ck":&lt;ushort&gt;, /\* контрольная сумма изображения водителя \*/  
"ct":&lt;uint&gt;, /\* время создания \*/  
"mt":&lt;uint&gt;, /\* время редактирования \*/  
"bu":&lt;long&gt;, /\* назначенный объект \*/  
"pu":&lt;long&gt;, /\* предыдущий назначенный объект \*/  
"bt":&lt;uint&gt;, /\* время последнего назначения/снятия \*/  
"bs":&lt;long&gt;, /\* ID датчика \*/  
"pos":{ /\* местоположение \*/  
"y":&lt;double&gt;, /\* широта \*/  
"x":&lt;double&gt; /\* долгота \*/  
}  
}  
\]

Флаги:

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x1 | Тип объекта: Водитель. |
| 0x2 | Тип объекта: Прицеп. |
| 0x4 | Ограничить назначение. |
| 0x8 | Тип объекта: Группа водителей. |
| 0x10 | Тип объекта: Группа прицепов. |

Для запросов, связанных с удалением:

\[  
&lt;long&gt;, /\* ID водителя \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 1002 | Не удалось изменить телефонный номер. Возможно по причине того, что этот номер уже существует. |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_DRIVERS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_driver_units

Функция **update_driver_units** используется для редактирования списка объектов, выбранных для автоматического назначения водителей.

svc=resource/update_driver_units&params={"itemId":&lt;long&gt;,  
"units":\[&lt;long&gt;\]}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| units | Массив ID объектов. |

## Возвращаемый результат

{  
"drvrun":\[&lt;long&gt;\] /\* массив объектов для автоматического назначения \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_DRIVERS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_drivers_group

Функция **update_drivers_group** используется для создания, редактирования или удаления групп водителей.

svc=resource/update_drivers_group&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"callMode":&lt;text&gt;,  
"n":&lt;text&gt;,  
"d":&lt;text&gt;,  
"drs":\[&lt;uint&gt;\],  
"f":&lt;uint&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| id  | ID группы водителей. |
| callMode | Действие: создание, редактирование, удаление. |

Следующие параметры необходимы только для создания и удаления групп водителей:

|     |     |
| --- | --- |
| Название | Описание |
| n   | Имя. |
| d   | Описание. |
| drs | Массив ID водителей. |
| f   | Флаги. Не влияет на результат запроса. |

## Возвращаемый результат

Для запросов, связанных с созданием и редактированием:

\[  
&lt;long&gt;, /\* ID группы \*/  
{  
"id":&lt;long&gt;, /\* ID группы \*/  
"n":&lt;text&gt;, /\* имя \*/  
"d":&lt;text&gt;, /\* описание \*/  
"drs":\[&lt;uint&gt;\] /\* массив ID водителей \*/  
}  
\]

Для запросов, связанных с удалением:

\[  
&lt;long&gt;, /\* ID группы \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_DRIVERS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_email_template

Функция **update_email_template** используется для редактирования произвольного шаблона письма.

svc=resource/update_email_template&params={"resourceId":&lt;uint&gt;,  
"subject":"&lt;text&gt;",  
"body":"&lt;text&gt;",  
"flags":&lt;uint&gt;}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>resourceId</p></td><td><p>ID ресурса пользователя.</p></td></tr><tr><td><p>subject</p></td><td><p>Тема письма.</p></td></tr><tr><td><p>body</p></td><td><p>Тело письма.</p></td></tr><tr><td><p>flags</p></td><td><p>Использовать стандартный шаблон:</p><ul><li>0&nbsp;— да;</li><li>1&nbsp;— нет.</li></ul></td></tr></tbody></table></div>

В теме и тексте письма можно использовать следующие переменные:

|     |     |
| --- | --- |
| Название | Описание |
| %JOB_NOTIFICATION% | Имя задания или уведомления. |
| %ITEM% | Имя элемента в отчете. |
| %TEMPLATE% | Имя шаблона отчета. |
| %DATE_TIME% | Дата и время. |
| %LINK% | Ссылка для скачивания отчета. |

## Возвращаемый результат

{"error":0} /\* в случае успешного выполнения \*/

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_ITEM_VIEW_PROPERTIES и ADF_ACL_ITEM_EDIT_OTHER). |
| 6   | Не удалось обновить шаблон письма. |
| 4   | Неверные входные параметры. |

# update_job

Функция **update_job** используется для создания, редактирования или удаления заданий.

svc=resource/update_job&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"callMode":"&lt;text&gt;",  
"n":"&lt;text&gt;",  
"d":"&lt;text&gt;",  
"r":"&lt;text&gt;",  
"at":&lt;uint&gt;,  
"m":&lt;uint&gt;,  
"fl":&lt;uint&gt;, /\* Не требуется при создании, редактировании и удалении заданий. Используется для тестового выполнения. По умолчанию: 0 \*/  
"tz":&lt;int&gt;,  
"l":"&lt;text&gt;",  
"e":&lt;bool&gt;,  
"sch":{  
"f1":&lt;uint&gt;,  
"f2":&lt;uint&gt;,  
"t1":&lt;uint&gt;,  
"t2":&lt;uint&gt;,  
"m":&lt;uint&gt;,  
"y":&lt;uint&gt;,  
"w":&lt;uint&gt;  
},  
"act":{  
"t":"&lt;text&gt;",  
"p":{  
"&lt;text&gt;":"&lt;text&gt;",  
...  
}  
}}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| id  | ID задания (0 — создать). |
| callMode | Действие: создание, редактирование, удаление. |

Другие параметры необходимы только для создания и редактирования. См. страницу [**get_job_data**](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_job_data).

## Возвращаемый результат

Для запросов, связанных с созданием и редактированием:

\[  
&lt;long&gt;, /\* ID задания \*/  
{  
"id":&lt;long&gt;, /\* ID задания \*/  
"n":"&lt;text&gt;", /\* имя \*/  
"d":"&lt;text&gt;", /\* описание \*/  
"m":&lt;uint&gt;, /\* максимальное количество выполнений, 0 — не ограничено \*/  
"fl":&lt;uint&gt;, /\* удалить задание после достижения максимального количества выполнений, 1 — да. Не требуется при создании, редактировании и удалении заданий. Используется для тестового выполнения. \*/  
"st":{ /\* состояние \*/  
"e":&lt;uint&gt;, /\* включено/отключено \*/  
"c":&lt;uint&gt;, /\* количество выполнений \*/  
"l":&lt;uint&gt; /\* время последнего выполнения \*/  
},  
"act":"&lt;text&gt;", /\* действие \*/  
"ct":&lt;uint&gt;, /\* время создания \*/  
"mt":&lt;uint&gt; /\* время последнего изменения \*/  
}  
\]

Все доступные типы действий описаны [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_job_data#get_job_data-actiontypes).

Для запросов, связанных с удалением:

\[  
&lt;long&gt;, /\* ID задания \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_JOBS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_notification

Функция **update_notification** используется для создания, редактирования или удаления уведомлений.

svc=resource/update_notification&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;, /\* ID уведомления \*/  
"callMode":"&lt;text&gt;",  
"e":&lt;uint&gt;,  
"n":"&lt;text&gt;", /\* имя \*/  
"txt":"&lt;text&gt;", /\* текст уведомления \*/  
"ta":&lt;uint&gt;, /\* время активации (формат Unix) \*/  
"td":&lt;uint&gt;, /\* время деактивации (формат Unix) \*/  
"ma":&lt;uint&gt;, /\* максимальное количество срабатываний (0 — не ограничено) \*/  
"mmtd":&lt;uint&gt;, /\* максимальный временнóй интервал между сообщениями, сек. \*/  
"cdt":&lt;uint&gt;, /\* таймаут срабатывания, сек. \*/  
"mast":&lt;uint&gt;, /\* минимальная продолжительность тревожного состояния, сек. \*/  
"mpst":&lt;uint&gt;, /\* минимальная продолжительность предыдущего состояния, сек. \*/  
"cp":&lt;uint&gt;, /\* период контроля относительно текущего времени, сек. \*/  
"fl":&lt;uint&gt;, /\* флаги уведомления (см. ниже) \*/  
"tz":&lt;int&gt;, /\* временнáя зона \*/  
"la":"&lt;text&gt;", /\* язык пользователя (двухбуквенный код) \*/  
"un":\[&lt;long&gt;\], /\* массив ID объектов/групп объектов \*/  
"sch":{ /\* массив ID объектов/групп объектов \*/  
"f1":&lt;uint&gt;, /\* начало интервала 1 (количество минут от полуночи) \*/  
"f2":&lt;uint&gt;, /\* начало интервала 2 (количество минут от полуночи) \*/  
"t1":&lt;uint&gt;, /\* конец интервала 1 (количество минут от полуночи) \*/  
"t2":&lt;uint&gt;, /\* конец интервала 2 (количество минут от полуночи) \*/  
"m":&lt;uint&gt;, /\* маска дней месяца \[1: 2||0, 31: 2||30\] \*/  
"y":&lt;uint&gt;, /\* маска месяцев \[Jan: 2||0, Dec: 2||11\] \*/  
"w":&lt;uint&gt; /\* маска дней недели \[Mon: 2||0, Sun: 2||6\] \*/  
},  
"ctrl_sch":{ /\* расписание максимального количества интервалов срабатывания \*/  
"f1":&lt;uint&gt;, /\* начало интервала 1 (количество минут от полуночи) \*/  
"f2":&lt;uint&gt;, /\* начало интервала 2 (количество минут от полуночи) \*/  
"t1":&lt;uint&gt;, /\* конец интервала 1 (количество минут от полуночи) \*/  
"t2":&lt;uint&gt;, /\* конец интервала 2 (количество минут от полуночи) \*/  
"m":&lt;uint&gt;, /\* конец интервала 2 (количество минут от полуночи) \*/  
"y":&lt;uint&gt;, /\* маска месяцев \[Jan: 2||0, Dec: 2||11\] \*/  
"w":&lt;uint&gt; /\* маска дней недели \[Mon: 2||0, Sun: 2||6\] \*/  
},  
"trg":{ /\* контроль \*/  
"t":"&lt;text&gt;", /\* тип контроля (см. ниже) \*/  
"p":{ /\* параметры \*/  
"&lt;text&gt;":"&lt;text&gt;", /\* название параметра: значение \*/  
...  
}  
},  
"act":\[ /\* действия \*/  
{  
"t":"&lt;text&gt;", /\* тип действия (см. ниже) \*/  
"p":{ /\* параметры \*/  
"&lt;text&gt;":"&lt;text&gt;", /\* название параметра: значение \*/  
...  
}  
}  
\]}

Смотрите описание флагов уведомлений, типов действий и типов контроля на странице [get_notification_data](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_notification_data).

Для уведомления с [типом контроля **Простой**](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_notification_data#get_notification_data-idling_ru) значение параметра **mast** в секундах должно соответствовать параметру **min_idle_time** в минутах. Например, чтобы уведомление срабатывало после 10 минут простоя, укажите 10 в параметре **min_idle_time** и 600 в **mast**.

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>itemId</p></td><td><p>ID ресурса.</p></td></tr><tr><td><p>id</p></td><td><p>ID уведомления (0&nbsp;— создать).</p></td></tr><tr><td><p>callMode</p></td><td><p>Действие: создание, редактирование, удаление, включение/отключение (create, edit, delete, enable).</p></td></tr><tr><td><p>e</p></td><td><p>Используется только для действия включения/отключения (enable):</p><ul><li>0&nbsp;— отключить;</li><li>1&nbsp;— включить.</li></ul></td></tr></tbody></table></div>

Другие параметры необходимы только для создания и редактирования. См. страницу [**get_notification_data**](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_notification_data).

## Возвращаемый результат

Для запросов, связанных с созданием и редактированием:

\[  
&lt;long&gt;, /\* ID уведомления \*/  
{  
"id":&lt;long&gt;, /\* ID уведомления \*/  
"n":"&lt;text&gt;", /\* имя \*/  
"txt":"&lt;text&gt;", /\* текст уведомления \*/  
"ta":&lt;uint&gt;, /\* время активации (формат Unix) \*/  
"td":&lt;uint&gt;, /\* время деактивации (формат Unix) \*/  
"ma":&lt;uint&gt;, /\* максимальное количество срабатываний (0 — не ограничено) \*/  
"fl":&lt;uint&gt;, /\* флаги уведомлений \*/  
"ac":&lt;uint&gt;, /\* количество срабатываний \*/  
"un":\[&lt;long&gt;\], /\* массив ID объектов/групп объектов \*/  
"act":\["&lt;text&gt;"\], /\* действия \*/  
"trg":"&lt;text&gt;", /\* тип контроля \*/  
"trg_p":{}, /\* настройки контроля \*/  
"crc":&lt;long&gt;, /\* контрольная сумма бинарного представления уведомления \*/  
"ct":&lt;uint&gt;, /\* время создания \*/  
"mt":&lt;uint&gt; /\* время последнего изменения \*/  
}  
\]

Флаги уведомлений, типы действий и контроля описаны [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_notification_data).

Для запросов, связанных с удалением:

\[  
&lt;long&gt;, /\* ID уведомления \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_NF). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_orders_notification

Функция **update_orders_notification** используется для редактирования настроек шаблонов уведомлений о заявках.

svc=resource/update_orders_notification&params={"resourceId":&lt;long&gt;,  
"ordersNotification":&lt;JSON&gt;}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| resourceId | ID ресурса. |
| ordersNotification | Настройки шаблона уведомления в формате JSON. |

Ключи JSON:

{  
"sms":"&lt;text&gt;", /\* текст SMS-уведомления \*/  
"subj":"&lt;text&gt;", /\* тема электронного письма \*/  
"text":"&lt;text&gt;", /\* текст электронного письма \*/  
"html":&lt;uint&gt;, /\* текст электронного письма в формате HTML (1 — да) \*/  
"currency":"&lt;text&gt;", /\* валюта \*/  
"dns":"&lt;text&gt;", /\* адрес локатора (без http://) \*/  
"driverPushMsg":{ /\* настройки push-уведомлений для водителей \*/  
"crR":{  
"t":"&lt;text&gt;" /\* текст уведомления после создания нового маршрута \*/  
},  
"delR":{  
"t":"&lt;text&gt;" /\* текст уведомления после удаления маршрута \*/  
},  
"updC":{  
"t":"&lt;text&gt;" /\* текст уведомления после изменения контактной информации \*/  
},  
"attO":{  
"t":"&lt;text&gt;" /\* текст уведомления после прикрепления файлов \*/  
},  
"detO":{  
"t":"&lt;text&gt;" /\* текст уведомления после удаления файлов \*/  
},  
"updG":{  
"t":"&lt;text&gt;" /\* текст уведомления после изменения параметров заявки \*/  
},  
"vtD":{  
"t":"&lt;text&gt;" /\* текст уведомления после превышения времени доставки \*/  
},  
"utD":{  
"t":"&lt;text&gt;" /\* текст уведомления после превышения времени разгрузки \*/  
},  
"trk":{  
"t":"&lt;text&gt;" /\* текст уведомления в случае отклонения от маршрута \*/  
}  
"skp":{  
"t":"&lt;text&gt;" /\* текст уведомления в случае пропуска заявки \*/  
},  
"stO":{  
"t":"&lt;text&gt;" /\* текст уведомления в случае неподтверждения заявки курьером/диспетчером \*/  
}  
},  
}

Теги текста уведомления и темы электронного письма:

|     |     |
| --- | --- |
| Тег | Описание |
| %ORDER_NAME% | Имя заявки. |
| %ORDER_ARRIVAL_TIME% | Планируемое прибытие. |
| %ORDER_COST% | Стоимость заявки. |
| %ORDER_COMMENT% | Комментарий. |
| %LOCATOR_LINK% | Текущее местоположении. |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_ORDERS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_tag

Функция **update_tag** используется для создания, редактирования или удаления меток. Метки используются при назначении или снятии пассажиров.

svc=resource/update_tag&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"callMode":"&lt;text&gt;",  
"c":"&lt;text&gt;",  
"ck":&lt;short&gt;,  
"n":"&lt;text&gt;",  
"p":"&lt;text&gt;",  
"r":&lt;double&gt;,  
"tz":&lt;int&gt;,  
"f":&lt;int&gt;,  
"art":&lt;uint&gt;,  
"jp":{  
"&lt;text&gt;":"&lt;text&gt;",  
...  
}}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>itemId</p></td><td><p>ID ресурса.</p></td></tr><tr><td><p>id</p></td><td><p>ID метки. Для создания метки отправьте 0.</p></td></tr><tr><td><p>callMode</p></td><td><p>Режимы:</p><ul><li>создание (create);</li><li>редактирование (update);</li><li>удаление (delete);&nbsp;</li><li>удаление изображения (reset_image).</li></ul></td></tr></tbody></table></div>

Следующие параметры необходимы только для создания и редактирования меток:

|     |     |
| --- | --- |
| Название | Описание |
| c   | Код. |
| ck  | Контрольная сумма изображения метки. |
| n   | Имя метки. |
| p   | Телефонный номер в формате +1234567890. Должен быть закодирован в %2B. |
| tz  | Временнáя зона. |
| jp  | Произвольные поля в формате **"имя":"значение"**. |
| f   | Флаги (необязательно). По умолчанию — 0. |
| art | Время для автоматического снятия (необязательно). По умолчанию — 36000 (10 часов). |

## Возвращаемый результат

Для запросов, связанных с созданием и редактированием:

\[  
&lt;long&gt;, /\* ID метки \*/  
{  
"id":&lt;long&gt;, /\* ID \*/  
"n":"&lt;text&gt;", /\* имя \*/  
"c":"&lt;text&gt;", /\* код \*/  
"jp": { /\* произвольные поля \*/  
"&lt;text&gt;":"&lt;text&gt;", /\* "имя":"значение" \*/  
...  
},  
"r":&lt;double&gt;, /\* пропорции изображения метки \*/  
"ck":&lt;ushort&gt;, /\* контрольная сумма изображения метки \*/  
"f":&lt;ushort&gt;, /\* флаг в настоящее время не используется, значение по умолчанию = 1 \*/  
"bu":&lt;long&gt;, /\* назначенный объект \*/  
"pu":&lt;long&gt;, /\* предыдущий назначенный объект \*/  
"bt":&lt;uint&gt;, /\* время последнего назначения/снятия \*/  
"pos":{ /\* местоположение \*/  
"y":&lt;double&gt;, /\* широта \*/  
"x":&lt;double&gt; /\* долгота \*/  
}  
}  
\]

Для запросов, связанных с удалением:

\[  
&lt;long&gt;, /\* ID метки \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_TAGS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_tag_message

Функция **update_tag_message** используется для редактирования или удаления сообщения о прикреплении метки. Метки используются при назначении или снятии пассажиров.

 Работает только с [созданными ранее](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_tag_bindings) назначениями.

svc=resource/update_tag_message&params={"resourceId":&lt;long&gt;,  
"unitId":&lt;long&gt;,  
"tagId":&lt;long&gt;,  
"time":&lt;uint&gt;,  
"callMode":"&lt;text&gt;"}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| resourceId | ID ресурса. |
| unitId | ID объекта для изменения на назначение, 0 — для изменения на снятие.<br><br>Необходимо только для режима редактирования (update). |
| tagId | ID метки. |
| time | Время. |
| callMode | Режим: редактирование (update) или удаление (delete). |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_TAGS или ADF_ACL_ITEM_VIEW). |
| 4   | Неверные входные параметры. |
| 3   | Не удалось извлечь сообщения. |

# update_tag_units

Функция **update_tag_units** используется для изменения списка объектов, выбранных для автоматического назначения меток в ресурсе. Метки используются при назначении или снятии пассажиров.

svc=resource/update_tag_units&params={"itemId":&lt;long&gt;,  
"units":\[&lt;long&gt;\]}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| units | Массив ID объектов. |

## Возвращаемый результат

{  
"tagrun":\[&lt;long&gt;\] /\* массив объектов для автоматического назначения \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_TAGS). |
| 6   | Ошибка обновления. |
| 4   | Неверные входные параметры. |

# update_tags_group

Функция **update_tags_group** функция используется для создания, редактирования или удаления групп меток. Метки используются при назначении или снятии пассажиров.

svc=resource/update_tags_group&params={"itemId":&lt;uint&gt;,  
"id":&lt;uint&gt;,  
"callMode":"&lt;text&gt;",  
"n":"&lt;text&gt;",  
"d":"&lt;text&gt;",  
"tgs":\[&lt;uint&gt;,...\]}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| id  | ID группы меток. |
| callMode | Действие: создание, редактирование, удаление (create, update, delete). |

Следующие параметры необходимы только для создания и удаления групп меток:

|     |     |
| --- | --- |
| Название | Описание |
| n   | Имя. |
| d   | Описание. |
| trs | Массив ID меток. |

## Возвращаемый результат

Для запросов, связанных с созданием и редактированием:

\[  
&lt;long&gt;, /\* ID группы \*/  
{  
"id":&lt;long&gt;, /\* ID \*/  
"n":"&lt;text&gt;", /\* имя \*/  
"d":"&lt;text&gt;", /\* описание \*/  
"tgs":\[&lt;uint&gt;,...\] /\* массив ID меток \*/  
}  
\]

Для запросов, связанных с удалением:

\[  
&lt;long&gt;, /\* ID группы \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_TAGS). |
| 6   | Не удалось получить текущего пользователя или неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_trailer

Функция **update_trailer** используется для создания, редактирования или удаления прицепов.

svc=resource/update_trailer&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"callMode":"&lt;text&gt;",  
"ej":{ ... },  
"c":"&lt;text&gt;",  
"ds":"&lt;text&gt;",  
"n":"&lt;text&gt;",  
"f":&lt;uint&gt;,  
"jp":{  
"&lt;text&gt;":"&lt;text&gt;",  
...  
}}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>itemId</p></td><td><p>ID ресурса.</p></td></tr><tr><td><p>id</p></td><td><p>ID прицепа. Для создания прицепа отправьте 0.</p></td></tr><tr><td><p>callMode</p></td><td><p>Режимы:</p><ul><li>создание (create);</li><li>редактирование (update);</li><li>удаление (delete);&nbsp;</li><li>удаление изображения (reset_image).</li></ul></td></tr></tbody></table></div>

Следующие параметры необходимы только для создания и редактирования прицепов:

|     |     |
| --- | --- |
| Название | Описание |
| ej  | Расширенный JSON (необязательно). По умолчанию — **{ }**. |
| c   | Код. |
| ds  | Описание. |
| n   | Имя прицепа. |
| f   | Флаги. Сейчас не используются. |
| jp  | Произвольные поля в формате **"имя":"значения"**. Необязательно. По умолчанию — **{ }**. |

## Возвращаемый результат

Для запросов, связанных с созданием и редактированием:

\[  
&lt;long&gt;, /\* ID прицепа \*/  
{  
"id":&lt;long&gt;, /\* ID прицепа \*/  
"n":"&lt;text&gt;", /\* имя \*/  
"c":"&lt;text&gt;", /\* код \*/  
"ej":"&lt;text&gt;", /\* расширенный JSON \*/  
"jp": { /\* произвольные поля \*/  
"&lt;text&gt;":"&lt;text&gt;", /\* имя: значение \*/  
...  
},  
"ds":"&lt;text&gt;", /\* описание \*/  
"p":"&lt;text&gt;", /\* телефонный номер \*/  
"r":&lt;double&gt;, /\* пропорции изображения \*/  
"ck":&lt;ushort&gt; /\* контрольная сумма изображения \*/  
"bu":&lt;long&gt;, /\* назначенный объект \*/  
"pu":&lt;long&gt;, /\* предыдущий назначенный объект \*/  
"bt":&lt;uint&gt;, /\* время предыдущего назначения/снятия \*/  
"pos":{ /\* местоположение \*/  
"y":&lt;double&gt;, /\* широта \*/  
"x":&lt;double&gt; /\* долгота \*/  
}  
}  
\]

Для запросов, связанных с удалением:

\[  
&lt;long&gt;, /\* ID прицепа \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_TRAILERS). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_trailer_units

Функция **update_trailer_units** используется для редактирования списка объектов, выбранных для автоматического назначения прицепов.

svc=resource/update_trailer_units&params={"itemId":&lt;long&gt;,  
"units":\[&lt;long&gt;\]}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| units | Массив ID объектов. |

## Возвращаемый результат

{  
"trlrun":\[&lt;long&gt;\] /\* массив объектов для автоматического назначения \*/  
}

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_TRAILERS). |
| 6   | Ошибка обновления или неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_zone

Функция **update_zone** используется для создания, редактирования или удаления геозон.

svc=resource/update_zone&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"callMode":"&lt;text&gt;",  
"n":"&lt;text&gt;",  
"d":"&lt;text&gt;",  
"t":&lt;int&gt;,  
"w":&lt;int&gt;,  
"f":&lt;uint&gt;,  
"c":&lt;int&gt;,  
"tc":&lt;uint&gt;,  
"ts":&lt;uint&gt;,  
"min":&lt;uint&gt;,  
"max":&lt;uint&gt;,  
"path":"&lt;text&gt;",  
"libId":&lt;long&gt;,  
"oldItemId":&lt;uint&gt;,  
"oldZoneId":&lt;uint&gt;,  
"jp":&lt;JSON&gt;,  
"p":\[  
{  
"x":&lt;double&gt;,  
"y":&lt;double&gt;,  
"r":&lt;int&gt;  
}  
\]}

## Параметры

<div class="joplin-table-wrapper"><table><tbody><tr><td><p>Название</p></td><td><p>Описание</p></td></tr><tr><td><p>itemId</p></td><td><p>ID ресурса.</p></td></tr><tr><td><p>id</p></td><td><p>ID геозоны (0&nbsp;—&nbsp;создать).</p></td></tr><tr><td><p>callMode</p></td><td><p>Действие: создание, редактирование, удаление, удаление изображения (create, update, delete, reset_image).</p></td></tr><tr><td><p>oldItemId</p></td><td><p>ID ресурса, из которого необходимо скопировать геозону.</p></td></tr><tr><td><p>oldZoneId</p></td><td><p>ID геозоны, которую необходимо скопировать.</p></td></tr><tr><td><p>n</p></td><td><p>Имя.</p></td></tr><tr><td><p>d</p></td><td><p>Описание.</p></td></tr><tr><td><p>t</p></td><td><p>Тип геозоны:&nbsp;</p><ul><li>1&nbsp;— линия;</li><li>2&nbsp;— полигон;</li><li>3 — круг.</li></ul></td></tr><tr><td><p>w</p></td><td><p>Толщина линии.</p></td></tr><tr><td><p>f</p></td><td><p>Флаги (см. ниже).</p></td></tr><tr><td><p>c</p></td><td><p>Цвет.</p></td></tr><tr><td><p>tc</p></td><td><p>Цвет текста.</p></td></tr><tr><td><p>ts</p></td><td><p>Размер текста.</p></td></tr><tr><td><p>min</p></td><td><p>Минимальный масштаб (видимость от).</p></td></tr><tr><td><p>max</p></td><td><p>Максимальный масштаб (видимость до).</p></td></tr><tr><td><p>path</p></td><td><p>Путь к иконке.</p></td></tr><tr><td><p>lindId</p></td><td><p>ID библиотеки иконок.</p></td></tr><tr><td><p>jp</p></td><td><p>Произвольные поля в формате <strong>имя:значение</strong>.</p></td></tr><tr><td><p>p</p></td><td><p>Точки, где&nbsp;"r"&nbsp;— радиус.</p></td></tr></tbody></table></div>

 Если необходимо скопировать (и одновременно редактировать) геозону, используйте параметры **oldItemId** и **oldZoneId**, чтобы указать ее.

Другие параметры необходимы только для создания и редактирования геозон. См. подробнее на странице [**get_zone_data**](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_zone_data).

Флаги:

|     |     |
| --- | --- |
| Флаг | Описание |
| 0х1 | Адрес. |
| 0x2 | Начало поездки. |
| 0x4 | Конец поездки. |
| 0x10 | Сделать перемещаемой. |
| 0x20 | Показать форму. |
| 0x40 | Не минифицировать. |

## Возвращаемый результат

Для запросов, связанных с созданием и редактированием:

\[  
&lt;long&gt;, /\* ID геозоны \*/  
{  
"n":"&lt;text&gt;", /\* имя \*/  
"d":"&lt;text&gt;", /\* описание \*/  
"id":&lt;long&gt;, /\* ID геозоны \*/  
"f":&lt;uint&gt;, /\* флаги \*/  
"t":&lt;int&gt;, /\* тип: 1 — линия, 2 — полигон, 3 — круг \*/  
"e":&lt;ushort&gt; /\* контрольная сумма (CRC16) \*/  
"c":&lt;uint&gt;, /\* цвет RGB \*/  
"i":&lt;ushort&gt;, /\* контрольная сумма изображения (CRC16) \*/  
"icon":"&lt;text&gt;", /\* URI изображения иконки \*/  
"path":"&lt;text&gt;", /\* короткий путь до иконки по умолчанию \*/  
"libId":&lt;long&gt;, /\* ID библиотеки иконок, 0 — ID библиотеки иконок по умолчанию \*/  
"w":&lt;int&gt;, /\* толщина линии \*/  
"b":{ /\* конфигурация для отрисовки \*/  
"min_x":&lt;double&gt;, /\* минимальная долгота \*/  
"min_y":&lt;double&gt;, /\* минимальная широта \*/  
"max_x":&lt;double&gt;, /\* максимальная долгота \*/  
"max_y":&lt;double&gt;, /\* максимальная широта \*/  
"cen_x":&lt;double&gt;, /\* долгота центра \*/  
"cen_y":&lt;double&gt; /\* широта центра \*/  
},  
"ct":&lt;uint&gt;, /\* время создания \*/  
"mt":&lt;uint&gt;, /\* время последнего изменения \*/  
"jp":&lt;JSON&gt; /\* произвольный JSON \*/  
}  
\]

Флаги геозон описаны на странице [**get_zone_data**](https://help.wialon.com/ru/api/user-guide/api-reference/resource/get_zone_data).

Для запросов, связанных с удалением:

\[  
&lt;long&gt;, /\* ID геозоны \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с необходимым ACL (ADF_ACL_AVL_RES_EDIT_ZONES или ADF_ACL_AVL_RES_VIEW_ZONES) или не удалось найти элемент/геозону с **old_id**. |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# update_zones_group

Функция **update_zones_group** используется для создания, редактирования или удаления групп геозон.

svc=resource/update_zones_group&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"callMode":"&lt;text&gt;",  
"n":"&lt;text&gt;",  
"d":"&lt;text&gt;",  
"zns":\[&lt;uint&gt;\]}

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| id  | ID группы геозон. |
| callMode | Действие: создание, редактирование, удаление (create, update, delete). |

Следующие параметры необходимы только для создания и удаления групп геозон:

|     |     |
| --- | --- |
| Название | Описание |
| n   | Имя. |
| d   | Описание. |
| trs | Массив ID геозон. |

## Возвращаемый результат

Для запросов, связанных с созданием и редактированием:

\[  
&lt;long&gt;, /\* ID группы \*/  
{  
"id":&lt;long&gt;, /\* ID группы \*/  
"n":"&lt;text&gt;", /\* имя \*/  
"d":"&lt;text&gt;", /\* описание \*/  
"zns":\[&lt;uint&gt;\] /\* массив ID геозон \*/  
}  
\]

Для запросов, связанных с удалением:

\[  
&lt;long&gt;, /\* ID группы \*/  
null  
\]

Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь ресурс с требуемым ACL (ADF_ACL_AVL_RES_EDIT_ZONES). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

# upload_driver_image

Функция **upload_driver_image** используется для прикрепления изображения к водителю.

svc=resource/upload_driver_image&params={"itemId":&lt;long&gt;,  
"driverId":&lt;long&gt;,  
"eventHash":"&lt;text&gt;",  
"oldItemId":&lt;long&gt;,  
"oldDrvId":&lt;uint&gt;}  
&sid="&lt;text&gt;"

 Чтобы удалить изображения, используйте функцию [**update_driver**](https://help.wialon.com/ru/api/user-guide/api-reference/resource/update_driver).

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| driverId | ID водителя. |
| eventHash | Имя события, которое должно быть сгенерировано после прикрепления изображения. Необязательный параметр. |
| oldItemId | ID ресурса, из которого должно быть скопировано изображение водителя. Необязательный параметр. |
| oldTagId | ID водителя, изображение которого должно быть скопировано. Необязательный параметр. |

Чтобы загрузить изображение, используйте запрос POST (multipart/form-data), в котором в одной части содержатся параметры, а в другой — изображение.

Пример:

Request URL: https://hst-api.wialon.com/wialon/ajax.html?svc=resource/upload_driver_image  
Request Method: POST  
Host: hst-api.wialon.com  
Connection: keep-alive  
Content-Length: 31755  
Cache-Control: no-cache  
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryB4wasXYYHLTNXHBl  
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8  
Accept-Charset: windows-1251,utf-8;q=0.7,\*;q=0.3  
Accept-Encoding: gzip,deflate,sdch  
Accept-Language: ru,en-US;q=0.8,en;q=0.6  
<br/>\------WebKitFormBoundaryB4wasXYYHLTNXHBl  
Content-Disposition: form-data; name="params"  
<br/>{"itemId":717314,"driverId":17,"eventHash":"jUploadForm1372768554999"}  
\------WebKitFormBoundaryB4wasXYYHLTNXHBl  
Content-Disposition: form-data; name="eventHash"  
<br/>jUploadForm1372768554999  
\------WebKitFormBoundaryB4wasXYYHLTNXHBl  
Content-Disposition: form-data; name="drivers_dlg_props_upload_image"; filename="image.jpg"  
Content-Type: image/jpeg  
<br/>\------WebKitFormBoundaryB4wasXYYHLTNXHBl--

Также можно скопировать изображение из другого водителя. Для этого выполните запрос без изображения, но с полями **oldItemId** и **oldDrvId**.

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_AVL_RES_EDIT_DRIVERS) или не удалось найти элемент/водителя с **old_id** (при копировании изображения из другого водителя). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

Чтобы убедиться, что изображение загружено, выполните запрос [**avl_evts**](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_evts):

{  
"tm":&lt;uint&gt;, /\* текущее время сервера (UTC) \*/  
"events":\[  
{  
"i":&lt;long&gt;, /\* ID водителя (-1, если неизвестно) \*/  
"d":{ /\* данные \*/  
"hash":"&lt;text&gt;" /\* загрузка завершена \*/  
}  
}  
\]  
}

# upload_tag_image

Функция **upload_tag_image** используется для прикрепления изображения к метке. Метки используются при назначении или снятии пассажиров.

svc=resource/upload_tag_image&params={"itemId":&lt;long&gt;,  
"tagId":&lt;long&gt;,  
"eventHash":"&lt;text&gt;",  
"oldItemId":&lt;long&gt;,  
"oldTagId":&lt;uint&gt;}  
&sid="&lt;text&gt;"

 Чтобы удалить изображение, используйте функцию [**update_tag**](https://help.wialon.com/ru/api/user-guide/api-reference/resource/update_tag).

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| tagId | ID метки. |
| eventHash | Имя события, которое должно быть сгенерировано после прикрепления изображения. Необязательный параметр. |
| oldItemId | ID ресурса, из которого должно быть скопировано изображение метки (пассажира). Необязательный параметр. |
| oldTagId | ID метки, изображение которой должно быть скопировано. Необязательный параметр. |

Чтобы загрузить изображение, используйте запрос POST (multipart/form-data), где в одной части содержатся параметры, а в другой — изображение.

Пример:

Request URL: https://hst-api.wialon.com/wialon/ajax.html?svc=resource/upload_tag_image  
Request Method: POST  
Host: hst-api.wialon.com  
Connection: keep-alive  
Content-Length: 31755  
Cache-Control: no-cache  
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryB4wasXYYHLTNXHBl  
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8  
Accept-Charset: windows-1251,utf-8;q=0.7,\*;q=0.3  
Accept-Encoding: gzip,deflate,sdch  
Accept-Language: ru,en-US;q=0.8,en;q=0.6  
<br/>\------WebKitFormBoundaryB4wasXYYHLTNXHBl  
Content-Disposition: form-data; name="params"  
<br/>{"itemId":717314,"tagId":17,"eventHash":"jUploadForm1372768554999"}  
\------WebKitFormBoundaryB4wasXYYHLTNXHBl  
Content-Disposition: form-data; name="eventHash"  
<br/>jUploadForm1372768554999  
\------WebKitFormBoundaryB4wasXYYHLTNXHBl  
Content-Disposition: form-data; name="tags_dlg_props_upload_image"; filename="image.jpg"  
Content-Type: image/jpeg  
<br/>\------WebKitFormBoundaryB4wasXYYHLTNXHBl--

Также можно скопировать изображение из другой метки (пассажира). Для этого выполните запрос без изображения, но с полями **oldItemId** и **oldTagId**.

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Code | Description |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_AVL_RES_EDIT_TAGS) или не удалось найти элемент/метку с **old_id** (при копировании изображения из другой метки). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

Чтобы убедиться, что изображение загружено, выполните запрос [**avl_evts**](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_evts):

{  
"tm":&lt;uint&gt;, /\* текущее время сервера (UTC) \*/  
"events":\[  
{  
"i":&lt;long&gt;, /\* ID метки (-1, если неизвестно) \*/  
"d":{ /\* данные \*/  
"hash":"&lt;text&gt;" /\* загрузка завершена \*/  
}  
}  
\]  
}

# upload_trailer_image

Функция **upload_trailer_image** используется для прикрепления изображения к прицепу.

svc=resource/upload_trailer_image&params={"itemId":&lt;long&gt;,  
"trailerId":&lt;long&gt;,  
"eventHash":"&lt;text&gt;",  
"oldItemId":&lt;long&gt;,  
"oldTrId":&lt;uint&gt;}  
&sid="&lt;text&gt;"

 Чтобы удалить изображения, используйте функцию [**update_trailer**](https://help.wialon.com/ru/api/user-guide/api-reference/resource/update_trailer).

## Параметры

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID ресурса. |
| trailerId | ID прицепа. |
| eventHash | Имя события, которое должно быть сгенерировано после прикрепления изображения. Необязательный параметр. |
| oldItemId | ID ресурса, из которого должно быть скопировано изображение прицепа. Необязательный параметр. |
| oldTagId | ID прицепа, изображение которого должно быть скопировано. Необязательный параметр. |

Чтобы загрузить изображение, используйте запрос POST (multipart/form-data), в котором в одной части содержатся параметры, а в другой — изображение.

Пример:

Request URL:https: //hst-api.wialon.com/wialon/ajax.html?svc=resource/upload_trailer_image  
Request Method: POST  
Host: hst-api.wialon.com  
Connection: keep-alive  
Content-Length: 31756  
Cache-Control: no-cache  
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryLjl26xgAWBYzO713  
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8  
Accept-Charset: windows-1251,utf-8;q=0.7,\*;q=0.3  
Accept-Encoding: gzip,deflate,sdch  
Accept-Language: ru,en-US;q=0.8,en;q=0.6  
<br/>\------WebKitFormBoundaryLjl26xgAWBYzO713  
Content-Disposition: form-data; name="params"  
<br/>{"itemId":717314,"trailerId":6,"eventHash":"jUploadForm1372768935931"}  
\------WebKitFormBoundaryLjl26xgAWBYzO713  
Content-Disposition: form-data; name="eventHash"  
<br/>jUploadForm1372768935931  
\------WebKitFormBoundaryLjl26xgAWBYzO713  
Content-Disposition: form-data; name="trailers_dlg_props_upload_image"; filename="image.jpg"  
Content-Type: image/jpeg  
<br/><br/>\------WebKitFormBoundaryLjl26xgAWBYzO713--

Также можно скопировать изображение из другого прицепа. Для этого выполните запрос без изображения, но с полями **oldItemId** и **oldTagId**.

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_AVL_RES_EDIT_TRAILERS) или не удалось найти элемент/прицеп с **old_id** (при копировании изображения из другого прицепа). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

Чтобы убедиться, что изображение загружено, выполните запрос [**avl_evts**](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_evts)**:**

{  
"tm":&lt;uint&gt;, /\* текущее время сервера (UTC) \*/  
"events":\[  
{  
"i":&lt;long&gt;, /\* ID прицепа (-1, если неизвестно) \*/  
"d":{ /\* данные \*/  
"hash":"&lt;text&gt;" /\* загрузка завершена \*/  
}  
}  
\]  
}

# upload_zone_image

Функция **upload_zone_image** используется для прикрепления изображения к геозоне и для копирования изображения из одной геозоны в другую.

svc=resource/upload_zone_image&params={"itemId":&lt;long&gt;,  
"id":&lt;long&gt;,  
"eventHash":&lt;text&gt;,  
"oldItemId":&lt;long&gt;,  
"oldZoneId":&lt;uint&gt;}  
&sid="&lt;text&gt;"

Чтобы удалить изображение, используйте функцию [**update_zone**](https://help.wialon.com/ru/api/user-guide/api-reference/resource/update_zone).

Чтобы получить изображение, используйте функцию [**avl_zone_image**](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_zone_image).

## Параметры

|     |     |
| --- | --- |
| Name | Description |
| itemId | ID ресурса. |
| id  | ID геозоны. |
| eventHash | Имя события, которое должно быть сгенерировано после прикрепления изображения. |
| oldItemId | ID ресурса геозоны, изображение которой должно быть применено. Необязательный параметр. |
| oldZoneId | ID геозоны, изображение которой должно быть применено. Необязательный параметр. |

Чтобы загрузить изображение, используйте запрос POST (multipart/form-data), в котором в одной части содержатся параметры, а в другой — изображение.

Пример:

Request URL: https://hst-api.wialon.com/wialon/ajax.html?svc=resource/upload_zone_image  
Request Method: POST  
Host: hst-api.wialon.com  
Connection: keep-alive  
Content-Length: 31753  
Cache-Control: no-cache  
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryX2W1y7AVnQkXQAM0  
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8  
Accept-Charset: windows-1251,utf-8;q=0.7,\*;q=0.3  
Accept-Encoding: gzip,deflate,sdch  
Accept-Language: ru,en-US;q=0.8,en;q=0.6  
<br/>\------WebKitFormBoundaryX2W1y7AVnQkXQAM0  
Content-Disposition: form-data; name="params"  
<br/>{"itemId":717314,"id":1,"eventHash":"jUploadForm1372768029714"}  
\------WebKitFormBoundaryX2W1y7AVnQkXQAM0  
Content-Disposition: form-data; name="eventHash"  
<br/>jUploadForm1372768029714  
\------WebKitFormBoundaryX2W1y7AVnQkXQAM0  
Content-Disposition: form-data; name="zone_create_upload_image"; filename="zZeVUgLEJXE.jpg"  
Content-Type: image/jpeg  
<br/>\------WebKitFormBoundaryX2W1y7AVnQkXQAM0--

Также можно скопировать изображение из одной геозоны в другую. Для этого выполните запрос без изображения, но с полями **oldItemId** и **oldZoneId.**

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой JSON.

{ }

В противном случае возвращается код ошибки. Возможные коды ошибок:

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Не удалось извлечь элемент с требуемым ACL (ADF_ACL_AVL_RES_EDIT_ZONES) или не удалось найти элемент/геозону с **oldItemId** or **oldZoneId** (при копировании изображения из одной геозоны в другую). |
| 6   | Неопределенная ошибка. |
| 4   | Неверные входные параметры. |

Чтобы убедиться, что изображение загружено, выполните запрос [**avl_evts**](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/avl_evts):

{  
"tm":&lt;uint&gt;, /\* текущее время сервера (UTC) \*/  
"events":\[  
{  
"i":&lt;long&gt;, /\* ID геозоны (-1, если неизвестно) \*/  
"d":{ /\* данные \*/  
"hash":&lt;text&gt; /\* загрузка завершена \*/  
}  
}  
\]  
}

# retranslator

В этом разделе описаны методы для работы с ретрансляторами. О создании ретрансляторов читайте [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/item/add_log_record).

# update_config

Для обновления конфигурации ретранслятора используйте метод **retranslator/update_config**:

svc=retranslator/update_config&params={"itemId":&lt;long&gt;,  
"config":{  
"protocol":&lt;text&gt;,  
"server":&lt;text&gt;,  
"port":&lt;ushort&gt;,  
"v6type":&lt;text&gt;,  
"auth":&lt;text&gt;,  
"attach_sensors":&lt;bool&gt;,  
"ssl":&lt;text&gt;,  
"login":&lt;text&gt;,  
"password":&lt;text&gt;,  
"notauth":&lt;int&gt;  
}}

## Параметры

Запрос может содержать следующие параметры. Обязательные параметры отмечены звездочкой (\*).

| Название | Описание |
| --- | --- |
| itemId\* | ID ретранслятора. |
| config\* | Конфигурация. Набор параметров в объекте **config** зависит от типа протокола. |
| protocol\* | Название протокола (см. [ниже](#protocols)). |
| server\* | Сервер для ретрансляции. |
| port\* | Порт (для всех протоколов кроме NIS) |
| v6type\* | Использовать протокол v.6 (только для Granit Navigator):<br><br>1 — да<br><br>0 — нет |
| auth\* | Авторизация (только для NIS и Wialon IPS) |
| attach_sensors | Ретранслировать рассчитанные значения датчиков (для Wialon IPS и Wialon Retranslator)<br><br>1 — да<br><br>0 — нет |
| ssl\* | Защищенное соединение (для NIS):<br><br>1 — да<br><br>0 — нет |
| login\* | Логин. |
| password\* | Пароль. |
| notauth\* | Отключить авторизацию (только для EGTS):<br><br>1 — да<br><br>0 — нет |

### Протоколы

| Значение | Протокол |
| --- | --- |
| **wialon** | Wialon Retranslator |
| **wialon_ips** | Wialon IPS |
| **nis** | Nis |
| **granit3** | Granit Navigator |
| **skaut** | Skaut |
| **cyber_glx** | Cyber GLX |
| **vt300** | VT300 |
| **egts** | EGTS |
| **soap** | SOAP |

## Ответ

В случае успешного выполнения запроса возвращается ответ следующего формата:

{  
"rtrc":{  
"port":&lt;ushort&gt;, /\* Порт (для всех кроме NIS). \*/  
"protocol":&lt;text&gt;, /\* Протокол. \*/  
"server":&lt;text&gt;, /\* Сервер для ретрансляции. \*/  
"v6type":&lt;text&gt;, /\* Протокол v.6 (только для Granit Navigator): 1 — да, 0 — нет. \*/  
"auth":&lt;text&gt;, /\* Авторизация (только для NIS и Wialon IPS). \*/  
"ssl":&lt;text&gt;, /\* Защищенное соединение (для NIS): 1 — да, 0 — нет \*/  
"login":&lt;text&gt;, /\* Логин. \*/  
"password":&lt;text&gt;, /\* Пароль. \*/  
"notauth":&lt;int&gt; /\* Отключить авторизацию (только для EGTS): 0 — нет, 1 — да. \*/  
}  
}

В противном случае возвращается код ошибки.

### Коды ошибок

| Код ошибки | Описание |
| --- | --- |
| 4   | Не удалось разобрать входные параметры или не удалось установить конфигурацию. |
| 7   | Отсутствует право доступа **ADF_ACL_AVL_RETR_EDIT_SETTINGS** на ретранслятор. |
| 6   | Не удалось сгенерировать ответ. |

# get_stats

Для получения данных о состоянии ретрансляции истории используйте команду **retranslator/get_stats**.

svc=retranslator/get_stats&params={"itemId":&lt;long&gt;}

## Параметры

Запрос должен содержать параметр **itemId**, указывающий ID ретранслятора.

## Ответ

В случае успешного выполнения запроса возвращается ответ следующего формата:

{  
"au": &lt;long&gt;, /\* Количество элементов, которые были добавлены в ретранслятор или удалены из него напрямую. \*/  
"ru": &lt;long&gt;, /\* Количество элементов в очереди на ретрансляцию истории \*/  
"hf": &lt;long&gt;, /\* Время начала ретрансляции. \*/  
"ht": &lt;long&gt; /\* Время окончания ретрансляции. \*/  
"hc": &lt;uint&gt;, /\* Время последнего ретранслированного сообщения. \*/  
"hms": &lt;uint&gt;, /\* Текущая очередь исторических сообщений. \*/  
"hp": &lt;uint&gt;, /\* Процент выполнения. \*/  
}

В противном случае возвращается код ошибки.

### Коды ошибок

| Код ошибки | Описание |
| --- | --- |
| 7   | Отсутствует право доступа **ADF_ACL_AVL_RETR_EDIT_SETTINGS** к ретранслятору. |
| 4   | Неверные входные параметры. |

# list

Для получения списка пользовательских ретрансляторов используйте метод **retranslator/list**.

svc=retranslator/list&params={}

## Параметры

Параметры не требуются. Передайте пустой объект в запросе.

## Ответ

В случае успешного выполнения запроса возвращается ответ следующего формата:

{  
"custom_retranslators": \[  
{  
"name": "apad_gps",  
"params": {  
"fields": \[  
{  
"key": "server",  
"type": "name"  
},  
{  
"key": "api_key",  
"type": "name"  
},  
{  
"key": "password",  
"type": "name"  
}  
\],  
"name": "APAD GPS",  
"public": 1  
}  
},  
{  
"name": "blac_solutions",  
"params": {  
"fields": \[  
{  
"key": "server",  
"type": "name"  
},  
{  
"key": "username",  
"type": "name"  
},  
{  
"key": "password",  
"type": "name"  
}  
\],  
"name": "Blac Solutions IQER",  
"public": 1  
}  
},  
...  
\]  
}

В противном случае возвращается код ошибки.

### Коды ошибок

| Код ошибки | Описание |
| --- | --- |
| 5   | Не удалось получить пользовательские ретрансляторы. |
| 6   | У пользователя нет прав на выполнение метода. |

# update_units

Для добавления объектов в ретранслятор или их удаления используйте метод **retranslator/update_units**.

svc=retranslator/update_units&params={"itemId":&lt;long&gt;,  
"units":\[{"a":&lt;text&gt;,  
"i":&lt;long&gt;,  
"st":&lt;uint&gt;}, ...\],  
"callMode":&lt;text&gt;  
}

Установите callMode в значение add и включите описание для каждого объекта в массиве units.

## Параметры

Запрос может содержать следующие параметры. Обязательные параметры отмечены звездочкой (\*).

| Название | Описание |
| --- | --- |
| itemId\* | ID ретранслятора. |
| units\* | Массив ID объектов для ретрансляции. |
| i\* | ID объекта. |
| a\* | Уникальный ID оборудования. |
| st  | Время, когда ретрансляция останавливается. |
| callMode | Режим: добавить или удалить. |

## Ответ

{  
"rtru":\[  
{  
"i":&lt;long&gt;, /\* ID объекта. \*/  
"a":&lt;text&gt;, /\* Уникальный ID оборудования. \*/  
"st":&lt;uint&gt; /\* Время, когда ретрансляция останавливается. \*/  
}  
\]  
}

В противном случае возвращается код ошибки.

### Коды ошибок

| Код ошибки | Описание |
| --- | --- |
| 7   | Отсутствует право доступа **ADF_ACL_AVL_RETR_EDIT_SETTINGS** к ретранслятору. |
| 4   | Не удалось обработать текст или отсутствуют текущие объекты ретранслятора. |
| 6   | Не удалось сгенерировать ответ. |

# update_operating

Для запуска или остановки ретранслятора или ретрансляции за прошедший период используйте команду **retranslator/update_operating**:

svc=retranslator/update_operating&params={"itemId":&lt;long&gt;,  
"operate":&lt;bool&gt;,  
"stopTime":&lt;uint&gt;,  
"timeFrom":&lt;uint&gt;,  
"timeTo":&lt;uint&gt;,  
"callMode":&lt;text&gt;  
}

## Параметры

Запрос может содержать следующие параметры. Обязательные параметры отмечены звездочкой (\*).

| Название | Описание |
| --- | --- |
| itemId\* | ID ретранслятора. |
| operate\* | Запуск или остановка ретрансляции:  <br><br>True — запуск<br><br>false — остановка |
| stopTime | Время, когда ретрансляция будет остановлена. |
| timeFrom\* | Начало ретрансляции истории, время UNIX (только для истории). |
| timeTo\* | Окончание ретрансляции истории, время UNIX (только для истории). |
| callMode\* | Установите callMode в значение Switch для запуска или остановки ретранслятора. Установите callMode в значение History для запуска или остановки ретрансляции за прошедший период. |

## Ответ

В случае успешного выполнения запроса возвращается ответ следующего формата:

{  
"rtro":&lt;int&gt; /\* 0 — остановлен, 1 — запущен \*/  
"rtrst":&lt;uint&gt; /\* Время, когда ретрансляция останавливается. \*/  
}

В противном случае возвращается код ошибки.

### Коды ошибок

| Код ошибки | Описание |
| --- | --- |
| 7   | Отсутствует право доступа **ADF_ACL_AVL_RETR_EDIT_SETTINGS** к ретранслятору. |
| 4   | Неверные входные параметры или не удалось запустить/остановить ретранслятор. |

# route

В этом разделе описаны функции, которые можно применить к маршрутам. О создании маршрутов читайте [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/core/create_route).

# unit_group

В этом разделе описаны функции, которые можно применить к группам объектов. О создании групп объектов читайте [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/core/create_unit_group).

# update_units

Чтобы добавить объекты в группу или убрать их из нее, используйте команду **unit_group/update_units**:

svc=unit_group/update_units&params={"itemId":&lt;long&gt;,  
"units":\[&lt;long&gt;\]}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Опсание |
| itemId\* | ID группы объектов. |
| units\* | Массив ID объектов. |

Параметр **units** должен содержать ID как уже добавленных объектов, так и тех, которые необходимо добавить. Чтобы убрать объект из группы, необходимо указать ID только тех объектов, которые должны в ней остаться.

## Возвращаемый результат

Если запрос выполнен успешно, возвращается следующий результат:

{  
"u":\[&lt;long&gt;\] /\* массив ID объектов \*/  
}

В обратном случае возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Error code | Description |
| 7   | Не удалось извлечь элемент с ACL(ADF_ACL_ITEM_EDIT_SUB_ITEMS) или проверить сессию. |
| 6   | Не удалось записать новый список объектов. |
| 4   | Неверные вводные параметры (объекты). |

# unit

В этом разделе описаны функции для работы с объектами. О создании объектов читайте [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/core/create_unit).

# update_health_check

Чтобы указать настройки диагностики устройства, используйте метод **unit/update_health_check**.

svc=unit/update_health_check&params={  
"itemId":&lt;long&gt;,  
"settings":&lt;text&gt;  
}

## Параметры

В запросе должны содержаться следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID объекта. |
| settings | JSON с параметрами настроек для диагностики устройства. См. ниже. |

## Пример JSON

Ниже приведен пример JSON-объекта с параметрами настроек для диагностики устройств.

"settings": {  
"low_battery": {  
"period": "1h",  
"unhealthy_conditions": \[  
{  
"type": "less", // less (меньше), greater(больше), equal (равно), not_equal (не равно), unchanged (не изменяется)  
"value": 20.0  
}  
\]  
},  
"max_messages_last_hour": {  
"period": "1m",  
"unhealthy_conditions": \[  
{  
"type": "greater", // less (меньше), greater(больше), equal (равно), not_equal (не равно), unchanged (не изменяется)  
"value": 1000.0  
}  
\]  
},  
"no_data": {  
"period": "1d"  
},  
"missing_position_data": {  
"period": "1m"  
},  
"insufficient_satellite_coverage": {  
"period": "1m",  
"unhealthy_conditions": \[  
{  
"type": "less", // less (меньше), greater(больше), equal (равно), not_equal (не равно), unchanged (не изменяется)  
"value": 4.0  
}  
\]  
},  
"max_distance_between_messages": {  
"period": "1h",  
"unhealthy_conditions": \[  
{  
"type": "greater", // less (меньше), greater(больше), equal (равно), not_equal (не равно), unchanged (не изменяется)  
"value": 100000.0 // m  
}  
\]  
},  
"sensor": {  
<br/>"items": \[  
{  
"id": 1, // напряжение  
"period": "1m",  
"unhealthy_conditions": \[  
{  
"type": "less", // less (меньше), greater(больше), equal (равно), not_equal (не равно), unchanged (не изменяется)  
"value": 12.0  
},  
{  
"type": "greater", // less (меньше), greater(больше), equal (равно), not_equal (не равно), unchanged (не изменяется)  
"value": 13.0  
}  
\]  
},  
{  
"id": 3, // топливо  
"period": "1m",  
"unhealthy_conditions": \[  
{  
"type": "unchanged", // less (меньше), greater(больше), equal (равно), not_equal (не равно), unchanged (не изменяется)  
"value": 0.0 // не парсить  
}  
\]  
},  
{  
"id": 2, // цифровой датчик (зажигание)  
"period": "1m",  
"unhealthy_conditions": \[  
{  
"type": "equal", // equal (равно), not_equal (не равно)  
"value": 0.0 // 0.0 - выкл., 1.0 - вкл.  
}  
\]  
}  
\]  
}  
}

## Пример

Ниже приведен пример запроса **unit/update_health_check**.

svc=unit/update_health_check&params={  
"itemId": 1583,  
"settings": {  
"low_battery": {  
"period": "1h",  
"unhealthy_conditions": \[  
{  
"type": "less",  
"value": 20.0  
}  
\]  
},  
"max_messages_last_hour": {  
"period": "1m",  
"unhealthy_conditions": \[  
{  
"type": "greater",  
"value": 1000.0  
}  
\]  
},  
"no_data": {  
"period": "1d"  
},  
"missing_position_data": {  
"period": "1m"  
},  
"insufficient_satellite_coverage": {  
"period": "1m",  
"unhealthy_conditions": \[  
{  
"type": "less",  
"value": 4.0  
}  
\]  
},  
"max_distance_between_messages": {  
"period": "1h",  
"unhealthy_conditions": \[  
{  
"type": "greater",  
"value": 100000.0  
}  
\]  
},  
"sensor": {  
"items": \[  
{  
"id": 1,  
"period": "1m",  
"unhealthy_conditions": \[  
{  
"type": "less",  
"value": 12.0  
},  
{  
"type": "greater",  
"value": 13.0  
}  
\]  
},  
{  
"id": 3,  
"period": "1m",  
"unhealthy_conditions": \[  
{  
"type": "unchanged",  
"value": 0.0  
}  
\]  
},  
{  
"id": 2,  
"period": "1m",  
"unhealthy_conditions": \[  
{  
"type": "equal",  
"value": 0.0  
}  
\]  
}  
\]  
}  
}  
}

## Возвращаемый результат

При успешном выполнении запроса возвращается пустой ответ.

{ }

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

| Код ошибки | Описание |
| --- | --- |
| 4   | Невалидные входные параметры. |
| 7   | Не подключена услуга «Диагностика устройств», или у пользователя нет права доступа ADF_ACL_ITEM_EDIT_OTHER на объект. |
| 6   | Не удалось изменить настройки диагностики устройства |

# update_task

Метод **unit/update_task** позволяет редактировать задачи.

svc=unit/update_task&params={  
"itemId": &lt;long&gt;,  
"taskId": &lt;text&gt;,  
"props": {  
"key1": &lt;long&gt;,  
"key2": &lt;text&gt;,  
.....  
}  
}

Пример запроса:

https://hst-api.wialon.com/wialon/ajax.html?sid=5e860dbe24e3d704ffb196d0733ec714&svc=unit/update_task&params={  
"itemId": 1514,  
"taskId": "6f6aeeebad9ebe64bda86924f8d379d8e6b06bd690c53da4aab526c5e221bdb266b52a50",  
"props": {  
"task_status": 2,  
"task_priority": 3  
}  
}

## Параметры

Требуются следующие параметры:

|     |     |
| --- | --- |
| **Параметр** | **Описание** |
| itemId | Идентификатор объекта. |
| taskId | Идентификатор задачи (хэш строки). |
| props | Объект свойств, которые необходимо обновить (пары ключ — значение). Указывайте только те свойства, которые вы хотите отредактировать, поскольку каждое новое свойство полностью заменяет соответствующее ему существующее свойство. Ниже приведен список флагов, которые можно использовать в этом параметре для изменения свойств задачи. |

### Флаги

<div class="joplin-table-wrapper"><table><tbody><tr><td><p><strong>Флаг</strong></p></td><td><p><strong>Описание</strong></p></td></tr><tr><td><p>task_status</p></td><td><p>Статус задачи. Допустимые значения:</p><ul><li>1 (Новая),</li><li>2 (К выполнению),</li><li>3 (В процессе),</li><li>4 (Приостановлено),</li><li>5 (Отклонено),</li><li>6 (Выполнено).</li></ul></td></tr><tr><td><p>task_priority</p></td><td><p>Приоритет задачи.&nbsp;Допустимые значения:&nbsp;</p><ul><li>1 (Низкий),</li><li>2 (Средний),</li><li>3 (Высокий).</li></ul></td></tr><tr><td><p>task_assignee</p></td><td><p>Идентификатор пользователя, на которого назначена задача.&nbsp;</p></td></tr><tr><td><p>task_comments</p></td><td><p>Комментарий к задаче. Поле комментария не должно быть пустым или содержать более 500 символов.</p></td></tr></tbody></table></div>

Флаг **task_comment** должен иметь следующую структуру:

\[  
{  
timestamp: 13243,  
assignee: 1564,  
comment: "Hello world"  
},  
{  
timestamp: 13244,  
assignee: 1564,  
comment: "Hello world 2"  
}  
\]

## Возвращаемый результат

При успешном выполнении запроса возвращается пустая строка.

{ }

Если запрос не выполнен, возвращается код ошибки. Пример:

{  
"error": 5  
}

### **Коды ошибок**

<div class="joplin-table-wrapper"><table><tbody><tr><td><p><strong>Код</strong></p></td><td><p><strong>Описание</strong></p></td></tr><tr><td><p>4</p></td><td><p>Невалидные входные параметры.</p></td></tr><tr><td><p>5</p></td><td><p>Ошибка выполнения запроса.&nbsp;</p><p>Не удалось найти задачу с указанным индикатором.&nbsp;</p></td></tr><tr><td><p>6</p></td><td><p>Неизвестная ошибка.</p></td></tr><tr><td><p>2008</p></td><td><p>Доступ запрещен. Необходимы следующие права доступа:</p><ul><li>Право<strong>&nbsp;Просмотр элемента и его основных свойств&nbsp;</strong>на объект,</li><li>Право<strong>&nbsp;Действовать от имени этого пользователя</strong>&nbsp;на пользователя, на которого назначена задача.</li></ul><p>Эта ошибка также возникает, если не найден указанный идентификатор пользователя, на которого назначена задача.</p></td></tr></tbody></table></div>

# update_video_settings

 Используется только в Wialon Hosting.

Функция **update_video_settings** используется для того, чтобы настраивать имя стрима и выгружать видео с камеры.

svc=unit/update_video_settings&params={  
"itemId":long,  
"settings":\[{"name":"text","flags":int},{"name":"text","flags":int}...\]}

 Для отправки запроса необходимо право доступа на объект **Редактирование неупомянутых свойств**.

## Параметры 

|     |     |
| --- | --- |
| Название | Описание |
| itemId | ID объекта. |
| name | Имя камеры. |
| flags | Флаг выгрузки. Если для камеры указан flags:1, то видео с нее выгружается, если flags:0, — нет. |

## Возвращаемый результат

В случае успешного выполнения запроса возвращается пустой JSON.

{ }

## Пример запроса

svc=unit/update_video_settings&params={"itemId":45644,"settings":"settings":\[{"name":"Камера 1","flags":1},{"name":"Камера 2","flags":1}\]}

# user

В этом разделе описаны функции для работы с пользователями. О создании пользователей читайте [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/core/create_user).

# bind_auth_service

Чтобы подключить или отключить сервис авторизации, используйте следующий запрос:

svc=user/bind_auth_service&params={  
"service":"&lt;text&gt;",  
"token":"&lt;text&gt;",  
"mode":&lt;bool&gt;,  
"serviceId":"&lt;text&gt;",  
"userId":&lt;long&gt;  
}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| service\* | URL сервиса авторизации. |
| token\* | Токен доступа к сервису авторизации. |
| mode\* | 1 — подключить, 0 — отключить. |
| serviceId\* | ID из сервиса авторизации. |
| userId | Пользователь, для которого необходимо подключить/отключить сервис авторизации. |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается следующий результат:

{  
&lt;auth_service&gt;:&lt;auth_param&gt; /\* например, "gmail":"john.doe@gmail.com" \*/  
}

В обратном случае возвращается код ошибки.

### Error codes

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Не удалось извлечь пользователя с ACL(ADF_ACL_USER_OPERATE_AS). |
| 6   | Запрос не поддерживается на сервере, или не удалось подключить/отключить сервис авторизации. |
| 4   | Текущий пользователь не найден, либо сервис авторизации не поддерживается на сервере, либо указан неверный пользователь. |
| 1002 | Такой пользователь уже существует. |

# get_items_access

Чтобы узнать, какими правами доступа обладает пользователь на определенный тип элементов, используйте следующий запрос:

svc=user/get_items_access&params={"userId":&lt;long&gt;,  
"directAccess":&lt;bool&gt;,  
"itemSuperclass":"&lt;text&gt;",  
"flags":&lt;uint&gt;}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| userId\* | ID пользователя. |
| directAccess\* | Возвращать только те элементы, на которые у пользователя прямые права доступа. |
| itemSuperclass\* | Тип элемента. Смотрите список всех типов [здесь](https://help.wialon.com/help/api/ru/user-guide/api-reference/core/search_items). |
| flags | Флаги. Возвращать: 0x1 — комбинированные права доступа, 0x2 — прямые права доступа. |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается следующий результат:

{  
"&lt;text&gt;": /\* item ID \*/  
{  
"cacl":&lt;long&gt;, /\* комбинированные права доступа \*/  
"dacl":&lt;long&gt; /\* прямые права доступа \*/  
}  
}

Права доступа описаны [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/core/check_items_billing).

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок 

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Не удалось извлечь пользователя. |

# get_items_by_access

Этот запрос возвращает все элементы указанного типа, к которым у пользователя есть как минимум указанные права доступа. Запрос возвращает список ID подходящих элементов. Он может быть полезен, если вы часто используете запрос **user/get_items_access.**

## Запрос

svc=user/get_items_by_access&params={  
"userId":&lt;long&gt;,  
"itemSuperclass":"&lt;text&gt;",  
"reqAccess":&lt;long&gt;  
}

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| userId | ID пользователя. |
| itemSuperclass | Тип элемента. |
| reqAccess | Обязательные права доступа. |

## Возвращаемый результат

{  
"ids":\[  
&lt;long&gt;,  
&lt;long&gt;,  
...  
\]  
}

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Не удалось извлечь текущего пользователя или указанного пользователя с ACL (ADF_ACL_USER_SET_ITEMS_ACCESS). |

# get_keys

Чтобы получить информацию о ключах, используемых для доступа к внешним картографическим сервисам, выполните команду **user/get_keys**.

svc=user/get_keys&params={}

## Возвращаемый результат

При успешном выполнении запроса возвращается следующий результат:

{  
"&lt;key_name&gt;": {  
"ct":&lt;long&gt;, /\* время создания \*/  
"name":&lt;text&gt;, /\* имя ключа \*/  
"key":&lt;text&gt;, /\* значение ключа (может быть скрыто в зависимости от пользователя, источника карт и типа ключа) \*/  
"provider":&lt;text&gt;, /\* имя источника карт ("google", "here", "trimble" и т. д.) \*/  
"type":&lt;uint&gt;, /\* побитовая комбинация значений из таблицы «Типы ключей» (см. ниже) \*/  
"sites":\[&lt;text&gt;,&lt;text&gt;,&lt;text&gt;\] /\* идентификаторы сайтов, для которых доступен ключ \*/  
}  
...  
}

### Типы ключей

|     |     |
| --- | --- |
| Значение | Имя |
| 1   | GIS_EXT_MAP_KEY_PROTECTED |
| 2   | GIS_EXT_MAP_KEY_ROUTING |
| 4   | GIS_EXT_MAP_KEY_GEOCODING |
| 8   | GIS_EXT_MAP_KEY_DISTANCE_MATRIX |
| 16  | GIS_EXT_MAP_KEY_PUBLIC |
| 32  | GIS_EXT_MAP_KEY_SPEEDINGS |

Если запрос не выполнен, возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 1   | Невалидный или устаревший SID запроса. |
| 4   | Невалидные параметры запроса. |
| 6   | Внутренняя ошибка сервера. |
| 7   | Неавторизованный пользователь. |

# get_locale

Чтобы установить формат даты и времени и/или первый день недели, используйте команду **user/get_locale**.

svc=user/get_locale&params={"userId":&lt;long&gt;}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| userId\* | ID пользователя. |

## Возвращаемый результат

Если настройки никогда не менялись с помощью запроса [user/update_locale](https://help.wialon.com/ru/api/user-guide/api-reference/user/update_locale), возвращается пустая строка:

{}

Если настройки изменены, возвращается следующий результат:

{  
"fd":"&lt;text&gt;", /\* формат даты и времени \*/  
"wd":&lt;uint&gt; /\* первый день недели: 1 - понедельник, 7 - воскресенье\*/  
}

 Подробнее о формате даты и времени читайте [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/render/set_locale).

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Не удалось извлечь пользователя с ACL (ADF_ACL_ITEM_VIEW_PROPERTIES). |

# get_video_units

Этот запрос используется только для Wialon Local. Он возвращает список объектов с доступными видеотрансляциями.

## Запрос

svc=user/get_video_units&params={}

## Возвращаемый результат

\[  
{  
"id":&lt;long&gt;,  
"name":"&lt;text&gt;",  
"unique_id":"&lt;text&gt;",  
"hw_type":"&lt;text&gt;",  
"video_uri":"&lt;text&gt;",  
"cameras":"&lt;text&gt;",  
"connected":&lt;int&gt; //1 - подключено, 0 - не подключено  
"icon_uri":"&lt;text&gt;",  
"cmds":\[  
{  
"id":&lt;long&gt;,  
"n":"&lt;text&gt;", //имя команды  
"c":"&lt;text&gt;", //фактическое имя команды  
"l":"&lt;text&gt;", //тип ссылки команды  
"p":"&lt;text&gt;", //фактический параметр команды  
"a":&lt;long&gt;, //ACL команды  
"f":&lt;uint&gt;, //флаги команды  
"ct":&lt;long&gt;, //создать время  
"mt":&lt;long&gt; //время изменения  
},  
...  
\]  
},  
...  
\]

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | На хосте не запущен Wialon Local, или доступ запрещен. |
| 14  | Видеосервис недоступен. |

# send_sms

Чтобы отправить SMS-сообщение, используйте следующую команду:

svc=user/send_sms&params={"phoneNumber":"&lt;text&gt;",  
"smsText":"&lt;text&gt;"}

## Параметры

TОбязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| phoneNumber\* | Номер телефона. |
| smsText\* | Текст сообщения. |

## Возвращаемый результат

Если сообщение отправлено успешно, возвращается GUID SMS-сообщения.

{  
"hash":"&lt;text&gt;"  
}

В обратном случае возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Значение |
| 6   | Не удалось отправить сообщение, или пользователь не может отправлять SMS. |
| 4   | Невалидный параметр. |

# update_auth_params

Чтобы изменить настройки двухфакторной аутентификации, используйте следующую команду:

svc=user/update_auth_params&params={"userId":&lt;long&gt;,  
"type":&lt;int&gt;,  
"phone":"&lt;text&gt;"}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| userId\* | ID пользователя. |
| type\* | Тип (0 — нет, 1 —  email, 2 — SMS ). |
| phone | Номер телефона (если тип 2). |

## Возвращаемый результат

{  
"type":&lt;uint&gt;,  
"phone":"&lt;text&gt;"  
}

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Не удалось получить данные пользователя с ACL (ADF_ACL_ITEM_EDIT_PROPERTIES), или пользователь не найден, или невалидные вводные параметры. |
| 6   | Не удалось установить новые параметры аутентификации. |

# update_hosts_mask

Чтобы установить или обновить маску хоста пользователя, используйте следующую команду:

svc=user/update_hosts_mask&params={"userId":&lt;long&gt;,  
"hostsMask":"&lt;text&gt;"}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| userId\* | ID пользователя. |
| hostsMask\* | Маска хоста. |

## Возвращаемый результат

{  
"hm":"&lt;text&gt;" /\* маска хоста \*/  
}

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Не удалось получить данные пользователя с ACL (ADF_ACL_USER_EDIT_FLAGS). |
| 6   | Не удалось обновить маску хоста. |

# update_item_access

Чтобы предоставить пользователю права доступа на элемент, используйте команду user/update_item_access:

svc=user/update_item_access&params={"userId":&lt;long&gt;,  
"itemId":&lt;long&gt;,  
"accessMask":&lt;long&gt;}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

| Параметр | Описание |
| --- | --- |
| userId\* | ID пользователя. |
| itemId\* | ID элемента. |
| accessMask\* | Маска доступа. См. [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/core/check_items_billing). |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустая строка.

{}

В обратном случае возвращается код ошибки.

### Коды ошибок

| Код ошибки | Описание |
| --- | --- |
| 7   | Не удалось получить данные пользователя с ACL (ADF_ACL_USER_SET_ITEMS_ACCESS), или пользователь не имеет прав на редактирование элемента. |
| 6   | Не удалось обновить права доступа к элементу. |

# update_locale

Чтобы установить формат даты и времени, а также первый день недели, используйте следующую команду:

svc=user/update_locale&params={"userId":&lt;long&gt;,  
"locale":  
{  
"fd":"&lt;text&gt;",  
"wd":&lt;ubyte&gt;  
}  
}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| userId\* | ID пользователя. |
| fd\* | Формат даты и времени.  <br>См. [здесь](https://help.wialon.com/help/api/ru/user-guide/api-reference/render/set_locale). |
| wd\* | Первый день недели:  <br>1 — понедельник;  <br>7 — воскресенье. |

## Возвращаемый результат

{  
"locale":  
{  
"fd":"&lt;text&gt;", /\* формат даты и времени \*/  
"wd":&lt;uint&gt; /\* первый день недели: 1 — понедельник, 7 — воскресенье \*/  
}  
}

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибок | Описание |
| 7   | Не удалось получить данные пользователя с ACL (ADF_ACL_ITEM_VIEW_PROPERTIES), или указаны невалидные параметры. |
| 6   | Не удалось обновить настройки. |

# update_password

Чтобы изменить пароль пользователя, используйте следующую команду:

svc=user/update_password&params={"userId":&lt;long&gt;,  
"oldPassword":"&lt;text&gt;",  
"newPassword":"&lt;text&gt;"}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| userId\* | ID объекта. |
| oldPassword\* | Старый пароль. |
| newPassword\* | Новый пароль. |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустая строка.

{}

В обратном случае возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Пользователь не найден, или у текущего пользователя нет прав на изменение настроек указанного пользователя, или пароль нельзя изменить. |
| 6   | Пароль не соответствует требованиям безопасности, либо не удалось изменить пароль, либо не найден текущий пользователь. |

# update_user_flags

Чтобы установить флаги пользователя (дополнительные свойства), используйте команду **user/update_user_flags**:

svc=user/update_user_flags&params={"userId":&lt;long&gt;,  
"flags":&lt;uint&gt;,  
"flagsMask":&lt;uint&gt;}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| userId\* | ID пользователя. |
| flags\* | Флаги настроек. См. ниже. |
| flagsMask\* | Маска, определяющая, какие биты будут изменены. |

Флаги настроек пользователя:

|     |     |
| --- | --- |
| Значение | Описание |
| 0x01 | Пользователь выключен. |
| 0x02 | Не может менять пароль. |
| 0x04 | Может создавать элементы. |
| 0x10 | Не может менять свои настройки. |
| 0x20 | Может отправлять SMS. |
| 0x40 | Администратор. |

**Пример использования маски и флагов**

Необходимо разрешить пользователю менять пароль (0x02), запретить менять настройки (0x10), а все остальные флаги оставить без изменений. В этом случае маска будет иметь вид **0x2+0x10=0x12**. Флаг 0x02 необходимо убрать, а флаг 0x10 — добавить. Следовательно, **флаг параметра будет равен 0x10**.

## Возвращаемый результат

{  
"fl":&lt;uint&gt; /\* флаги\*/  
}

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 6   | Не удалось изменить настройки. |
| 7   | Не удалось получить данные пользователя с ACL (ADF_ACL_USER_EDIT_FLAGS), либо не удалось извлечь создателя пользователя, или указаны невалидные флаги. |

# update_user_notification

Чтобы отправить пользователю онлайн-уведомление, используйте команду **user/update_user_notification**.

### Создание уведомления

svc=user/update_user_notification&params={  
"itemId":&lt;long&gt;, /\*обязательный параметр\*/  
"callMode":"&lt;text&gt;", /\*обязательный параметр\*/  
"h":"&lt;text&gt;", /\*обязательный параметр\*/  
"d":"{ /\*обязательный параметр\*/  
\\"body\\":\\"&lt;text&gt;\\",  
\\"head\\":{  
\\"c\\":&lt;uint&gt;,  
\\"fs\\":\\"&lt;text&gt;\\"  
},  
\\"multiple\\":&lt;int&gt;  
}",  
"s":"&lt;text&gt;", /\*обязательный параметр\*/  
"ttl":&lt;uint&gt; /\*обязательный параметр\*/  
}

### Удаление уведомления

svc=user/update_user_notification&params={  
"itemId":&lt;long&gt;, /\*обязательный параметр\*/  
"id":&lt;long&gt;, /\*обязательный параметр\*/  
"callMode":"&lt;text&gt;", /\*обязательный параметр\*/  
}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

### Параметры для создания уведомления

|     |     |
| --- | --- |
| Параметр | Описание |
| itemId\* | ID пользователя. |
| callMode\* | Тип действия. Для создания уведомления укажите тип **"create"**. |
| h\* | Тема уведомления. |
| d\* | Настройка текста уведомления. |
| body\* | Текст. |
| с\* | Цвет, RGB. |
| fs\* | Размер шрифта. |
| multiple\* | Многократная активация: 1 - да, 0 - нет. |
| s\* | Имя отправителя. |
| ttl\* | Срок действия уведомления (UTC). По истечении этого срока уведомление будет удалено. |

### Параметры для удаления уведомления

|     |     |
| --- | --- |
| **Параметр** | **Описание** |
| itemId\* | ID пользователя. |
| id\* | ID уведомления. |
| callMode\* | Тип действия. Для удаления уведомления укажите тип **"delete"**. |

 Important

Если параметр **ttl** указывает на дату в прошлом, то уведомления срабатывают только онлайн (не хранятся на сервере). **ttl** — это дата в секундах от 1 января 1970 года.

## Возвращаемый результат

При успешном создании уведомления возвращается следующий результат:

\[  
&lt;long&gt;, /\* ID уведомления\*/  
{  
"id":&lt;long&gt;, /\* ID уведомления \*/  
"t":&lt;uint&gt;, /\* срок действия (UTC) \*/  
"d":"&lt;text&gt;", /\* настройка текста уведомления \*/  
"h":"&lt;text&gt;", /\* тема уведомления \*/  
"s":"&lt;text&gt;" /\* отправитель \*/  
}  
\]

При успешном удалении уведомления возвращается следующий результат:

\[  
&lt;long&gt;, /\* ID уведомления \*/  
null  
\]

Если запрос выполнить не удалось, возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Не удалось получить данные пользователя с ACL (ADF_ACL_ITEM_EDIT_OTHER). |
| 6   | Не удалось создать/удалить уведомление. |
| 4   | Невалидный тип действия (должно быть "create" или "delete"). |

# verify_auth

Команда **user/verify_auth** используется для получения кода верификации на указанный адрес. Если адрес валидный, на него отправляется код, а в ответе возвращается пустая строка. Для завершения двухфакторной авторизации и проверки кода необходимо использовать запрос [**verify_code**](https://help.wialon.com/ru/api/user-guide/api-reference/user/verify_code).

svc=user/verify_auth&params={"userId":&lt;long&gt;,  
"type":&lt;int&gt;,  
"destination":"&lt;text&gt;"}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| userId\* | ID пользователя. |
| type\* | Тип адреса (0 — SMS, 1 — электронная почта). |
| destination\* | Адрес электронной почты или номер телефона. |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой ответ.

{ }

В обратном случае возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 7   | Не удалось получить данные пользователя с ACL (ADF_ACL_ITEM_EDIT_PROPERTIES), или указаны невалидные параметры. |
| 6   | Не удалось отправить код верификации. |

# verify_code

Запрос **user/verify_code** используется для двухфакторной авторизации. В запросе необходимо передать код, полученный по email или SMS после отправки команды [**user/verify_auth**](https://help.wialon.com/ru/api/user-guide/api-reference/user/verify_auth).

svc=user/verify_code&params={  
"userId":&lt;long&gt;,  
"code":&lt;long&gt;  
}

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| userId\* | ID пользователя. |
| code\* | Код, высланный по email или SMS после вызова user/verify_auth. |

## Возвращаемый результат

Если запрос выполнен успешно, возвращается пустой ответ.

{ }

В обратном случае возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код ошибки | Описание |
| 4   | Указаны невалидные параметры, пользователь не найден, или истек срок действия (TTL) кода. Срок действия кода равен двум часам. |
| 1006 | Превышено максимальное количество попыток ввода кода. |

# Другие методы

В этом разделе описаны динамические запросы, которые можно отправить на сервер.

# avl_evts

Запрос **avl_evts** возвращает информацию о событиях, которые произошли с момента последнего выполнения этого запроса.

http://&lt;host&gt;/avl_evts?sid="&lt;text&gt;"

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| sid | ID сессии. |

## Возвращаемый результат

{  
"tm":&lt;uint&gt;, /\* время сервера \*/  
"events":\[ /\* события \*/  
{  
"i":&lt;long&gt;, /\* ID элемента \*/  
"t":"&lt;text&gt;", /\* тип события: m — сообщение, u — изменение, d — удаление\*/  
"d":{ /\* описание события, зависит от типа события \*/  
...  
}  
}  
\]  
}

# avl_render

Чтобы получить тайл, который содержит информацию обо всех включенных графических слоях, испольуйте следующих запрос:

http://&lt;host&gt;/avl_render/&lt;x&gt;\_&lt;y&gt;\_&lt;z&gt;/&lt;sid&gt;.png

 Этот запрос рассмотрен в примере [messages](https://help.wialon.com/ru/api/user-guide/api-reference/messages).

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| x   | Координата X тайла. |
| y   | Координата Y тайла. |
| z   | Масштаб. |
| sid | ID сессии. |

"adfurl":&lt;uint&gt; /\* специальная переменная, которая используется, чтобы избежать кеширования браузера, изменяя &lt;uint&gt; в рамках сессии \*/

Координаты тайлов рассчитываются по принципу, описанному [здесь](http://www.maptiler.org/google-maps-coordinates-tile-bounds-projection/). Для карт Webgis используются тайлы масштабов от 17 до z.

## Размер тайлов

По умолчанию размер тайла равен 256\*256. Чтобы поменять размер тайла, используйте команду render/set_locale вместе с параметром density.

## Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 304 | Не изменено. |
| 503 | Сервис недоступен. |

## Возвращаемый результат

Возвращает изображение в формате PNG.

# avl_zone_image

Чтобы получить изображение геозоны, используйте следующий запрос:

http://&lt;host&gt;/avl_poi_image/&lt;rid&gt;/&lt;id&gt;/&lt;max_border&gt;/&lt;any.png&gt;

## Параметры

|     |     |
| --- | --- |
| Параметр | Описание |
| rid | ID ресурса. |
| id  | ID геозоны. |
| max_border | Максимальный размер изображения (от 16 до 256 пикселей, рекомендуемый размер — 32). |
| v   | Разрешить формат SVG. |
| any | Произвольное значение (необязательно). Указывается, если необходимо скачать изображение, а не использовать файл из кэша. |

## Возвращаемый результат

Возвращает изображение в формате PNG.

# apps (apps/list)

Чтобы получить список доступных приложений, используйте следующий запрос:

svc=apps/list&params={"manageMode":1,"filterLang":""}

## Параметры

В запросе можно использовать следующие необязательные параметры:

|     |     |
| --- | --- |
| Параметр | Описание |
| manageMode | 1 — флаг данных о биллинге. |
| filterLang | Фильтр по языку. |

## Возвращаемый результат

Если запрос выполняется успешно, возвращается следующий результат:

{"name":"&lt;text&gt;", /\* имя приложения \*/  
"description":"&lt;text&gt;", /\* описание приложения \*/  
"url":"&lt;text&gt;", /\* URL приложения \*/  
"flags":&lt;uint&gt;, /\* флаги \*/  
"sortOrder":&lt;uint&gt;, /\* тип сортировки \*/  
"serviceName":"&lt;text&gt;", /\* имя услуги \*/  
"id":&lt;uint&gt;, /\* ID приложения \*/  
"langs":"&lt;text&gt;", /\* язык приложения \*/  
"requiredServicesList":"&lt;text&gt;", /\* требуемые услуги \*/  
"billingPlans":"&lt;text&gt;", /\* требуемые тарифные планы \*/}

В обратном случае приходит код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 7   | Нет доступа (неизвестный WDC_ROOT, неизвестный кластер для пользователя, ошибка проверки биллинга для пользователя). |

# avl_driver_image

Чтобы получить изображение водителя или прицепа, используйте следующий запрос:

http://&lt;host&gt;/avl_driver_image/&lt;rid&gt;/&lt;did&gt;/&lt;max_border&gt;/&lt;any.png&gt;

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| rid\* | ID ресурса. |
| did\* | ID водителя или прицепа. |
| max_border\* | Максимальный размер изображения (от 16 до 256 пикселей, рекомендуемое значение — 32). |
| flags | Флаги. 0x02 — для изображения прицепа. |

## Возвращаемый результат

Если запрос выполняется успешно, возвращается изображение в формате PNG. В обратном случае возвращается код ошибки.

### Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 404 | Не найдено. |
| 304 | Не изменено. |
| 503 | Услуга недоступна. |
| 416 | Запрошен невалидный диапазон. |

# avl_hittest_pos

Чтобы получить информацию об элементе на графическом слое по его координатам, используйте следующий запрос:

http://&lt;host&gt;/avl_hittest_pos?sid="&lt;text&gt;"&lat=&lt;double&gt;&lon=&lt;double&gt;&scale=&lt;uint&gt;&  
radius=&lt;double&gt;&layerName="&lt;text&gt;"

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| sid\* | ID сессии. |
| lat\* | Широта. |
| lon\* | Долгота. |
| scale | Масштаб: 0-17. |
| radius\* | Радиус поиска в градусах (как координаты). |
| layerName | Название слоя. |
| flags | Флаги слоя (см. ниже). По умолчанию установлены все возможные биты. |

### Флаги

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x10 | Использовать информацию из слоя маркеров. |
| 0x20 | Использовать информацию из слоя сообщений. |
| 0x40 | Использовать информацию из слоя форм. |

 Чтобы получить информацию о маркере, необходимо указать координаты его изображения и произвольный радиус. В случае с геозоной и маркером в форме круга необходимо указать координаты в пределах этой фигуры и произвольный радиус.

## Возвращаемый результат

**Для сообщений**:

{  
"type":"msg", /\* тип результата \*/  
"currMsg":{ /\* текущее сообщение \*/  
...  
},  
"prevMsg":{ /\* предыдущее сообщение \*/  
...  
},  
"msgIndex":&lt;uint&gt;, /\* индекс последнего сообщения \*/  
"unitId":&lt;long&gt;, /\* ID объекта \*/  
"mileage":&lt;double&gt;, /\* пробег \*/  
"layerName":"&lt;text&gt;" /\* название слоя \*/  
}

Форматы текущего и предыдущего сообщения описаны [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/format/messages).

**Для маркеров**:

{  
"type":"marker", /\* тип результата \*/  
"lat":&lt;double&gt;, /\* широта \*/  
"lon":&lt;double&gt;, /\* долгота \*/  
"info":\[{}\], /\* информация о маркере: зависит от типа маркера \*/  
"layerName":"&lt;text&gt;", /\* название слоя \*/  
"marker":"&lt;text&gt;" /\* дополнительная информация о маркере, если доступно \*/  
}

**Для геозон**:

{  
"type":"shape", /\* тип результата \*/  
"lat":&lt;double&gt;, /\* широта\*/  
"lon":&lt;double&gt;, /\* долгота \*/  
"layerName":"&lt;text&gt;", /\* название слоя \*/  
"shape":"&lt;text&gt;" /\* информация о геозоне, например, ее имя \*/

# avl_item_image

Чтобы получить изображение объекта, используйте следующий запрос:

http://&lt;host&gt;/avl_item_image/&lt;item_id&gt;/&lt;max_border&gt;/&lt;any.png&gt;

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| item_id\* | ID объекта. |
| max_border | Максимальный размер изображения (от 16 до 256 пикселей, рекомендуемое значение — 32). |
| any | Произвольное значение. Указывается, если нужно прочитать изображение, а не взять его из кэша |

## Возвращаемый результат

Возвращается изображением в формате PNG.

# avl_msg_photo

Чтобы получить фотографию из сообщения, используйте следующий запрос:

http://&lt;host&gt;/avl_msg_photo?sid=&lt;sid&gt;&layerName="&lt;text&gt;"&msgIndex=&lt;uint&gt;&time=&lt;uint&gt;&unitIndex=&lt;uint&gt;&saveMode=&lt;uint&gt;

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| sid\* | ID сессии. |
| layerName\* | Название слоя. |
| msgIndex\* | Индекс сообщения. |
| time\* | Время. |
| unitIndex\* | Индекс объекта. |
| saveMode | Используется, чтобы сохранить изображение как файл на устройстве пользователя; 1 — активирован. |

## Возвращаемый результат.

Возвращается фотография.

# coordinates_simple (gis_search)

Чтобы получить координаты по адресу, используйте следующий запрос:

https://search-maps.wialon.com/&lt;host&gt;/gis_search?country="&lt;text&gt;"&region="&lt;text&gt;"&city="&lt;text&gt;"&street="&lt;text&gt;"&  
flags=&lt;uint&gt;&count=&lt;uint&gt;&indexFrom=&lt;uint&gt;&uid=&lt;long&gt;

Как обычно используется [hst-api.wialon.com](http://hst-api.wialon.com).

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| country | Название страны или его часть. |
| region | Название региона или его часть. |
| city | Название города или его часть. |
| street | Название улицы или его часть. |
| flags\* | Флаги поиска или форматирования. См. описание ниже. |
| count\* | Количество выводимых результатов. |
| indexFrom | Порядковый номер первого результата. |
| searchFlags\* | Дополнительные флаги поиска. См. описание ниже. |
| gis_sid\* | Уникальный ID сессии пользователя. |
| uid | ID пользователя. Устарело, всегда используйте **gis_sid**. |

## Флаги поиска

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x100 | Вывести путь в результат. |
| 0x200 | Вывести имя карты в результат. |
| 0x400 | Вывести координаты в результат. |
| 0x800 | Не создавать JSON. Вернуть результаты как список объектов. |

## Флаги

|     |     |
| --- | --- |
| Флаг | Описание |
| 0x0 | Искать страну. |
| 0x1 | Искать регион. |
| 0x2 | Искать город. |
| 0x3 | Искать улицу. |
| 0x4 | Искать дом. |
| 0x100 | Добавить поля с форматированной строкой адреса в результат. |
| 0x200 | Добавить название карты в результат. |
| 0x400 | Добавить координаты карты в результат. |

Флаги форматирования описаны [здесь](https://help.wialon.com/ru/api/user-guide/api-reference/other-methods/address-gis_geocode).

## Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 1   | Невалидная сессия. |
| 4   | Неверные вводные параметры. |
| 6   | Неизвестные ошибки. |
| 7   | Нет доступа, неизвестный провайдер поиска. |

## Возвращаемый результат

{  
"items":\[ /\* массив результатов \*/  
{  
"name":"&lt;text&gt;", /\* название элемента поиска \*/  
"map":"&lt;text&gt;", /\* название карты \*/  
"x":&lt;double&gt;, /\* долгота \*/  
"y":&lt;double&gt;, /\* широта \*/  
"path":"&lt;text&gt;", /\* часть адреса, исключая названия элемента, указанного в поле name \*/  
"formatted_path":"&lt;text&gt;" /\* строка адреса, отформатированная в соответствии с установленными флагами \*/  
}  
\],  
"more":&lt;uint&gt; /\* дополнительные результаты: 0 — нет, 1 — есть \*/

# gis_render

Чтобы получить тайл карты WebGIS, используйте следующий запрос:

https://&lt;host&gt;/gis_render/&lt;x&gt;\_&lt;y&gt;\_&lt;z&gt;/&lt;uid&gt;/&lt;tile_name&gt;.png?density=...

## Параметры

Обязательные параметры отмечены звездочкой (\*).

|     |     |
| --- | --- |
| Параметр | Описание |
| x\* | X-координата тайла. |
| y\* | Y-координата тайла. |
| z\* | Масштаб. |
| uid\* | ID пользователя. Устарело, всегда используйте **gis_sid**. |
| density | Размер тайла. |
| gis_sid\* | Уникальный ID сессии пользователя. |
| f\* | Флаги: 0x200 — масштаб Google Maps. |

Координаты тайлов рассчитываются по принципу, описанному [здесь](https://developers.google.com/maps/documentation/javascript/coordinates#tile-coordinates). Для Webgis используются тайлы масштаба от 17 до z.

### Density

Необязательный параметр. Размер тайла по умолчанию — 256\*256.

|     |     |     |
| --- | --- | --- |
| Значение | Размер тайла | Пропорции |
| 1   | 256\*256 | 1   |
| 2   | 384\*384 | 1.5 |
| 3   | 512\*512 | 2   |
| 4   | 768\*768 | 3   |
| 5   | 1024\*1024 | 4   |

## Коды ошибок

|     |     |
| --- | --- |
| Код | Описание |
| 500 | Внутренняя ошибка сервера. |
| 401 | Нет доступа. |
| 304 | Не изменено. |

## Возвращаемый результат

Возвращается изображение в формате PNG.

# account

В этом разделе описываются методы, которые можно применить к учетным записям.

# change_account

Предварительные требования

Для того, чтобы передать объект в подчиненную учетную запись, пользователь, создавший учетную запись, должен иметь право доступа **Управление учетной записью** к своей учетной записи (флаг ACL 0x100000000). Необходимы следующие права доступа к передаваемому объекту:

Просмотр элемента и его основных свойств (флаг ACL 0x000001)

Управление доступом к элементу (флаг ACL 0x000004)

Удаление элемента (флаг ACL 0x000008)

Просмотр и редактирование настроек подключения: тип устройства, уникальный ID, телефон, пароль доступа, фильтрация валидности сообщений (флаг ACL 0x100000)

Удаление сообщений (флаг ACL 0x800000)

Чтобы переместить объект в подчиненную учетную запись и изменить создателя объекта в этой учетной записи, используйте метод **account/change_account**:

svc=account/change_account&params={"itemId":&lt;long&gt;,  
"resourceId":&lt;long&gt;}

## Параметры

Запрос должен содержать следующие параметры.

| Параметр | Описание |
| --- | --- |
| itemId | ID объекта. |
| resourceId | ID учетной записи. |

## Ответ

В случае успешной миграции возвращается пустой объект.

Если возникают [ошибки](https://help.wialon.com/ru/api/user-guide/error-codes), ответ имеет следующий формат:

{  
"error":\\&lt;uint&gt;  
}

# create_account

Чтобы создать новую учетную запись, используйте метод **account/create_account**:

svc=account/create_account&params={"itemId":&lt;long&gt;,  
"plan":&lt;text&gt;}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID ресурса. |
| plan | Тарифный план. |

## Ответ

В случае успешного создания учетной записи возвращается пустой объект.

В противном случае возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# delete_account

Для удаления учетной записи используйте метод **account/delete_account**:

## Точка доступа

Чтобы удалить учетную запись с объектами в Wialon Hosting, используйте следующую сигнатуру:

svc=account/delete_account  
&params={  
"itemId": &lt;long&gt;,  
"reasons": \[{"reason_key"}\]  
}

Чтобы удалить учетную запись без объектов в Wialon Hosting или любую учетную запись в Wialon Local, используйте следующую сигнатуру:

svc=account/delete_account  
&params={  
"itemId": &lt;long&gt;  
}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID учетной записи. |
| reasons | Массив с причинами удаления учетной записи Wialon Hosting. Ключи причин и их описание смотрите ниже. |

### Причины удаления учетной записи

| Ключ причины | Описание |
| --- | --- |
| delayed_resolution_of_reported_bugs_partner | Задержки в исправлении выявленных багов (инициатива партнёра). |
| delayed_resolution_of_reported_bugs_user | Задержки в исправлении выявленных багов (инициатива пользователя). |
| missing_functionality_partner | Отсутствие необходимых функций (инициатива партнёра). |
| missing_functionality_user | Отсутствие необходимых функций (инициатива пользователя). |
| downtime_or_frequent_errors_partner | Недоступность системы или частые ошибки (инициатива партнёра). |
| downtime_or_frequent_errors_user | Недоступность системы или частые ошибки (инициатива пользователя). |
| disagreement_on_pricing | Разногласия по ценам. |
| better_terms_from_another_platform | Лучшие условия от другой платформы. |
| strict_debt_management_rules_or_account_blockages | Строгие правила управления задолженностью, блокировки. |
| poor_technical_support_quality | Недостаточное качество технической поддержки. |
| lack_of_support_in_desired_language | Отсутствие поддержки на нужном языке. |
| end-user_stopped_payments_or_went_out_of_business | Прекращение оплаты конечным пользователем или закрытие его бизнеса. |
| other_reasons_partner | Другие причины (инициатива партнёра). |
| other_reasons_user | Другие причины (инициатива пользователя). |
| better_terms_from_another_provider | Лучшие условия от другого поставщика. |
| seasonal_units_deletion | Удаление сезонных объектов. |
| contract_expiration | Истечение срока договора. |
| poor_service | Неудовлетворительный сервис. |

## Пример

Ниже приведён пример запроса для удаления аккаунта с объектами в Wialon Hosting:

svc=account/delete_account&params={"itemId": 19812, "reasons": \[{"reason_key": "delays_in_resolving_reported_technical_problems_partner"}\]}

## Ответ

В случае успешного удаления учетной записи возвращается пустой объект.

В противном случае возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# do_payment

Для совершения платежа используйте метод **account/do_payment**:

svc=account/do_payment&params={"itemId":&lt;long&gt;,  
"balanceUpdate":&lt;double&gt;,  
"daysUpdate":&lt;int&gt;,  
"description":&lt;text&gt;}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID ресурса (учетной записи) |
| balanceUpdate | Сумма платежа. Значение может быть отрицательным. |
| daysUpdate | Количество добавляемых дней. Значение может быть отрицательным. |
| description | Описание. |

## Ответ

В случае успешного платежа возвращается пустой объект.

В противном случае возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# enable_account

Для включения или отключения учетной записи используйте метод **account/enable_account**:

svc=account/enable_account&params={"itemId":&lt;long&gt;,  
"enable":&lt;bool&gt;}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID ресурса (учетной записи). |
| enable | Режим: 0 — отключить, 1 — включить. |

## Ответ

В случае успешного включения учетной записи возвращается пустой объект.

В противном случае возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# get_account_data

Для получения подробной информации об учетной записи используйте следующую сигнатуру метода **account/get_account_data**:

svc=account/get_account_data&params={"itemId":&lt;long&gt;,  
"type":&lt;uint&gt;}

Для получения информации о нескольких учетных записях используйте следующую сигнатуру:

svc=account/get_account_data&params={"itemId":\[&lt;long&gt;\],  
"type":&lt;uint&gt;}

## Параметры

Запрос может содержать следующие параметры. Обязательные параметры отмечены звездочкой (\*).

| Параметр | Описание |
| --- | --- |
| itemId\* | ID ресурса (учетной записи). |
| type | Флаг ответа. Типы ответа:<br><br>1 — минимальная информация, обычно требуемая для оценки состояния авторизованного пользователя;<br><br>2 — подробная информация с комбинированными, персональными настройками и настройками тарифного плана;<br><br>4 — исключает подчиненные учетные записи из **usage**. Информация касается только этой учетной записи;<br><br>8 — подробная информация о персональных сайтах. |

## Ответ

Если запрос выполнен успешно, ответ для одной учетной записи имеет следующий вид:

{  
"parentAccountName":&lt;text&gt;, /\* Название родительской учетной записи. \*/  
"parentAccountId":&lt;long&gt;, /\* ID родительской учетной записи. \*/  
"parentEnabled":&lt;bool&gt;, /\* Родительская учетная запись: 1 — доступна, 0 — заблокирована. \*/  
"plan":&lt;text&gt;, /\* Название тарифного плана. \*/  
"enabled":&lt;int&gt;, /\* Состояние: 0 — заблокирована, 1 — активна. \*/  
"flags":&lt;uint&gt;, /\* Флаги - дублируют флаги из настроек тарифного плана. \*/  
"created":&lt;unit&gt;, /\* Время создания учетной записи, UNIX-время. \*/  
"balance":&lt;text&gt;, /\* Баланс (с валютой). \*/  
"daysCounter":&lt;uint&gt;, /\* Счетчик дней. \*/  
"settings":{  
"balance":&lt;double&gt;, /\* Баланс. \*/  
"plan":{ /\* Настройки тарифного плана. \*/  
"flags":&lt;uint&gt;, /\* Флаги тарифного плана (см. ниже). \*/  
"blockBalance":&lt;int&gt;, /\* Минимальный баланс для активности учетной записи. \*/  
"denyBalance":&lt;int&gt;, /\* Запрещающий баланс \*/  
<br/>"minDaysCounter":&lt;int&gt;, /\* Минимальное количество дней. Если остается меньше дней, учетная запись блокируется. \*/  
"historyPeriod":&lt;uint&gt;, /\* Период хранения сообщений. Если указан 0, период хранения не ограничен. \*/  
"currencyFormat":"&lt;currency_format&gt;", /\* Формат валюты учетной записи. \*/  
"services":{ /\* Список услуг. \*/  
&lt;text&gt;:{ /\* Название услуги. \*/  
"type":&lt;int&gt;, /\* Тип услуги: 1 — по требованию; 2 — периодическая \*/  
"usage":&lt;uint&gt;, /\* Количество созданных ресурсов в текущей услуге \*/  
"maxUsage":&lt;int&gt;, /\* Максимальное количество ресурсов. \*/  
"cost":&lt;text&gt;, /\* Таблица стоимости. \*/  
"interval":&lt;int&gt; /\* Частота сброса: 0 — нет, 1 — ежечасно, 2 — ежедневно, 3 — еженедельно, 4 — ежемесячно.\*/  
"descr":"&lt;text&gt;" /\* Описание тарифицируемой услуги. \*/  
}  
}  
},  
"personal":{ /\* Настройки учетной записи (персональные). \*/  
... /\* Имеет тот же формат, что и настройки тарифного плана. \*/  
},  
"combined":{ /\* Комбинированные настройки, состоящие из настроек тарифного плана и учетной записи. \*/  
... /\* Имеет тот же формат, что и настройки тарифного плана. \*/  
}  
},  
"siteAccess":{  
"&lt;service_name&gt;":"&lt;dns_name&gt;", /\* Где ключ — это название услуги, а значение — DNS-имя \*/  
...  
/\* При использовании параметра "type=8" (см. выше) объект включает следующую дополнительную информацию.\*/  
"&lt;service_name&gt;": {  
"n":"&lt;dns_name&gt;", /\* Где значение — это DNS-имя. \*/  
"tt":"&lt;template_type&gt;", /\* Где значение — это тип шаблона сайта (wialon_web, cms_manager.) \*/  
"b":"&lt;branch&gt;", /\* Ветка сайта (v1311, master, develop,v1408). \*/  
"sp":&lt;int&gt;, /\* SSL-порт. \*/  
"force_https":"&lt;force_https&gt;", /\* Пользовательское свойство сайта "force_https". \*/  
"ignore_in_cms_login_as":"&lt;ignore_in_cms_login_as&gt;" /\* Пользовательское свойство сайта "ignore_in_cms_login_as". \*/  
}  
...  
},  
"serviceKeys":{ /\* Внешние поставщики карт. \*/ "name":"&lt;text&gt;", /\* Название ключа карты.\*/  
"type":&lt;int&gt;, /\* Тип ключа. \*/  
"provider":"&lt;text&gt;" /\* Название поставщика карт. \*/  
},  
"managable":&lt;int&gt;, /\* Разрешить управление указанной в запросе учетной записью: 1 — да, 0 — нет. \*/  
"dealerRights":&lt;int&gt;, /\* Разрешить использование дилерских прав для тарифного плана указанной учетной записи: 0 — нет, 1 — да. \*/  
"subPlans":\[&lt;text&gt;\] /\* Массив подчиненных тарифных планов. \*/  
}

Ответ для нескольких учетных записей имеет следующую структуру:

{  
"&lt;account_id1&gt;": { /\* ID запрошенной учетной записи. \*/  
... /\* Информация об учетной записи (см. выше). \*/  
},  
"&lt;account_id2&gt;": { /\* ID запрошенной учетной записи. \*/  
... /\* Информация об учетной записи (см. выше). \*/  
},  
...  
}

### Типы ключей услуг

| Тип | Описание |
| --- | --- |
| 0x01 | Защищенный ключ (ключ Gurtam). |
| 0x02 | Ключ маршрутизации. |
| 0x04 | Ключ геокодирования. |
| 0x08 | Ключ матрицы расстояний. |
| 0x10 | Ключ тайлов карт. |

### Флаги учетной записи

| Флаг | Описание |
| --- | --- |
| 0x01 | Блокировать пользователей, если баланс ниже порога блокировки. |
| 0x02 | Запретить вход в систему и заблокировать учетную запись, если баланс меньше порога блокировки. |
| 0x20 | Уменьшать количество дней в счетчике дней и блокировать учетную запись, когда количество оставшихся дней достигает минимума. |
| 0x40 | Переопределить флаги тарифного плана. |
| 0x04 | Разрешить неизвестные услуги. |

### Список услуг

| Услуга | Тип | Описание |
| --- | --- | --- |
| avl_resource | периодическая | Активирует раздел **Учетные записи** в CMS Manager; определяет количество и стоимость ресурсов и учетных записей. |
| avl_retranslator | периодическая | Активирует раздел **Ретрансляторы** в CMS Manager и определяет разрешенное количество и стоимость ретрансляторов. |
| avl_route | периодическая | Активирует модуль **Маршруты**. Включает вкладку Маршруты и связанные отчеты и уведомления. |
| avl_unit | периодическая | Активирует раздел **Объекты** в CMS Manager и вкладку Объекты в системе мониторинга. Определяет стоимость и количество объектов. |
| avl_unit_group | периодическая | Активирует раздел **Группы объектов** в CMS Manager и вкладку **Объекты** в системе мониторинга. Определяет стоимость и количество групп объектов. |
| cms_manager | по требованию | Предоставляет доступ к CMS Manager. |
| create_units | по требованию | Активирует кнопку создания объектов в разделе **Объекты** в CMS Manager и на вкладке **Объекты** в системе мониторинга. |
| create_users | по требованию | Активирует кнопку создания пользователей в разделе **Пользователи** в CMS Manager и на вкладке Пользователи в системе мониторинга. |
| create_unit_groups | по требованию | Активирует кнопку создания групп объектов в разделе **Группы объектов** в CMS Manager и на вкладке Группы объектов в системе мониторинга |
| create_resources | по требованию | Активирует кнопку создания ресурсов и учетных записей в разделе **Ресурсы** в CMS Manager. |
| custom_fields | периодическая | Активирует вкладку **Произвольные поля** в свойствах объектов, пользователей или групп. Определяет стоимость и количество (суммарно, по объектам разных типов) произвольных полей; не влияет на водителей и прицепы. |
| custom_reports | по требованию | Активирует расширенные отчеты: отчеты по группам объектов, пользователям, водителям, прицепам, а также группам водителей и прицепов (кроме таблицы **Журнал** для пользователей и групп объектов). Работает в рамках модуля **Отчеты**. |
| drivers | периодическая | Активирует модуль **Водители** и определяет стоимость и количество водителей. При отключении вкладка **Водители** не отображается, а упоминания о водителях исчезают из уведомлений, настроек пользователя и диалога SMS. |
| driver_groups | периодическая | Определяет количество и стоимость групп водителей. Работает в рамках модуля **Водители**. |
| email_notification | по требованию | Включает отправку уведомлений по email. Рекомендуемое ограничение — 10 отчетов в час (во избежание перегрузки сервера). |
| email_report | по требованию | Включает отправку отчета по email (в рамках модуля Задания). Рекомендуемое ограничение — 10 отчетов в час (во избежание перегрузки сервера). |
| google_service | по требованию | Активирует сервисы Google. |
| import_export | по требованию | Активирует функции **Импорт/Экспорт** на сайтах мониторинга. |
| jobs | периодическая | Активирует вкладку **Задания**. Определяет стоимость и разрешенное количество заданий. |
| locator | по требованию | Активирует опцию **Локатор** в меню пользователя. |
| messages | по требованию | Предоставляет доступ к вкладке **Сообщения**. |
| net_access (устарело) | по требованию | Разрешает аутентификацию через сервисный коннектор в Wialon Pro. |
| notifications | периодическая | Активирует вкладку **Уведомления** и определяет стоимость и разрешенное количество уведомлений. |
| orders | периодическая | Активирует доступ к приложению [Логистика](http://apps.wialon.com/?lang=ru#logistics) и позволяет запускать отчет **Заявки** по объектам и водителям в системе мониторинга. |
| pois (устарело) | периодическая | Активирует панель POI и определяет стоимость и разрешенное количество POI. |
| reports | по требованию | Активирует модуль **Отчеты** и определяет стоимость и разрешенное количество шаблонов отчетов. При отключении исчезают связанные задания и уведомления, а детектор поездок не может быть использован. |
| retranslator_units | периодическая | Определяет количество доступных объектов, привязанных к активированным ретрансляторам. |
| rounds | периодическая | Определяет количество разрешенных рейсов и их стоимость (в рамках модуля **Маршруты**). |
| route_schedules | периодическая | Определяет количество разрешенных расписаний и их стоимость (в рамках модуля **Маршруты**). |
| sdk | по требованию | Предоставляет доступ к Apps. |
| service_intervals | периодическая | Определяет стоимость и количество интервалов техобслуживания. При активации во вкладке свойств объекта появляется вкладка **Интервалы техобслуживания**. Позволяет регистрировать события типа Техобслуживание, запускать отчеты и получать уведомления о техобслуживании. |
| sms | по требованию | Определяет разрешенное количество SMS-сообщений и их стоимость. |
| tacho | по требованию | Активирует таблицы **Активность водителя** и **Нарушения** в отчетах по водителям. |
| storage_user | периодическая | Активирует вкладку **Пользователи** и определяет стоимость и количество пользователей. |
| trailers | периодическая | Активирует вкладку **Прицепы** и определяет стоимость и количество прицепов. |
| trailer_groups | периодическая | Определяет количество и стоимость прицепов; работает в рамках модуля **Прицепы**. |
| unit_commands | периодическая | Активирует вкладку **Команды** в свойствах объекта. Определяет количество (для всех объектов в сумме) и стоимость команд. |
| unit_sensors | периодическая | Определяет количество датчиков (рассчитывается для всех объектов в сумме) и их стоимость. |
| user_notifications | периодическая | Включает получение информационных сообщений от администратора сервиса. |
| Wialon_activex (устарело) | по требованию | Предоставляет удаленный доступ к системе через SDK, ActiveX. |
| wialon_mobile (устарело) | по требованию | Активирует доступ к приложению для Android и iOS. |
| wialon_mobile2 | по требованию | Активирует доступ к [приложению для Android и iOS](https://help.wialon.com/ru/wialon-mobile/android/user-guide/introduction). Требуется включенная услуга wialon_mobile. |
| wialon_sdk | по требованию | Предоставляет удаленный доступ к системе через SDK. |
| zones_library | периодическая | Активирует модуль Геозоны и определяет стоимость и количество геозон. При отключении вкладка **Геозоны** не отображается, а любое упоминание о геозонах исчезает из отчетов и настроек пользователя. |
| zone_groups | периодическая | Активирует группы геозон. |

| AgroService (устарело) | Тип | Описание |
| --- | --- | --- |
| agroplots | периодическая | Поля |
| agroplotgroups | периодическая | Группы полей |
| agrocrops | периодическая | Культуры |
| agromachines | периодическая | Сельхозтехника |
| agroequipments | периодическая | Оборудование |
| agrocultivationtypes | периодическая | Типы обработки |

# get_account_history

Для получения статистики учетной записи используйте метод **account/get_account_history**:

svc=account/get_account_history&params={"itemId":&lt;long&gt;,  
"days":&lt;int&gt;,  
"tz":&lt;int&gt;}

Вы не можете выполнить этот запрос одновременно с запросами из раздела [exchange](https://help.wialon.com/ru/api/user-guide/api-reference/exchange) и следующими запросами:

- […/report/exec_report](https://help.wialon.com/en/api/user-guide/api-reference/report/exec_report)
- […/report/export_result](https://help.wialon.com/en/api/user-guide/api-reference/report/export_result)
- […/report/get_result_chart](https://help.wialon.com/en/api/user-guide/api-reference/report/get_result_chart)
- […/report/get_result_map](https://help.wialon.com/en/api/user-guide/api-reference/report/get_result_map)
- […/messages/load_interval](https://help.wialon.com/en/api/user-guide/api-reference/messages/load_interval)
- […/render/create_messages_layer](https://help.wialon.com/en/api/user-guide/api-reference/render/create_messages_layer)
- […/unit/get_trips](https://help.wialon.com/en/api/user-guide/api-reference/unit/get_trips)
- […/resource/get_driver_bindings](https://help.wialon.com/en/api/user-guide/api-reference/resource/get_driver_bindings)
- […/resource/get_trailer_bindings](https://help.wialon.com/en/api/user-guide/api-reference/resource/get_trailer_bindings)

## Параметры

Запрос должен содержать следующие параметры.

| Название | Описание |
| --- | --- |
| itemId | ID ресурса (учетной записи). |
| days | Интервал, за который запрашивается статистика, в днях. |
| tz  | Часовой пояс. |

## Ответ

Если запрос выполнен успешно, возвращается ответ следующего формата:

\[  
\[  
&lt;uint&gt;, /\* Тип действия: 1 — оплата, 0 — снятие \*/  
&lt;text&gt;, /\* Дата \*/  
&lt;text&gt;, /\* Услуга \*/  
&lt;text&gt;, /\* Стоимость \*/  
&lt;uint&gt;, /\* Количество \*/  
&lt;text&gt;, /\* Информация \*/  
&lt;int&gt; /\* Время регистрации \*/  
\]  
\]

Если запрос завершается ошибкой, возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# get_billing_plans

Запрос доступен только для учетных записей верхнего уровня.

Для получения списка, состоящего из собственного и подчиненных тарифных планов, используйте метод **account/get_billing_plans**:

svc=account/get_billing_plans&params={}

## Ответ

Если запрос выполнен успешно, возвращается ответ следующего формата:

{  
"plan": { /\* Ваш тарифный план. \*/  
"parent": &lt;text&gt;, /\* Название родительского плана. \*/  
"name": &lt;text&gt;, /\* Название тарифного плана. \*/  
"servicesModCounter": &lt;uint&gt;, /\* Счетчик изменений услуг. \*/  
"historyPeriod": &lt;int&gt;, /\* Период хранения сообщений объекта. \*/  
"flags": &lt;uint&gt;, /\* Флаги. \*/  
"denyBalance": &lt;double&gt;, /\* Минимальный баланс, необходимый для работы платных функций. \*/  
"minDaysCounter": &lt;int&gt;, /\* Минимальное количество дней до блокировки учетной записи. \*/  
"blockBalance": &lt;double&gt;, /\* Порог баланса для блокировки учетной записи. \*/  
"currencyFormat": &lt;text&gt;, /\* Формат валюты. \*/  
"descr": &lt;text&gt;, /\* Описание тарифного плана. \*/  
"email": &lt;text&gt;, /\* Email адрес. \*/  
"enable_smtp": &lt;text&gt;, /\* Состояние SMTP email. \*/  
"smtp_host": &lt;text&gt;, /\* SMTP хост. \*/  
"smtp_port": &lt;text&gt;, /\* SMTP порт. \*/  
"smtp_login": &lt;text&gt;, /\* SMTP логин. \*/  
<br/>"nfSmsSender": &lt;text&gt;, /\* Телефон отправителя уведомлений. \*/  
"cmdSmsSender": &lt;text&gt;, /\* Телефон отправителя команд. \*/  
<br/>"hwTypes": { /\* Объект оборудования. \*/  
"&lt;hw_id&gt;": {  
"name": &lt;text&gt; /\* Название оборудования. \*/  
},  
...  
},  
<br/>"personal": {  
"services": &lt;object&gt; /\* Объект услуги (см. ниже). \*/  
},  
<br/>"combined": {  
"services": &lt;object&gt; /\* Объект услуги (см. ниже). \*/  
}  
},  
"subPlans": \[ /\* Список подчиненных тарифных планов. \*/  
{  
"parent": &lt;text&gt;, /\* Название родительского плана. \*/  
"name": &lt;text&gt;, /\* Название тарифного плана. \*/  
"servicesModCounter": &lt;uint&gt;, /\* Счетчик изменений услуг. \*/  
"historyPeriod": &lt;int&gt;, /\* Период хранения сообщений. \*/  
"flags": &lt;uint&gt;, /\* Флаги. \*/  
"denyBalance": &lt;double&gt;, /\* Минимальный баланс, необходимый для работы платных функций. \*/  
"minDaysCounter": &lt;int&gt;, /\* Количество дней до блокировки учетной записи. \*/  
"blockBalance": &lt;double&gt;, /\* Минимальный баланс, необходимый для работы учестной записи \*/  
"currencyFormat": &lt;text&gt;, /\* Формат валюты. \*/  
"descr": &lt;text&gt;, /\* Описание. \*/  
"email": &lt;text&gt;, /\* Email адрес. \*/  
"enable_smtp": &lt;text&gt;, /\* Флаг включения SMTP. \*/  
"smtp_host": &lt;text&gt;, /\* SMTP хост. \*/  
"smtp_port": &lt;text&gt;, /\* SMTP порт. \*/  
"smtp_login": &lt;text&gt;, /\* SMTP логин. \*/  
"nfSmsSender": &lt;text&gt;, /\* Телефон отправителя уведомлений. \*/  
"cmdSmsSender": &lt;text&gt;, /\* Телефон отправителя команд. \*/  
<br/>"hwTypes": {  
"&lt;hw_id&gt;": {  
"name": &lt;text&gt; /\* Название оборудования. \*/  
},  
...  
},  
<br/>"personal": {  
"services": &lt;object&gt; /\* Объект услуг. \*/  
},  
<br/>"combined": {  
"services": &lt;object&gt; /\* Объект комбинированных услуг. \*/  
<br/>}  
},  
...  
\]  
}

### Услуги

"services":{ /\* Объект услуги, где ключами являются корректные названия услуг. \*/  
"&lt;service_name&gt;":{ /\* Вместо &lt;service_name&gt; укажите корректное название услуги. \*/  
<br/>"type": &lt;uint&gt;,  
"maxUsage": &lt;int&gt;,  
"cost": &lt;text&gt;,  
"interval": &lt;uint&gt;,  
"descr": &lt;text&gt;,  
"flags": &lt;uint&gt;,  
"ct": &lt;uint&gt;,  
"mt": &lt;uint&gt;  
},  
...  
}

Полный список услуг можно найти на странице [account/get_account_data](https://help.wialon.com/en/spaces/api/user-guide/api-reference/account/get_account_data).

# get_business_spheres

Сферы бизнеса доступны только для пользователей учетных записей верхнего уровня или учетных записей с дилерскими правами. Для получения доступных сфер бизнеса, которые могут быть использованы в качестве сферы бизнеса клиента, используйте метод **get_business_spheres**:

svc=account/get_business_spheres&params={"lang":""}

Параметр **lang** является необязательным. Значение по умолчанию – **en**.

## Ответ

Если запрос выполнен успешно, ответ содержит список доступных сфер бизнеса. Пример:

{  
"long_haul_transportation":{  
"name":"Long-haul transportation",  
"group":"Transportation and delivery",  
"position":1  
},  
"local_fmcg_delivery":{  
"name":"Local FMCG delivery",  
"group":"Transportation and delivery",  
"position":2  
},  
"food_and_grocery_delivery":{  
"name":"Food and grocery delivery",  
"group":"Transportation and delivery",  
"position":3  
},  
"cold_chain_transportation":{  
"name":"Cold chain transportation",  
"group":"Transportation and delivery",  
"position":4  
},  
"post_and_express_mail_services":{  
"name":"Post and express mail services",  
"group":"Transportation and delivery",  
"position":5  
},  
"pharmaceutical_transportation":{  
"name":"Pharmaceutical transportation",  
"group":"Transportation and delivery",  
"position":6  
},  
"dangerous_goods_transportation":{  
"name":"Dangerous goods transportation",  
"group":"Transportation and delivery",  
"position":7  
},  
"maritime_and_waterway_delivery":{  
"name":"Maritime and waterway delivery",  
"group":"Transportation and delivery",  
"position":8  
},  
"railway_cargo_transport":{  
"name":"Railway cargo transport",  
"group":"Transportation and delivery",  
"position":9  
},  
"drone_delivery":{  
"name":"Drone delivery",  
"group":"Transportation and delivery",  
"position":10  
},  
"public_transport":{  
"name":"Public transport",  
"group":"Passenger transport",  
"position":11  
},  
"taxi_limo_and_ridesharing_services":{  
"name":"Taxi, limo and ridesharing services",  
"group":"Passenger transport",  
"position":12  
},  
"student_transport":{  
"name":"Student transport",  
"group":"Passenger transport",  
"position":13  
},  
"corporate_transport":{  
"name":"Corporate transport",  
"group":"Passenger transport",  
"position":14  
},  
"railway_passenger_transport":{  
"name":"Railway passenger transport",  
"group":"Passenger transport",  
"position":15  
},  
"maritime_passenger_transport":{  
"name":"Maritime passenger transport",  
"group":"Passenger transport",  
"position":16  
},  
"government_and_ngo_vehicles":{  
"name":"Government and NGO vehicles",  
"group":"Passenger transport",  
"position":17  
},  
"food_industry":{  
"name":"Food industry",  
"group":"Industry and manufacturing",  
"position":18  
},  
"industrial_manufacturing":{  
"name":"Industrial manufacturing",  
"group":"Industry and manufacturing",  
"position":19  
},  
"electric_power_generation_and_services":{  
"name":"Electric power generation and services",  
"group":"Industry and manufacturing",  
"position":20  
},  
"consumer_goods_manufacturing":{  
"name":"Consumer goods manufacturing",  
"group":"Industry and manufacturing",  
"position":21  
},  
"crop_farming":{  
"name":"Crop farming",  
"group":"Agriculture",  
"position":22  
},  
"greenhouse_and_hydroponics":{  
"name":"Greenhouse and hydroponics",  
"group":"Agriculture",  
"position":23  
},  
"forestry":{  
"name":"Forestry",  
"group":"Agriculture",  
"position":24  
},  
"animal_breeding":{  
"name":"Animal breeding",  
"group":"Agriculture",  
"position":25  
},  
"construction_and_demolition":{  
"name":"Construction and demolition",  
"group":"Construction",  
"position":26  
},  
"landscaping":{  
"name":"Landscaping",  
"group":"Construction",  
"position":27  
},  
"ready_mix_concrete":{  
"name":"Ready-mix concrete",  
"group":"Construction",  
"position":28  
},  
"roadworks":{  
"name":"Roadworks",  
"group":"Construction",  
"position":29  
},  
"child_protection":{  
"name":"Child protection",  
"group":"Personal monitoring",  
"position":30  
},  
"field_workers":{  
"name":"Field workers",  
"group":"Personal monitoring",  
"position":31  
},  
"people_with_special_needs":{  
"name":"People with special needs",  
"group":"Personal monitoring",  
"position":32  
},  
"prisoners_in_custody_and_on_parole":{  
"name":"Prisoners in custody and on parole",  
"group":"Personal monitoring",  
"position":33  
},  
"delivery_personnel":{  
"name":"Delivery personnel",  
"group":"Personal monitoring",  
"position":34  
},  
"leasing_and_auto_loans":{  
"name":"Leasing and auto loans",  
"group":"Rentals and sharing",  
"position":35  
},  
"carsharing":{  
"name":"Carsharing",  
"group":"Rentals and sharing",  
"position":36  
},  
"micromobility":{  
"name":"Micromobility",  
"group":"Rentals and sharing",  
"position":37  
},  
"car_and_truck_rental":{  
"name":"Car and truck rental",  
"group":"Rentals and sharing",  
"position":38  
},  
"equipment_and_special_machinery_rental":{  
"name":"Equipment and special machinery rental",  
"group":"Rentals and sharing",  
"position":39  
},  
"oil_gas_fuel":{  
"name":"Oil, gas, fuel",  
"group":"Mining and processing",  
"position":40  
},  
"mining_and_quarrying":{  
"name":"Mining and quarrying",  
"group":"Mining and processing",  
"position":41  
},  
"raw_materials_processing":{  
"name":"Raw materials processing",  
"group":"Mining and processing",  
"position":42  
},  
"smart_home_and_office":{  
"name":"Smart home and office",  
"group":"Building automation and management",  
"position":43  
},  
"domestic_utilities_and_services":{  
"name":"Domestic utilities and services",  
"group":"Building automation and management",  
"position":44  
},  
"telecom_cable_tv":{  
"name":"Telecom, cable TV",  
"group":"Building automation and management",  
"position":45  
},  
"security_alarm_fire_systems":{  
"name":"Security, alarm, fire systems",  
"group":"Building automation and management",  
"position":46  
},  
"ambulance_and_emergency_services":{  
"name":"Ambulance and emergency services",  
"group":"Security and public safety",  
"position":47  
},  
"police":{  
"name":"Police",  
"group":"Security and public safety",  
"position":48  
},  
"fire_safety":{  
"name":"Fire safety",  
"group":"Security and public safety",  
"position":49  
},  
"security_services":{  
"name":"Security services",  
"group":"Security and public safety",  
"position":50  
},  
"stolen_vehicle_recovery_svr":{  
"name":"Stolen vehicle recovery (SVR)",  
"group":"Security and public safety",  
"position":51  
},  
"video_surveillance":{  
"name":"Video surveillance",  
"group":"Security and public safety",  
"position":52  
},  
"military":{  
"name":"Military",  
"group":"Security and public safety",  
"position":53  
},  
"waste_management":{  
"name":"Waste management",  
"group":"Public utilities",  
"position":54  
},  
"street_cleaning_and_roadworks":{  
"name":"Street cleaning and roadworks",  
"group":"Public utilities",  
"position":55  
},  
"towing_and_roadside_assistance":{  
"name":"Towing and roadside assistance",  
"group":"Public utilities",  
"position":56  
},  
"gas_stations":{  
"name":"Gas stations",  
"group":"Stationary assets",  
"position":57  
},  
"electric_generators_and_wind_turbines":{  
"name":"Electric generators and wind turbines",  
"group":"Stationary assets",  
"position":58  
},  
"vending_machines":{  
"name":"Vending machines",  
"group":"Stationary assets",  
"position":59  
},  
"equipment_and_tools":{  
"name":"Equipment and tools",  
"group":"Stationary assets",  
"position":60  
},  
"electric_charging_stations":{  
"name":"Electric charging stations",  
"group":"Stationary assets",  
"position":61  
},  
"consumer_goods":{  
"name":"Consumer goods",  
"group":"Stationary assets",  
"position":62  
},  
"other_stationary_assets":{  
"name":"Other stationary assets",  
"group":"Stationary assets",  
"position":63  
},  
"vehicle_maintenance_and_repair":{  
"name":"Vehicle maintenance and repair",  
"group":"Vehicle servicing",  
"position":64  
},  
"insurance":{  
"name":"Insurance",  
"group":"Vehicle servicing",  
"position":65  
},  
"pet_monitoring":{  
"name":"Pet monitoring",  
"group":"Animal tracking",  
"position":66  
},  
"wildlife_tracking":{  
"name":"Wildlife tracking",  
"group":"Animal tracking",  
"position":67  
},  
"indoor_asset_tracking":{  
"name":"Indoor asset tracking",  
"group":"Indoor Tracking",  
"position":68  
},  
"indoor_person_tracking":{  
"name":"Indoor person tracking",  
"group":"Indoor Tracking",  
"position":69  
},  
"other":{  
"name":"Other",  
"group":"Other",  
"position":70  
}  
<br/>}

Если запрос завершается ошибкой, возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# list_change_accounts

Для получения списка учетных записей, в которые можно передать объект, используйте метод **list_change_accounts**:

svc=account/list_change_accounts&params={"units":\[&lt;long&gt;\]} |

Запрос должен содержать параметр **unit**, указывающий массив ID объектов.

## Ответ

Если запрос выполнен успешно, возвращается ответ следующего формата:

\[  
{  
"id":&lt;long&gt;, /\* ID учетной записи. \*/  
"name":&lt;text&gt; /\* Название учетной записи. \*/  
},  
... /\* Другие доступные учетные записи (если есть). \*/  
\]

# sites

Вы можете использовать метод **account/sites** для получения списка сайтов учетной записи верхнего уровня и обновления ветки сайта.

## Получение списка сайтов

Для получения списка сайтов (wialon_web) учетной записи верхнего уровня установите параметр **callMode** в значение **list**.

svc=account/sites&params={"callMode":"list"}

## Обновление сайта

Для обновления ветки вы можете использовать запрос, который применяет активные ветки (ADF + CMS) к сайтам wialon_web.

С помощью этого запроса может быть изменена только опция сайта **branch_mode**.

Запрос отправляется в виде JSON-объекта, где ключами являются названия сайтов.

Установите параметр **callMode** в значение **update**, укажите название сайта и ветку:

svc=account/sites&params={"callMode":"update","sites":{"&lt;site_name&gt;":"&lt;branch_value&gt;"}}

где **&lt;site_name&gt;** является текстовым значением названия сайта, а **&lt;branch_value&gt;** — это значение режима ветки сайта, описанное ниже.

Значения соответствуют следующим веткам:

| Значение | Ветка сайта |
| --- | --- |
| 0   | Стабильная. |
| 1   | Бета. |
| 2   | Стабильная и бета. |

## Ответ

Если запрос выполнен успешно, возвращается ответ следующего формата:

\[  
{  
"n":"video-hosting.wialon.com", /\* Адрес сайта. \*/  
"cn":"hosting_video", /\* Название сайта. \*/  
"bm":0 /\* Режим ветки 0, 1, 2. \*/  
},  
{  
"n":"night-hosting.wialon.com",  
"cn":"default_night",  
"bm":0  
},  
{  
"n":"beta-hosting.wialon.com",  
"cn":"hosting_beta",  
"bm":0  
},  
{  
"n":"wialonb3.gurtam.com",  
"cn":"GurtamTest",  
"bm":0  
},  
{  
"n":"my-hosting.wialon.com",  
"cn":"GurtamTest7",  
"bm":0  
},  
{  
"n":"us.hosting.wialon.net",  
"cn":"GurtamTest5",  
"bm":0  
},  
{  
"n":"qa.wialon.com",  
"cn":"GurtamTest_3",  
"bm":0  
},  
{  
"n":"sales-hosting.wialon.com",  
"cn":"GurtamTest6",  
"bm":0  
}  
\]

Если запрос завершается ошибкой, возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# trash

В учетной записи верхнего уровня вы можете получить список удаленных макро-элементов в корзине. Вы также можете восстановить их при помощи метода **account/trash**:

svc=account/trash&params={"callMode":&lt;text&gt;, "guids":\[&lt;text&gt;\]}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| callMode | Возможные значения - **list** и **restore**. **List** используется для получения списка удаленных объектов. Для восстановления объектов укажите значение **restore**. |
| GUIDs | GUID элементов для восстановления. Используется для режима **restore**. |

Вы можете восстановить удаленный элемент только через 20 минут после его удаления.

## Ответ

Если запрос выполнен успешно, ответ для списка макро-элементов в корзине имеет следующий вид:

{  
"code":&lt;uint&gt;,  
"items": \[  
{  
"guid":&lt;text&gt;, /\* GUID \*/  
"name":&lt;text&gt;, /\* Имя элемента. \*/  
"tm":&lt;uint&gt;, /\* Время удаления. \*/  
"type":&lt;text&gt;, /\* Тип макро-элемента (например, "avl_resource"). \*/  
"creator_id":&lt;text&gt;, /\* ID создателя. \*/  
"tm":&lt;\*\*int\*\*&gt;, /\* Время удаления \*/  
"props":  
{  
"prop_name":&lt;prop_type&gt;, /\* Список свойств общедоступных элементов (строка, целое число, длинное число, двойное число). \*/ ...  
}  
},  
...  
\]  
}

Ответ на запрос на восстановление макро-элементов из корзины:

{  
"code":&lt;uint&gt;,  
"items": \[  
{  
"name":&lt;text&gt;, /\* Название элемента. \*/  
"result":&lt;bool&gt;, /\* Результат: 1 — успешно, 0 — ошибка. \*/  
"type":&lt;text&gt;, /\* Тип макро-элемента. \*/  
"reason":&lt;text&gt; /\* Причина возможной ошибки. \*/  
},  
...  
\]  
}

Если объект не удалось восстановить, в ответе могут быть указаны следующие причины:

- MAX_ITEMS_EXCEEDED. Превышен лимит, установленный для ресурса.
- TIMEOUT_20_MIN. Вы можете восстановить удаленный элемент только через 20 минут после его удаления.
- INTERNAL_SERVER_ERROR. Произошла ошибка сервера.

# trash_microelements

В учетной записи верхнего уровня вы можете получить список удаленных микро-элементов в корзине и восстановить их с помощью метода **account/trash_microelements**:

svc=account/trash_microelements&params={"callMode":&lt;text&gt;}

Установите параметр **callmode** в значение **list** для получения списка микро-элементов и **restore** для их восстановления из корзины.

svc=account/trash_microelements&params={"callMode":"restore","items":\[{"type":&lt;text&gt;,"guid":&lt;text&gt;,"props":\["name":&lt;text&gt;,"ids":\[&lt;long&gt;\]\]}\]}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| type | Передайте значение **avl_resource** в этом параметре. |
| guid | GUID ресурса. |
| name | Тип микро-элемента: “drivers”, “trailers”, “tags” (пассажиры). |
| ids | ID микро-элементов (водители, прицепы, пассажиры). |

## Ответ

Если запрос выполнен успешно, ответ для списка удаленных микро-элементов имеет следующий вид:

{  
"code":&lt;uint&gt;,  
"items": \[  
{  
"type":&lt;text&gt;, /\* avl_resource \*/  
"guid":&lt;text&gt;, /\* GUID ресурса\*/  
"name":&lt;text&gt; /\* Имя ресурса \*/  
"trailers": \[  
{  
...  
}  
\],  
"drivers": \[  
{  
...  
}  
\],  
"tags": \[  
{  
...  
}  
}  
},  
...  
\]  
}

Ответ на запрос о восстановлении удаленных микро-элементов: учетные данные

{  
"code":&lt;uint&gt;,  
"items": \[  
{  
"guid":&lt;text&gt;, /\* GUID ресурса\*/  
"type":&lt;text&gt;, /\* avl_resource \*/  
"props": \[  
{  
"name":&lt;text&gt;, /\* Тип микро-элемента: "drivers", "trailers", "tags" (пассажиры). \*/  
"id":&lt;int&gt;, /\* ID микро-элемента (водитель, прицеп, пассажир)\*/  
"result":&lt;int&gt;, /\* Результат: 1 — успешно, 0 — ошибка. \*/  
}  
\]  
},  
...  
\]  
}

# update_billing_plan

Для создания, обновления и удаления тарифного плана используйте метод **update_billing_plan**.

svc=account/update_billing_plan&params={"callMode":&lt;text&gt;,  
"plan":{  
"name":&lt;text&gt;,  
"rename":&lt;text&gt;,  
"servicesModCounter":&lt;uint&gt;,  
"historyPeriod":&lt;\*\*int\*\*&gt;,  
"flags":&lt;uint&gt;,  
"denyBalance":&lt;\*\*double\*\*&gt;,  
"blockBalance":&lt;\*\*double\*\*&gt;,  
"minDaysCounter":&lt;\*\*int\*\*&gt;,  
"currencyFormat":&lt;text&gt;,  
"descr":&lt;text&gt;,  
"email":&lt;text&gt;,  
"enable_smtp": &lt;text&gt;, /\* Состояние SMTP email \*/  
"smtp_host": &lt;text&gt;, /\* SMTP-хост \*/  
"smtp_port": &lt;text&gt;, /\* SMTP-порт \*/  
"smtp_login": &lt;text&gt;, /\* SMTP-логин \*/  
"smtp_password": &lt;text&gt;, /\* SMTP-пароль \*/  
"mapserver_tags":&lt;text&gt;, /\* Теги карт \*/  
"hwTypes":{  
"&lt;hw_id&gt;":  
{  
"name": &lt;uint&gt;  
},  
...  
},  
"parent": &lt;text&gt;,  
"personal":  
{  
"services": &lt;object&gt;  
}  
}  
}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| callMode | Тип запроса (создание, обновление, удаление). |
| name | Название тарифного плана (уникальное поле). |
| rename | Новое название тарифного плана. Вы не можете редактировать название тарифного плана пользователя учетной записи верхнего уровня. Названия тарифных планов уникальны. Вы не можете дать одинаковое название двум тарифным планам. |
| servicesModCounter | Количество изменений в списке услуг. |
| historyPeriod | Время хранения сообщений объекта в днях. |
| flags | Флаги тарифного плана (см. ниже). |
| denyBalance | Минимальный баланс для активности учетной записи. Если баланс ниже, учетная запись блокируется. |
| blockBalance | Минимальный баланс для доступности платных услуг. Если баланс ниже, услуги блокируются. |
| minDaysCounter | Количество дней, оставшихся до блокировки учетной записи. Количество дней уменьшается, если включена опция **Блокировка по дням**. |
| currencyFormat | Формат валюты. |
| descr | Описание тарифного плана. |
| email | Email адрес. |

### Флаги тарифного плана

| Флаг | Описание |
| --- | --- |
| 0x01 | Блокировать пользователей, если баланс ниже порога блокировки. |
| 0x02 | Если баланс ниже минимального, пользователь не может войти в систему, а учетная запись блокируется. |
| 0x08 | Запрещено использовать указанные типы оборудования. |
| 0x10 | Запрещено использовать типы оборудования, которые не указаны. |
| 0x20 | Уменьшать количество дней в счетчике дней и блокировать учетную запись, когда количество оставшихся дней достигает минимума. |

### Типы оборудования

| Название | Описание |
| --- | --- |
| &lt;hw_name&gt; | Название оборудования. |
| id  | ID оборудования. |

### Услуги

| Название | Описание |
| --- | --- |
| cost | Лимит и стоимость в формате, описанном на странице [Услуги](https://help.wialon.com/ru/wialon-hosting/user-guide/management-system/accounts-and-resources/account-properties/services#limit-and-cost). |
| descr | Описание услуги. |
| flags | Определяет действие: 0 — нет, 1 — создать/обновить, 2 — удалить. |
| interval | Частота сброса:<br><br>0 — нет<br><br>1 — ежечасно<br><br>2 — ежедневно<br><br>3 — еженедельно<br><br>4 — ежемесячно |
| maxUsage | Количество доступных элементов. |
| name | Название услуги. |
| type | Тип услуги: 1 — по требованию, 2 — периодическая. |

Более подробную информацию об услугах можно найти на странице [get_account_data](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_data).

## Ответ

Если запрос выполнен успешно, ответ имеет следующий вид:

{  
"parent":&lt;text&gt;, /\* Название родительского тарифного плана. \*/  
"name":&lt;text&gt;, /\* Название тарифного плана. \*/  
"servicesModCounter":&lt;uint&gt;, /\* Количество изменений услуг.\*/  
"historyPeriod":&lt;uint&gt;, /\* Период хранения сообщений в днях. Если указан 0, период не ограничен. \*/  
"flags":&lt;uint&gt;, /\* Флаги тарифного плана. \*/  
"denyBalance":&lt;int&gt;, /\* Значение баланса, при котором платные услуги становятся недоступными. \*/  
"blockBalance":&lt;int&gt;, /\* Значение баланса, при котором учетная запись блокируется. \*/  
"minDaysCounter":&lt;int&gt;, /\* Количество дней, оставшихся до блокировки учетной записи. \*/  
"currencyFormat":&lt;text&gt;, /\* Формат валюты. \*/  
"descr":&lt;text&gt;, /\* Описание. \*/  
"email":&lt;text&gt;, /\* Email. \*/  
"mapserverTags":&lt;text&gt;, /\* Теги сервера карт. \*/  
"hwTypes":{ /\* Объект оборудования. \*/  
"&lt;hw_id&gt;": /\* ID оборудования. \*/  
{  
"name": &lt;text&gt; /\* Название оборудования. \*/  
},  
...  
},  
"personal":  
{  
"services": &lt;object&gt; /\* Объект услуг (см. ниже). \*/  
},  
"combined":  
{  
"services":{ /\* Объект услуг, где ключами являются корректные названия услуг. \*/  
"&lt;service_name&gt;":{ /\* Вместо &lt;service_name&gt; укажите название услуги. \*/  
"type": &lt;uint&gt;, /\* Тип: 1 — по требованию; 2 — периодическая. \*/  
"maxUsage": &lt;int&gt;, /\* Количество активных ресурсов услуги. \*/  
"cost": &lt;text&gt;, /\* Максимальное количество ресурсов. \*/  
"interval": &lt;uint&gt;, /\* Таблица стоимости. \*/  
"descr": &lt;text&gt;, /\* Интервал: 0 — нет, 1 — ежечасно, 2 — ежедневно, 3 — еженедельно, 4 — ежемесячно. \*/  
"flags": &lt;uint&gt;  
},  
...  
}  
}  
}

Для получения более подробной информации об услугах посетите страницу [get_account_data](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_data#services_list).

# update_billing_service

Для управления доступными услугами и их стоимостью используйте метод **account/update_billing_service**.

svc=account/update_billing_service&params={"itemId":&lt;long&gt;,  
"name":&lt;text&gt;,  
"type":&lt;ubyte&gt;,  
"intervalType":&lt;ubyte&gt;,  
"costTable":&lt;text&gt;  
}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID ресурса (учетной записи). |
| name | Название услуги. Полный список услуг можно найти на странице [get_account_data](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_data). |
| type | Тип услуги:<br><br>**1** – по требованию (например, SMS). **IntervalType** определяет, как часто сбрасывается указанный лимит.<br><br>**2** – периодические услуги. Оплата производится после определенного временного интервала. |
| intervalType | Тип интервала сброса:<br><br>**0** – никогда,<br><br>**1** – ежечасно,<br><br>**2** – ежедневно,<br><br>**3** – еженедельно,<br><br>**4** – ежемесячно. |
| costTable | Лимит и стоимость в формате, описанном на странице [Услуги](https://help.wialon.com/ru/wialon-hosting/user-guide/management-system/accounts-and-resources/account-properties/services#limit-and-cost). |

## Ответ

Если услуга успешно обновлена, возвращается пустой объект. В противном случае возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# update_business_sphere

Чтобы установить сферу бизнеса для учетной записи, используйте метод **account/update_business_sphere**:

svc=account/update_business_sphere&params={"itemId":&lt;long&gt;, "sph":&lt;text&gt;}

Принимаются только учетные записи (не ресурсы). Поле **sph** должно содержать либо действительные ID (взятые из конфигурационного файла), либо пустое значение для сброса.

Вы можете получить список сфер бизнеса с помощью команды [account/get_business_spheres](https://help.wialon.com/ru/spaces/api/user-guide/api-reference/account/get_business_spheres).

## Ответ

Если сфера бизнеса успешно обновлена, возвращается пустой объект.

В противном случае в ошибке указывается одна из следующих причин:

- item is not account. Вы указали ID объекта, который не является учетной записью.
- unknown sphere id. Значение в поле **sph** некорректно.

{"error":&lt;\*\*int\*\*&gt;,"reason":&lt;unknown sphere id&gt; }

# update_dealer_rights

Для предоставления учетной записи дилерских прав применяется метод **account/update_dealer_rights**:

svc=account/update_dealer_rights&params={"itemId":&lt;long&gt;,  
"enable":&lt;bool&gt;}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID ресурса (учетной записи). |
| enable | Включить или отключить дилерские права. |

## Ответ

Если дилерские права успешно включены, возвращается пустой объект. В противном случае возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# update_flags

Для установки флагов настроек учетной записи используйте метод **account/set_flags**:

svc=account/update_flags&params={"itemId":&lt;long&gt;,  
"flags":&lt;long&gt;,  
"blockBalance":&lt;double&gt;,  
"denyBalance":&lt;double&gt;}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID ресурса (учетной записи). |
| flags | Флаги настроек учетной записи. Подробнее о флагах учетной записи читайте на странице [get_account_data](https://help.wialon.com/ru/api/user-guide/api-reference/account/get_account_data). |
| blockBalance | Значение баланса, при котором учетная запись блокируется. |
| denyBalance | Значение баланса, при котором платные услуги становятся недоступными. |

## Ответ

Если флаги успешно обновлены, возвращается пустой объект.

В противном случае возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# **update_history_period**

Для обновления периода хранения данных учетной записи используйте метод **account/update_history_period**:

svc=account/update_history_period&params={"itemId":&lt;long&gt;,  
"historyPeriod":&lt;int&gt;}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID ресурса (учетной записи). |
| historyPeriod | Значение периода хранения в днях. Если значение имеет маску **0x10000**, период хранения измеряется в месяцах. |

## Ответ

Если период хранения успешно обновлен, возвращается пустой объект.

В противном случае возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# update_min_days

Для обновления минимального количества дней используйте метод **account/update_min_days**:

svc=account/update_min_days&params={"itemId":&lt;long&gt;,  
"minDays":&lt;int&gt;}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID ресурса (учетной записи). |
| minDays | Минимальное количество дней. |

## Ответ

Если количество дней успешно обновлено, возвращается пустой объект.

В противном случае возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# update_plan

Предварительные требования

Для назначения тарифного плана учетной записи пользователь должен иметь право доступа **Управление учетной записью** к этой учетной записи (см. [core/check_items_billing](https://help.wialon.com/ru/api/user-guide/api-reference/core/check_items_billing)). Пользователь должен быть прямым или косвенным родителем учетной записи.

Для назначения тарифного плана используйте метод **account/update_plan**.

svc=account/update_plan&params={"itemId":&lt;long&gt;,  
"plan":&lt;text&gt;}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID ресурса (учетной записи). |
| plan | Название тарифного плана. |

## Ответ

Если план успешно назначен, возвращается пустой объект.

В противном случае возвращается [код ошибки](https://help.wialon.com/ru/api/user-guide/error-codes).

# update_sub_plans

Предварительные требования

Пользователь может назначать только доступные подчиненные тарифные планы. Для назначения тарифного плана учетной записи пользователь должен быть прямым или косвенным родителем учетной записи и иметь следующие разрешения:

Право доступа **Управление учетной записью** к этой учетной записи (см. [core/check_items_billing](https://help.wialon.com/ru/api/user-guide/api-reference/core/check_items_billing)).

дилерские права. Для их включения используйте метод [account/update_dealer_rights](https://help.wialon.com/ru/api/user-guide/api-reference/account/update_dealer_rights).

Для установки списка подчиненных планов, которые указанная учетная запись может назначать, используйте метод **account/update_sub_plans**:

svc=account/update_sub_plans&params={"itemId":&lt;long&gt;,  
"plans":\[&lt;text&gt;\]}

## Параметры

Запрос должен содержать следующие параметры:

| Параметр | Описание |
| --- | --- |
| itemId | ID ресурса (учетной записи). |
| plans | Список подчиненных планов. |

## Ответ

Если план успешно обновлен, возвращается пустой объект.

В противном случае ответ содержит код ошибки 7, указывающий на то, что у пользователя нет дилерских прав.

# token

В этом разделе описываются методы для работы с токенами.

# list

Для получения списка токенов используйте метод **token/list**.

svc=token/list&params={"userId":&lt;text&gt;}

## Параметры

Запрос может содержать параметр **userId**, указывающий идентификатор нижестоящего пользователя. Параметр является необязательным.

## Ответ

В случае успешного выполнения запроса возвращается ответ следующего формата:

\[  
{  
"h":&lt;text&gt;, /\* Уникальное имя токена, 72 символа. \*/  
"app":&lt;text&gt;, /\* Название приложения. \*/  
"at":&lt;uint&gt;, /\* Время активации токена, UNIX-time. \*/  
"ct":&lt;uint&gt;, /\* Время создания токена, UNIX-time. \*/  
"dur":&lt;uint&gt;, /\* Длительность действия токена после активации, секунды. \*/  
"fl":&lt;uint&gt;, /\* Флаги доступа. \*/  
"items":\[&lt;long&gt;\], /\* Список идентификаторов элементов, к которым токен предоставляет доступ. \*/  
"p":&lt;text&gt; /\* Пользовательские параметры. Значение должно быть объектом или массивом объектов. \*/  
},  
... /\* Другие токены (если есть). \*/  
\]

В случае неудачного выполнения запроса ответ содержит код ошибки 7, указывающий на отсутствие у пользователя необходимого права доступа (ADF_ACL_ITEM_VIEW_PROPERTIES).

# login

Для получения токена используйте формы, указанные в разделе [login](https://help.wialon.com/en/api/user-guide/api-reference/login). Для работы под токеном используется **token/login**. Сигнатура метода следующая:

svc=token/login&params={"token":&lt;text&gt;,  
"operateAs":&lt;text&gt;,  
"fl":&lt;uint&gt;  
}

## Параметры

Запрос может содержать следующие параметры. Обязательные параметры отмечены звездочкой (\*).

| Имя | Описание |
| --- | --- |
| token\* | Уникальное имя токена. Состоит из 72 символов. |
| operateAs | Имя подчиненного пользователя для входа. |
| fl\* | Флаги ответа (см. ниже). |

### Флаги ответа

| Флаг в HEX | Флаг в DEC | Описание |
| --- | --- | --- |
| 0x1 | 1   | Общая информация. |
| 0x2 | 2   | Информация о пользователе. |
| 0x4 | 4   | Информация о токене. |
| 0x8 | 8   | Информация об элементах. |
| 0x10 | 16  | Информация от тарифицируемых услугах |
| 0x20 | 32  | Произвольные свойства пользователя. |

### Как получить имя токена

- Создайте новый токен ([token/update](https://help.wialon.com/ru/spaces/api/user-guide/api-reference/token/update), **callmode:create**);
- Если токены уже созданы, выполните команду **token/list**.

Вы не можете войти в систему с помощью неактивированного токена (параметр **at** в параметрах токена).

## Ответ

Если запрос выполнен успешно, новый параметр **token** добавляется ко всем параметрам токена в качестве значения. Возвращается ответ следующего формата:

{  
"eid":&lt;text&gt;, /\* ID сессии. \*/  
"gis_sid":&lt;text&gt;, /\* ID сессии для гис-сервисов. \*/  
"host":&lt;text&gt;, /\* Хост. \*/  
"hw_gw_ip":&lt;text&gt;, /\* IP аппаратного шлюза. \*/  
"au":&lt;text&gt;, /\* Имя пользователя. \*/  
"pi":&lt;int&gt;, /\* Пинг. \*/  
"tm":&lt;uint&gt;, /\* Текущее время (UTC). \*/  
"wsdk_version":&lt;text&gt; /\* Версия SDK \*/  
"user":{ /\* Пользователь, от имени которого выполняется вход. \*/  
"nm":&lt;text&gt;, /\* Имя. \*/  
"cls":&lt;uint&gt;, /\* ID суперкласса "пользователь". \*/  
"id":&lt;long&gt;, /\* ID \*/  
"prp":{ /\* Пользовательские свойства, например: \*/  
"dst":&lt;text&gt;, /\* переход на летнее время \*/  
"language":&lt;text&gt;, /\* язык (двухбуквенный код) \*/  
"msakey":&lt;text&gt;, /\* ключ доступа к мобильному сайту \*/  
"pcal":&lt;text&gt;, /\* иранский календарь \*/  
"tz":&lt;text&gt;, /\* часовой пояс \*/  
"us_units":&lt;text&gt;, /\* американская система мер (мили и галлоны) \*/  
...  
},  
"crt":&lt;uint&gt;, /\* ID создателя. \*/  
"bact":&lt;uint&gt;, /\* ID учетной записи. \*/  
"fl":&lt;uint&gt;, /\* Флаги пользователя. \*/  
"hm":&lt;text&gt;, /\* Маска хоста. \*/  
"uacl":&lt;uint&gt;, /\* Доступ пользователя к своей учетной записи. \*/  
"mu": &lt;uint&gt;, /\* Система измерений. \*/  
"ct": &lt;uint&gt;, /\* Дата создания пользователя. \*/  
"ftp": {&lt;text&gt;}, /\* Настройки FTP \*/  
"ld": &lt;uint&gt;, /\* Дата последнего входа. \*/  
"pfl": &lt;uint&gt;, /\* Флаг создателя \*/  
"ap": { /\* Настройки двухфакторной аутентификации \*/  
"type":&lt;uint&gt;, /\* Тип аутентификации ( 0 — нет, 1 — email, 2 — SMS ). \*/  
"phone":&lt;text&gt; /\* Номер телефона. \*/  
},  
"mapps": {&lt;text&gt;}, /\* Список мобильных приложений. \*/  
"mappsmax": &lt;int&gt; /\* Ограничения на мобильные приложения, указанные в тарифном плане. \*/  
},  
"classes":{ /\* Суперклассы, доступные текущему пользователю (ключ — имя суперкласса, значение — ID суперкласса): \*/  
"avl_hw":&lt;uint&gt;, /\* Тип оборудования. \*/  
"avl_resource":&lt;uint&gt;, /\* Ресурс. \*/  
"avl_retranslator":&lt;uint&gt;, /\* Ретранслятор. \*/  
"avl_unit":&lt;uint&gt;, /\* Объект. \*/  
"avl_unit_group":&lt;uint&gt;, /\* Группа объектов. \*/  
"user":&lt;uint&gt;, /\* Пользователь. \*/  
"avl_route":&lt;uint&gt; /\* Маршрут. \*/  
}  
"features":{  
"unlim":&lt;bool&gt;, /\* Тип тарифного плана: 0 — обычный, 1 — специальный (для разработки/тестирования). \*/  
"svcs":{ /\* Хеш-коллекция разрешенных сервисов. Если сервис здесь не упомянут, значит он запрещен. \*/  
"&lt;service_name&gt;":&lt;bool&gt;, /\* Ключ — имя сервиса, значение: 0 — сервис доступен, но достигнут лимит, 1 — сервис доступен и может использоваться. \*/  
...  
}  
}  
<br/>..., /\* Ответ core/login. \*/  
<br/>"token":"{\\"app\\":\\"&lt;text&gt;\\",\\"ct\\":&lt;uint&gt;\\"at\\":&lt;uint&gt;,\\"dur\\":&lt;uint&gt;,\\"fl\\":&lt;uint&gt;\\"p\\":\\"&lt;text&gt;\\",\\"items\\":\[&lt;long&gt;\]}",  
/\* Все настройки токена в виде экранированного JSON. \*/  
... /\* ответ core/login \*/  
}

В случае неудачного выполнения запроса возвращается код ошибки.

### Коды ошибок

| Код ошибки | Описание |
| --- | --- |
| 6   | Неизвестная ошибка. |
| 4   | Неверная длина токена. |
| 1003 | Превышен лимит запросов. |
| 7   | Одна из следующих ошибок:<br><br>пользователь отключен<br><br>не достигнуто время активации ключа<br><br>нет доступа к услуге. |
| 8   | Указанный подчиненный пользователь не найден или у вас нет прав доступа к этому пользователю. |

# update

Этот метод используется для управления вашими токенами и токенами пользователей, к которым у вас есть доступ. Этот метод не используется для аутентификации. Для входа в систему используйте **token/login**.

Для создания, редактирования или удаления токена используйте метод **token/update**:

svc=token/update&params={"callMode":&lt;text&gt;,  
"userId":&lt;text&gt;,  
"h":&lt;text&gt;,  
"app":&lt;text&gt;,  
"at":&lt;uint&gt;,  
"dur":&lt;uint&gt;,  
"fl":&lt;uint&gt;,  
"p":&lt;text&gt;,  
"items":\[&lt;long&gt;\],  
"deleteAll":&lt;bool&gt;|&lt;text&gt;  
}

## Параметры

Запрос может содержать следующие параметры. Обязательные параметры отмечены звездочкой (\*).

| Имя | Описание |
| --- | --- |
| callMode\* | Действие, которое вы хотите выполнить. Для создания токена укажите **create** в этом параметре. Для редактирования токена передайте в параметре **update**, а для удаления - **delete**. |
| userId | ID нижестоящего пользователя. Параметр используется для управления ключами других пользователей. |
| h\* | Имя ключа. Состоит из 72 символов. Этот параметр должен использоваться в запросах на редактирование и удаление ключа. |
| app\* | Название приложения. |
| at\* | Время активации ключа, UNIX-time.  <br>Вы можете передать 0 в этом параметре, чтобы ключ активировался сразу после успешного выполнения запроса. |
| dur\* | Длительность действия ключа после активации, секунды.  <br>Передайте 0 в этом параметре для установки бесконечной длительности. |
| fl\* | Флаги доступа. |
| p\* | Пользовательские параметры, значение должно быть объектом или массивом объектов. |
| items | Список идентификаторов элементов, к которым предоставляет доступ ключ. |
| deleteAll | Актуально для **callMode:delete**  <br>Передайте **1** или **true** для удаления всех созданных ключей. |

Токены удаляются автоматически после 100 дней бездействия (даже с **dur:0**).

Пример объекта для параметра **p**:

"p":"{\\"paramA\\":\\"valueB\\"}"

Пример массива объектов для параметра **p**:

"p":"\[{\\"paramA\\":\\"valueB\\"},{\\"paramB\\":\\"valueD\\"}\]"

### Флаги доступа

| Значение | Описание |
| --- | --- |
| 0x100 | Слежение за объектами в реальном времени. |
| 0x200 | Доступ к просмотру большинства данных. |
| 0x400 | Изменение нечувствительных данных. |
| 0x800 | Изменение особо важных данных. |
| 0x1000 | Изменение особо важных данных, включая удаление сообщений. |
| 0x2000 | Связь с объектом (отправка команд). |
| 0xFFFFFFFF | Неограниченная работа в качестве авторизованного пользователя (позволяет управлять токенами пользователя). |

Смотрите дополнительную информацию о флагах токенов на странице [Токены](https://help.wialon.com/ru/api/user-guide/data-format/tokens).

## Ответ

В случае успешного выполнения запроса возвращается ответ следующего формата:

{  
"h":&lt;text&gt;, /\* Уникальное имя токена, 72 символа. \*/  
"app":&lt;text&gt;, /\* Название приложения. \*/  
"at":&lt;uint&gt;, /\* Время активации токена, UNIX-time. \*/  
"ct":&lt;uint&gt;, /\* Время создания токена, UNIX-time. \*/  
"dur":&lt;uint&gt;, /\* Длительность действия токена после активации, секунды. \*/  
"fl":&lt;uint&gt;, /\* Флаги доступа. \*/  
"items":\[&lt;long&gt;\], /\* Список идентификаторов элементов, к которым предоставляет доступ токен. \*/  
"p":&lt;text&gt; /\* Произвольные параметры. Значение должно быть объектом или массивом объектов. \*/  
}

В случае неудачного выполнения запроса возвращается код ошибки.

### Коды ошибок

<div class="joplin-table-wrapper"><table><thead><tr><th><p>Код ошибки</p></th><th><p>Описание</p></th></tr></thead><tbody><tr><td><p>4</p></td><td><p>Неверные входные параметры.</p></td></tr><tr><td><p>1003</p></td><td><p>Достигнут лимит запросов.</p></td></tr><tr><td><p>7</p></td><td><p>Одна из следующих ошибок:</p><ul><li>Неверный токен.</li><li>Токен пользователя не найден.</li><li>Не удалось удалить токен.</li><li>Отсутствует право доступа ADF_ACL_USER_OPERATE_AS на пользователя.</li></ul></td></tr></tbody></table></div>