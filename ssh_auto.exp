#!/usr/bin/expect -f

set timeout 30
set server "194.87.143.169"
set username "root"
set password "g-t+XM#3an2YJM"

# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
spawn ssh -o StrictHostKeyChecking=no $username@$server

# –û–∂–∏–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å –ø–∞—Ä–æ–ª—è
expect {
    "password:" {
        send "$password\r"
        exp_continue
    }
    "Password:" {
        send "$password\r"
        exp_continue
    }
    "# " {
        # –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        send "echo 'üöÄ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! –ù–∞—á–∏–Ω–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É...'\r"
        expect "# "
        
        send "pwd\r"
        expect "# "
        
        send "systemctl status axenta-backend 2>/dev/null || echo '–°–µ—Ä–≤–∏—Å axenta-backend –Ω–µ –Ω–∞–π–¥–µ–Ω'\r"
        expect "# "
        
        send "find /opt -name '*axenta*' -type d 2>/dev/null || echo '–ü–∞–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ /opt'\r"
        expect "# "
        
        send "find /var/www -name '*axenta*' -type d 2>/dev/null || echo '–ü–∞–ø–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ /var/www'\r"
        expect "# "
        
        send "find /home -name '*backend*' -type d 2>/dev/null | head -5 || echo 'Backend –ø–∞–ø–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'\r"
        expect "# "
        
        send "ps aux | grep -i 'go\\|axenta\\|backend' | grep -v grep || echo 'Go/Backend –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'\r"
        expect "# "
        
        send "netstat -tlnp | grep :8080 || echo '–ü–æ—Ä—Ç 8080 –Ω–µ –∑–∞–Ω—è—Ç'\r"
        expect "# "
        
        send "ls -la /etc/systemd/system/ | grep -i axenta || echo 'Systemd —Å–µ—Ä–≤–∏—Å—ã axenta –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'\r"
        expect "# "
        
        send "echo '‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞'\r"
        expect "# "
        
        send "exit\r"
    }
    timeout {
        puts "Timeout –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏"
        exit 1
    }
    eof {
        puts "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ"
        exit 1
    }
}

expect eof
