<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - Axenta CRM</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f7;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .test-section {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .test-section:last-child {
            border-bottom: none;
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .test-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .input-group label {
            font-size: 14px;
            font-weight: 500;
            color: #666;
        }
        
        input, select, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background: #5a6fd8;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .results {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .results h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .user-item {
            background: white;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .user-name {
            font-weight: 500;
            color: #333;
        }
        
        .user-email {
            font-size: 12px;
            color: #666;
        }
        
        .user-role {
            font-size: 12px;
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 8px;
        }
        
        .status-active {
            background: #4caf50;
        }
        
        .status-inactive {
            background: #f44336;
        }
        
        .loading {
            text-align: center;
            color: #666;
            padding: 20px;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }
        
        .filter-status {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .filter-chip {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .clear-filters {
            background: #f44336;
            font-size: 12px;
            padding: 4px 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
            <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤–æ –≤–∫–ª–∞–¥–∫–µ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"</p>
        </div>

        <!-- –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ -->
        <div class="test-section">
            <div class="test-title">1. –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            <div class="test-controls">
                <div class="input-group">
                    <label>–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏/email/–ª–æ–≥–∏–Ω—É:</label>
                    <input type="text" id="searchInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è, email –∏–ª–∏ –ª–æ–≥–∏–Ω...">
                </div>
                <button onclick="testSearch()">üîç –ü–æ–∏—Å–∫</button>
                <button onclick="clearSearch()">‚ùå –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div class="filter-status" id="searchStatus"></div>
            <div class="results" id="searchResults">
                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:</h4>
                <div id="searchContent">–ù–∞–∂–º–∏—Ç–µ "–ü–æ–∏—Å–∫" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
            </div>
        </div>

        <!-- –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Ä–æ–ª–∏ -->
        <div class="test-section">
            <div class="test-title">2. –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Ä–æ–ª–∏</div>
            <div class="test-controls">
                <div class="input-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å:</label>
                    <select id="roleFilter">
                        <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        <option value="manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                        <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                        <option value="client">–ö–ª–∏–µ–Ω—Ç</option>
                        <option value="installer">–ú–æ–Ω—Ç–∞–∂–Ω–∏–∫</option>
                    </select>
                </div>
                <button onclick="testRoleFilter()">üé≠ –§–∏–ª—å—Ç—Ä –ø–æ —Ä–æ–ª–∏</button>
                <button onclick="clearRoleFilter()">‚ùå –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div class="filter-status" id="roleStatus"></div>
            <div class="results" id="roleResults">
                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–æ–ª–∏:</h4>
                <div id="roleContent">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å –∏ –Ω–∞–∂–º–∏—Ç–µ "–§–∏–ª—å—Ç—Ä –ø–æ —Ä–æ–ª–∏"</div>
            </div>
        </div>

        <!-- –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Å—Ç–∞—Ç—É—Å—É -->
        <div class="test-section">
            <div class="test-title">3. –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Å—Ç–∞—Ç—É—Å—É</div>
            <div class="test-controls">
                <div class="input-group">
                    <label>–°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                    <select id="statusFilter">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="true">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                        <option value="false">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                    </select>
                </div>
                <button onclick="testStatusFilter()">‚úÖ –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É</button>
                <button onclick="clearStatusFilter()">‚ùå –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div class="filter-status" id="statusStatus"></div>
            <div class="results" id="statusResults">
                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É:</h4>
                <div id="statusContent">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –∏ –Ω–∞–∂–º–∏—Ç–µ "–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É"</div>
            </div>
        </div>

        <!-- –¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ -->
        <div class="test-section">
            <div class="test-title">4. –¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞</div>
            <div class="test-controls">
                <div class="input-group">
                    <label>–ü–æ–∏—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
                    <input type="text" id="multipleSearchInput" placeholder="admin, manager, user...">
                </div>
                <button onclick="testMultipleSearch()">üë• –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫</button>
                <button onclick="clearMultipleSearch()">‚ùå –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div class="filter-status" id="multipleStatus"></div>
            <div class="results" id="multipleResults">
                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞:</h4>
                <div id="multipleContent">–í–≤–µ–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–º–µ–Ω —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é</div>
            </div>
        </div>

        <!-- –¢–µ—Å—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
        <div class="test-section">
            <div class="test-title">5. –¢–µ—Å—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤</div>
            <div class="test-controls">
                <div class="input-group">
                    <label>–ü–æ–∏—Å–∫:</label>
                    <input type="text" id="combinedSearch" placeholder="–ü–æ–∏—Å–∫...">
                </div>
                <div class="input-group">
                    <label>–†–æ–ª—å:</label>
                    <select id="combinedRole">
                        <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        <option value="manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
                        <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>–°—Ç–∞—Ç—É—Å:</label>
                    <select id="combinedStatus">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="true">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                        <option value="false">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                    </select>
                </div>
                <button onclick="testCombinedFilters()">üîó –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã</button>
                <button onclick="clearAllFilters()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
            </div>
            <div class="filter-status" id="combinedStatus"></div>
            <div class="results" id="combinedResults">
                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤:</h4>
                <div id="combinedContent">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –Ω–∞–∂–º–∏—Ç–µ "–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã"</div>
            </div>
        </div>

        <!-- –¢–µ—Å—Ç –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞ -->
        <div class="test-section">
            <div class="test-title">6. –¢–µ—Å—Ç –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞ –ø–æ–∏—Å–∫–∞ (500–º—Å)</div>
            <div class="test-controls">
                <div class="input-group">
                    <label>–ë—ã—Å—Ç—Ä—ã–π –≤–≤–æ–¥ (–¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π):</label>
                    <input type="text" id="debounceInput" placeholder="–ë—ã—Å—Ç—Ä–æ –ø–µ—á–∞—Ç–∞–π—Ç–µ –∑–¥–µ—Å—å..." oninput="testDebounce()">
                </div>
                <button onclick="clearDebounce()">‚ùå –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div class="filter-status" id="debounceStatus"></div>
            <div class="results" id="debounceResults">
                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞:</h4>
                <div id="debounceContent">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –±—ã—Å—Ç—Ä–æ - –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 500–º—Å</div>
            </div>
        </div>

        <!-- –û–±—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div class="test-section">
            <div class="test-title">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div>
            <div class="results">
                <div id="testSummary">
                    <p><strong>–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:</strong> <span id="totalTests">0</span></p>
                    <p><strong>–£—Å–ø–µ—à–Ω—ã—Ö:</strong> <span id="successTests" style="color: #2e7d32;">0</span></p>
                    <p><strong>–ù–µ—É–¥–∞—á–Ω—ã—Ö:</strong> <span id="failedTests" style="color: #c62828;">0</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let testStats = {
            total: 0,
            success: 0,
            failed: 0
        };
        
        let debounceTimer = null;
        let lastDebounceTime = 0;

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
        const API_BASE_URL = 'https://api.axenta.cloud/api';
        let authToken = null;
        let companyId = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π');
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ localStorage
            authToken = localStorage.getItem('axenta_token');
            companyId = localStorage.getItem('axenta_company');
            
            if (authToken) {
                console.log('‚úÖ –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω:', authToken.substring(0, 20) + '...');
            } else {
                console.log('‚ö†Ô∏è –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ä–µ–∂–∏–º –¥–µ–º–æ');
            }
            
            if (companyId) {
                try {
                    const companyData = JSON.parse(companyId);
                    console.log('‚úÖ –ö–æ–º–ø–∞–Ω–∏—è:', companyData.name || companyData.id);
                } catch (e) {
                    console.log('‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–∏');
                }
            }
            
            updateTestSummary();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è API –∑–∞–ø—Ä–æ—Å–∞
        async function makeApiRequest(endpoint, params = {}) {
            const url = new URL(endpoint, API_BASE_URL);
            Object.keys(params).forEach(key => {
                if (params[key] !== undefined && params[key] !== null && params[key] !== '') {
                    url.searchParams.append(key, params[key]);
                }
            });

            const headers = {
                'Content-Type': 'application/json',
            };

            if (authToken) {
                headers['Authorization'] = `Token ${authToken}`;
                headers['authorization'] = `Token ${authToken}`;
            }

            if (companyId) {
                try {
                    const companyData = JSON.parse(companyId);
                    headers['X-Tenant-ID'] = companyData.id;
                } catch (e) {
                    console.warn('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ companyId');
                }
            }

            console.log('üì° API –∑–∞–ø—Ä–æ—Å:', {
                url: url.toString(),
                headers: headers,
                params: params
            });

            try {
                const response = await fetch(url.toString(), {
                    method: 'GET',
                    headers: headers,
                });

                const data = await response.json();
                
                console.log('üì° API –æ—Ç–≤–µ—Ç:', {
                    status: response.status,
                    data: data
                });

                return {
                    success: response.ok,
                    status: response.status,
                    data: data
                };
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ API –∑–∞–ø—Ä–æ—Å–∞:', error);
                return {
                    success: false,
                    error: error.message
                };
            }
        }

        // –¢–µ—Å—Ç –ø–æ–∏—Å–∫–∞
        async function testSearch() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) {
                showResult('searchResults', '–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å', 'error');
                return;
            }

            showResult('searchResults', '–ó–∞–≥—Ä—É–∑–∫–∞...', 'loading');
            updateFilterStatus('searchStatus', `üîç –ü–æ–∏—Å–∫: "${searchTerm}"`);

            const result = await makeApiRequest('/users/', {
                page: 1,
                limit: 20,
                search: searchTerm
            });

            testStats.total++;
            
            if (result.success && result.data.status === 'success') {
                const users = result.data.data.items || [];
                displayUsers('searchContent', users, `–ù–∞–π–¥–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
                showResult('searchResults', `‚úÖ –ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ`, 'success');
                testStats.success++;
            } else {
                showResult('searchResults', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞: ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                testStats.failed++;
            }
            
            updateTestSummary();
        }

        // –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Ä–æ–ª–∏
        async function testRoleFilter() {
            const role = document.getElementById('roleFilter').value;
            if (!role) {
                showResult('roleResults', '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏', 'error');
                return;
            }

            showResult('roleResults', '–ó–∞–≥—Ä—É–∑–∫–∞...', 'loading');
            updateFilterStatus('roleStatus', `üé≠ –†–æ–ª—å: "${role}"`);

            const result = await makeApiRequest('/users/', {
                page: 1,
                limit: 20,
                role: role
            });

            testStats.total++;
            
            if (result.success && result.data.status === 'success') {
                const users = result.data.data.items || [];
                displayUsers('roleContent', users, `–ù–∞–π–¥–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é "${role}"`);
                showResult('roleResults', `‚úÖ –§–∏–ª—å—Ç—Ä –ø–æ —Ä–æ–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ`, 'success');
                testStats.success++;
            } else {
                showResult('roleResults', `‚ùå –û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                testStats.failed++;
            }
            
            updateTestSummary();
        }

        // –¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —Å—Ç–∞—Ç—É—Å—É
        async function testStatusFilter() {
            const status = document.getElementById('statusFilter').value;
            if (status === '') {
                showResult('statusResults', '–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏', 'error');
                return;
            }

            showResult('statusResults', '–ó–∞–≥—Ä—É–∑–∫–∞...', 'loading');
            updateFilterStatus('statusStatus', `‚úÖ –°—Ç–∞—Ç—É—Å: "${status === 'true' ? '–ê–∫—Ç–∏–≤–Ω—ã–µ' : '–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ'}"`);

            const result = await makeApiRequest('/users/', {
                page: 1,
                limit: 20,
                active: status
            });

            testStats.total++;
            
            if (result.success && result.data.status === 'success') {
                const users = result.data.data.items || [];
                displayUsers('statusContent', users, `–ù–∞–π–¥–µ–Ω–æ ${users.length} ${status === 'true' ? '–∞–∫—Ç–∏–≤–Ω—ã—Ö' : '–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö'} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
                showResult('statusResults', `‚úÖ –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ`, 'success');
                testStats.success++;
            } else {
                showResult('statusResults', `‚ùå –û—à–∏–±–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏: ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                testStats.failed++;
            }
            
            updateTestSummary();
        }

        // –¢–µ—Å—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
        async function testMultipleSearch() {
            const searchTerms = document.getElementById('multipleSearchInput').value.trim();
            if (!searchTerms) {
                showResult('multipleResults', '–í–≤–µ–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–º–µ–Ω —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é', 'error');
                return;
            }

            showResult('multipleResults', '–ó–∞–≥—Ä—É–∑–∫–∞...', 'loading');
            updateFilterStatus('multipleStatus', `üë• –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫: "${searchTerms}"`);

            const result = await makeApiRequest('/users/', {
                page: 1,
                limit: 20,
                search: searchTerms
            });

            testStats.total++;
            
            if (result.success && result.data.status === 'success') {
                const users = result.data.data.items || [];
                const terms = searchTerms.split(',').map(t => t.trim());
                displayUsers('multipleContent', users, `–ù–∞–π–¥–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∑–∞–ø—Ä–æ—Å—É: ${terms.join(', ')}`);
                showResult('multipleResults', `‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ`, 'success');
                testStats.success++;
            } else {
                showResult('multipleResults', `‚ùå –û—à–∏–±–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞: ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                testStats.failed++;
            }
            
            updateTestSummary();
        }

        // –¢–µ—Å—Ç –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        async function testCombinedFilters() {
            const search = document.getElementById('combinedSearch').value.trim();
            const role = document.getElementById('combinedRole').value;
            const status = document.getElementById('combinedStatus').value;

            const filters = [];
            if (search) filters.push(`–ø–æ–∏—Å–∫: "${search}"`);
            if (role) filters.push(`—Ä–æ–ª—å: "${role}"`);
            if (status) filters.push(`—Å—Ç–∞—Ç—É—Å: "${status === 'true' ? '–∞–∫—Ç–∏–≤–Ω—ã–µ' : '–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ'}"`);

            if (filters.length === 0) {
                showResult('combinedResults', '–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ñ–∏–ª—å—Ç—Ä', 'error');
                return;
            }

            showResult('combinedResults', '–ó–∞–≥—Ä—É–∑–∫–∞...', 'loading');
            updateFilterStatus('combinedStatus', `üîó –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã: ${filters.join(', ')}`);

            const params = {
                page: 1,
                limit: 20
            };

            if (search) params.search = search;
            if (role) params.role = role;
            if (status) params.active = status;

            const result = await makeApiRequest('/users/', params);

            testStats.total++;
            
            if (result.success && result.data.status === 'success') {
                const users = result.data.data.items || [];
                displayUsers('combinedContent', users, `–ù–∞–π–¥–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏`);
                showResult('combinedResults', `‚úÖ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ`, 'success');
                testStats.success++;
            } else {
                showResult('combinedResults', `‚ùå –û—à–∏–±–∫–∞ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤: ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                testStats.failed++;
            }
            
            updateTestSummary();
        }

        // –¢–µ—Å—Ç –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞
        function testDebounce() {
            const input = document.getElementById('debounceInput');
            const value = input.value.trim();
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä
            if (debounceTimer) {
                clearTimeout(debounceTimer);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            updateFilterStatus('debounceStatus', `‚è±Ô∏è –î–µ–±–∞—É–Ω—Å–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω... (–≤–≤–æ–¥: "${value}")`);
            showResult('debounceResults', '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–≤–æ–¥–∞ (500–º—Å)...', 'loading');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Ç–∞–π–º–µ—Ä
            debounceTimer = setTimeout(async () => {
                if (value) {
                    console.log('üöÄ –î–µ–±–∞—É–Ω—Å–∏–Ω–≥: –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–∏—Å–∫ –¥–ª—è:', value);
                    updateFilterStatus('debounceStatus', `‚úÖ –ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω: "${value}"`);
                    
                    const result = await makeApiRequest('/users/', {
                        page: 1,
                        limit: 20,
                        search: value
                    });

                    testStats.total++;
                    
                    if (result.success && result.data.status === 'success') {
                        const users = result.data.data.items || [];
                        displayUsers('debounceContent', users, `–ù–∞–π–¥–µ–Ω–æ ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–¥–µ–±–∞—É–Ω—Å–∏–Ω–≥ 500–º—Å)`);
                        showResult('debounceResults', `‚úÖ –î–µ–±–∞—É–Ω—Å–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ`, 'success');
                        testStats.success++;
                    } else {
                        showResult('debounceResults', `‚ùå –û—à–∏–±–∫–∞ –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞: ${result.error || result.data?.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`, 'error');
                        testStats.failed++;
                    }
                    
                    updateTestSummary();
                } else {
                    updateFilterStatus('debounceStatus', '‚ùå –ü—É—Å—Ç–æ–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å');
                    showResult('debounceResults', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞', 'error');
                }
            }, 500); // 500–º—Å –∑–∞–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º –∫–æ–¥–µ
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function displayUsers(containerId, users, summary) {
            const container = document.getElementById(containerId);
            
            if (users.length === 0) {
                container.innerHTML = `<p style="color: #666; text-align: center; padding: 20px;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>`;
                return;
            }

            let html = `<p style="margin-bottom: 15px; font-weight: 500;">${summary}</p>`;
            
            users.forEach(user => {
                const statusClass = user.is_active ? 'status-active' : 'status-inactive';
                const statusText = user.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω';
                
                html += `
                    <div class="user-item">
                        <div class="user-info">
                            <div class="user-name">${user.username || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</div>
                            <div class="user-email">${user.email || '–ë–µ–∑ email'}</div>
                            <div class="user-role">${user.role?.display_name || '–ë–µ–∑ —Ä–æ–ª–∏'}</div>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <span style="font-size: 12px; color: #666;">${statusText}</span>
                            <div class="status-indicator ${statusClass}"></div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function showResult(containerId, message, type) {
            const container = document.getElementById(containerId);
            const resultDiv = container.querySelector('h4').nextElementSibling;
            
            if (type === 'loading') {
                resultDiv.innerHTML = `<div class="loading">${message}</div>`;
            } else if (type === 'error') {
                resultDiv.innerHTML = `<div class="error">${message}</div>`;
            } else if (type === 'success') {
                resultDiv.innerHTML = `<div class="success">${message}</div>`;
            } else {
                resultDiv.innerHTML = message;
            }
        }

        function updateFilterStatus(containerId, text) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<span class="filter-chip">${text}</span>`;
        }

        function updateTestSummary() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('successTests').textContent = testStats.success;
            document.getElementById('failedTests').textContent = testStats.failed;
        }

        // –§—É–Ω–∫—Ü–∏–∏ –æ—á–∏—Å—Ç–∫–∏
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchStatus').innerHTML = '';
            showResult('searchResults', '–ü–æ–∏—Å–∫ –æ—á–∏—â–µ–Ω', 'success');
        }

        function clearRoleFilter() {
            document.getElementById('roleFilter').value = '';
            document.getElementById('roleStatus').innerHTML = '';
            showResult('roleResults', '–§–∏–ª—å—Ç—Ä –ø–æ —Ä–æ–ª–∏ –æ—á–∏—â–µ–Ω', 'success');
        }

        function clearStatusFilter() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('statusStatus').innerHTML = '';
            showResult('statusResults', '–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –æ—á–∏—â–µ–Ω', 'success');
        }

        function clearMultipleSearch() {
            document.getElementById('multipleSearchInput').value = '';
            document.getElementById('multipleStatus').innerHTML = '';
            showResult('multipleResults', '–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –æ—á–∏—â–µ–Ω', 'success');
        }

        function clearAllFilters() {
            document.getElementById('combinedSearch').value = '';
            document.getElementById('combinedRole').value = '';
            document.getElementById('combinedStatus').value = '';
            document.getElementById('combinedStatus').innerHTML = '';
            showResult('combinedResults', '–í—Å–µ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –æ—á–∏—â–µ–Ω—ã', 'success');
        }

        function clearDebounce() {
            document.getElementById('debounceInput').value = '';
            document.getElementById('debounceStatus').innerHTML = '';
            if (debounceTimer) {
                clearTimeout(debounceTimer);
                debounceTimer = null;
            }
            showResult('debounceResults', '–î–µ–±–∞—É–Ω—Å–∏–Ω–≥ –æ—á–∏—â–µ–Ω', 'success');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
